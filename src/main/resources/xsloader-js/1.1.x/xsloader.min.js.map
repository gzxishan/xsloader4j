{"version":3,"file":"xsloader.min.js","sources":["../xsloader-src/util/global.js","../xsloader-src/core/loader.js","../xsloader-src/util/urls.js","../xsloader-src/util/base.js","../xsloader-src/util/loading.js","../xsloader-src/util/base64.js","../xsloader-src/util/index.js","../xsloader-src/public/global-deprecated.js","../xsloader-src/polyfill/json.js","../xsloader-src/polyfill/proxy.js","../xsloader-src/polyfill/index.js","../xsloader-src/public/global-base.js","../xsloader-src/public/is.js","../xsloader-src/public/funs.js","../xsloader-src/public/browser.js","../xsloader-src/public/index.js","../xsloader-src/core/module-def.js","../xsloader-src/core/module.js","../xsloader-src/core/script.js","../xsloader-src/core/index.js","../xsloader-src/define.js","../xsloader-src/core/plugins/inner-dep.js","../xsloader-src/core/plugins/ready.js","../xsloader-src/core/plugins/try.js","../xsloader-src/core/plugins/nodeps.js","../xsloader-src/core/plugins/exists.js","../xsloader-src/core/plugins/name.js","../xsloader-src/core/plugins/css.js","../xsloader-src/core/plugins/text.js","../xsloader-src/core/plugins/window.js","../xsloader-src/core/plugins/withdeps.js","../xsloader-src/core/plugins/json.js","../xsloader-src/core/plugins/xshttp.js","../xsloader-src/core/plugins/request.js","../xsloader-src/core/plugins/xsmsg.js","../xsloader-src/core/plugins/image.js","../xsloader-src/core/plugins/default.js","../xsloader-src/core/plugins/xsloader4j-server-bridge.js","../xsloader-src/service.js","../xsloader-src/main.js"],"sourcesContent":["let g;\r\nif(typeof window !== undefined) {\r\n\tg = window;\r\n} else if(typeof self !== undefined) {\r\n\tg = self;\r\n} else if(typeof global !== undefined) {\r\n\tg = global;\r\n} else {\r\n\tthrow new Error(\"not found global var!\");\r\n}\r\n\r\n/**\r\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\r\n * @param {Object} val\r\n */\r\nfunction InVar(val) {\r\n\tthis.get = function() {\r\n\t\treturn val;\r\n\t};\r\n\r\n\tthis.set = function(newVal) {\r\n\t\tlet old = val;\r\n\t\tval = newVal;\r\n\t\treturn old;\r\n\t};\r\n}\r\ng.InVar = InVar;\r\n\r\nexport default g;","import global from '../util/global.js';\r\nlet loaderFun;\r\nlet xsloader = global.xsloader = function() {\r\n\treturn loaderFun.apply(this, arguments);\r\n};\r\n\r\nexport default {\r\n\tloaderFun: (fun) => {\r\n\t\tloaderFun = fun;\r\n\t}\r\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\r\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\r\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\r\n\r\nimport global from './global.js';\r\nconst xsloader = global.xsloader;\r\n\r\nfunction isJsFile(path) {\r\n\tif(!xsloader.isString(path) || path.indexOf(\".\") == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\tpath = path.substring(0, pluginIndex);\r\n\t}\r\n\tvar index = path.indexOf(\"?\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tindex = path.indexOf(\"#\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tlet theConfig = xsloader.config();\r\n\r\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\r\n\tfor(var i = 0; i < jsExts.length; i++) {\r\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\r\n\t\t\treturn {\r\n\t\t\t\text: jsExts[i],\r\n\t\t\t\tpath: path\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction dealPathMayAbsolute(path, currentUrl) {\r\n\tcurrentUrl = currentUrl || location.href;\r\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\r\n\r\n\tlet finalPath;\r\n\tlet absolute;\r\n\tif(rs) {\r\n\t\tlet protocol = rs[1];\r\n\t\tabsolute = true;\r\n\r\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\r\n\t\tlet _protocol = rs && rs[1] || location.protocol;\r\n\t\tlet _host = rs && rs[2] || location.host;\r\n\r\n\t\tif(protocol == \"//\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + path;\r\n\t\t} else if(protocol == \"/\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\r\n\t\t} else {\r\n\t\t\tfinalPath = path;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tabsolute = false;\r\n\t\tfinalPath = path;\r\n\t}\r\n\treturn {\r\n\t\tabsolute: absolute,\r\n\t\tpath: finalPath\r\n\t};\r\n}\r\n\r\nfunction getPathWithRelative(path, relative, isPathDir) {\r\n\r\n\tlet relativeQuery = \"\";\r\n\tlet qIndex = path.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\tpath = path.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = path.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\tpath = path.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tqIndex = relative.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\trelativeQuery = relative.substring(qIndex);\r\n\t\trelative = relative.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = relative.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\trelativeQuery = relative.substring(qIndex);\r\n\t\t\trelative = relative.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tlet absolute = dealPathMayAbsolute(relative);\r\n\tif(absolute.absolute) {\r\n\t\treturn absolute.path + relativeQuery;\r\n\t}\r\n\r\n\tif(isPathDir === undefined) {\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tif(index == path.length - 1) {\r\n\t\t\tisPathDir = true;\r\n\t\t} else {\r\n\t\t\tif(index == -1) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\r\n\t\t}\r\n\t}\r\n\r\n\tif(xsloader.endsWith(path, \"/\")) {\r\n\t\tpath = path.substring(0, path.length - 1);\r\n\t}\r\n\r\n\tlet isRelativeDir = false;\r\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\r\n\t\trelative = relative.substring(0, relative.length - 1);\r\n\t\tisRelativeDir = true;\r\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\r\n\t\tisRelativeDir = true;\r\n\t}\r\n\r\n\tlet prefix = \"\";\r\n\tlet index = -1;\r\n\tlet absolute2 = dealPathMayAbsolute(path);\r\n\tif(absolute2.absolute) {\r\n\t\tpath = absolute2.path;\r\n\t\tlet index2 = path.indexOf(\"//\");\r\n\t\tindex = path.indexOf(\"/\", index2 + 2);\r\n\t\tif(index == -1) {\r\n\t\t\tindex = path.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprefix = path.substring(0, index + 1);\r\n\tpath = path.substring(index + 1);\r\n\r\n\tlet stack = path.split(\"/\");\r\n\tif(!isPathDir && stack.length > 0) {\r\n\t\tstack.pop();\r\n\t}\r\n\tlet relatives = relative.split(\"/\");\r\n\tfor(let i = 0; i < relatives.length; i++) {\r\n\t\tlet str = relatives[i];\r\n\t\tif(\"..\" == str) {\r\n\t\t\tif(stack.length == 0) {\r\n\t\t\t\t\r\n\t\t\t\tthrow new Error(\"no more upper path:path=\"+arguments[0]+\",relative=\"+arguments[1]);\r\n\t\t\t}\r\n\t\t\tstack.pop();\r\n\t\t} else if(\".\" != str) {\r\n\t\t\tstack.push(str);\r\n\t\t}\r\n\t}\r\n//\tif(stack.length == 0) {\r\n//\t\treturn \"\";\r\n//\t}\r\n\tlet result = prefix + stack.join(\"/\");\r\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\r\n\t\tresult += \"/\";\r\n\t}\r\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\r\n\treturn result;\r\n}\r\n\r\nfunction getNodeAbsolutePath(node) {\r\n\tlet src = node.src || node.getAttribute(\"src\");\r\n\treturn getPathWithRelative(location.href, src);\r\n}\r\n\r\n//去掉url的query参数和#参数\r\nfunction removeQueryHash(url) {\r\n\tif(url) {\r\n\t\tlet index = url.indexOf(\"?\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\r\n\t\tindex = url.indexOf(\"#\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\r\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\r\n\r\nfunction propertiesDeal(configObject, properties) {\r\n\tif(!properties) {\r\n\t\treturn configObject;\r\n\t}\r\n\r\n\tfunction replaceStringProperties(string, properties, property) {\r\n\t\tlet rs;\r\n\t\tlet str = string;\r\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\r\n\t\tif(rs) {\r\n\t\t\tlet propKey = rs[1];\r\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\r\n\t\t\tif(propValue === undefined) {\r\n\t\t\t\treturn str;\r\n\t\t\t} else {\r\n\t\t\t\treturn propValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet result = \"\";\r\n\t\twhile(true) {\r\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\r\n\t\t\tif(!rs) {\r\n\t\t\t\tresult += str;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tlet propKey = rs[1];\r\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\r\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\r\n\t\t\t\t} else if(property) {\r\n\t\t\t\t\tproperty.has = true;\r\n\t\t\t\t}\r\n\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\r\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//处理属性引用\r\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\r\n\t\tif(!obj) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\tif(xsloader.isFunction(obj)) {\r\n\t\t\treturn obj;\r\n\t\t} else if(xsloader.isArray(obj)) {\r\n\t\t\tfor(let i = 0; i < obj.length; i++) {\r\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\r\n\t\t\t}\r\n\t\t} else if(xsloader.isString(obj)) {\r\n\t\t\tobj = replaceStringProperties(obj, properties, property);\r\n\t\t} else if(xsloader.isObject(obj)) {\r\n\t\t\tif(property) {\r\n\t\t\t\tproperty.has = false;\r\n\t\t\t}\r\n\t\t\tlet replaceKeyMap = {};\r\n\t\t\tfor(let x in obj) {\r\n\t\t\t\tif(property) {\r\n\t\t\t\t\tproperty.propertyKey = x;\r\n\t\t\t\t}\r\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\r\n\t\t\t\tif(enableKeyAttr) {\r\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\r\n\t\t\t\t\tif(_x !== x) {\r\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let x in replaceKeyMap) {\r\n\t\t\t\tlet objx = obj[x];\r\n\t\t\t\tdelete obj[x];\r\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\r\n\t}\r\n\r\n\tif(!properties.__dealt__) {\r\n\t\tlet property = {\r\n\t\t\thas: false\r\n\t\t};\r\n\r\n\t\tfor(let x in properties) {\r\n\t\t\tlet fun = properties[x];\r\n\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\tproperties[x] = fun.call(properties);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo {\r\n\t\t\treplaceProperties(properties, property);\r\n\t\t} while (property.has);\r\n\t\tproperties.__dealt__ = true;\r\n\t}\r\n\r\n\treturn replaceProperties(configObject, undefined, true);\r\n}\r\n\r\nfunction replaceModulePrefix(config, deps) {\r\n\r\n\tif(!deps||deps.length==0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet m = deps[i];\r\n\t\tif(typeof m == \"string\") {\r\n\t\t\tlet index = m.indexOf(\"!\");\r\n\t\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tindex = m.indexOf(\"?\");\r\n\t\t\tlet query = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tlet is = isJsFile(m);\r\n\t\t\tif(!is && !/\\.[^\\/\\s]*$/.test(m) && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\r\n\t\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(config.modulePrefixCount) {\r\n\t\t//模块地址的前缀替换\r\n\t\tfor(let prefix in config.modulePrefix) {\r\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\r\n\t\t\tlet len = prefix.length;\r\n\t\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t\tlet m = deps[i];\r\n\t\t\t\tif(typeof m == \"string\") {\r\n\t\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\r\n\t\t\t\t\tlet pluginName = null;\r\n\t\t\t\t\tif(pluginIndex >= 0) {\r\n\t\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\r\n\t\t\t\t\t\tm = m.substring(pluginIndex + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(xsloader.startsWith(m, prefix)) {\r\n\t\t\t\t\t\tlet dep = replaceStr + m.substring(len);\r\n\t\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getScriptBySubname(subname) {\r\n\tlet ss = document.getElementsByTagName('script');\r\n\tif(subname) {\r\n\t\tfor(let i = 0; i < ss.length; i++) {\r\n\t\t\tlet script = ss[i];\r\n\t\t\tlet src = script.src;\r\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\r\n\t\t\tif(src.indexOf(subname) >= 0) {\r\n\t\t\t\treturn script;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn ss;\r\n\t}\r\n}\r\n\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = removeQueryHash(url);\r\n\treturn url;\r\n})();\r\n\r\nexport default {\r\n\tgetPathWithRelative,\r\n\tgetNodeAbsolutePath,\r\n\tdealPathMayAbsolute,\r\n\tremoveQueryHash,\r\n\tpropertiesDeal,\r\n\treplaceModulePrefix,\r\n\tisJsFile,\r\n\tgetScriptBySubname,\r\n\tthePageUrl,\r\n};","import global from './global.js';\r\nconst xsloader = global.xsloader;\r\nconst COMMENT_REGEXP = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst REPLACE_REQUIRE_GET_REGEXP = /(^|[\\s\\(\\),;.\\?:]+)require\\s*\\.\\s*get\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\nconst REPLACE_REQUIRE_REGEXP = /(^|[\\s\\(\\),;.\\?:]+)require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\nconst NOT_REQUIRE_REGEXP = /\\.\\s*$/;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif(!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif(!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif(!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif(paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor(let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor(let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif(!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif(pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif(!obj || xsloader.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor(let x in obj) {\r\n\t\tif(xsloader.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func(item,index,array)\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif(ary) {\r\n\t\tif(isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif(rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif(fromEnd) {\r\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n\r\nfunction __appendInnerDeps(deps, callbackString, reg, depIndex, notIndex) {\r\n\tcallbackString.replace(reg, function() {\r\n\t\tlet dep = arguments[depIndex]\r\n\t\tif((!notIndex || !NOT_REQUIRE_REGEXP.test(arguments[notIndex])) && xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\tdeps.push(dep);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//添加内部直接require.get('...')或require('...')的模块\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif(xsloader.isFunction(callback)) {\r\n\t\tlet theConfig = xsloader.config();\r\n\t\tlet innerDepType = !theConfig ? \"disable\" : theConfig.props.innerDepType;\r\n\t\tif(innerDepType != \"disable\") {\r\n\r\n\t\t\tconst callbackString = callback\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(COMMENT_REGEXP, __commentReplace);\r\n\r\n\t\t\tif(innerDepType == \"auto\") {\r\n\t\t\t\tif(callbackString.indexOf(\"__webpack_require__\") >= 0) {\r\n\t\t\t\t\tinnerDepType = \"disable\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(innerDepType == \"auto\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2, 1);\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2, 1);\r\n\t\t\t} else if(innerDepType == \"require\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2, 1);\r\n\t\t\t} else if(innerDepType == \"require.get\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2, 1);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker, extra) {\r\n\t\tthis.err = err;\r\n\t\tthis.invoker = invoker;\r\n\t\tthis.extra = extra;\r\n\t}\r\n}\r\n\r\nfunction unwrapError(err) {\r\n\tif(err) {\r\n\t\tlet n = 0;\r\n\t\twhile(err instanceof PluginError && n++ < 100) {\r\n\t\t\terr = err.err;\r\n\t\t}\r\n\t}\r\n\treturn err;\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif(isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if(isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if(isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tunwrapError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n};","//顶部加载条功能\r\n/*\r\n ** ToProgress v0.1.1\r\n ** http://github.com/djyde/ToProgress\r\n */\r\n\r\n// Animation Detection\r\nfunction whichTransitionEvent() {\r\n\tlet t,\r\n\t\tel = document.createElement(\"fakeelement\");\r\n\r\n\tlet transitions = {\r\n\t\t\"transition\": \"transitionend\",\r\n\t\t\"OTransition\": \"oTransitionEnd\",\r\n\t\t\"MozTransition\": \"transitionend\",\r\n\t\t\"WebkitTransition\": \"webkitTransitionEnd\"\r\n\t};\r\n\r\n\tfor(t in transitions) {\r\n\t\tif(el.style[t] !== undefined) {\r\n\t\t\treturn transitions[t];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet transitionEvent = whichTransitionEvent();\r\n\r\nconst ToProgress = function(opt) {\r\n\t// Attributes\r\n\tthis.progress = 0;\r\n\tthis.options = {\r\n\t\tid: 'xsloader-top-progress-bar',\r\n\t\tcolor: '#F44336',\r\n\t\tbgColor:undefined,\r\n\t\theight: 2,\r\n\t\tduration: 0.2\r\n\t};\r\n\tif(opt && typeof opt === 'object') {\r\n\t\tfor(let key in opt) {\r\n\t\t\tthis.options[key] = opt[key];\r\n\t\t}\r\n\t}\r\n\tthis.options.opacityDuration = 0; //this.options.duration * 3;\r\n\tthis.progressBar = document.createElement('div');\r\n\tthis.container = document.createElement('div');\r\n\tthis.container.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\tthis.container.id = this.options.id;\r\n\r\n\tthis.progressBar.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\r\n\tthis.container.setCSS({\r\n\t\t\"position\": \"fixed\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"height\": (this.options.height + 1) + \"px\",\r\n\t\t\"width\": \"100%\",\r\n\t\t\"opacity\": \"1\",\r\n\t\t'z-index': '9999999999',\r\n\t\t'background-color': this.options.bgColor,\r\n\t});\r\n\r\n\tthis.progressBar.setCSS({\r\n\t\t\"position\": \"absolute\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"background-color\": this.options.color,\r\n\t\t\"height\": this.options.height + \"px\",\r\n\t\t\"width\": \"0%\",\r\n\t\t\"transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-moz-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-webkit-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\"\r\n\t});\r\n\tthis.container.appendChild(this.progressBar);\r\n\tdocument.body.appendChild(this.container);\r\n};\r\n\r\n////////////////////////////////////\r\nToProgress.prototype.setColor = function(color) {\r\n\tthis.progressBar.style.backgroundColor = color;\r\n};\r\n\r\nToProgress.prototype._isAuto = false;\r\nToProgress.prototype._timer = null;\r\n\r\nToProgress.prototype.stopAuto = function() {\r\n\tthis._isAuto = false;\r\n\tif(this._timer) {\r\n\t\tclearInterval(this._timer);\r\n\t\tthis._timer = null;\r\n\t}\r\n};\r\n\r\nToProgress.prototype.autoIncrement = function(time = 100) {\r\n\tthis.stopAuto();\r\n\tthis._isAuto = true;\r\n\tlet dt = time < 100 ? 100 : time;\r\n\r\n\tlet k = 100; //\r\n\tlet step = 0.05;\r\n\tlet x = 1 - step / 2;\r\n\tthis._timer = setInterval(() => {\r\n\t\tx += step;\r\n\t\tthis.setProgress(100 - k / x);\r\n\t}, dt);\r\n};\r\n\r\nToProgress.prototype.toError = function(errColor) {\r\n\tthis.setProgress(this.progress < 60 ? 60 : this.progress);\r\n\tthis.setColor(errColor);\r\n\tthis.stopAuto();\r\n};\r\n\r\n///////////////////////////////////\r\n\r\nToProgress.prototype.transit = function() {\r\n\tthis.progressBar.style.width = this.progress + '%';\r\n};\r\n\r\nToProgress.prototype.getProgress = function() {\r\n\treturn this.progress;\r\n};\r\n\r\nToProgress.prototype.setProgress = function(progress, callback) {\r\n\tthis.show();\r\n\tif(progress > 100) {\r\n\t\tthis.progress = 100;\r\n\t} else if(progress < 0) {\r\n\t\tthis.progress = 0;\r\n\t} else {\r\n\t\tthis.progress = progress;\r\n\t}\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.increase = function(toBeIncreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress + toBeIncreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.decrease = function(toBeDecreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress - toBeDecreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.finish = function(callback) {\r\n\tthis.setProgress(100, callback);\r\n\tsetTimeout(() => {\r\n\t\tthis.hide();\r\n//\t\tlet fun;\r\n//\t\tfun = (e) => {\r\n//\t\t\tthis.reset();\r\n//\t\t\tthis.progressBar.removeEventListener(e.type, fun);\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t};\r\n//\t\ttransitionEvent && this.progressBar.addEventListener(transitionEvent, fun);\r\n//\t\tif(!transitionEvent) {\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t}\r\n\t\tthis.container.parentNode.removeChild(this.container);\r\n\t}, 500);\r\n};\r\n\r\nToProgress.prototype.reset = function(callback) {\r\n\tthis.progress = 0;\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.hide = function() {\r\n\tthis.progressBar.style.opacity = '0';\r\n\tthis.container.style.display = 'none';\r\n};\r\n\r\nToProgress.prototype.show = function() {\r\n\tthis.progressBar.style.opacity = '1';\r\n\tthis.container.style.display = 'block';\r\n};\r\n\r\nexport default {\r\n\tToProgress\r\n};","function Base64() {\r\n\r\n\t// private property\r\n\tlet _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n\t// public method for encoding\r\n\tthis.encode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = _utf8_encode(input);\r\n\t\twhile(i < input.length) {\r\n\t\t\tchr1 = input.charCodeAt(i++);\r\n\t\t\tchr2 = input.charCodeAt(i++);\r\n\t\t\tchr3 = input.charCodeAt(i++);\r\n\t\t\tenc1 = chr1 >> 2;\r\n\t\t\tenc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\t\tenc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\t\tenc4 = chr3 & 63;\r\n\t\t\tif(isNaN(chr2)) {\r\n\t\t\t\tenc3 = enc4 = 64;\r\n\t\t\t} else if(isNaN(chr3)) {\r\n\t\t\t\tenc4 = 64;\r\n\t\t\t}\r\n\t\t\toutput = output +\r\n\t\t\t\t_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +\r\n\t\t\t\t_keyStr.charAt(enc3) + _keyStr.charAt(enc4);\r\n\t\t}\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// public method for decoding\r\n\tthis.decode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3;\r\n\t\tlet enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n\t\twhile(i < input.length) {\r\n\t\t\tenc1 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc2 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc3 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc4 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\r\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\r\n\t\t\toutput = output + String.fromCharCode(chr1);\r\n\t\t\tif(enc3 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr2);\r\n\t\t\t}\r\n\t\t\tif(enc4 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr3);\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput = _utf8_decode(output);\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// private method for UTF-8 encoding\r\n\tlet _utf8_encode = function(string) {\r\n\t\tstring = string.replace(/\\r\\n/g, \"\\n\");\r\n\t\tlet utftext = \"\";\r\n\t\tfor(let n = 0; n < string.length; n++) {\r\n\t\t\tlet c = string.charCodeAt(n);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tutftext += String.fromCharCode(c);\r\n\t\t\t} else if((c > 127) && (c < 2048)) {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 6) | 192);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t} else {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 12) | 224);\r\n\t\t\t\tutftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn utftext;\r\n\t};\r\n\r\n\t// private method for UTF-8 decoding\r\n\tlet _utf8_decode = function(utftext) {\r\n\t\tlet string = \"\";\r\n\t\tlet i = 0;\r\n\t\tlet c=0, c2=0, c3=0;\r\n\t\t\r\n\t\twhile(i < utftext.length) {\r\n\t\t\tc = utftext.charCodeAt(i);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tstring += String.fromCharCode(c);\r\n\t\t\t\ti++;\r\n\t\t\t} else if((c > 191) && (c < 224)) {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tstring += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n\t\t\t\ti += 2;\r\n\t\t\t} else {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tc3 = utftext.charCodeAt(i + 2);\r\n\t\t\t\tstring += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n\t\t\t\ti += 3;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn string;\r\n\t};\r\n}\r\n\r\nexport default Base64;","import urls from './urls.js';\r\nimport global from './global.js';\r\nimport base from './base.js';\r\nimport loading from './loading.js';\r\nimport base64 from './base64.js';\r\n\r\nexport default {\r\n\t...urls,\r\n\tglobal,\r\n\t...base,\r\n\t...loading,\r\n\tbase64,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//ie9\r\ntry {\r\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\r\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\r\n\t\t\tlet thiz = Function.prototype.bind;\r\n\t\t\tconsole[method] = thiz.call(console[method], console);\r\n\t\t});\r\n\t}\r\n} catch(e) {\r\n\tglobal.console = {\r\n\t\tlog: function() {},\r\n\t\terror: function() {},\r\n\t\twarn: function() {}\r\n\t};\r\n}\r\n\r\ntry {\r\n\r\n\tif(!Array.prototype.indexOf) {\r\n\t\tArray.prototype.indexOf = function(elem, offset) {\r\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\r\n\t\t\t\tif(this[i] == elem) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\t}\r\n\r\n\tif(!Array.pushAll) {\r\n\t\tArray.pushAll = function(thiz, arr) {\r\n\t\t\tif(!xsloader.isArray(arr)) {\r\n\t\t\t\tthrow new Error(\"not array:\" + arr);\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < arr.length; i++) {\r\n\t\t\t\tthiz.push(arr[i]);\r\n\t\t\t}\r\n\t\t\treturn thiz;\r\n\t\t};\r\n\t}\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}\r\n\r\nfunction startsWith(str, starts) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\treturn str.indexOf(starts) == 0;\r\n}\r\n\r\nfunction endsWith(str, ends) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\tlet index = str.lastIndexOf(ends);\r\n\tif(index >= 0 && (str.length - ends.length == index)) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction _indexInArray(array, ele, offset = 0, compare) {\r\n\tlet index = -1;\r\n\tif(array) {\r\n\t\tfor(let i = offset || 0; i < array.length; i++) {\r\n\t\t\tif(compare) {\r\n\t\t\t\tif(compare(array[i], ele, i, array)) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(array[i] == ele) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\treturn index;\r\n}\r\n\r\nfunction indexInArray(array, ele, compare) {\r\n\treturn _indexInArray(array, ele, 0, compare);\r\n}\r\n\r\nfunction indexInArrayFrom(array, ele, offset, compare) {\r\n\treturn _indexInArray(array, ele, offset, compare);\r\n}\r\n\r\nexport default {\r\n\tstartsWith,\r\n\tendsWith,\r\n\tindexInArray,\r\n\tindexInArrayFrom\r\n};","//https://github.com/douglascrockford/JSON-js\r\n//  json2.js\r\n//  2017-06-12\r\n//  Public Domain.\r\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\r\n\r\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\r\n//  NOT CONTROL.\r\nconst JSON = {};\r\n\r\nexport default JSON;\r\n\r\nlet rx_one = /^[\\],:{}\\s]*$/;\r\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\r\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\r\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\r\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\n\r\nfunction f(n) {\r\n\t// Format integers to have at least two digits.\r\n\treturn(n < 10) ?\r\n\t\t\"0\" + n :\r\n\t\tn;\r\n}\r\n\r\nfunction this_value() {\r\n\treturn this.valueOf();\r\n}\r\n\r\nif(typeof Date.prototype.toJSON !== \"function\") {\r\n\r\n\tDate.prototype.toJSON = function() {\r\n\t\treturn isFinite(this.valueOf()) ?\r\n\t\t\t(\r\n\t\t\t\tthis.getUTCFullYear() +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCMonth() + 1) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCDate()) +\r\n\t\t\t\t\"T\" +\r\n\t\t\t\tf(this.getUTCHours()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCMinutes()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCSeconds()) +\r\n\t\t\t\t\"Z\"\r\n\t\t\t) :\r\n\t\t\tnull;\r\n\t};\r\n\r\n\tBoolean.prototype.toJSON = this_value;\r\n\tNumber.prototype.toJSON = this_value;\r\n\tString.prototype.toJSON = this_value;\r\n}\r\n\r\nlet gap;\r\nlet indent;\r\nlet meta;\r\nlet rep;\r\n\r\nfunction quote(string) {\r\n\r\n\t// If the string contains no control characters, no quote characters, and no\r\n\t// backslash characters, then we can safely slap some quotes around it.\r\n\t// Otherwise we must also replace the offending characters with safe escape\r\n\t// sequences.\r\n\r\n\trx_escapable.lastIndex = 0;\r\n\treturn rx_escapable.test(string) ?\r\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\r\n\t\t\tlet c = meta[a];\r\n\t\t\treturn typeof c === \"string\" ?\r\n\t\t\t\tc :\r\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\r\n\t\t}) + \"\\\"\" :\r\n\t\t\"\\\"\" + string + \"\\\"\";\r\n}\r\n\r\nfunction str(key, holder) {\r\n\t// Produce a string from holder[key].\r\n\tlet i; // The loop counter.\r\n\tlet k; // The member key.\r\n\tlet v; // The member value.\r\n\tlet length;\r\n\tlet mind = gap;\r\n\tlet partial;\r\n\tlet value = holder[key];\r\n\r\n\t// If the value has a toJSON method, call it to obtain a replacement value.\r\n\tif(\r\n\t\tvalue &&\r\n\t\ttypeof value === \"object\" &&\r\n\t\ttypeof value.toJSON === \"function\"\r\n\t) {\r\n\t\tvalue = value.toJSON(key);\r\n\t}\r\n\r\n\t// If we were called with a replacer function, then call the replacer to\r\n\t// obtain a replacement value.\r\n\r\n\tif(typeof rep === \"function\") {\r\n\t\tvalue = rep.call(holder, key, value);\r\n\t}\r\n\r\n\t// What happens next depends on the value's type.\r\n\r\n\tswitch(typeof value) {\r\n\t\tcase \"string\":\r\n\t\t\treturn quote(value);\r\n\t\tcase \"number\":\r\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\r\n\t\t\treturn(isFinite(value)) ?\r\n\t\t\t\tString(value) :\r\n\t\t\t\t\"null\";\r\n\r\n\t\tcase \"boolean\":\r\n\t\tcase \"null\":\r\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\r\n\t\t\t// typeof null does not produce \"null\". The case is included here in\r\n\t\t\t// the remote chance that this gets fixed someday.\r\n\t\t\treturn String(value);\r\n\r\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\r\n\t\t\t// null.\r\n\t\tcase \"object\":\r\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\r\n\t\t\t// so watch out for that case.\r\n\t\t\tif(!value) {\r\n\t\t\t\treturn \"null\";\r\n\t\t\t}\r\n\r\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\r\n\r\n\t\t\tgap += indent;\r\n\t\t\tpartial = [];\r\n\t\t\t// Is the value an array?\r\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\r\n\r\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\r\n\t\t\t\t// for non-JSON values.\r\n\t\t\t\tlength = value.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\r\n\t\t\t\t}\r\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\r\n\t\t\t\t// brackets.\r\n\r\n\t\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\t\"[]\" :\r\n\t\t\t\t\tgap ?\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t\"[\\n\" +\r\n\t\t\t\t\t\tgap +\r\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\r\n\t\t\t\t\t\t\"\\n\" +\r\n\t\t\t\t\t\tmind +\r\n\t\t\t\t\t\t\"]\"\r\n\t\t\t\t\t) :\r\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\r\n\t\t\t\tgap = mind;\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\r\n\t\t\tif(rep && typeof rep === \"object\") {\r\n\t\t\t\tlength = rep.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\r\n\t\t\t\t\t\tk = rep[i];\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" : \":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" :\r\n\t\t\t\t\t\t\t\t\":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Join all of the member texts together, separated with commas,\r\n\t\t\t// and wrap them in braces.\r\n\r\n\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\"{}\" : gap ?\r\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\r\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\r\n\t\t\tgap = mind;\r\n\t\t\treturn v;\r\n\t}\r\n}\r\n\r\n// If the JSON object does not yet have a stringify method, give it one.\r\nif(typeof JSON.stringify !== \"function\") {\r\n\tmeta = { // table of character substitutions\r\n\t\t\"\\b\": \"\\\\b\",\r\n\t\t\"\\t\": \"\\\\t\",\r\n\t\t\"\\n\": \"\\\\n\",\r\n\t\t\"\\f\": \"\\\\f\",\r\n\t\t\"\\r\": \"\\\\r\",\r\n\t\t\"\\\"\": \"\\\\\\\"\",\r\n\t\t\"\\\\\": \"\\\\\\\\\"\r\n\t};\r\n\tJSON.stringify = function(value, replacer, space) {\r\n\r\n\t\t// The stringify method takes a value and an optional replacer, and an optional\r\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\r\n\t\t// that can replace values, or an array of strings that will select the keys.\r\n\t\t// A default replacer method can be provided. Use of the space parameter can\r\n\t\t// produce text that is more easily readable.\r\n\r\n\t\tlet i;\r\n\t\tgap = \"\";\r\n\t\tindent = \"\";\r\n\t\t// If the space parameter is a number, make an indent string containing that\r\n\t\t// many spaces.\r\n\t\tif(typeof space === \"number\") {\r\n\t\t\tfor(i = 0; i < space; i += 1) {\r\n\t\t\t\tindent += \" \";\r\n\t\t\t}\r\n\r\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\r\n\r\n\t\t} else if(typeof space === \"string\") {\r\n\t\t\tindent = space;\r\n\t\t}\r\n\r\n\t\t// If there is a replacer, it must be a function or an array.\r\n\t\t// Otherwise, throw an error.\r\n\r\n\t\trep = replacer;\r\n\t\tif(replacer && typeof replacer !== \"function\" && (\r\n\t\t\t\ttypeof replacer !== \"object\" ||\r\n\t\t\t\ttypeof replacer.length !== \"number\"\r\n\t\t\t)) {\r\n\t\t\tthrow new Error(\"JSON.stringify\");\r\n\t\t}\r\n\r\n\t\t// Make a fake root object containing our value under the key of \"\".\r\n\t\t// Return the result of stringifying the value.\r\n\r\n\t\treturn str(\"\", {\r\n\t\t\t\"\": value\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// If the JSON object does not yet have a parse method, give it one.\r\n\r\nif(typeof JSON.parse !== \"function\") {\r\n\tJSON.parse = function(text, reviver) {\r\n\t\t// The parse method takes a text and an optional reviver function, and returns\r\n\t\t// a JavaScript value if the text is a valid JSON text.\r\n\t\tlet j;\r\n\r\n\t\tfunction walk(holder, key) {\r\n\t\t\t// The walk method is used to recursively walk the resulting structure so\r\n\t\t\t// that modifications can be made.\r\n\t\t\tlet k;\r\n\t\t\tlet v;\r\n\t\t\tlet value = holder[key];\r\n\t\t\tif(value && typeof value === \"object\") {\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = walk(value, k);\r\n\t\t\t\t\t\tif(v !== undefined) {\r\n\t\t\t\t\t\t\tvalue[k] = v;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelete value[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn reviver.call(holder, key, value);\r\n\t\t}\r\n\r\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\r\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\r\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\r\n\t\ttext = String(text);\r\n\t\trx_dangerous.lastIndex = 0;\r\n\t\tif(rx_dangerous.test(text)) {\r\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\r\n\t\t\t\treturn(\r\n\t\t\t\t\t\"\\\\u\" +\r\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// In the second stage, we run the text against regular expressions that look\r\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\r\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\r\n\t\t// But just to be safe, we want to reject all unexpected forms.\r\n\r\n\t\t// We split the second stage into 4 regexp operations in order to work around\r\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\r\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\r\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\r\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\r\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\r\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\r\n\r\n\t\tif(\r\n\t\t\trx_one.test(\r\n\t\t\t\ttext\r\n\t\t\t\t.replace(rx_two, \"@\")\r\n\t\t\t\t.replace(rx_three, \"]\")\r\n\t\t\t\t.replace(rx_four, \"\")\r\n\t\t\t)\r\n\t\t) {\r\n\r\n\t\t\t// In the third stage we use the eval function to compile the text into a\r\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\r\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\r\n\t\t\t// in parens to eliminate the ambiguity.\r\n\t\t\tj = eval(\"(\" + text + \")\");\r\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\r\n\t\t\t// each name/value pair to a reviver function for possible transformation.\r\n\r\n\t\t\treturn(typeof reviver === \"function\") ?\r\n\t\t\t\twalk({\r\n\t\t\t\t\t\"\": j\r\n\t\t\t\t}, \"\") : j;\r\n\t\t}\r\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\r\n\t\tthrow new SyntaxError(\"JSON.parse\");\r\n\t};\r\n}","/*\r\n * Copyright 2016 Google Inc. All rights reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n * use this file except in compliance with the License. You may obtain a copy of\r\n * the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\r\n * License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\n//https://github.com/GoogleChrome/proxy-polyfill\r\nexport default function proxyPolyfill() {\r\n\tlet lastRevokeFn = null;\r\n\tlet ProxyPolyfill;\r\n\r\n\t/**\r\n\t * @param {*} o\r\n\t * @return {boolean} whether this is probably a (non-null) Object\r\n\t */\r\n\tfunction isObject(o) {\r\n\t\treturn o ? (typeof o === 'object' || typeof o === 'function') : false;\r\n\t}\r\n\r\n\t/**\r\n\t * @constructor\r\n\t * @param {!Object} target\r\n\t * @param {{apply, construct, get, set}} handler\r\n\t */\r\n\tProxyPolyfill = function(target, handler) {\r\n\t\tif(!isObject(target) || !isObject(handler)) {\r\n\t\t\tthrow new TypeError('Cannot create proxy with a non-object as target or handler');\r\n\t\t}\r\n\r\n\t\t// Construct revoke function, and set lastRevokeFn so that Proxy.revocable can steal it.\r\n\t\t// The caller might get the wrong revoke function if a user replaces or wraps scope.Proxy\r\n\t\t// to call itself, but that seems unlikely especially when using the polyfill.\r\n\t\tlet throwRevoked = function() {};\r\n\t\tlastRevokeFn = function() {\r\n\t\t\tthrowRevoked = function(trap) {\r\n\t\t\t\tthrow new TypeError(`Cannot perform '${trap}' on a proxy that has been revoked`);\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t// Fail on unsupported traps: Chrome doesn't do this, but ensure that users of the polyfill\r\n\t\t// are a bit more careful. Copy the internal parts of handler to prevent user changes.\r\n\t\tconst unsafeHandler = handler;\r\n\t\thandler = {\r\n\t\t\t'get': null,\r\n\t\t\t'set': null,\r\n\t\t\t'apply': null,\r\n\t\t\t'construct': null\r\n\t\t};\r\n\t\tfor(let k in unsafeHandler) {\r\n\t\t\tif(!(k in handler)) {\r\n\t\t\t\tthrow new TypeError(`Proxy polyfill does not support trap '${k}'`);\r\n\t\t\t}\r\n\t\t\thandler[k] = unsafeHandler[k];\r\n\t\t}\r\n\t\tif(typeof unsafeHandler === 'function') {\r\n\t\t\t// Allow handler to be a function (which has an 'apply' method). This matches what is\r\n\t\t\t// probably a bug in native versions. It treats the apply call as a trap to be configured.\r\n\t\t\thandler.apply = unsafeHandler.apply.bind(unsafeHandler);\r\n\t\t}\r\n\r\n\t\t// Define proxy as this, or a Function (if either it's callable, or apply is set).\r\n\t\t// TODO(samthor): Closure compiler doesn't know about 'construct', attempts to rename it.\r\n\t\tlet proxy = this;\r\n\t\tlet isMethod = false;\r\n\t\tlet isArray = false;\r\n\t\tif(typeof target === 'function') {\r\n\t\t\tproxy = function ProxyPolyfill() {\r\n\t\t\t\tconst usingNew = (this && this.constructor === proxy);\r\n\t\t\t\tconst args = Array.prototype.slice.call(arguments);\r\n\t\t\t\tthrowRevoked(usingNew ? 'construct' : 'apply');\r\n\r\n\t\t\t\tif(usingNew && handler['construct']) {\r\n\t\t\t\t\treturn handler['construct'].call(this, target, args);\r\n\t\t\t\t} else if(!usingNew && handler.apply) {\r\n\t\t\t\t\treturn handler.apply(target, this, args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// since the target was a function, fallback to calling it directly.\r\n\t\t\t\tif(usingNew) {\r\n\t\t\t\t\t// inspired by answers to https://stackoverflow.com/q/1606797\r\n\t\t\t\t\targs.unshift(target); // pass class as first arg to constructor, although irrelevant\r\n\t\t\t\t\t// nb. cast to convince Closure compiler that this is a constructor\r\n\t\t\t\t\tconst f = /** @type {!Function} */ (target.bind.apply(target, args));\r\n\t\t\t\t\treturn new f();\r\n\t\t\t\t}\r\n\t\t\t\treturn target.apply(this, args);\r\n\t\t\t};\r\n\t\t\tisMethod = true;\r\n\t\t} else if(target instanceof Array) {\r\n\t\t\tproxy = [];\r\n\t\t\tisArray = true;\r\n\t\t}\r\n\r\n\t\t// Create default getters/setters. Create different code paths as handler.get/handler.set can't\r\n\t\t// change after creation.\r\n\t\tconst getter = handler.get ? function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn handler.get(this, prop, proxy);\r\n\t\t} : function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn this[prop];\r\n\t\t};\r\n\t\tconst setter = handler.set ? function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tconst status = handler.set(this, prop, value, proxy);\r\n\t\t\t// TODO(samthor): If the calling code is in strict mode, throw TypeError.\r\n\t\t\t// if (!status) {\r\n\t\t\t// It's (sometimes) possible to work this out, if this code isn't strict- try to load the\r\n\t\t\t// callee, and if it's available, that code is non-strict. However, this isn't exhaustive.\r\n\t\t\t// }\r\n\t\t} : function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tthis[prop] = value;\r\n\t\t};\r\n\r\n\t\t// Clone direct properties (i.e., not part of a prototype).\r\n\t\tlet propertyNames = Object.getOwnPropertyNames(target);\r\n\r\n\t\t/////////用于代理Promise:then方法等\r\n\t\tif(target instanceof Promise && target.__proto__) {\r\n\t\t\tlet props = Object.getOwnPropertyNames(target.__proto__);\r\n\t\t\tlet obj = {};\r\n\t\t\tpropertyNames.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tprops.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tpropertyNames = [];\r\n\t\t\tfor(let prop in obj) {\r\n\t\t\t\tpropertyNames.push(prop);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst propertyMap = {};\r\n\t\tpropertyNames.forEach(function(prop) {\r\n\t\t\tif((isMethod || isArray) && prop in proxy) {\r\n\t\t\t\treturn; // ignore properties already here, e.g. 'bind', 'prototype' etc\r\n\t\t\t}\r\n\t\t\tconst real = Object.getOwnPropertyDescriptor(target, prop);\r\n\t\t\tconst desc = {\r\n\t\t\t\tenumerable: !!(real && real.enumerable),\r\n\t\t\t\tget: getter.bind(target, prop),\r\n\t\t\t\tset: setter.bind(target, prop),\r\n\t\t\t};\r\n\t\t\tObject.defineProperty(proxy, prop, desc);\r\n\t\t\tpropertyMap[prop] = true;\r\n\t\t});\r\n\r\n\t\t// Set the prototype, or clone all prototype methods (always required if a getter is provided).\r\n\t\t// TODO(samthor): We don't allow prototype methods to be set. It's (even more) awkward.\r\n\t\t// An alternative here would be to _just_ clone methods to keep behavior consistent.\r\n\t\tlet prototypeOk = true;\r\n\t\tif(Object.setPrototypeOf) {\r\n\t\t\tObject.setPrototypeOf(proxy, Object.getPrototypeOf(target));\r\n\t\t} else if(proxy.__proto__) {\r\n\t\t\tproxy.__proto__ = target.__proto__;\r\n\t\t} else {\r\n\t\t\tprototypeOk = false;\r\n\t\t}\r\n\t\tif(handler.get || !prototypeOk) {\r\n\t\t\tfor(let k in target) {\r\n\t\t\t\tif(propertyMap[k]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tObject.defineProperty(proxy, k, {\r\n\t\t\t\t\tget: getter.bind(target, k)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// The Proxy polyfill cannot handle adding new properties. Seal the target and proxy.\r\n\t\tObject.seal(target);\r\n\t\tObject.seal(proxy);\r\n\r\n\t\treturn proxy; // nb. if isMethod is true, proxy != this\r\n\t};\r\n\r\n\tProxyPolyfill.revocable = function(target, handler) {\r\n\t\tconst p = new ProxyPolyfill(target, handler);\r\n\t\treturn {\r\n\t\t\t'proxy': p,\r\n\t\t\t'revoke': lastRevokeFn\r\n\t\t};\r\n\t};\r\n\r\n\treturn ProxyPolyfill;\r\n}","import JSON from './json.js';\r\nimport \"./ie.js\";\r\nimport ProxyUtil from './proxy.js';\r\n\r\nfunction polyfillInit(global, xsloader) {\r\n\tlet proxy = ProxyUtil();\r\n\tif(!global['Proxy']) {\r\n\t\tglobal.Proxy = proxy;\r\n\t}\r\n\txsloader.Proxy = proxy;\r\n}\r\n\r\nexport {\r\n\tJSON,\r\n\tpolyfillInit\r\n};","import {\r\n\tJSON as xsJSON,\r\n\tpolyfillInit\r\n} from \"../polyfill/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst IE_VERSION = utils.IE_VERSION;\r\n\r\npolyfillInit(global, xsloader);\r\n\r\nif(!String.prototype.trim) {\r\n\tString.prototype.trim = function() {\r\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n\t};\r\n}\r\n\r\n//生成一个随机的id，只保证在本页面是唯一的\r\nfunction randId(suffix) {\r\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\r\n\tif(suffix !== undefined) {\r\n\t\tid += suffix;\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction xsEval(scriptString) {\r\n\ttry {\r\n\t\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\r\n\t\treturn rs;\r\n\t} catch(e) {\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\n/**\r\n * 注意key需要用引号包裹\r\n * @param {Object} str\r\n * @param {Object} option\r\n */\r\nfunction xsParseJson(str, option) {\r\n\ttry {\r\n\t\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\r\n\t\toption = xsloader.extend({\r\n\t\t\tfnStart: \"\", //\"/*{f}*/\",\r\n\t\t\tfnEnd: \"\", //\"/*{f}*/\",\r\n\t\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\r\n\t\t}, option);\r\n\r\n\t\tlet fnMap = {};\r\n\t\tlet fnOffset = 0;\r\n\t\tlet replacer = undefined;\r\n\t\tif(option.fnStart && option.fnEnd) {\r\n\t\t\twhile(true) {\r\n\t\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\r\n\t\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\r\n\t\t\t\tif(indexStart == -1 && indexEnd == -1) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(indexStart == -1) {\r\n\t\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(indexEnd == -1) {\r\n\t\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\r\n\t\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\r\n\t\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\r\n\t\t\t\t\tthrow \"not a function:\" + fnStr;\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\r\n\t\t\t\t\tlet fn = xsloader.xsEval(fnStr);\r\n\t\t\t\t\tfnMap[fnId] = fn;\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.error(fnStr);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t\tfnOffset = indexStart + fnId.length;\r\n\t\t\t}\r\n\t\t\treplacer = function(key, val) {\r\n\t\t\t\tif(xsloader.isString(val) && fnMap[val]) {\r\n\t\t\t\t\treturn fnMap[val];\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif(option.rcomment) {\r\n\t\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\r\n\t\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\r\n\t\t}\r\n\r\n\t\tlet jsonObj = xsJSON;\r\n\t\treturn jsonObj.parse(str, replacer);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\r\n\t\t\tif(e.message && reg.test(e.message)) {\r\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\r\n\t\t\t\tlet pos = parseInt(posStr.trim());\r\n\t\t\t\tlet _str = str.substring(pos);\r\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\r\n\t\t\t}\r\n\t\t} catch(e2) {\r\n\t\t\tconsole.warn(e2);\r\n\t\t}\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\nfunction xsJson2String(obj) {\r\n\tlet jsonObj = xsJSON;\r\n\treturn jsonObj.stringify(obj);\r\n}\r\n\r\nconst getPathWithRelative = utils.getPathWithRelative;\r\n\r\nfunction _toParamsMap(argsStr, decode = true) {\r\n\tif(xsloader.isObject(argsStr)) {\r\n\t\treturn argsStr;\r\n\t}\r\n\tif(!argsStr) {\r\n\t\targsStr = location.search;\r\n\t}\r\n\r\n\tlet index = argsStr.indexOf(\"?\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(index + 1);\r\n\t} else {\r\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\tindex = argsStr.lastIndexOf(\"#\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(0, index);\r\n\t}\r\n\r\n\tlet ret = {},\r\n\t\tseg = argsStr.split('&'),\r\n\t\ts;\r\n\tfor(let i = 0; i < seg.length; i++) {\r\n\t\tif(!seg[i]) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ts = seg[i].split('=');\r\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\r\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} url\r\n * @param {Object} urlArgs \"a=b&b=c#hash\",\"#hash\",Object\r\n */\r\nfunction appendArgs2Url(url, urlArgs) {\r\n\tif(url === undefined || url === null || !urlArgs) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tlet index = url.lastIndexOf(\"?\");\r\n\tlet hashIndex = url.lastIndexOf(\"#\");\r\n\tif(hashIndex < 0) {\r\n\t\thashIndex = url.length;\r\n\t}\r\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\r\n\tlet newParams = _toParamsMap(urlArgs, false);\r\n\tlet has = false;\r\n\tfor(let k in newParams) {\r\n\t\tif(oldParams[k] != newParams[k]) {\r\n\t\t\toldParams[k] = newParams[k];\r\n\t\t\thas = true;\r\n\t\t}\r\n\t}\r\n\t//\tif(!has) {\r\n\t//\t\treturn url; //参数没有变化直接返回\r\n\t//\t}\r\n\r\n\tlet paramKeys = [];\r\n\tfor(let k in oldParams) {\r\n\t\tparamKeys.push(k);\r\n\t}\r\n\tparamKeys.sort();\r\n\r\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\r\n\tlet params = [];\r\n\r\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\r\n\t\tlet k = paramKeys[i];\r\n\t\tparams.push(k + \"=\" + oldParams[k]);\r\n\t}\r\n\tparams = params.join(\"&\");\r\n\tlet hash = \"\";\r\n\tif((typeof urlArgs == \"string\") && urlArgs.lastIndexOf(\"#\") >= 0) {\r\n\t\thash = urlArgs.substring(urlArgs.lastIndexOf(\"#\"));\r\n\t} else if(hashIndex >= 0 && hashIndex < url.length) {\r\n\t\thash = url.substring(hashIndex);\r\n\t}\r\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\r\n\r\n}\r\n\r\nfunction queryString2ParamsMap(argsStr, decode) {\r\n\treturn _toParamsMap(argsStr, decode);\r\n}\r\n\r\nexport default {\r\n\trandId,\r\n\txsEval,\r\n\txsParseJson,\r\n\txsJson2String,\r\n\tgetPathWithRelative,\r\n\tappendArgs2Url,\r\n\tqueryString2ParamsMap,\r\n\tIE_VERSION\r\n};","const ostring = Object.prototype.toString;\r\n\r\nfunction isArray(it) {\r\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\r\n}\r\n\r\nfunction isFunction(it) {\r\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\r\n}\r\n\r\nfunction isObject(it) {\r\n\tif(it === null || it === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\r\n}\r\n\r\nfunction isString(it) {\r\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\r\n}\r\n\r\nfunction isDate(it) {\r\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\r\n}\r\n\r\nfunction isRegExp(it) {\r\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\r\n}\r\n\r\nfunction isEmpty(it) {\r\n\treturn it === null || it === undefined || it === \"\";\r\n}\r\n\r\nexport default {\r\n\tisArray,\r\n\tisFunction,\r\n\tisObject,\r\n\tisString,\r\n\tisDate,\r\n\tisRegExp,\r\n\tisEmpty,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nfunction queryParam(name, otherValue, optionUrl) {\r\n\tlet search;\r\n\tif(optionUrl) {\r\n\t\tlet index = optionUrl.indexOf('?');\r\n\t\tif(index < 0) {\r\n\t\t\tindex = 0;\r\n\t\t} else {\r\n\t\t\tindex += 1;\r\n\t\t}\r\n\t\tsearch = optionUrl.substr(index);\r\n\t} else {\r\n\t\tsearch = window.location.search.substr(1);\r\n\t}\r\n\r\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n\tlet r = search.match(reg);\r\n\tif(r != null) return decodeURIComponent(r[2]);\r\n\treturn otherValue !== undefined ? otherValue : null;\r\n}\r\n\r\nfunction getUrl(relativeUrl, appendArgs=true, optionalAbsUrl) {\r\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\r\n\t}\r\n//\tif(appendArgs === undefined) {\r\n//\t\tappendArgs = true;\r\n//\t}\r\n\tlet theConfig = xsloader.config();\r\n\tlet thePageUrl = utils.thePageUrl;\r\n\tlet url;\r\n\tif(relativeUrl === undefined) {\r\n\t\turl = thePageUrl;\r\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\r\n\t} else {\r\n\t\turl = theConfig.baseUrl + relativeUrl;\r\n\t}\r\n\tif(appendArgs) {\r\n\t\tif(url == thePageUrl) {\r\n\t\t\turl += location.search + location.hash;\r\n\t\t}\r\n\t\treturn theConfig.dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction getUrl2(relativeUrl, appendArgs=true, optionalAbsUrl) {\r\n\tlet url = getUrl(relativeUrl, false, optionalAbsUrl);\r\n\tif(appendArgs) {\r\n\t\treturn xsloader.config().dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\r\n\tlet rs;\r\n\ttry {\r\n\t\tthiz = thiz === undefined ? this : thiz;\r\n\t\trs = fun.call(thiz);\r\n\t} catch(e) {\r\n\t\tif(xsloader.isFunction(exCallback)) {\r\n\t\t\texCallback(e);\r\n\t\t} else {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n\tif(rs === undefined || rs === null) {\r\n\t\trs = defaultReturn;\r\n\t}\r\n\treturn rs;\r\n}\r\n\r\nfunction dealProperties(obj, properties) {\r\n\treturn utils.propertiesDeal(obj, properties);\r\n}\r\n\r\nfunction extend(target) {\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\ttarget[x] = obj[x];\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction extendDeep(target) {\r\n\tif(!target) {\r\n\t\treturn target;\r\n\t}\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\r\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\r\n\t\t\t} else {\r\n\t\t\t\ttarget[x] = obj[x];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction _AsyncCall(useTimer) {\r\n\tlet thiz = this;\r\n\tlet count = 0;\r\n\tlet ctrlCallbackMap = {};\r\n\r\n\tfunction initCtrlCallback(callbackObj) {\r\n\t\tlet mineCount = count + \"\";\r\n\t\tif(!ctrlCallbackMap[mineCount]) {\r\n\t\t\tlet ctrlCallback = function() {\r\n\t\t\t\tcount++;\r\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\r\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\r\n\t\t\t\twhile(asyncCallQueue.length) {\r\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\r\n\t\t\t\t\tlet lastReturn = undefined;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif(callbackObj.callback) {\r\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet handle;\r\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\r\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\r\n\t\t\t\t\t\tif(!handle) {\r\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tctrlCallbackMap[mineCount] = [];\r\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\r\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout(ctrlCallback, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet queue = ctrlCallbackMap[mineCount];\r\n\t\tqueue.push(callbackObj);\r\n\t}\r\n\r\n\tthis.pushTask = function(callback, obj) {\r\n\t\tlet callbackObj;\r\n\t\tlet handle = {\r\n\t\t\tnext: function(nextCallback, lastReturn) {\r\n\t\t\t\tcallbackObj.nextCallback.push({\r\n\t\t\t\t\tcallback: nextCallback,\r\n\t\t\t\t\tlastReturn: lastReturn\r\n\t\t\t\t});\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t};\r\n\t\tcallbackObj = {\r\n\t\t\tcallback: callback,\r\n\t\t\tobj: obj,\r\n\t\t\tnextCallback: [],\r\n\t\t\thandle: handle\r\n\t\t};\r\n\r\n\t\tinitCtrlCallback(callbackObj);\r\n\r\n\t\treturn handle;\r\n\t};\r\n}\r\n\r\nconst theAsyncCall = new _AsyncCall();\r\nconst theAsyncCallOfTimer = new _AsyncCall(true);\r\n\r\nlet asyncCall = function(callback, useTimer) {\r\n\tif(useTimer) {\r\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\r\n\t} else {\r\n\t\treturn theAsyncCall.pushTask(callback);\r\n\t}\r\n};\r\n\r\n/**\r\n * 得到属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction getObjectAttr(obj, attrNames, defaultValue) {\r\n\tif(!obj || !attrNames) {\r\n\t\treturn undefined;\r\n\t}\r\n\tlet attrs = attrNames.split(\".\");\r\n\tlet rs = defaultValue;\r\n\tlet i = 0;\r\n\tfor(; i < attrs.length && obj; i++) {\r\n\t\tlet k = attrs[i];\r\n\t\tobj = obj[k];\r\n\t}\r\n\tif(i == attrs.length) {\r\n\t\trs = obj;\r\n\t}\r\n\r\n\treturn rs;\r\n}\r\n\r\n/**\r\n * 设置属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction setObjectAttr(obj, attrNames, value) {\r\n\tlet _obj = obj;\r\n\tlet attrs = attrNames.split(\".\");\r\n\r\n\tfor(let i = 0; i < attrs.length; i++) {\r\n\t\tlet k = attrs[i];\r\n\r\n\t\tif(i == attrs.length - 1) {\r\n\t\t\tobj[k] = value;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet o = obj[k];\r\n\t\tif(!o) {\r\n\t\t\to = {};\r\n\t\t\tobj[k] = o;\r\n\t\t}\r\n\t\tobj = o;\r\n\t}\r\n\treturn _obj;\r\n}\r\n\r\nfunction clone(obj, isDeep = false) {\r\n\t// Handle the 3 simple types, and null or undefined or function\r\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\r\n\r\n\tif(xsloader.isRegExp(obj)) {\r\n\t\treturn new RegExp(obj.source, obj.flags);\r\n\t}\r\n\r\n\t// Handle Date\r\n\tif(xsloader.isDate(obj)) {\r\n\t\tlet copy = new Date();\r\n\t\tcopy.setTime(obj.getTime());\r\n\t\treturn copy;\r\n\t}\r\n\t// Handle Array or Object\r\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\r\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\r\n\t\tfor(let attr in obj) {\r\n\t\t\tif(obj.hasOwnProperty(attr)) {\r\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn copy;\r\n\t}\r\n\treturn obj;\r\n}\r\n\r\nfunction sortObject(obj) {\r\n\tif(!obj || !xsloader.isObject(obj)) {\r\n\t\treturn obj;\r\n\t} else {\r\n\t\tlet keys = [];\r\n\t\tfor(let k in obj) {\r\n\t\t\tkeys.push(k);\r\n\t\t}\r\n\t\tkeys.sort();\r\n\t\tlet newObj = {};\r\n\t\tfor(let i = 0; i < keys.length; i++) {\r\n\t\t\tnewObj[keys[i]] = obj[keys[i]];\r\n\t\t}\r\n\t\treturn newObj;\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tqueryParam,\r\n\tgetUrl,\r\n\tgetUrl2,\r\n\ttryCall,\r\n\tdealProperties,\r\n\textend,\r\n\textendDeep,\r\n\tasyncCall,\r\n\tgetObjectAttr,\r\n\tsetObjectAttr,\r\n\tclone,\r\n\tsortObject,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet isDOM = (typeof HTMLElement === 'object') ?\r\n\tfunction(obj) {\r\n\t\treturn obj && (obj instanceof HTMLElement);\r\n\t} :\r\n\tfunction(obj) {\r\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\r\n\t};\r\n\r\nlet onReadyFun = (function() {\r\n\tlet isGlobalReady = false;\r\n\tlet bindReadyQueue = [];\r\n\r\n\tfunction BindReady(callback) {\r\n\t\tif(isGlobalReady) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet isReady = false;\r\n\r\n\t\tfunction ready() {\r\n\t\t\tif(isReady) return;\r\n\t\t\tisReady = true;\r\n\t\t\tisGlobalReady = true;\r\n\t\t\tcallback();\r\n\t\t}\r\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\r\n\t\tif(document.addEventListener) {\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\r\n\r\n\t\t} else if(document.attachEvent) {\r\n\t\t\t// ensure firing before onload,\r\n\t\t\t// maybe late but safe also for iframes\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tif(document.readyState === \"complete\") {\r\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\r\n\t\t\t\t\tready();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\r\n\t\t\t// If IE and not an iframe\r\n\t\t\t// continually check to see if the document is ready\r\n\r\n\t\t\tlet fun2;\r\n\t\t\tfun2 = function() {\r\n\t\t\t\tif(isReady) return;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\r\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tsetTimeout(fun2, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// and execute any waiting functions\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\r\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\r\n\t\t} else {\r\n\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\tready();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.readyCall = ready;\r\n\t}\r\n\tlet onReady = function(callback) {\r\n\t\tif(document.readyState === \"complete\") {\r\n\t\t\tisGlobalReady = true;\r\n\t\t}\r\n\t\tlet br = new BindReady(callback);\r\n\t\tif(!isGlobalReady) {\r\n\t\t\tbindReadyQueue.push(br);\r\n\t\t}\r\n\t};\r\n\tonReady(function() {\r\n\t\tisGlobalReady = true;\r\n\t});\r\n\r\n\tif(document.readyState === \"complete\") {\r\n\t\tisGlobalReady = true;\r\n\t} else {\r\n\t\tlet addEventHandle;\r\n\t\tif(global.addEventListener) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.addEventListener(type, callback, false);\r\n\t\t\t};\r\n\t\t} else if(global.attachEvent) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\taddEventHandle(\"load\", function() {\r\n\t\t\tisGlobalReady = true;\r\n\t\t\twhile(bindReadyQueue.length) {\r\n\t\t\t\tbindReadyQueue.shift().readyCall();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn onReady;\r\n})();\r\n\r\nexport default {\r\n\tisDOM,\r\n\tonReady: onReadyFun\r\n};","import utils from \"../util/index.js\";\r\n////////////////////\r\n\r\nimport deprecated from './global-deprecated.js';\r\nimport base from './global-base.js';\r\n//////////////////\r\nimport is from './is.js';\r\nimport funs from './funs.js';\r\nimport browser from './browser.js';\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst env = {\r\n\tversion: ENV_XSLOADER_VERSION\r\n}\r\n\r\nlet toGlobal = {\r\n\t...deprecated,\r\n\t...base\r\n};\r\nfor(let k in toGlobal) {\r\n\txsloader[k] = toGlobal[k];\r\n\tglobal[k] = toGlobal[k];\r\n}\r\n\r\nlet justLoader = {\r\n\t...is,\r\n\t...funs,\r\n\t...browser,\r\n\tignoreAspect_: {\r\n\r\n\t},\r\n\teach: utils.each,\r\n\tBase64: utils.base64,\r\n\tenv,\r\n};\r\nfor(let k in justLoader) {\r\n\txsloader[k] = justLoader[k];\r\n}","import utils from \"../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\n//global.__showModules=()=>{\r\n//\tconsole.log(theDefinedMap);\r\n//};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\t_preIndex;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif(isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\tpreDependModule: true,\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t//用于提前依赖\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tmodule.index = module.index || this._preIndex || 0;\r\n\t\tthis._preModule = null;\r\n\t\twhile(queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\n/**\r\n * 获取指定脚本、加载中模块的依赖，并添加到defineObject.deps末尾。(配置里的依赖、不一定被添加到实际模块中，模块别名的缘故)\r\n * @param {Object} src\r\n */\r\nfunction appendLoadingModuleDeps(defineObject) {\r\n\tlet src = defineObject.src;\r\n\tlet deps = defineObject.deps;\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tlet mod = moduleDef.defaultModule && moduleDef.defaultModule.state == \"loading\" && moduleDef.defaultModule;\r\n\t\tlet _deps = mod && mod.deps;\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(mod) {\r\n\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t}\r\n\t\tfor(let k in moduleDef.modules) {\r\n\t\t\tmod = moduleDef.modules[k].state == \"loading\" && moduleDef.modules[k];\r\n\t\t\t_deps = mod && mod.deps;\r\n\r\n\t\t\tif(mod) {\r\n\t\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t\t}\r\n\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} nameOrUrl\r\n * @param {Object} selfname\r\n * @param ifoneThenGet 如果没有找到(排除此模块)，且只有唯一的一个、且状态为loaded或defined、则返回该模块对象。获取的模块不等于此模块。\r\n */\r\nfunction getModule(nameOrUrl, selfname = null, ifoneThenGet = null) {\r\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif(moduleDef) {\r\n\t\tlet module;\r\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif(selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(module == ifoneThenGet) {\r\n\t\t\tmodule = null;\r\n\t\t}\r\n\r\n\t\tif(!module && ifoneThenGet) {\r\n\t\t\tlet count = 0;\r\n\t\t\tlet mod = moduleDef.defaultModule;\r\n\t\t\tmod && mod != ifoneThenGet && count++;\r\n\t\t\tfor(let k in moduleDef.modules) {\r\n\t\t\t\tmod = moduleDef.modules[k];\r\n\t\t\t\tmod != ifoneThenGet && count++;\r\n\t\t\t}\r\n\t\t\tif(count == 1 && (mod.state == \"loaded\" || mod.state == \"defined\")) {\r\n\t\t\t\tmodule = mod;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name, index) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif(isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if(theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, true);\r\n\t\tdef._preIndex = index;\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif(!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if(theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef && !moduleDef.defaultModule) {\r\n\t\tif(moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor(let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif(!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tif(name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif(name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n\tappendLoadingModuleDeps\r\n};","import utils from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs, index = 0) {\r\n\tlet instanceModule = {\r\n\t\tindex,\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif(module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif(theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif(xsloader.isObject(obj)) {\r\n\t\t\t\tif(module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\r\n\t\t\t} else if(xsloader.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tlet exports = {};\r\n\t\t\tthis._setDepModuleObjectGen(exports);\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif(this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif(this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinitInstance: function(justForSingle) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\t\t\tif(pluginArgs !== undefined) {\r\n\t\t\t\tif(!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif(this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif(result == undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif(this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new utils.PluginError(err || false));\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.args);\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\t//console.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tindex,\r\n\t\tmodule: module,\r\n\t\tsrc: module.src,\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tselfname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//\tif(module.selfname == \"css\") {\r\n\t//\t\tconsole.log(\"absUrl=\" + instanceModule.thiz.absUrl() + \",invoker.absUrl=\" + instanceModule.thiz.invoker().absUrl());\r\n\t//\t}\r\n\r\n\t//\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _newModule(name, src, thatInvoker, index) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlet defineObject = new script.DefineObject(src, null, [name, null, null]);\r\n\tdefineObject.index = index;\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(); //添加配置依赖，该模块对象是加载者、而不是define者\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tindex: defineObject.index || 0, //在上级依赖数组中所处的索引位置\r\n\t\tid: utils.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tparent: defineObject.parentDefine,\r\n\t\tdescription() {\r\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\tignoreAspect: false,\r\n\t\targs: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tabsUrlFromModule: () => defineObject.absUrlFromDefineObject(),\r\n\t\tgetCallback: () => defineObject.callback,\r\n\t\t_dealApplyArgs: (args) => args,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\texports: null,\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(defineObject) {\r\n\t\t\tthis.deps = defineObject.deps || [];\r\n\t\t\tthis.getCallback = () => defineObject.callback;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif(willCache) {\r\n\t\t\t\tif(!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\targs = this._dealApplyArgs(args);\r\n\t\t\tthis.args = args;\r\n\t\t\tlet obj;\r\n\t\t\tif(xsloader.isFunction(this.getCallback())) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.getCallback().apply(this.thiz, args);\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.getCallback();\r\n\t\t\t\tif(this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif(obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(this.loopObject) {\r\n\t\t\t\tif(!xsloader.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor(let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif(this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs, fun.index);\r\n\t\t\t\t\t\tdepModule.initInstance();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif(deps && deps.length > 0) {\r\n\t\t\t\t\txsloader.require(deps, () => {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: this.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif(fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif(!this._callback()) {\r\n\t\t\t\twhile(this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.state = this.refmodule.state; //状态同步,保持与refmodule状态相同\r\n\t\t\t\treturn this.refmodule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\trefmodule: undefined, //引用指定模块\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.refmodule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile(theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\tthis.refmodule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif(this.relys.length || this.refmodule && this.refmodule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs, index) {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.refmodule.relyIt(thatInvoker, callbackFun, pluginArgs, index); //传递给refmodule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs,\r\n\t\t\t\tindex,\r\n\t\t\t};\r\n\t\t\tif(this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tnew script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif(xsloader.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if(xsloader.isObject(name)) {\r\n\t\t\t\t\tfor(let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor(let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(mobj._modules_) {\r\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif(node.nodes.length) {\r\n\t\t\t\tutils.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tif(node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.error(\"{-----------------------------------------------------------------------------------------------\");\r\n\t\tconsole.error(\"load module error:id=\" + this.id + \",\" + (this.selfname ? \"selfname=\" + this.selfname + \",\" : \"\") + \"my page=\" + location.href);\r\n\t\tutils.each(leafs, function(leaf) {\r\n\t\t\tlet infos = [];\r\n\t\t\tgenErrs(leaf, infos);\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tfor(let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(\"\\n\\t--->\"));\r\n\t\t\t}\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\t\t\tif(errModule) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(dep + \":null\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tconsole.warn(\"\\t\" + dep + \":src=\" + depMod.src + \",absUrl=\" + (depMod.thiz && depMod.thiz.absUrl()));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(dep + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.error(\"}-----------------------------------------------------------------------------------------------\");\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif(this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.each(this.deps, function(dep) {\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif(indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif(mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif(mod) {\r\n\t\t\t\tmod._printOnNotDefined && mod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif(defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径,此时模块的依赖已经全部处理好了\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = xsloader.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_of_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if(isError) {\r\n\t\t\tmodule.setState('error', isError);\r\n\t\t\tif(!hasCallErr) {\r\n\t\t\t\thasCallErr = true;\r\n\t\t\t\tlet err = new utils.PluginError(isError, invoker_of_module, {\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t});\r\n\t\t\t\terrCallback(err, invoker_of_module);\r\n\t\t\t}\r\n\t\t}!isError && syncHandle && syncHandle();\r\n\t}\r\n\r\n\tutils.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\t//\t\tif(xsloader.startsWith(dep, \"css!\")) {\r\n\t\t//\t\t\tconsole.log(\"src=\" + module.src + \",absUrl=\" + invoker_of_module.absUrl() + \",absolute=\" + invoker_of_module.src());\r\n\t\t//\t\t}\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tmoduleDef.getModule(dep)\r\n\t\t\t\t.relyIt(invoker_of_module, function(depModule, err) {\r\n\t\t\t\t\tif(!err) {\r\n\t\t\t\t\t\tdepCount--;\r\n\t\t\t\t\t\tif(dep == \"exports\") {\r\n\t\t\t\t\t\t\tif(theExports) {\r\n\t\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tmodule.exports = theExports;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\t}, pluginArgs, index);\r\n\t\t};\r\n\r\n\t\tif(!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = utils.isJsFile(dep);\r\n\t\t\tdo {\r\n\t\t\t\tlet urls;\r\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif(i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif(i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = xsloader.resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if(config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if(isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\turls = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif(urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep, index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif(!invoker_of_module.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(invoker_of_module.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(urls[index] == dep) {\r\n\t\t\t\t\t\t\tdep = url; //替换为绝对路径\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url,true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!isError && urls.length) {\r\n\t\t\t\t\tutils.replaceModulePrefix(config, urls); //前缀替换\r\n\r\n\t\t\t\t\tif(isJsFile) {\r\n\t\t\t\t\t\tlet lastModule;\r\n\t\t\t\t\t\tutils.each([dep].concat(urls), (item) => {\r\n\t\t\t\t\t\t\tlastModule = moduleDef.getModule(item);\r\n\t\t\t\t\t\t\tif(lastModule) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif(lastModule) { //已经被加载过,在dep最初为相对地址、接着变成绝对地址、且该模块被多个其他模块依赖时会出现这种情况\r\n\t\t\t\t\t\t\tdep = lastModule.src;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], invoker_of_module, index);\r\n\t\t\t\t\tmodule2.setState(\"loading\"); //只有此处才设置loading状态\r\n\r\n\t\t\t\t\tlet configDeps = [];\r\n\t\t\t\t\tif(m2Name) {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(m2Name);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tutils.each(urls, (url) => {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(url);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(configDeps.length) {\r\n\t\t\t\t\t\t//先加载配置依赖\r\n\t\t\t\t\t\txsloader.require(configDeps, () => {\r\n\t\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif(index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif(index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = utils.removeQueryHash(url);\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\tlet defaultMod;\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块或者唯一的模块\r\n\t\t\t\t\t\t\t\t//(唯一的模块用于支持：脚本里只有一个define、且指定了模块名、且此处的模块名与其自己指定了不相等)\r\n\t\t\t\t\t\t\t\tdefaultMod = moduleDef.getModule(module2.src, null, module2);\r\n\t\t\t\t\t\t\t\tif(defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!defaultMod && module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//isError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//errCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t\t\tisError = e;\r\n\t\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif(!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};","import utils from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+)\\s+safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = utils.removeQueryHash(utils.getNodeAbsolutePath(theLoaderScript));\r\nconst thePageUrl = utils.thePageUrl;\r\nconst theHead = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif(this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastScriptSrc = thePageUrl;\r\nlet theRealDefine;\r\nif(safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps, defineObject) {\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif(xsloader.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\tabsUrl: defineObject.absUrlFromDefineObject(),\r\n\t\t\t\torderDep: isOrderDep,\r\n\t\t\t\tsrc: defineObject.src,\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\nclass Handle {\r\n\tdefineObject;\r\n\tconstructor(defineObject) {\r\n\t\tthis.defineObject = defineObject;\r\n\t}\r\n\r\n\tthen(option) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\r\n\t\treturn this;\r\n\t}\r\n\terror(onError) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle.onError = onError;\r\n\t\treturn this;\r\n\t}\r\n\tonError(err, invoker) {\r\n\t\tthis.defineObject.handle.onError(err, invoker);\r\n\t}\r\n}\r\n\r\nclass ThisInvoker {\r\n\tinvoker;\r\n\tconstructor(invoker) {\r\n\t\tthis.invoker = invoker;\r\n\t}\r\n}\r\n\r\nfunction _buildInvoker(module) {\r\n\tlet invoker = module[\"thiz\"];\r\n\tmodule = module.module || module;\r\n\tlet id = xsloader.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\r\n\t\tlet url;\r\n\t\tif(relativeUrl === undefined) {\r\n\t\t\turl = this.src();\r\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.absUrl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\r\n\t\t}\r\n\t\tif(appendArgs) {\r\n\t\t\tif(url == thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.getUrl2 = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tlet url = this.getUrl(relativeUrl, false, optionalAbsUrl);\r\n\t\tif(appendArgs) {\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.require = function() {\r\n\t\t//\t\tconsole.log(\"this.require:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0]);\r\n\t\tlet h = xsloader.require.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.require.get = function(name) {\r\n\t\treturn xsloader.require.get.apply(new ThisInvoker(invoker), [name]);\r\n\t};\r\n\r\n\tinvoker.define = function() {\r\n\t\t//\t\tconsole.log(\"this.define:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0] + (typeof arguments[0] == \"string\" ? (\",args[1]=\" + arguments[1]) : \"\"));\r\n\t\tlet h = xsloader.define.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrlFromDefineObject() || this.absUrl();\r\n\t};\r\n\r\n\t//deprecated\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = invoker.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.withAbsUrl = function(absUrlStr) {\r\n\t\tif(!absUrlStr) {\r\n\t\t\tabsUrlStr = invoker.absUrl();\r\n\t\t}\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tsrc: module.src,\r\n\t\t\tabsUrl: () => absUrlStr,\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\treturn new Invoker(moduleMap);\r\n\t};\r\n}\r\n\r\nclass Invoker {\r\n\t_im;\r\n\t_id;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new InVar(moduleMap);\r\n\t\tthis._id = utils.getAndIncIdCount();\r\n\t\tmoduleMap.thiz = this;\r\n\t\t_buildInvoker(moduleMap);\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址（弃用）\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址\r\n\t */\r\n\tsrc() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取在上级依赖数组中的索引位置\r\n\t */\r\n\tgetIndex() {\r\n\t\treturn this._im.get().index;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取当前调用者的调用者\r\n\t */\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrlFromModule();\r\n\t}\r\n\r\n\texports() {\r\n\t\treturn this._im.get().exports;\r\n\t}\r\n\r\n\troot() {\r\n\t\tlet p = this.invoker();\r\n\t\treturn p ? p.invoker() : this;\r\n\t}\r\n}\r\n\r\nfunction getMineInvoker(thiz) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thiz;\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = true) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else {\r\n\t\tlet parentModule = currentDefineModuleQueue.peek();\r\n\t\tif(parentModule) {\r\n\t\t\treturn parentModule.thiz;\r\n\t\t} else if(nullNew) {\r\n\t\t\tlet moduleMap = {\r\n\t\t\t\tmodule: \"\",\r\n\t\t\t\tsrc: thePageUrl,\r\n\t\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\t\tname: \"__root__\",\r\n\t\t\t\tinvoker: null\r\n\t\t\t};\r\n\t\t\treturn new Invoker(moduleMap);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tthiz;\r\n\tisRequire;\r\n\tsrc;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\t_directDepLength = 0;\r\n\tdirectDepLength = 0;\r\n\tnames = [];\r\n\tindex;\r\n\tconstructor(src, thiz, args = [], isRequire = false /*, willDealConfigDeps = false*/ ) {\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.handle = {\r\n\t\t\tonError(err, invoker) {\r\n\t\t\t\tconsole.error(utils.unwrapError(err));\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\r\n\t\tif(thiz instanceof ThisInvoker) {\r\n\t\t\t//this.handle.absUrl = thiz.invoker.src(); //设置默认参考地址\r\n\t\t\tthis.src = thiz.invoker.src();\r\n\t\t}\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif(args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if(typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif(deps && !xsloader.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif(!deps) {\r\n\t\t\tdeps = [];\r\n\t\t} else {\r\n\t\t\tdeps = xsloader.clone(deps);\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\t//if(!isRequire) {\r\n\t\tutils.appendInnerDeps(deps, callback);\r\n\t\t//}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.pushName(selfname);\r\n\t\tthis.callback = callback;\r\n\t\tthis._directDepLength = deps.length;\r\n\t\tthis.directDepLength = deps.length;\r\n\t}\r\n\r\n\tpushName(name) {\r\n\t\tif(name && xsloader.indexInArray(this.names, name) == -1) {\r\n\t\t\tthis.names.push(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理配置依赖及嵌套依赖,同时会替换前缀\r\n\t */\r\n\tappendConfigDepsAndEmbedDeps(module) {\r\n\t\tlet config = xsloader.config();\r\n\t\tlet src = this.src;\r\n\t\tlet deps = this.deps;\r\n\r\n\t\tlet _deps = config.getDeps(src);\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tutils.each(this.names, (name) => {\r\n\t\t\t_deps = config.getDeps(name);\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tif(this.handle.orderDep && this._directDepLength > 1 && deps.length > this._directDepLength) {\r\n\t\t\tlet odeps = [true]; //第一个true表示顺序依赖\r\n\t\t\twhile(this._directDepLength-- > 0) {\r\n\t\t\t\todeps.push(deps.shift());\r\n\t\t\t}\r\n\t\t\tdeps.unshift(odeps);\r\n\t\t\tthis.handle.orderDep = false;\r\n\t\t}\r\n\r\n\t\t_dealEmbedDeps(deps, this); //处理嵌套依赖\r\n\t\tutils.replaceModulePrefix(config, deps); //前缀替换\r\n\r\n\t\tif(module) {\r\n\t\t\tmodule.deps = deps;\r\n\t\t\tmodule._dealApplyArgs = (function(directDepLength, hasOrderDep) {\r\n\t\t\t\treturn function(applyArgs) {\r\n\t\t\t\t\tif(directDepLength == 0 || applyArgs.length == 0) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//顺序依赖,还原成最初的顺序,移除额外的依赖。\r\n\t\t\t\t\tlet args = new Array(directDepLength + 1);\r\n\t\t\t\t\tif(hasOrderDep) {\r\n\t\t\t\t\t\targs = applyArgs[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor(var i = 0; i < directDepLength; i++) {\r\n\t\t\t\t\t\t\targs[i] = applyArgs[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\targs[directDepLength] = applyArgs[applyArgs.length - 1].slice(0, directDepLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t})(this.directDepLength, this.directDepLength > 0 && this._directDepLength <= 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = utils.isJsFile(m);\r\n\r\n\t\t\t//替换相对路径为绝对路径\r\n\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\r\n\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\tdeps[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\tlet paths = utils.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif(paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrlFromDefineObject() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl || this.src;\r\n\t}\r\n\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n * @param {Object} isRemoveQueryHash\r\n */\r\nfunction getCurrentScript(isRemoveQueryHash = true) {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif(document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif(node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\t//\t\t\tutils.each(nodes, (node) => {\r\n\t\t\t//\t\t\t\tconsole.log(\"node.src=\" + node.src + \",node.readyState=\" + node.readyState);\r\n\t\t\t//\t\t\t});\r\n\t\t\tfor(let i = nodes.length - 1; i >= 0; i--) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif(node.readyState === \"interactive\" && node.src) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif(!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs;\r\n\tlet parentDefine = currentDefineModuleQueue.peek();\r\n\tif(parentDefine) {\r\n\t\trs = {\r\n\t\t\tsrc: parentDefine.src\r\n\t\t};\r\n\t} else {\r\n\t\trs = _getCurrentScriptOrSrc();\r\n\t}\r\n\r\n\tif(!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif(utils.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif(!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = utils.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif(src == utils.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(rs.node) {\r\n\t\trs.src = utils.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\tif(isRemoveQueryHash) {\r\n\t\trs.src = utils.removeQueryHash(rs.src);\r\n\t}\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = \"async\";\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif(node.detachEvent && !isOpera) {\r\n\t\tif(ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !xsloader.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif(useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tappendHeadDom(node);\r\n\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tnode.src = url; //在ie10-以下，必须在脚本插入head后再进行src的设置、且需要异步设置。\r\n\t\t});\r\n\t} else {\r\n\t\tnode.src = url;\r\n\t}\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif(!xsloader.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\ttheHead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif(isSrcFromScriptLoad) {\r\n\t\t\t\tlastScriptSrc = scriptData.src; //已经不含参数\r\n\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(utils.IE_VERSION > 0 || utils.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\t//\tconsole.log(\"**********************************[\");\r\n\tlet rs = getCurrentScript(); //已经不含参数\r\n\r\n\t//\tif(typeof args[0] == \"string\") {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",args[1]=\" + args[1] + \",src=\" + rs.src);\r\n\t//\t} else {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",src=\" + rs.src);\r\n\t//\t}\r\n\t//\tconsole.log(rs.node);\r\n\t//\tconsole.log(\"**********************************]\\n\");\r\n\tlet src = rs.src;\r\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire);\r\n\tif(!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif(defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\txsloader.config().error(e);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet handle = new Handle(defineObject);\r\n\r\n\tlet isLoaderEnd = utils.isLoaderEnd();\r\n\txsloader.asyncCall(() => {\r\n\t\tif(isSrcFromScriptLoad && isLoaderEnd) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastScriptSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastScriptSrc;\r\n\t\t}\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nlet isFirstRequire = true;\r\n\r\nfunction prerequire(deps, callback) {\r\n\tlet config = xsloader.config();\r\n\tif(!config) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\tlet thatInvoker = getInvoker(this);\r\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\r\n\t\tif(deps == \"exports\") { //当require(\"exports\")时，必须依赖了exports\r\n\t\t\tlet mineInvoker = getMineInvoker(this);\r\n\t\t\tlet exports = mineInvoker && mineInvoker.exports();\r\n\t\t\tif(!exports) {\r\n\t\t\t\tthrow new Error(\"not found exports\");\r\n\t\t\t} else {\r\n\t\t\t\treturn exports;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet originDeps = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = deps.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\r\n\t\t\tdeps = deps.substring(0, pluginIndex);\r\n\t\t\tif(pluginArgs) {\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tutils.replaceModulePrefix(config, argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet module = moduleScript.getModule(deps);\r\n\t\tif(!module) {\r\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\r\n\t\t\tmodule = moduleScript.getModule(deps);\r\n\t\t}\r\n\t\tif(!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t} else if(module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}, pluginArgs).initInstance(true);\r\n\t\tif(theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = xsloader.randId(\"_require\");\r\n\tif(xsloader.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t} else if(!xsloader.isArray(deps)) {\r\n\t\tthrow new Error(\"unexpected argument:\" + deps);\r\n\t}\r\n\tutils.appendInnerDeps(deps, callback);\r\n\tlet timeid;\r\n\tlet loading;\r\n\tlet isOk = false;\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\tif(isFirstRequire && config.plugins.loading.enable) {\r\n\t\tisFirstRequire = false;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif(!isOk) {\r\n\t\t\t\tloading = new utils.ToProgress(config.plugins.loading);\r\n\t\t\t\tloading.autoIncrement();\r\n\t\t\t\tif(isErr) {\r\n\t\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t\t\tloading = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config.plugins.loading.delay);\r\n\t}\r\n\tlet clearTimer = function(isErr = false) {\r\n\t\tif(loading) {\r\n\t\t\tif(isErr) {\r\n\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t} else {\r\n\t\t\t\tloading.stopAuto();\r\n\t\t\t\tloading.finish();\r\n\t\t\t}\r\n\t\t\tloading = null;\r\n\t\t}\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tisOk = true;\r\n\t\tclearTimer();\r\n\t\t//\t\tconsole.log(\"2======require:\"+selfname);\r\n\t\t//\t\tconsole.log(callback);\r\n\t\tif(xsloader.isFunction(callback)) {\r\n\t\t\ttry {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t} catch(e) {\r\n\t\t\t\thandle.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}], true);\r\n\thandle.waitTime = config.waitSeconds * 1000;\r\n\r\n\thandle.logError = function(err, invoker, logFun = \"error\") {\r\n\t\tinvoker && console[logFun](\"invoker.url=\", invoker.getUrl());\r\n\t\tthatInvoker && console[logFun](\"require.invoker.url=\", thatInvoker.getUrl());\r\n\t\tconsole[logFun](utils.unwrapError(err));\r\n\t};\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tisErr = !!err;\r\n\t\tclearTimer(true);\r\n\t\tif(customerErrCallback) {\r\n\t\t\tcustomerErrCallback.call(handle, err, invoker);\r\n\t\t} else {\r\n\t\t\thandle.logError(err, invoker);\r\n\t\t}\r\n\t});\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\txsloader.asyncCall(() => {\r\n\r\n\t\tif(handle.waitTime) {\r\n\t\t\tlet checkResultFun = function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\t\t\t\t//console.log(isErr)\r\n\t\t\t\t\tif((!ifmodule || ifmodule.state != 'defined') && !isErr) {\r\n\t\t\t\t\t\tlet module = ifmodule;\r\n\t\t\t\t\t\thandle.onError(\"require timeout:selfname=\" + selfname + \",\\n\\tdeps=[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\r\n\t\t\t\t\t\tif(module) {\r\n\t\t\t\t\t\t\tutils.each(module.deps, function(dep) {\r\n\t\t\t\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\t\t\t\tif(mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t\tclearTimer();\r\n\t\t\t};\r\n\t\t\ttimeid = setTimeout(checkResultFun, handle.waitTime);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tif(typeof Promise != \"undefined\" && arguments.length == 1 && !callback) {\r\n\t\tlet promise = new Promise((resolve, inject) => {\r\n\t\t\tcallback = function() {\r\n\t\t\t\tif(deps.length == 1) {\r\n\t\t\t\t\tresolve(arguments[0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(var i = 0; i < deps.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\thandle.error((err) => {\r\n\t\t\t\tcallback = null;\r\n\t\t\t\tinject(err);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn promise;\r\n\t}\r\n\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif(!xsloader.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile(globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\tlastAppendHeadDom: function() {\r\n\t\treturn lastAppendHeadDom;\r\n\t},\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\thead: function() {\r\n\t\treturn theHead;\r\n\t},\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tHandle,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};","import loader from './loader.js';\r\nimport \"../public/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nimport script from \"./script.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nlet theContext;\r\nlet theConfig;\r\nlet argsObject = {};\r\n\r\nxsloader.config = function() {\r\n\treturn theConfig;\r\n};\r\nxsloader.script = function() {\r\n\treturn script.theLoaderScript;\r\n};\r\n\r\nxsloader.lastAppendHeadDom = function() {\r\n\treturn script.lastAppendHeadDom();\r\n};\r\n\r\nxsloader.scriptSrc = function() {\r\n\treturn script.theLoaderUrl;\r\n};\r\n\r\nxsloader.putUrlArgs = function(argsObj) {\r\n\targsObject = xsloader.extend(argsObject, argsObj);\r\n};\r\n\r\nxsloader.getUrlArgs = function() {\r\n\tlet obj = xsloader.extend({}, argsObject);\r\n\treturn obj;\r\n};\r\n\r\nxsloader.clearUrlArgs = function() {\r\n\targsObject = {};\r\n};\r\n\r\nxsloader.appendHeadDom = script.appendHeadDom;\r\n\r\nxsloader.hasDefine = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif(!module || module.state == \"init\") {\r\n\r\n\t} else {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\r\nxsloader.resUrlBuilder = function(groupName) {\r\n\tthrow new Error('resUrlBuilder not found!');\r\n};\r\n\r\nxsloader.clear_module_ = function() {\r\n\tlet modules = arguments;\r\n\tfor(let i = 0; i < modules.length; i++) {\r\n\t\tif(modules[i]) {\r\n\t\t\tdelete modules[i]._module_;\r\n\t\t\tdelete modules[i]._modules_;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction _newContext() {\r\n\tlet context = {\r\n\t\tcontextName: script.contextName,\r\n\t\tdefQueue: []\r\n\t};\r\n\treturn context;\r\n}\r\n\r\nloader.loaderFun((option) => {\r\n\tif(theContext) {\r\n\t\tthrow new Error(\"already configed!\");\r\n\t}\r\n\toption = xsloader.extend({\r\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\r\n\t\turlArgs: {},\r\n\t\tignoreProperties: false,\r\n\t\tpaths: {},\r\n\t\tdepsPaths: {},\r\n\t\tdeps: {},\r\n\t\tjsExts: undefined,\r\n\t\tproperties: {},\r\n\t\tmodulePrefix: {},\r\n\t\tdefineFunction: {},\r\n\t\tmodulePrefixCount: 0,\r\n\t\twaitSeconds: 20,\r\n\t\tautoUrlArgs() {\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tinstance: \"single\",\r\n\t\tdealtDeps: {},\r\n\t\tdealProperties(obj) {\r\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\r\n\t\t},\r\n\t\tisInUrls(m) {\r\n\t\t\treturn !!this.getUrls(m);\r\n\t\t},\r\n\t\tgetUrls(m) {\r\n\t\t\treturn this.paths[m] || this.depsPaths[m];\r\n\t\t},\r\n\t\tgetDeps(m) {\r\n\t\t\tlet as = this.dealtDeps[m] || [];\r\n\t\t\tlet deps = [];\r\n\t\t\tlet hasOrderDep = undefined;\r\n\r\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\r\n\t\t\t\tif(as[0]) {\r\n\t\t\t\t\tdeps = [\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t];\r\n\t\t\t\t\thasOrderDep = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tas.splice(0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < as.length; i++) {\r\n\t\t\t\tif(hasOrderDep === true) {\r\n\t\t\t\t\tdeps[0].push(as[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeps.push(as[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deps;\r\n\t\t},\r\n\t\tdealUrl(module, url, addVersion = false) {\r\n\t\t\tlet urlArg;\r\n\t\t\tlet nameOrUrl;\r\n\t\t\tif(this.autoUrlArgs()) {\r\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\r\n\t\t\t} else {\r\n\t\t\t\tlet moduleName;\r\n\t\t\t\tlet src;\r\n\t\t\t\tif(xsloader.isString(module)) {\r\n\t\t\t\t\tmoduleName = module;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleName = module.selfname;\r\n\t\t\t\t\tsrc = module.src;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//精确匹配优先\r\n\r\n\t\t\t\t//先尝试模块名\r\n\t\t\t\turlArg = this.urlArgs[moduleName];\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(moduleName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//再尝试提供的url\r\n\t\t\t\tif(!urlArg && url) {\r\n\t\t\t\t\turlArg = this.urlArgs[url];\r\n\t\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(url);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//接着尝试模块src\r\n\t\t\t\tif(!urlArg && src) {\r\n\t\t\t\t\turlArg = this.urlArgs[src];\r\n\t\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(src);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//最后尝试通用的\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif(xsloader.isFunction(urlArg)) {\r\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\r\n\t\t\t}\r\n\r\n\t\t\tif(!urlArg) {\r\n\t\t\t\turlArg = \"\";\r\n\t\t\t}\r\n\r\n\t\t\tfor(let k in argsObject) { //加入全局的参数\r\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\r\n\t\t\t}\r\n\r\n\t\t\tif(addVersion && this.props.addVersion) {\r\n\t\t\t\turlArg += \"&_xsv=\" + encodeURIComponent(xsloader.env.version);\r\n\t\t\t}\r\n\r\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\r\n\t\t},\r\n\t\tdealUrlArgs(url) {\r\n\t\t\turl = utils.getPathWithRelative(location.href, url);\r\n\t\t\treturn this.dealUrl(url, url);\r\n\t\t},\r\n\t\tdefaultVersion: {},\r\n\t\tplugins: {},\r\n\t\tprops: {},\r\n\t}, option);\r\n\r\n\toption.props = xsloader.extend({\r\n\t\taddVersion: true,\r\n\t\tinnerDepType: \"auto\", //auto,require.get,require,disable\r\n\t}, option.props);\r\n\r\n\toption.plugins.loading = xsloader.extend({\r\n\t\tenable: true,\r\n\t\tcolor: '#2196f3',\r\n\t\tbgColor: 'rgba(0,0,0,0.1)',\r\n\t\terrColor: '#f5222d',\r\n\t\tduration: 0.2,\r\n\t\theight: 1,\r\n\t\tdelay: 500,\r\n\t}, option.plugins.loading);\r\n\r\n\tif(script.theLoaderScript.getAttribute(\"disable-loading\") !== undefined) {\r\n\t\toption.plugins.loading.enable = false;\r\n\t}\r\n\r\n\toption.plugins.image = xsloader.extend({\r\n\t\ttimeout: 10000, //超时时间，毫秒\r\n\t}, option.plugins.image);\r\n\r\n\toption.plugins.xsmsg = xsloader.extend({\r\n\t\ttimeout: 30000, //连接超时时间，毫秒\r\n\t\tsleep: 500, //连接检测的休眠时间，毫秒\r\n\t}, option.plugins.xsmsg);\r\n\r\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\r\n\t\toption.baseUrl += \"/\";\r\n\t}\r\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\r\n\r\n\tif(!option.ignoreProperties) {\r\n\t\toption = option.dealProperties(option);\r\n\t}\r\n\r\n\tutils.strValue2Arr(option.paths);\r\n\tutils.strValue2Arr(option.depsPaths);\r\n\tutils.strValue2Arr(option.deps);\r\n\r\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\r\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\r\n\t\toption.autoUrlArgs = function() {\r\n\t\t\treturn isAutoUrlArgs;\r\n\t\t};\r\n\t}\r\n\r\n\tlet modulePrefixCount = 0;\r\n\tfor(let prefix in option.modulePrefix) {\r\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\r\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\r\n\t\t}\r\n\t\tmodulePrefixCount++;\r\n\t}\r\n\toption.modulePrefixCount = modulePrefixCount;\r\n\tif(modulePrefixCount > 0) {\r\n\t\t//替换urlArgs中地址前缀\r\n\t\tlet star = option.urlArgs[\"*\"];\r\n\t\tdelete option.urlArgs[\"*\"];\r\n\r\n\t\tlet urlArgsArr = [];\r\n\t\tfor(let k in option.urlArgs) {\r\n\t\t\tlet url = k;\r\n\t\t\tif(utils.isJsFile(url)) { //处理相对\r\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\r\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\r\n\t\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\turlArgsArr.push({\r\n\t\t\t\turl: url,\r\n\t\t\t\targs: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor(let prefix in option.modulePrefix) {\r\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\r\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\t\tlet starP = \"\";\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\r\n\t\t\t\t\tstarP = \"*[\";\r\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\r\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\r\n\t\t\t\t}\r\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\r\n\t\t\t}\r\n\t\t}\r\n\t\toption.urlArgs = {};\r\n\t\toption.urlArgs[\"*\"] = star;\r\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\r\n\t\t}\r\n\t}\r\n\r\n\t//预处理urlArgs中的*[与*]\r\n\tlet _urlArgs_prefix = [];\r\n\tlet _urlArgs_suffix = [];\r\n\toption._urlArgs_prefix = _urlArgs_prefix;\r\n\toption._urlArgs_suffix = _urlArgs_suffix;\r\n\r\n\tfor(let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\t\tif(xsloader.startsWith(url, \"*[\")) {\r\n\t\t\tlet strfix = url.substring(2);\r\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\r\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\r\n\t\t\t} else {\r\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\r\n\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\tstrfix = absolute.path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_urlArgs_prefix.push({\r\n\t\t\t\tstrfix: strfix,\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\r\n\t\t\t_urlArgs_suffix.push({\r\n\t\t\t\tstrfix: url.substring(2),\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t}\r\n\t}\r\n\r\n\toption.forPrefixSuffix = function(urlOrName) {\r\n\t\t//前缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\r\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//后缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\r\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor(let name in option.paths) {\r\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\r\n\t}\r\n\tfor(let name in option.depsPaths) {\r\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\r\n\t}\r\n\r\n\t//处理依赖\r\n\tlet dealtDeps = option.dealtDeps;\r\n\r\n\tlet pushDeps = (dealtDepArray, depsArray) => {\r\n\t\tutils.each(depsArray, (dep) => {\r\n\t\t\tdealtDepArray.push(dep);\r\n\t\t});\r\n\t};\r\n\r\n\tfor(let keyName in option.deps) {\r\n\t\tlet paths = keyName.split('::');\r\n\t\tlet depsArray = option.deps[keyName];\r\n\t\tutils.each(paths, (path) => {\r\n\t\t\tif(path == '*') {\r\n\t\t\t\tfor(let m in option.depsPaths) {\r\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\r\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\r\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttheConfig = option;\r\n\ttheContext = _newContext();\r\n\tscript.onConfigedCallback(); //完成配置回调\r\n\treturn theConfig;\r\n});","import utils from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tutils.each(defines, (defineObject) => {\r\n\t\tif(xsloader.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\t//\t\t\t\tif(defineObject.isRequire) {\r\n\t\t\t\t//\t\t\t\t\tconsole.log(\"1======require:\" + defineObject.selfname);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(defineObject);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(originCallback);\r\n\t\t\t\t//\t\t\t\t}\r\n\t\t\t\tlet config = xsloader.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tutils.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\t//同一个模块可能分属于不同的module对象，加载者module当前处于loading状态、需要将其依赖追加进来、确保依赖完整\r\n\tmoduleScript.appendLoadingModuleDeps(defineObject);\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\tif(ifmodule) {\r\n\t\tif(ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t}\r\n\r\n\tif(defineObject.selfname != defineObject.src) {\r\n\t\tdefineObject.pushName(defineObject.selfname);\r\n\t}\r\n\r\n\tif(ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tdefineObject.pushName(ifmodule.selfname);\r\n\t}\r\n\t//一个模块的所有名字，包括src\r\n\tutils.each(defineObject.names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif(xsloader.ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(ifmodule); //添加配置依赖:在配置文件里直接通过src、名称配置的\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif(defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\r\n\r\n\tif(module.deps.length == 0) {\r\n\t\ttry {\r\n\t\t\tmodule.finish([]); //递归结束\r\n\t\t} catch(e) {\r\n\t\t\tdefineObject.handle.onError(e);\r\n\t\t}\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tutils.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodule.finish(args);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tdefineObject.handle.onError(e);\r\n\t\t\t\t}\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\tdefineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif(defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.get = function(name) {\r\n\tif(!xsloader.isString(name)) {\r\n\t\tthrow new Error(\"expected string type for module name\");\r\n\t} else {\r\n\t\treturn require.call(this, name);\r\n\t}\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif(args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor(var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif(!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nxsloader.define = define;\r\n//deprecated\r\nxsloader.defineAsync = define;\r\nxsloader.require = require;\r\nglobal.define = define;\r\nglobal.require = require;\r\n\r\ndefine.amd = true;\r\n\r\n//声明exports,内部会做特殊处理\r\ndefine(\"exports\", function() {});","import script from \"../script.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//内部依赖加载插件\r\n\r\nxsloader.define(script.INNER_DEPS_PLUGIN, {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tlet depsObj = script.innerDepsMap[depId];\r\n\t\tlet deps = depsObj.deps;\r\n\t\t//delete innerDepsMap[depId];\r\n\t\tlet newInvoker = this.invoker().withAbsUrl(depsObj.absUrl);\r\n\t\tnewInvoker.src = () => depsObj.src;\r\n\t\tnewInvoker.require(deps, function() {\r\n\t\t\tlet args = [];\r\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\r\n\t\t\t\targs.push(arguments[k]);\r\n\t\t\t}\r\n\t\t\tonload(args);\r\n\t\t}).then({\r\n\t\t\torderDep: depsObj.orderDep,\r\n\t\t\terror(err, invoker) {\r\n\t\t\t\tonerror(new utils.PluginError(err, invoker));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetCacheKey(depId) {\r\n\t\treturn depId;\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"ready\", {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\txsloader.onReady(function() {\r\n\t\t\tonload();\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!module\r\n */\r\nxsloader.define(\"try\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tlet handle = this.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(err, invoker) {\r\n\t\t\tconsole.info(`try!:require '${dep}' failed`);\r\n\t\t\tthis.logError(err, invoker, \"info\");\r\n\t\t\tonload(null);\r\n\t\t});\r\n\t\tif(handle.waitTime && handle.waitTime > 1000) {\r\n\t\t\thandle.waitTime -= 1000;\r\n\t\t}\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 插件用于加载某些js文件，忽略其所有依赖，可用于忽略在加载webpack等打包的模块时自动添加内部require('...')的依赖\r\n */\r\nxsloader.define(\"nodeps\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tthis.invoker().withAbsUrl().require([arg], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\tdepBefore(index, dep, depDeps) {\r\n\t\t\t\tdepDeps.splice(0, depDeps.length);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * exists!module1 or module2 or module3|windowVar1|windowVar2...\r\n */\r\nxsloader.define(\"exists\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet vars = arg.split(\"|\");\r\n\t\tfor(let i = 0; i < vars.length; i++) {\r\n\t\t\tvars[i] = vars[i].trim();\r\n\t\t}\r\n\t\tif(vars.length == 0) {\r\n\t\t\tonerror(\"args error for exists!\");\r\n\t\t} else {\r\n\t\t\tlet moduleNames = (vars[0].replace(/\\s/g, \" \")).split(\" or \");\r\n\t\t\tlet moduleName;\r\n\t\t\tlet module;\r\n\t\t\tfor(let i = 0; i < moduleNames.length; i++) {\r\n\t\t\t\tmoduleName = moduleNames[i].trim();\r\n\t\t\t\tmodule = moduleScript.getModule(moduleName);\r\n\t\t\t\tif(module) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(module) {\r\n\t\t\t\tthis.invoker().withAbsUrl().require([moduleName], function(mod, depModuleArgs) {\r\n\t\t\t\t\tonload(mod);\r\n\t\t\t\t}).error(function(e) {\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tlet obj = undefined;\r\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\r\n\t\t\t\t\tif(window[vars[i]]) {\r\n\t\t\t\t\t\tobj = window[vars[i]];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(obj === undefined) {\r\n\t\t\t\t\tonerror(\"not found:\" + arg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!moduleName=>>modulePath\r\n */\r\n\r\nxsloader.define(\"name\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tmoduleName = moduleName.replace(/，/g, ',');\r\n\t\tlet names = moduleName.split(\",\");\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tlet existsMods = [];\r\n\t\t\tfor(let i = 0; i < names.length; i++) {\r\n\t\t\t\tlet newName = names[i];\r\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\r\n\t\t\t\tif(lastM && lastM.state != \"init\" && !lastM.preDependModule) {\r\n\t\t\t\t\texistsMods.push(\"\\tselfname=\" + newName + \",state=\" + lastM.state + \",src=\" + lastM.src);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet module = depModuleArgs[0].module;\r\n\t\t\t\tif(lastM && !lastM.preDependModule) {\r\n\t\t\t\t\tlastM.toOtherModule(module);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleScript.setModule(newName, module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(existsMods.length) {\r\n\t\t\t\tonerror(\"already exists:\" + existsMods.join('\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tonload(mod);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nimport script from \"../script.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/*\r\n * Require-CSS RequireJS css! loader plugin\r\n * 0.1.8\r\n * Guy Bedford 2014\r\n * MIT\r\n */\r\nxsloader.define(\"css\", function() {\r\n\r\n\tlet lastDom; //始终执行最后一个style（inverse处理的）\r\n\t//层级之间，越顶层的、越在后面；同级之间，索引越大的、越在后面\r\n\tclass Node {\r\n\t\tparent;\r\n\t\tchildren = {};\r\n\t\t_maxindex = -1;\r\n\t\t_minindex;\r\n\t\tdoms = {}; //index:dom\r\n\t\tsrc;\r\n\t\tconstructor(src) {\r\n\t\t\tthis.src = src;\r\n\t\t}\r\n\r\n\t\taddChild(src, node) {\r\n\t\t\tthis.children[src] = node;\r\n\t\t\tnode.parent = this;\r\n\t\t}\r\n\t\tgetChild(src) {\r\n\t\t\treturn this.children[src];\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 将添加到返回节点之前\r\n\t\t */\r\n\t\tfindAnchor(index, dom) {\r\n\t\t\tif(dom) {\r\n\t\t\t\tthis.doms[index] = dom;\r\n\t\t\t}\r\n\r\n\t\t\tlet anchorDom;\r\n\t\t\tif(this._maxindex == -1) {\r\n\t\t\t\tthis._maxindex = index;\r\n\t\t\t\tthis._minindex = index;\r\n\t\t\t\t//层级之间,反向添加\r\n\t\t\t\tlet p = this.parent;\r\n\t\t\t\twhile(p) {\r\n\t\t\t\t\tif(p._maxindex == -1) {\r\n\t\t\t\t\t\tp = p.parent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tanchorDom = p.doms[p._minindex];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//同级之间、按照索引大小顺序添加\r\n\t\t\t\tif(index > this._maxindex) {\r\n\t\t\t\t\tanchorDom = this.doms[this._maxindex].nextSibling;\r\n\t\t\t\t\tthis._maxindex = index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(this._minindex > index) {\r\n\t\t\t\t\t\tthis._minindex = index;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let i = index + 1; i < this._maxindex; i++) {\r\n\t\t\t\t\t\tif(this.doms[i]) {\r\n\t\t\t\t\t\t\tanchorDom = this.doms[i];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!anchorDom) {\r\n\t\t\t\tanchorDom = lastDom ? lastDom.nextSibling : xsloader.script().nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn anchorDom;\r\n\t\t}\r\n\t}\r\n\r\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\r\n\tlet useImportLoad = false;\r\n\tlet useOnload = true;\r\n\tif(engine[1] || engine[7])\r\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\r\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\r\n\t\tuseOnload = false;\r\n\telse if(engine[4])\r\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\r\n\tlet cssAPI = {};\r\n\r\n\tlet cssIndex = 0;\r\n\t//src:Node\r\n\tconst rootNodes = {};\r\n\r\n\tfunction domIndex(dom) {\r\n\t\tlet index = 0;\r\n\t\twhile((dom = dom.previousSibling)) {\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\treturn index;\r\n\t}\r\n\r\n\tfunction buildAndGetNode(mthiz) {\r\n\t\tlet src = mthiz.src();\r\n\t\tlet p = mthiz.invoker();\r\n\r\n\t\twhile(p && p.src() == src) {\r\n\t\t\tp = p.invoker();\r\n\t\t}\r\n\r\n\t\tif(p) {\r\n\t\t\tlet pnode = buildAndGetNode(p);\r\n\t\t\tlet node = pnode.getChild(src);\r\n\t\t\tif(!node) {\r\n\t\t\t\tnode = new Node(src);\r\n\t\t\t\tpnode.addChild(src, node);\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t} else {\r\n\t\t\t//root\r\n\t\t\tif(!rootNodes[src]) {\r\n\t\t\t\trootNodes[src] = new Node(src);\r\n\t\t\t}\r\n\t\t\treturn rootNodes[src];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction appendCssDom(dom, cssThis, inverse) {\r\n\t\tif(cssThis && inverse) {\r\n\t\t\tlet mthis = cssThis.invoker();\r\n\t\t\tlet node = buildAndGetNode(mthis);\r\n\t\t\tdom.setAttribute(\"data-insert-index\", cssIndex++);\r\n\t\t\tlet index = cssThis.getIndex();\r\n\t\t\tlet nextDom = node.findAnchor(index, dom);\r\n\t\t\tscript.head().insertBefore(dom, nextDom);\r\n\r\n\t\t\tif(!lastDom || domIndex(dom) > domIndex(lastDom)) {\r\n\t\t\t\tlastDom = dom;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\txsloader.appendHeadDom(dom);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet curStyle, curSheet;\r\n\tlet createStyle = function(mthis, inverse) {\r\n\t\tcurStyle = document.createElement('style');\r\n\t\tappendCssDom(curStyle, mthis, inverse);\r\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\r\n\t};\r\n\tlet ieCnt = 0;\r\n\tlet ieLoads = [];\r\n\tlet ieCurCallback;\r\n\tlet createIeLoad = function(url, mthis, inverse) {\r\n\t\tcurSheet.addImport(url);\r\n\t\tcurStyle.onload = function() {\r\n\t\t\tprocessIeLoad(mthis, inverse);\r\n\t\t};\r\n\r\n\t\tieCnt++;\r\n\t\tif(ieCnt == 31) {\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\t\t\tieCnt = 0;\r\n\t\t}\r\n\t};\r\n\tlet processIeLoad = function(mthis, inverse) {\r\n\t\tieCurCallback();\r\n\t\tlet nextLoad = ieLoads.shift();\r\n\t\tif(!nextLoad) {\r\n\t\t\tieCurCallback = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tieCurCallback = nextLoad[1];\r\n\t\tcreateIeLoad(nextLoad[0], mthis, inverse);\r\n\t};\r\n\tlet importLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif(!curSheet || !curSheet.addImport)\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\r\n\t\tif(curSheet && curSheet.addImport) {\r\n\t\t\tif(ieCurCallback) {\r\n\t\t\t\tieLoads.push([url, callback]);\r\n\t\t\t} else {\r\n\t\t\t\tcreateIeLoad(url, mthis, inverse);\r\n\t\t\t\tieCurCallback = callback;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcurStyle.sheet.cssRules;\r\n\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t};\r\n\tlet linkLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tlet link = document.createElement('link');\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tif(useOnload)\r\n\t\t\tlink.onload = function() {\r\n\t\t\t\tlink.onload = function() {};\r\n\t\t\t\tsetTimeout(callback, 7);\r\n\t\t\t};\r\n\t\telse {\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\tlet sheet = document.styleSheets[i];\r\n\t\t\t\t\tif(sheet.href == link.href) {\r\n\t\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\t\treturn callback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t\tlink.href = url;\r\n\t\tappendCssDom(link, mthis, inverse);\r\n\t};\r\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\r\n\t\tlet inverse = !(config.plugins.css && config.plugins.css.inverse === false); //默认逆向\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\t//\t\tconsole.log(\"cssId=\"+cssId+\",cssSrc=\"+this.invoker().getUrl(cssId, true)+\",absUrl=\"+this.invoker().absUrl());\r\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload, this, inverse);\r\n\t};\r\n\tcssAPI.getCacheKey = function(cssId) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\tlet invoker = this.invoker();\r\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\r\n\t};\r\n\tcssAPI.loadCss = function(cssPath, callback) {\r\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\r\n\t};\r\n\r\n\tcssAPI.loadCsses = function() {\r\n\t\tlet args = arguments;\r\n\t\tfor(let i = 0; i < args.length; i++) {\r\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\r\n\t\t}\r\n\t};\r\n\treturn cssAPI;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"text\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"text\")\r\n\t\t\t.ok(function(text) {\r\n\t\t\t\tonload(text);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式：window!varNameInWindow=>>modulePath\r\n */\r\n//window插件,用于添加模块到window对象中\r\nxsloader.define(\"window\", {\r\n\tisSingle: true,\r\n\tpluginMain: function(arg, onload, onerror, config, http) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\twindow[moduleName] = mod;\r\n\t\t\tonload(mod);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式:withdeps!modulePath=>>[deps]\r\n */\r\nxsloader.define(\"withdeps\", {\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet depsStr = arg.substring(index + 3);\r\n\t\tlet deps;\r\n\t\ttry {\r\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\r\n\t\t\tif(!xsloader.isArray(deps)) {\r\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\tonerror(\"deps error:\" + depsStr);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.invoker().withAbsUrl().require([\r\n\t\t\t[false].concat(deps), moduleName\r\n\t\t], function(_deps, mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\torderDep: true\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 加载json对象\r\n */\r\nxsloader.define(\"json\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"json\")\r\n\t\t\t.ok(function(json) {\r\n\t\t\t\tonload(json);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\r\n/**\r\n * option._beforeOpenHook\r\n * option._onOkResponseHook\r\n * option._onFailResponseHook\r\n * \r\n * @param {Object} option\r\n */\r\nfunction httpRequest(option) {\r\n\tif(!option) {\r\n\t\toption = {};\r\n\t}\r\n\r\n\tfunction prop(obj, varName, defaultVal) {\r\n\t\tif(obj[varName] === undefined) {\r\n\t\t\treturn defaultVal;\r\n\t\t} else {\r\n\t\t\treturn obj[varName];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction putProp(obj, varName, toObj) {\r\n\t\tif(obj[varName]) {\r\n\t\t\tfor(let x in obj[varName]) {\r\n\t\t\t\tlet value = obj[varName][x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttoObj[x] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlet _url = prop(option, \"url\", \"\"),\r\n\t\t_method = prop(option, \"method\", \"GET\"),\r\n\t\t_params = {},\r\n\t\t_headers = {\r\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\r\n\t\t},\r\n\t\t_async = prop(option, \"async\", true),\r\n\t\t_multiPart = prop(option, \"multiPart\", false),\r\n\t\t_handleType = prop(option, \"handleType\", \"json\");\r\n\tlet _timeout = option.timeout;\r\n\tputProp(option, \"params\", _params);\r\n\tputProp(option, \"headers\", _headers);\r\n\r\n\tlet okCallback = option.ok;\r\n\tlet failCallback = option.fail;\r\n\tlet uploadStartCallback = option.uploadStart;\r\n\tlet uploadProgressCallback = option.uploadProgress;\r\n\tlet uploadOkCallback = option.uploadOk;\r\n\tlet uploadErrorCallback = option.uploadError;\r\n\tlet uploadEndCallback = option.uploadEnd;\r\n\r\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\r\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\r\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\r\n\r\n\tfunction createXhr() {\r\n\t\tlet xhr, i, progId;\r\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\r\n\t\t\tfor(i = 0; i < 3; i += 1) {\r\n\t\t\t\tprogId = progIds[i];\r\n\t\t\t\ttry {\r\n\t\t\t\t\txhr = new ActiveXObject(progId);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(xhr) {\r\n\t\t\t\t\tprogIds = [progId];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction conn() {\r\n\t\t_conn(createXhr());\r\n\t}\r\n\r\n\tfunction _conn(xhr) {\r\n\t\tlet option = {\r\n\t\t\turl: _url,\r\n\t\t\tmethod: _method.toUpperCase(),\r\n\t\t\tparams: _params,\r\n\t\t\theaders: _headers,\r\n\t\t\thandleType: _handleType,\r\n\t\t\tasync: _async,\r\n\t\t\tmultiPart: _multiPart,\r\n\t\t\ttimeout: _timeout\r\n\t\t};\r\n\t\t_beforeOpenHook(option, function() {\r\n\t\t\t_connAfterOpenHook(option, xhr);\r\n\t\t}, xhr);\r\n\t}\r\n\r\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\r\n\t\t_onFailResponseHook(option, function(result) {\r\n\t\t\tif(result !== false && result !== undefined) {\r\n\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else if(typeof failCallback == \"function\") {\r\n\t\t\t\tfailCallback(err);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}, xhr, extraErr);\r\n\t}\r\n\r\n\tfunction _connAfterOpenHook(option, xhr) {\r\n\t\tlet body;\r\n\t\tif(option.multiPart) {\r\n\t\t\tlet formData = new FormData();\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(xsloader.isArray(value)) {\r\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformData.append(x, value);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tbody = formData;\r\n\t\t} else {\r\n\t\t\tbody = \"\";\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof value == \"object\") {\r\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\r\n\t\t\t\t}\r\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\r\n\t\t\t}\r\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\r\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\r\n\t\t\t\t\toption.url += \"?\";\r\n\t\t\t\t}\r\n\t\t\t\toption.url += body;\r\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\r\n\t\t\t\tbody = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\txhr.open(option.method, option.url, option.async);\r\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\r\n\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\r\n\t\t}\r\n\t\tfor(let header in option.headers) {\r\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\r\n\t\t}\r\n\r\n\t\tif(typeof uploadStartCallback == \"function\") {\r\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadProgressCallback == \"function\") {\r\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadOkCallback == \"function\") {\r\n\t\t\txhr.upload.onload = uploadOkCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadErrorCallback == \"function\") {\r\n\t\t\txhr.upload.onerror = uploadErrorCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadEndCallback == \"function\") {\r\n\t\t\txhr.upload.onloadend = uploadEndCallback;\r\n\t\t}\r\n\r\n\t\tlet timeoutTimer;\r\n\t\tlet isTimeout = false;\r\n\t\tif(option.timeout) {\r\n\t\t\ttimeoutTimer = setTimeout(function() {\r\n\t\t\t\tisTimeout = true;\r\n\t\t\t\txhr.abort();\r\n\t\t\t\tclearTimeout(timeoutTimer);\r\n\t\t\t}, option.timeout);\r\n\t\t}\r\n\r\n\t\txhr.onreadystatechange = function(evt) {\r\n\t\t\tlet status, err;\r\n\t\t\tif(xhr.readyState === 4) {\r\n\t\t\t\tstatus = xhr.status || 0;\r\n\t\t\t\tif(status > 399 && status < 600 || !status) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet result;\r\n\t\t\t\t\tif(option.handleType === \"json\") {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\r\n\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(option.handleType === \"text\") {\r\n\t\t\t\t\t\tresult = xhr.responseText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\r\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xhr);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif(timeoutTimer && isTimeout) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send(body);\r\n\t}\r\n\r\n\tlet requestObj = {\r\n\t\tmultiPart(multiPart) {\r\n\t\t\t_multiPart = multiPart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadStart(uploadStart) {\r\n\t\t\tuploadStartCallback = uploadStart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadProgress(uploadProgress) {\r\n\t\t\tuploadProgressCallback = uploadProgress;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadOk(callback) {\r\n\t\t\tuploadOkCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadError(callback) {\r\n\t\t\tuploadErrorCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadEnd(uploadEnd) {\r\n\t\t\tuploadEndCallback = uploadEnd;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\turl(urlStr) {\r\n\t\t\t_url = urlStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tmethod(methodStr) {\r\n\t\t\t_method = methodStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttimeout(timeout) {\r\n\t\t\t_timeout = timeout;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tasync(isAsync) {\r\n\t\t\t_async = isAsync;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tparams(paramsObj) {\r\n\t\t\tif(paramsObj) {\r\n\t\t\t\tfor(let x in paramsObj) {\r\n\t\t\t\t\tlet value = paramsObj[x];\r\n\t\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_params[x] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\theaders(headersObj) {\r\n\t\t\tif(headersObj) {\r\n\t\t\t\tfor(let x in headersObj) {\r\n\t\t\t\t\t_headers[x] = headersObj[x];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\thandleType(_handleType) {\r\n\t\t\treturn this.handleAs(_handleType);\r\n\t\t},\r\n\t\thandleAs(handleType) {\r\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\r\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\r\n\t\t\t}\r\n\t\t\t_handleType = handleType;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tok(callback) {\r\n\t\t\tokCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfail(callback) {\r\n\t\t\tfailCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_beforeOpenHook(callback) {\r\n\t\t\t_beforeOpenHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onOkResponseHook(callback) {\r\n\t\t\t_onOkResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onFailResponseHook(callback) {\r\n\t\t\t_onFailResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tdone() {\r\n\t\t\ttry {\r\n\t\t\t\tconn();\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif(typeof failCallback == \"function\") {\r\n\t\t\t\t\tfailCallback(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn requestObj;\r\n}\r\n/**\r\n */\r\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\r\n\tcallback();\r\n};\r\n\r\n/**\r\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\r\n */\r\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\r\n\tcallback(result);\r\n};\r\n/**\r\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\r\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\r\n */\r\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\r\n\tcallback(undefined);\r\n};\r\n\r\nwindow._xshttp_request_ = httpRequest;\r\n\r\nxsloader.define(\"xshttp\", [], function() {\r\n\treturn httpRequest;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 返回Request返回一个Promise\r\n */\r\nxsloader.define(\"request\", [\"xshttp\"], function(http) {\r\n\t/**\r\n\t * 参数列表:\r\n\t * async:始终为true\r\n\t * ok与fail失效\r\n\t * 其他参数同xshttp\r\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\r\n\t * @param {Object} option\r\n\t */\r\n\tlet Request = function(option) {\r\n\t\toption = xsloader.extend({\r\n\t\t\tparams: undefined,\r\n\t\t\theaders: undefined,\r\n\t\t\tmethod: undefined,\r\n\t\t\turl: undefined,\r\n\t\t\tcallback: undefined\r\n\t\t}, option);\r\n\t\toption.async = true;\r\n\r\n\t\tlet promise = new Promise((resolve, reject) => {\r\n\t\t\toption.ok = function(rs) {\r\n\t\t\t\tresolve(rs);\r\n\t\t\t};\r\n\t\t\toption.fail = function(err) {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t\thttp(option).done();\r\n\t\t});\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\treturn Request;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\ntry {\r\n\tlet isXsMsgDebug = false;\r\n\tlet api = {};\r\n\r\n\tfunction isDebug(type) {\r\n\t\treturn isXsMsgDebug;\r\n\t}\r\n\r\n\tapi.linkedList = function() {\r\n\t\treturn new LinkedList();\r\n\t};\r\n\r\n\tfunction LinkedList() {\r\n\t\tfunction newNode(element) {\r\n\t\t\tlet node = {\r\n\t\t\t\telement: element,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tpre: null\r\n\t\t\t};\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\tlet length = 0;\r\n\t\tlet headNode = newNode(),\r\n\t\t\tlastNode = headNode;\r\n\r\n\t\t/**\r\n\t\t * 在链表末尾添加元素\r\n\t\t */\r\n\t\tthis.append = function(element) {\r\n\t\t\tlet current = newNode(element);\r\n\r\n\t\t\tlastNode.next = current;\r\n\t\t\tcurrent.pre = lastNode;\r\n\t\t\tlastNode = current;\r\n\t\t\tlength++;\r\n\t\t};\r\n\r\n\t\t//在链表的任意位置插入元素\r\n\t\tthis.insert = function(position, element) {\r\n\t\t\tif(position >= 0 && position <= length) {\r\n\r\n\t\t\t\tlet node = newNode(element);\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tpNode.next.pre = node;\r\n\t\t\t\t\tnode.next = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t\tpNode.next = node;\r\n\t\t\t\tnode.pre = pNode;\r\n\t\t\t\tlength++;\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.elementAt = function(position) {\r\n\t\t\treturn getElement(position);\r\n\t\t};\r\n\r\n\t\tfunction getElement(position, willRemove) {\r\n\t\t\tif(position >= 0 && position < length) {\r\n\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tlet currentNode = pNode.next;\r\n\t\t\t\t\tif(willRemove) {\r\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlength--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn currentNode.element;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @param callback function 返回true表示移除\r\n\t\t */\r\n\t\tthis.eachForRemove = function(callback) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tlet currentNode = pNode;\r\n\t\t\t\tif(callback(currentNode)) {\r\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlength--;\r\n\t\t\t\t\tpNode = nextCurrentNode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//从链表中移除元素\r\n\t\tthis.removeAt = function(position) {\r\n\t\t\treturn getElement(position, true);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 移除并获取第一个元素\r\n\t\t * @param callback function(elem,index)\r\n\t\t */\r\n\t\tthis.pop = function(callback) {\r\n\t\t\treturn this.removeAt(0);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 返回元素在链表中的位置\r\n\t\t * @param element object|function(elem)\r\n\t\t */\r\n\t\tthis.indexOf = function(element) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\tlet index = 0;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tif(typeof element == \"function\") {\r\n\t\t\t\t\tif(element(pNode.element)) {\r\n\t\t\t\t\t\treturn index;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(pNode.element === element) {\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t}\r\n\t\t\t\tindex++;\r\n\t\t\t\tpNode = pNode.next;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tthis.find = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\r\n\t\t};\r\n\r\n\t\t//移除某个元素\r\n\t\tthis.remove = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn this.removeAt(index);\r\n\t\t};\r\n\r\n\t\t//判断链表是否为空\r\n\r\n\t\tthis.isEmpty = function() {\r\n\t\t\treturn length === 0;\r\n\t\t};\r\n\r\n\t\t//返回链表的长度\r\n\t\tthis.size = function() {\r\n\t\t\treturn length;\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tif(window.addEventListener) {\r\n\t\tlet postMessageBridge = (function() {\r\n\t\t\tlet handle = {};\r\n\r\n\t\t\tlet instanceMap = {}; //id:listener\r\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\r\n\t\t\tlet instanceBindMap = {}; //instanceid:true\r\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\r\n\r\n\t\t\t//isActive为false表示监听者\r\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\r\n\r\n\t\t\t\tlet listener = {\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t_onConned: _onConned,\r\n\t\t\t\t\t_onMsg: _onMsg,\r\n\t\t\t\t\t_onResponse: _onResponse,\r\n\t\t\t\t\t_onElse: _onElse,\r\n\t\t\t\t\tconndata: conndata,\r\n\t\t\t\t\tosource: source,\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\tconnectingSource: connectingSource,\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\trefused: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\r\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\r\n\t\t\t\t}\r\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\r\n\r\n\t\t\t\tlet instanceid = listener.id;\r\n\t\t\t\tinstanceMap[instanceid] = listener;\r\n\t\t\t\treturn instanceid;\r\n\t\t\t};\r\n\r\n\t\t\thandle.remove = function(instanceid) {\r\n\t\t\t\t//TODO !!!!!!!\r\n\t\t\t\t/*let listener = listeners[id];\r\n\t\t\t\tdelete listeners[id];\r\n\t\t\t\tif(listener.active) {\r\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\r\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\r\n\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\r\n\t\t\t\t\t\t\tif(as[k] == id) {\r\n\t\t\t\t\t\t\t\tas.splice(k, 1);\r\n\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(found) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}*/\r\n\t\t\t};\r\n\r\n\t\t\thandle.send = function(data, instanceid, msgid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendConn = function(instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendResponse = function(data, instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\r\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\r\n\t\t\t\tlet listener = instanceMap[minstanceid];\r\n\t\t\t\tlistener._onElse(\"binded\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\r\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\r\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\r\n\t\t\t\t\tthrow new Error(\"source changed!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onConned(listener.osource, data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onMsg(data, msgid);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onResponse(data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\tid: instanceid,\r\n\t\t\t\t\tmsgid: msgid\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\r\n\t\t\t\t\tconsole.log(msg);\r\n\t\t\t\t}\r\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener('message', function(event) {\r\n\t\t\t\tif(event.data && (typeof event.data == \"string\") && event.data.substring(0, 1) == \"{\") {\r\n\t\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\r\n\t\t\t\t\t\tconsole.log(event.data);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet data;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(\"error data:\", event.data);\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!data || !(data.cmd && data.type)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet cmd = data.cmd;\r\n\t\t\t\t\t\tlet oinstanceid = data.id;\r\n\t\t\t\t\t\tlet rdata = data.data;\r\n\t\t\t\t\t\tlet type = data.type;\r\n\t\t\t\t\t\tlet msgid = data.msgid;\r\n\r\n\t\t\t\t\t\tif(type == \"conn\") {\r\n\t\t\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"accept\") {\r\n\t\t\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"conned\") {\r\n\t\t\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"msg\") {\r\n\t\t\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"response\") {\r\n\t\t\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"binded\") {\r\n\t\t\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\thandle.runAfter = function(time, callback) {\r\n\t\t\t\tsetTimeout(callback, time);\r\n\t\t\t};\r\n\r\n\t\t\treturn handle;\r\n\t\t})();\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} cmd\r\n\t\t * @param {Object} source\r\n\t\t * @param {Object} connectingSource\r\n\t\t * @param {Object} onfailed\r\n\t\t * @param {Object} isActive\r\n\t\t * @param {Object} conndata 连接传送的数据\r\n\t\t * @param {Object} timeout 连接超时时间，毫秒\r\n\t\t * @param {Object} sleep 连接检测的休眠时间，毫秒\r\n\t\t */\r\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata, timeout, sleep) {\r\n\t\t\tlet msgQueue = new LinkedList();\r\n\r\n\t\t\tlet SLEEP = sleep;\r\n\t\t\tlet starttime;\r\n\t\t\tlet isFailed = false;\r\n\t\t\tlet isConnected = false;\r\n\t\t\tlet isCanceled = false;\r\n\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet handleId;\r\n\r\n\t\t\tthis.onConnectedListener = null;\r\n\t\t\tthis.onReceiveListener = null;\r\n\t\t\tthis.send = function(data) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t};\r\n\t\t\t\tmsgQueue.append(msg);\r\n\t\t\t\tsendTop();\r\n\t\t\t};\r\n\r\n\t\t\tthis.send.release = function() {\r\n\t\t\t\tpostMessageBridge.remove(handleId);\r\n\t\t\t};\r\n\r\n\t\t\tfunction couldChat() {\r\n\t\t\t\treturn !isFailed && !isCanceled;\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onConned(_source, data) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\tthiz.onConnectedListener.call(thiz, data);\r\n\t\t\t\t\tisConnected = true;\r\n\t\t\t\t\tsendTop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onMsg(data, msgid) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\r\n\t\t\t\t\t\tid: msgid\r\n\t\t\t\t\t}, handleId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onResponse(data) {\r\n\t\t\t\tmsgQueue.remove(function(elem) {\r\n\t\t\t\t\treturn elem.id = data.id;\r\n\t\t\t\t});\r\n\t\t\t\tcouldChat() && sendTop();\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onElse(type) {\r\n\t\t\t\tif(type == \"binded\") {\r\n\t\t\t\t\tisCanceled = true;\r\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\tonfailed(\"canceled\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction initListen() {\r\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\r\n\t\t\t}\r\n\r\n\t\t\tfunction sendTop() {\r\n\t\t\t\tif(isConnected) {\r\n\t\t\t\t\tlet msg;\r\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\r\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isTimeout() {\r\n\t\t\t\tlet dt = new Date().getTime() - starttime;\r\n\t\t\t\treturn dt > timeout;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 主动方初始化\r\n\t\t\t */\r\n\t\t\tfunction initActively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.sendConn(handleId);\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, initActively);\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 被动方检查\r\n\t\t\t */\r\n\t\t\tfunction checkPassively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:wait connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, checkPassively);\r\n\t\t\t}\r\n\r\n\t\t\t{\r\n\t\t\t\tstarttime = new Date().getTime();\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t} else if(!isActive) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tcheckPassively();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setSource = function(_source) {\r\n\t\t\t\tsource = _source;\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet handleApi = api;\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} winObjOrCallback\r\n\t\t * @param {Object} option\r\n\t\t * @param {Object} notActive\r\n\t\t */\r\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\r\n\t\t\tconst gconfig = xsloader.config().plugins.xsmsg;\r\n\t\t\toption = xsloader.extendDeep({\r\n\t\t\t\tcmd: \"default-cmd\",\r\n\t\t\t\tlistener: null,\r\n\t\t\t\tconnected: null,\r\n\t\t\t\tconndata: null,\r\n\t\t\t\ttimeout: gconfig.timeout,\r\n\t\t\t\tsleep: gconfig.sleep,\r\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\r\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\t\t\tcallback(mine == origin, \"default\");\r\n\t\t\t\t},\r\n\t\t\t\tonfailed: function(errtype) {\r\n\t\t\t\t\tif(errtype.indexOf(\"timeout:\") == 0) {\r\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \" ,err='\" + errtype + \"' ,my page=\" + location.href);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, option);\r\n\r\n\t\t\tlet cmd = option.cmd;\r\n\t\t\tlet connectedCallback = option.connected;\r\n\t\t\tlet receiveCallback = option.listener;\r\n\t\t\tlet conndata = option.conndata;\r\n\t\t\tlet onfailed = option.onfailed;\r\n\t\t\tlet timeout = option.timeout;\r\n\t\t\tlet sleep = option.sleep;\r\n\r\n\t\t\tlet isActive = !notActive;\r\n\t\t\tlet connectingSource = option.connectingSource;\r\n\r\n\t\t\tlet unit;\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t} else {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\r\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\r\n\t\t\t};\r\n\t\t\tif(connectedCallback) {\r\n\t\t\t\tunit.onConnectedListener = function(conndata) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(receiveCallback) {\r\n\t\t\t\tunit.onReceiveListener = function(data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treceiveCallback(data, this.send);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\twinObjOrCallback(function(winObj) {\r\n\t\t\t\t\tunit.setSource(winObj);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn unit.send;\r\n\t\t}\r\n\r\n\t\tfunction _connectIFrame(iframe, option) {\r\n\t\t\tlet winObj;\r\n\t\t\tif(typeof iframe == \"string\") {\r\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\r\n\t\t\t\twinObj = function(callback) {\r\n\t\t\t\t\tiframe.onload = function() {\r\n\t\t\t\t\t\tcallback(this.contentWindow);\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\twinObj = iframe.contentWindow;\r\n\t\t\t}\r\n\t\t\treturn _connectWindow(winObj, option);\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 用于连接iframe.\r\n\t\t * @param {Object} iframe iframe或selector\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectIFrame = function(iframe, option) {\r\n\t\t\treturn _connectIFrame(iframe, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接父页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectParent = function(option) {\r\n\t\t\treturn _connectWindow(window.parent, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接顶层页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectTop = function(option) {\r\n\t\t\treturn _connectWindow(window.top, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接打开者.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectOpener = function(option) {\r\n\t\t\treturn _connectWindow(window.opener, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于监听其他页面发送消息.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回一个sender\r\n\t\t */\r\n\t\thandleApi.listenMessage = function(option) {\r\n\t\t\treturn _connectWindow(null, option, true);\r\n\t\t};\r\n\r\n\t\thandleApi.debug = function(isDebug) {\r\n\t\t\tisXsMsgDebug = isDebug;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * *******************\r\n\t\t * option参数\r\n\t\t *********************\r\n\t\t * option.cmd:\r\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\r\n\t\t * option.listener: function(data,sender)\r\n\t\t * option.connected:function(sender,conndata)\r\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\r\n\t\t * option.conndata:\r\n\t\t * option.timeout:连接超时时间\r\n\t\t * option.sleep:连接检测休眠时间\r\n\t\t **************\r\n\t\t * 回调的extra参数\r\n\t\t **************\r\n\t\t * originStr:对方页面的地址\r\n\t\t */\r\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\r\n\t}\r\n\r\n\txsloader.define(\"XsLinkedList\", function() {\r\n\t\treturn LinkedList;\r\n\t});\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 用于图片加载\r\n */\r\nxsloader.define(\"image\", {\r\n\tpluginMain(name, onload, onerror, config) {\r\n\t\tlet src = this.invoker().getUrl(name, false);\r\n\t\tlet img = new Image();\r\n\t\tlet callback = (ok) => {\r\n\t\t\tlet image = img;\r\n\t\t\timg = null;\r\n\t\t\timage.onload = null;\r\n\t\t\timage.οnerrοr = null;\r\n\t\t\tonload(ok ? image : null);\r\n\t\t};\r\n\t\timg.onload = function() {\r\n\t\t\tcallback(true);\r\n\t\t};\r\n\t\timg.οnerrοr = function() {\r\n\t\t\tcallback(false);\r\n\t\t};\r\n\t\timg.src = src;\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tif(img) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif(img) {\r\n\t\t\t\t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, config.plugins.image.timeout);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:default!module\r\n */\r\nxsloader.define(\"default\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tlet handle = this.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tif(xsloader.isObject(mod)) {\r\n\t\t\t\tmod = mod[\"default\"];\r\n\t\t\t\tif(mod === undefined) {\r\n\t\t\t\t\tmod = null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmod = null;\r\n\t\t\t}\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(err, invoker) {\r\n\t\t\tonerror(err);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"xsloader4j-server-bridge\", [], function() {\n\tconst base64 = new xsloader.Base64();\n\tlet isDebug = false;\n\n\t/**\n\t * 用于支持jsx代码\n\t * @param {Object} vm\n\t */\n\tfunction __renderJsx(vm) {\n\t\treturn function(component, props /*, ...children*/ ) {\n\t\t\tif(!vm || !vm.$createElement) {\n\t\t\t\tlet Vue = xsloader.require.get(\"vue\");\n\t\t\t\tvm = new Vue();\n\t\t\t}\n\t\t\tlet $createElement = vm.$createElement;\n\t\t\tif(!$createElement) {\n\t\t\t\tthrow new Error(\"not found function '$createElement'\");\n\t\t\t}\n\t\t\tlet children = [];\n\t\t\tfor(let i = 2; i < arguments.length; i++) {\n\t\t\t\tchildren.push(arguments[i]);\n\t\t\t}\n\t\t\treturn $createElement(component, props, children);\n\t\t};\n\t}\n\n\tconst mod = {\n\t\tgetDefine(thiz) {\n\t\t\treturn thiz.define;\n\t\t},\n\t\tgetRequire(thiz) {\n\t\t\treturn thiz.require;\n\t\t},\n\t\tgetInvoker(thiz) {\n\t\t\treturn thiz.invoker();\n\t\t},\n\t\trenderJsx(vm) {\n\t\t\treturn __renderJsx(vm);\n\t\t},\n\t\tgetVueCompiler(thiz) {\n\t\t\tlet rt = function(exports) {\n\t\t\t\tlet Vue = xsloader.require(\"vue\");\n\t\t\t\tlet _default = exports['default'] || exports;\n\t\t\t\tif(_default.template) {\n\n\t\t\t\t\t//处理src,href,url(...)\n\t\t\t\t\tlet dealUrl = function(reg, group, str, appendArgs, fun) {\n\t\t\t\t\t\tfun = fun || function(regResult, url) {\n\t\t\t\t\t\t\treturn url;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlet result = \"\";\n\t\t\t\t\t\twhile(true) {\n\t\t\t\t\t\t\tlet rs = reg.exec(str);\n\t\t\t\t\t\t\tif(!rs) {\n\t\t\t\t\t\t\t\tresult += str;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet rurl = rs[group].trim();\n\n\t\t\t\t\t\t\t\tresult += str.substring(0, rs.index);\n\t\t\t\t\t\t\t\tif(xsloader.startsWith(rurl, \"url(\")) {\n\t\t\t\t\t\t\t\t\tresult += rs[0];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresult += fun(rs, thiz.getUrl(rurl, appendArgs));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstr = str.substring(rs.index + rs[0].length);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\t//排除掉':src'等属性\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)(src|href)\\s*=\\s*('|\")([^'\"\\(\\)]+)('|\")/, 4, _default.template, false, function(regResult, url) {\n\t\t\t\t\t\treturn regResult[2] + \"=\" + regResult[3] + url + regResult[5];\n\t\t\t\t\t});\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)url\\(([^\\(\\)]+)\\)/, 2, _default.template, true); //后处理url，src与href中可能包含url(...)\n\t\t\t\t\tlet res;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(isDebug) {\n\t\t\t\t\t\t\tconsole.log(\"compile vue template content,url=\", thiz.getUrl());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = Vue.compile(_default.template); //用template有bug，根元素有多个时出现死循环\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(\"url=\", thiz.getUrl());\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t\t_default.render = res.render;\n\t\t\t\t\t_default.staticRenderFns = res.staticRenderFns;\n\t\t\t\t}\n\t\t\t\tdelete _default.template;\n\t\t\t};\n\t\t\treturn rt;\n\t\t},\n\t\tgetVtemplate(thiz) {\n\t\t\tlet vtemplate = (component) => {\n\t\t\t\treturn(resolve, reject) => {\n\t\t\t\t\tlet invoker = thiz.invoker();\n\t\t\t\t\tthiz.require([component], (comp) => {\n\t\t\t\t\t\tresolve(comp);\n\t\t\t\t\t}).error((err) => {\n\t\t\t\t\t\treject(err.err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn vtemplate;\n\t\t},\n\t\tgetImporter(thiz) {\n\t\t\tlet vtemplate = this.getVtemplate(thiz);\n\t\t\treturn function(name) {\n\t\t\t\treturn new Promise(vtemplate(name));\n\t\t\t};\n\t\t},\n\t\tgetStyleBuilder(thiz) {\n\t\t\treturn function(cssContent) {\n\t\t\t\tif(cssContent) {\n\t\t\t\t\tlet id = xsloader.randId();\n\t\t\t\t\tlet count = 0;\n\t\t\t\t\tlet styleDom = document.createElement(\"style\");\n\t\t\t\t\tstyleDom.setAttribute(\"id\", id);\n\t\t\t\t\tstyleDom.setAttribute(\"type\", \"text/css\");\n\t\t\t\t\tstyleDom.innerHTML = cssContent;\n\n\t\t\t\t\tlet obj = {\n\t\t\t\t\t\tinit() {\n\t\t\t\t\t\t\tif(count <= 0) {\n\t\t\t\t\t\t\t\txsloader.appendHeadDom(styleDom);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tdestroy() {\n\t\t\t\t\t\t\t\t\tif(--count <= 0) {\n\t\t\t\t\t\t\t\t\t\tlet element = document.getElementById(id);\n\t\t\t\t\t\t\t\t\t\tif(element) {\n\t\t\t\t\t\t\t\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t};\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tdecodeBase64(base64Content) {\n\t\t\tif(base64Content) {\n\t\t\t\treturn base64.decode(base64Content);\n\t\t\t}\n\t\t}\n\n\t};\n\n\treturn mod;\n});","// 静态资源服务\r\nimport utils from \"./util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst http = global._xshttp_request_;\r\nconst DATA_CONF = \"data-conf\",\r\n\tDATA_CONFX = \"data-xsloader-conf\";\r\nconst DATA_CONF2 = \"data-conf2\",\r\n\tDATA_CONF2X = \"data-xsloader-conf2\";\r\nconst DATA_MAIN = \"data-main\",\r\n\tDATA_MAINX = \"data-xsloader-main\";\r\nconst DATA_CONF_TYPE = \"data-conf-type\";\r\n\r\nlet serviceConfigUrl;\r\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\r\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\r\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\r\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\r\n\tdataConfType = \"auto\";\r\n}\r\n\r\nlet initFun = () => {\r\n\tfunction getMainPath(config) {\r\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\r\n\t\tlet path = location.pathname;\r\n\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tlet name = path.substring(index + 1);\r\n\t\tif(name === \"\") {\r\n\t\t\tname = \"index\";\r\n\t\t}\r\n\t\tif(xsloader.endsWith(name, \".html\")) {\r\n\t\t\tname = name.substring(0, name.length - 5);\r\n\t\t}\r\n\t\tif(!mainPath) {\r\n\t\t\tmainPath = \"./main/{name}.js\";\r\n\t\t}\r\n\t\tmainPath = mainPath.replace(\"{name}\", name);\r\n\t\treturn mainPath;\r\n\t}\r\n\r\n\tfunction extendConfig(config) {\r\n\t\tconfig = xsloader.extendDeep({\r\n\t\t\tproperties: {},\r\n\t\t\tmain: {\r\n\t\t\t\tgetPath() {\r\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\r\n\t\t\t\t},\r\n\t\t\t\tname: \"main\",\r\n\t\t\t\tlocalConfigVar: \"lconfig\",\r\n\t\t\t\tglobalConfigVar: \"gconfig\",\r\n\t\t\t\tbefore(name) {\r\n\t\t\t\t\tconsole.log(\"before:\" + name);\r\n\t\t\t\t},\r\n\t\t\t\tafter(name) {\r\n\t\t\t\t\tconsole.log(\"after:\" + name);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tservice: {\r\n\t\t\t\thasGlobal: false,\r\n\t\t\t\tresUrls: []\r\n\t\t\t},\r\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\r\n\t\t\t\treturn \"default\";\r\n\t\t\t},\r\n\t\t\tloader: {\r\n\t\t\t\t\"default\": {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config);\r\n\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\r\n\t\thttp({\r\n\t\t\turl: url,\r\n\t\t\tmethod: \"get\",\r\n\t\t\ttimeout: 20000,\r\n\t\t\thandleType: \"text\",\r\n\t\t\tok(confText) {\r\n\r\n\t\t\t\tlet conf;\r\n\t\t\t\tif(dataConfType == \"js\") {\r\n\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t} else if(dataConfType == \"json\") {\r\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\r\n\t\t\t\t\t\t//同域则默认用脚本解析\r\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconf = extendConfig(conf);\r\n\t\t\t\tif(conf.beforeDealProperties) {\r\n\t\t\t\t\tconf.beforeDealProperties();\r\n\t\t\t\t}\r\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\r\n\r\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\r\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\r\n\t\t\t\t\t\tfunction(globalConfig) {\r\n\t\t\t\t\t\t\tlet localConfig = conf;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\r\n\r\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\r\n\r\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\r\n\t\t\t\t\t\t\tlet conf;\r\n\t\t\t\t\t\t\tlet loader;\r\n\t\t\t\t\t\t\tif(loaderName != null) {\r\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\r\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = globalConfig;\r\n\t\t\t\t\t\t\t\tif(loader){\r\n\t\t\t\t\t\t\t\t\tglobalConfig.current=loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\r\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = localConfig;\r\n\t\t\t\t\t\t\t\tif(loader){\r\n\t\t\t\t\t\t\t\t\tlocalConfig.current=loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(conf);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\r\n\t\t\t}\r\n\t\t}).done();\r\n\t}\r\n\r\n\tfunction startLoad() {\r\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\r\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\r\n\r\n\t\t\tlet mainName = localConfig.main.name;\r\n\r\n\t\t\tlet href = location.href;\r\n\t\t\tlet index = href.lastIndexOf(\"?\");\r\n\t\t\tif(index >= 0) {\r\n\t\t\t\thref = href.substring(0, index);\r\n\t\t\t}\r\n\r\n\t\t\tlet mainPath = getMainPath(localConfig);\r\n\r\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\r\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\r\n\t\t\tlet loader = localConfig.loader[loaderName];\r\n\t\t\tif(!loader) {\r\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlocalConfig.current=loaderName;\r\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\r\n\t\tlet resUrls = [];\r\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\r\n\r\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\r\n\r\n\t\txsloader.resUrlBuilder = function(groupModule) {\r\n\t\t\tlet as = [];\r\n\t\t\tutils.each(resUrls, function(url) {\r\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\r\n\t\t\t});\r\n\t\t\treturn as;\r\n\t\t};\r\n\t\tloader.ignoreProperties = true;\r\n\t\tloader.defineFunction = loader.defineFunction || {};\r\n\t\tloader.depsPaths = loader.depsPaths || {};\r\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\r\n\t\t\tlet theConfig = xsloader(loader);\r\n\r\n\t\t\tmainName = \"_plugin_main_\";\r\n\t\t\tlet deps = [];\r\n\t\t\tif(theConfig.deps) { //手动添加*依赖\r\n\t\t\t\tif(theConfig.deps[\"*\"]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\r\n\t\t\t\t}\r\n\t\t\t\tif(theConfig.deps[mainName]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdeps.push(mainPath);\r\n\t\t\txsloader.define(mainName, deps, function() {\r\n\r\n\t\t\t}).then({\r\n\t\t\t\tabsUrl: pageHref\r\n\t\t\t});\r\n\t\t} else if(!xsloader.hasDefine(mainName)) {\r\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\r\n\t\t\txsloader(loader);\r\n\t\t} else {\r\n\t\t\txsloader(loader);\r\n\t\t}\r\n\r\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\r\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\r\n\t\t\t\tconf.main.before.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\r\n\r\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\r\n\t\t\t\tconf.main.after.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\treturn rt;\r\n\t\t};\r\n\r\n\t\txsloader.require([mainName], function(main) {}).error((err, invoker) => {\r\n\t\t\tif(invoker) {\r\n\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\r\n\t\t\t}\r\n\t\t\tconsole.error(\"invoke main err:\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\txsloader.asyncCall(startLoad, true);\r\n};\r\n\r\nif(dataConf) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\r\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\r\n} else {\r\n\tinitFun = null;\r\n}\r\ninitFun && initFun();","import \"./core/index.js\";\r\nimport \"./define.js\";\r\nimport \"./core/plugins/index.js\";\r\nimport \"./service.js\"; //放在最后\r\nimport utils from \"./util/index.js\";\r\nutils.loaderEnd();"],"names":["g","undefined","window","self","global","Error","InVar","val","get","set","newVal","old","loaderFun","xsloader","apply","this","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","indexOf","pluginIndex","substring","index","theConfig","config","jsExts","i","length","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","finalPath","absolute","rs","exec","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","str","push","result","join","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","string","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","call","replaceModulePrefix","deps","m","pluginParam","query","test","startsWith","modulePrefixCount","modulePrefix","replaceStr","replace","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","thePageUrl","COMMENT_REGEXP","REPLACE_REQUIRE_GET_REGEXP","REPLACE_REQUIRE_REGEXP","NOT_REQUIRE_REGEXP","GraphPath","pathEdges","vertexMap","depMap","checkLoop","v","visited","recursionStack","paths","edges","edge","end","addEdge","begin","hasDep","name","tryAddEdge","hasLoop","strValue2Arr","each","ary","func","isSync","fromEnd","__commentReplace","match","singlePrefix","__appendInnerDeps","callbackString","reg","depIndex","notIndex","indexInArray","appendInnerDeps","callback","innerDepType","props","toString","idCount","getAndIncIdCount","PluginError","err","invoker","extra","unwrapError","n","isXsLoaderEnd","IE_VERSION","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","graphPath","loaderEnd","isLoaderEnd","whichTransitionEvent","t","el","createElement","transitions","style","transitionEvent","ToProgress","opt","progress","options","id","color","bgColor","height","duration","_typeof","key","opacityDuration","progressBar","container","setCSS","appendChild","body","prototype","setColor","backgroundColor","_isAuto","_timer","stopAuto","clearInterval","autoIncrement","time","dt","setInterval","_this","setProgress","toError","errColor","transit","width","getProgress","show","increase","toBeIncreasedProgress","decrease","toBeDecreasedProgress","finish","setTimeout","_this2","hide","parentNode","removeChild","reset","opacity","display","Base64","_keyStr","encode","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","_utf8_encode","charCodeAt","isNaN","charAt","decode","String","fromCharCode","_utf8_decode","utftext","c","c2","c3","urls","base","loading","base64","utils","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArrayFrom","JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","f","this_value","valueOf","Date","toJSON","isFinite","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","quote","lastIndex","a","slice","holder","k","partial","mind","value","Object","hasOwnProperty","stringify","replacer","space","parse","text","reviver","j","walk","eval","SyntaxError","proxyPolyfill","ProxyPolyfill","lastRevokeFn","o","target","handler","TypeError","throwRevoked","trap","unsafeHandler","proxy","isMethod","usingNew","constructor","args","unshift","getter","prop","setter","propertyNames","getOwnPropertyNames","Promise","__proto__","forEach","propertyMap","real","getOwnPropertyDescriptor","desc","enumerable","defineProperty","prototypeOk","setPrototypeOf","getPrototypeOf","seal","revocable","polyfillInit","ProxyUtil","Proxy","trim","randId","suffix","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","fn","xsJSON","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","search","s","ret","seg","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","isEmpty","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","baseUrl","dealUrl","getUrl2","tryCall","defaultReturn","exCallback","dealProperties","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","pushTask","callbackObj","handle","next","nextCallback","lastReturn","mineCount","ctrlCallback","asyncCallQueue","shift","nextObj","resolve","then","initCtrlCallback","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","clone","isDeep","source","flags","copy","setTime","attr","sortObject","keys","newObj","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","ready","addEventListener","removeEventListener","attachEvent","fun2","readyState","detachEvent","documentElement","doScroll","frameElement","readyCall","onReady","br","addEventHandle","type","env","version","toGlobal","deprecated","justLoader","is","funs","browser","ignoreAspect_","theDefinedMap","lastDefinObjectMap","ModuleDef","module","queue","_preModule","relyQueue","_preIndex","relyIt","isPreDependOn","modules","defaultModule","targetDef","preDependModule","_isSrc","nameOrUrl","setLastDefineObject","defineObject","getLastDefineObject","appendLoadingModuleDeps","moduleDef","mod","state","_deps","pushName","selfname","getModule","ifoneThenGet","isSrc","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","addTheAttrs","theObj","_invoker_","_modules_","_object","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","initInstance","justForSingle","dealInstance","hasFinished","onload","__default","onerror","last","concat","pluginMain","waitSeconds","moduleMap","absUrl","getName","Invoker","_newModule","DefineObject","appendConfigDepsAndEmbedDeps","newModule","instances","parent","parentDefine","relys","absUrlFromModule","absUrlFromDefineObject","getCallback","_dealApplyArgs","_loadCallback","exports","reinitByDefineObject","setInstanceType","_singlePluginResult","currentDefineModuleQueue","setState","isDefault","errinfo","_callback","_state","theCallback","getDeps","require","defined_module_for_deps","refmodule","toOtherModule","otherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","leaf","infos","genErrs","reverse","as","errModule","depMod","indexPlguin","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","theExports","hasCallErr","depCount","depModules","invoker_of_module","syncHandle","originDep","groupModule","i1","i2","i3","defaultVersion","_url","resUrlBuilder","isInUrls","getUrls","rurl","loadModule","module2","loadScript","scriptData","defaultMod","lastModule","m2Name","configDeps","d","depModule","dep_name","checkFinish","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","theHead","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","Handle","onError","ThisInvoker","_buildInvoker","getId","h","define","defineAsync","withAbsUrl","absUrlStr","_id","_im","p","getMineInvoker","getInvoker","nullNew","parentModule","names","directDepLength","hasOrderDep","_directDepLength","odeps","applyArgs","jsFilePath","absoluteUrl","isRequire","before","depBefore","depDeps","instance","getCurrentScript","isRemoveQueryHash","b","sourceURL","stacktrace","_getCurrentScriptOrSrc","__createNode","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","isFirstRequire","prerequire","mineInvoker","originDeps","argArr","theMod","timeid","customerErrCallback","isErr","isOk","plugins","enable","delay","clearTimer","clearTimeout","waitTime","logError","logFun","ifmodule","inject","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","_newContext","contextName","defQueue","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","splice","urlArg","addVersion","forPrefixSuffix","encodeURIComponent","dealUrlArgs","image","timeout","xsmsg","sleep","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","newInvoker","arg","info","vars","moduleNames","existsMods","newName","lastM","lastDom","Node","children","doms","anchorDom","_maxindex","_minindex","engine","useImportLoad","useOnload","curStyle","curSheet","cssAPI","cssIndex","rootNodes","domIndex","previousSibling","appendCssDom","cssThis","inverse","buildAndGetNode","mthiz","pnode","getChild","addChild","getIndex","findAnchor","createStyle","mthis","styleSheet","sheet","createIeLoad","addImport","processIeLoad","ieCnt","importLoad","ieCurCallback","ieLoads","textContent","loadInterval","cssRules","linkLoad","link","rel","styleSheets","nextLoad","cssId","css","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","_doOnFailResponseHook","xhr","extraErr","multiPart","urlStr","methodStr","isAsync","paramsObj","headers","headersObj","handleType","progId","XMLHttpRequest","ActiveXObject","createXhr","toUpperCase","timeoutTimer","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","isTimeout","abort","onreadystatechange","status","responseText","send","_connAfterOpenHook","extraErrorType","_xshttp_request_","reject","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","getElement","position","willRemove","pNode","currentNode","nextCurrentNode","current","insert","elementAt","eachForRemove","removeAt","find","remove","size","api","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","starttime","handleId","msgQueue","SLEEP","isFailed","isConnected","isCanceled","couldChat","_onConned","_source","data","onConnectedListener","sendTop","_onMsg","msgid","onReceiveListener","postMessageBridge","sendResponse","_onResponse","_onElse","initListen","listen","msg","initActively","sendConn","runAfter","release","checkPassively","setSource","_connectWindow","winObjOrCallback","notActive","unit","gconfig","listener","connected","origin","errtype","connectedCallback","receiveCallback","sender","winObj","_connectIFrame","iframe","contentWindow","osource","active","refused","instanceid","_sendData","event","oinstanceid","rdata","fromSource","originStr","listeners","Callback","isAccept","handleConn","minstanceid","handleAccept","checkSource","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","postMessage","img","οnerrοr","Image","getDefine","getRequire","renderJsx","vm","component","$createElement","Vue","getVueCompiler","_default","template","res","group","regResult","compile","render","staticRenderFns","getVtemplate","comp","getImporter","vtemplate","getStyleBuilder","cssContent","styleDom","innerHTML","init","destroy","getElementById","decodeBase64","base64Content","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","initXsloader","pageHref","mainName","conf","localConfig","resUrls","service","resUrl","originThis","originArgs","after","loadServiceConfig","tag","isLocal","confText","localConfigVar","globalConfigVar","hasGlobal","chooseLoader","beforeDealProperties","confUrl","globalConfig","loaderName"],"mappings":"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"}