{"version":3,"file":"xsloader.js","sources":["../xsloader-src/util/global.js","../xsloader-src/core/loader.js","../xsloader-src/util/urls.js","../xsloader-src/util/base.js","../xsloader-src/util/loading.js","../xsloader-src/util/base64.js","../xsloader-src/util/index.js","../xsloader-src/public/global-deprecated.js","../xsloader-src/polyfill/json.js","../xsloader-src/polyfill/proxy.js","../xsloader-src/polyfill/index.js","../xsloader-src/public/global-base.js","../xsloader-src/public/is.js","../xsloader-src/public/funs.js","../xsloader-src/public/browser.js","../xsloader-src/public/index.js","../xsloader-src/core/module-def.js","../xsloader-src/core/module.js","../xsloader-src/core/script.js","../xsloader-src/core/index.js","../xsloader-src/define.js","../xsloader-src/core/plugins/inner-dep.js","../xsloader-src/core/plugins/ready.js","../xsloader-src/core/plugins/try.js","../xsloader-src/core/plugins/nodeps.js","../xsloader-src/core/plugins/exists.js","../xsloader-src/core/plugins/name.js","../xsloader-src/core/plugins/css.js","../xsloader-src/core/plugins/text.js","../xsloader-src/core/plugins/window.js","../xsloader-src/core/plugins/withdeps.js","../xsloader-src/core/plugins/json.js","../xsloader-src/core/plugins/xshttp.js","../xsloader-src/core/plugins/request.js","../xsloader-src/core/plugins/xsmsg.js","../xsloader-src/core/plugins/image.js","../xsloader-src/core/plugins/default.js","../xsloader-src/core/plugins/xsloader4j-server-bridge.js","../xsloader-src/service.js","../xsloader-src/main.js"],"sourcesContent":["let g;\r\nif(typeof window !== undefined) {\r\n\tg = window;\r\n} else if(typeof self !== undefined) {\r\n\tg = self;\r\n} else if(typeof global !== undefined) {\r\n\tg = global;\r\n} else {\r\n\tthrow new Error(\"not found global var!\");\r\n}\r\n\r\n/**\r\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\r\n * @param {Object} val\r\n */\r\nfunction InVar(val) {\r\n\tthis.get = function() {\r\n\t\treturn val;\r\n\t};\r\n\r\n\tthis.set = function(newVal) {\r\n\t\tlet old = val;\r\n\t\tval = newVal;\r\n\t\treturn old;\r\n\t};\r\n}\r\ng.InVar = InVar;\r\n\r\nexport default g;","import global from '../util/global.js';\r\nlet loaderFun;\r\nlet xsloader = global.xsloader = function() {\r\n\treturn loaderFun.apply(this, arguments);\r\n};\r\n\r\nexport default {\r\n\tloaderFun: (fun) => {\r\n\t\tloaderFun = fun;\r\n\t}\r\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\r\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\r\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\r\n\r\nimport global from './global.js';\r\nconst xsloader = global.xsloader;\r\n\r\nfunction isJsFile(path) {\r\n\tif(!xsloader.isString(path) || path.indexOf(\".\") == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\tpath = path.substring(0, pluginIndex);\r\n\t}\r\n\tvar index = path.indexOf(\"?\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tindex = path.indexOf(\"#\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tlet theConfig = xsloader.config();\r\n\r\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\r\n\tfor(var i = 0; i < jsExts.length; i++) {\r\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\r\n\t\t\treturn {\r\n\t\t\t\text: jsExts[i],\r\n\t\t\t\tpath: path\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction dealPathMayAbsolute(path, currentUrl) {\r\n\tcurrentUrl = currentUrl || location.href;\r\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\r\n\r\n\tlet finalPath;\r\n\tlet absolute;\r\n\tif(rs) {\r\n\t\tlet protocol = rs[1];\r\n\t\tabsolute = true;\r\n\r\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\r\n\t\tlet _protocol = rs && rs[1] || location.protocol;\r\n\t\tlet _host = rs && rs[2] || location.host;\r\n\r\n\t\tif(protocol == \"//\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + path;\r\n\t\t} else if(protocol == \"/\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\r\n\t\t} else {\r\n\t\t\tfinalPath = path;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tabsolute = false;\r\n\t\tfinalPath = path;\r\n\t}\r\n\treturn {\r\n\t\tabsolute: absolute,\r\n\t\tpath: finalPath\r\n\t};\r\n}\r\n\r\nfunction getPathWithRelative(path, relative, isPathDir) {\r\n\r\n\tlet relativeQuery = \"\";\r\n\tlet qIndex = path.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\tpath = path.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = path.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\tpath = path.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tqIndex = relative.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\trelativeQuery = relative.substring(qIndex);\r\n\t\trelative = relative.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = relative.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\trelativeQuery = relative.substring(qIndex);\r\n\t\t\trelative = relative.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tlet absolute = dealPathMayAbsolute(relative);\r\n\tif(absolute.absolute) {\r\n\t\treturn absolute.path + relativeQuery;\r\n\t}\r\n\r\n\tif(isPathDir === undefined) {\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tif(index == path.length - 1) {\r\n\t\t\tisPathDir = true;\r\n\t\t} else {\r\n\t\t\tif(index == -1) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\r\n\t\t}\r\n\t}\r\n\r\n\tif(xsloader.endsWith(path, \"/\")) {\r\n\t\tpath = path.substring(0, path.length - 1);\r\n\t}\r\n\r\n\tlet isRelativeDir = false;\r\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\r\n\t\trelative = relative.substring(0, relative.length - 1);\r\n\t\tisRelativeDir = true;\r\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\r\n\t\tisRelativeDir = true;\r\n\t}\r\n\r\n\tlet prefix = \"\";\r\n\tlet index = -1;\r\n\tlet absolute2 = dealPathMayAbsolute(path);\r\n\tif(absolute2.absolute) {\r\n\t\tpath = absolute2.path;\r\n\t\tlet index2 = path.indexOf(\"//\");\r\n\t\tindex = path.indexOf(\"/\", index2 + 2);\r\n\t\tif(index == -1) {\r\n\t\t\tindex = path.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprefix = path.substring(0, index + 1);\r\n\tpath = path.substring(index + 1);\r\n\r\n\tlet stack = path.split(\"/\");\r\n\tif(!isPathDir && stack.length > 0) {\r\n\t\tstack.pop();\r\n\t}\r\n\tlet relatives = relative.split(\"/\");\r\n\tfor(let i = 0; i < relatives.length; i++) {\r\n\t\tlet str = relatives[i];\r\n\t\tif(\"..\" == str) {\r\n\t\t\tif(stack.length == 0) {\r\n\t\t\t\t\r\n\t\t\t\tthrow new Error(\"no more upper path:path=\"+arguments[0]+\",relative=\"+arguments[1]);\r\n\t\t\t}\r\n\t\t\tstack.pop();\r\n\t\t} else if(\".\" != str) {\r\n\t\t\tstack.push(str);\r\n\t\t}\r\n\t}\r\n//\tif(stack.length == 0) {\r\n//\t\treturn \"\";\r\n//\t}\r\n\tlet result = prefix + stack.join(\"/\");\r\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\r\n\t\tresult += \"/\";\r\n\t}\r\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\r\n\treturn result;\r\n}\r\n\r\nfunction getNodeAbsolutePath(node) {\r\n\tlet src = node.src || node.getAttribute(\"src\");\r\n\treturn getPathWithRelative(location.href, src);\r\n}\r\n\r\n//去掉url的query参数和#参数\r\nfunction removeQueryHash(url) {\r\n\tif(url) {\r\n\t\tlet index = url.indexOf(\"?\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\r\n\t\tindex = url.indexOf(\"#\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\r\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\r\n\r\nfunction propertiesDeal(configObject, properties) {\r\n\tif(!properties) {\r\n\t\treturn configObject;\r\n\t}\r\n\r\n\tfunction replaceStringProperties(string, properties, property) {\r\n\t\tlet rs;\r\n\t\tlet str = string;\r\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\r\n\t\tif(rs) {\r\n\t\t\tlet propKey = rs[1];\r\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\r\n\t\t\tif(propValue === undefined) {\r\n\t\t\t\treturn str;\r\n\t\t\t} else {\r\n\t\t\t\treturn propValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet result = \"\";\r\n\t\twhile(true) {\r\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\r\n\t\t\tif(!rs) {\r\n\t\t\t\tresult += str;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tlet propKey = rs[1];\r\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\r\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\r\n\t\t\t\t} else if(property) {\r\n\t\t\t\t\tproperty.has = true;\r\n\t\t\t\t}\r\n\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\r\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//处理属性引用\r\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\r\n\t\tif(!obj) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\tif(xsloader.isFunction(obj)) {\r\n\t\t\treturn obj;\r\n\t\t} else if(xsloader.isArray(obj)) {\r\n\t\t\tfor(let i = 0; i < obj.length; i++) {\r\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\r\n\t\t\t}\r\n\t\t} else if(xsloader.isString(obj)) {\r\n\t\t\tobj = replaceStringProperties(obj, properties, property);\r\n\t\t} else if(xsloader.isObject(obj)) {\r\n\t\t\tif(property) {\r\n\t\t\t\tproperty.has = false;\r\n\t\t\t}\r\n\t\t\tlet replaceKeyMap = {};\r\n\t\t\tfor(let x in obj) {\r\n\t\t\t\tif(property) {\r\n\t\t\t\t\tproperty.propertyKey = x;\r\n\t\t\t\t}\r\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\r\n\t\t\t\tif(enableKeyAttr) {\r\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\r\n\t\t\t\t\tif(_x !== x) {\r\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let x in replaceKeyMap) {\r\n\t\t\t\tlet objx = obj[x];\r\n\t\t\t\tdelete obj[x];\r\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\r\n\t}\r\n\r\n\tif(!properties.__dealt__) {\r\n\t\tlet property = {\r\n\t\t\thas: false\r\n\t\t};\r\n\r\n\t\tfor(let x in properties) {\r\n\t\t\tlet fun = properties[x];\r\n\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\tproperties[x] = fun.call(properties);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo {\r\n\t\t\treplaceProperties(properties, property);\r\n\t\t} while (property.has);\r\n\t\tproperties.__dealt__ = true;\r\n\t}\r\n\r\n\treturn replaceProperties(configObject, undefined, true);\r\n}\r\n\r\nfunction replaceModulePrefix(config, deps) {\r\n\r\n\tif(!deps||deps.length==0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet m = deps[i];\r\n\t\tif(typeof m == \"string\") {\r\n\t\t\tlet index = m.indexOf(\"!\");\r\n\t\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tindex = m.indexOf(\"?\");\r\n\t\t\tlet query = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tlet is = isJsFile(m);\r\n\t\t\tif(!is && !/\\.[^\\/\\s]*$/.test(m) && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\r\n\t\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(config.modulePrefixCount) {\r\n\t\t//模块地址的前缀替换\r\n\t\tfor(let prefix in config.modulePrefix) {\r\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\r\n\t\t\tlet len = prefix.length;\r\n\t\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t\tlet m = deps[i];\r\n\t\t\t\tif(typeof m == \"string\") {\r\n\t\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\r\n\t\t\t\t\tlet pluginName = null;\r\n\t\t\t\t\tif(pluginIndex >= 0) {\r\n\t\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\r\n\t\t\t\t\t\tm = m.substring(pluginIndex + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(xsloader.startsWith(m, prefix)) {\r\n\t\t\t\t\t\tlet dep = replaceStr + m.substring(len);\r\n\t\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getScriptBySubname(subname) {\r\n\tlet ss = document.getElementsByTagName('script');\r\n\tif(subname) {\r\n\t\tfor(let i = 0; i < ss.length; i++) {\r\n\t\t\tlet script = ss[i];\r\n\t\t\tlet src = script.src;\r\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\r\n\t\t\tif(src.indexOf(subname) >= 0) {\r\n\t\t\t\treturn script;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn ss;\r\n\t}\r\n}\r\n\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = removeQueryHash(url);\r\n\treturn url;\r\n})();\r\n\r\nexport default {\r\n\tgetPathWithRelative,\r\n\tgetNodeAbsolutePath,\r\n\tdealPathMayAbsolute,\r\n\tremoveQueryHash,\r\n\tpropertiesDeal,\r\n\treplaceModulePrefix,\r\n\tisJsFile,\r\n\tgetScriptBySubname,\r\n\tthePageUrl,\r\n};","import global from './global.js';\r\nconst xsloader = global.xsloader;\r\nconst COMMENT_REGEXP = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst REPLACE_REQUIRE_GET_REGEXP = /([\\s]|^)require\\s*\\.\\s*get\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\nconst REPLACE_REQUIRE_REGEXP = /([\\s]|^)require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif(!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif(!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif(!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif(paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor(let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor(let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif(!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif(pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif(!obj || xsloader.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor(let x in obj) {\r\n\t\tif(xsloader.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func(item,index,array)\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif(ary) {\r\n\t\tif(isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif(rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif(fromEnd) {\r\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n\r\nfunction __appendInnerDeps(deps, callbackString, reg, depIndex) {\r\n\tcallbackString.replace(reg, function() {\r\n\t\tlet dep = arguments[depIndex]\r\n\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\tdeps.push(dep);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//添加内部直接require.get('...')或require('...')的模块\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif(xsloader.isFunction(callback)) {\r\n\t\tlet innerDepType = xsloader.config().props.innerDepType;\r\n\t\tif(innerDepType != \"disable\") {\r\n\r\n\t\t\tconst callbackString = callback\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(COMMENT_REGEXP, __commentReplace);\r\n\r\n\t\t\tif(innerDepType == \"auto\") {\r\n\t\t\t\tif(callbackString.indexOf(\"__webpack_require__\") >= 0) {\r\n\t\t\t\t\tinnerDepType = \"disable\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(innerDepType == \"auto\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2);\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2);\r\n\t\t\t} else if(innerDepType == \"require\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2);\r\n\t\t\t} else if(innerDepType == \"require.get\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker, extra) {\r\n\t\tthis.err = err;\r\n\t\tthis.invoker = invoker;\r\n\t\tthis.extra = extra;\r\n\t}\r\n}\r\n\r\nfunction unwrapError(err) {\r\n\tif(err) {\r\n\t\tlet n = 0;\r\n\t\twhile(err instanceof PluginError && n++ < 100) {\r\n\t\t\terr = err.err;\r\n\t\t}\r\n\t}\r\n\treturn err;\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif(isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if(isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if(isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tunwrapError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n};","//顶部加载条功能\r\n/*\r\n ** ToProgress v0.1.1\r\n ** http://github.com/djyde/ToProgress\r\n */\r\n\r\n// Animation Detection\r\nfunction whichTransitionEvent() {\r\n\tlet t,\r\n\t\tel = document.createElement(\"fakeelement\");\r\n\r\n\tlet transitions = {\r\n\t\t\"transition\": \"transitionend\",\r\n\t\t\"OTransition\": \"oTransitionEnd\",\r\n\t\t\"MozTransition\": \"transitionend\",\r\n\t\t\"WebkitTransition\": \"webkitTransitionEnd\"\r\n\t};\r\n\r\n\tfor(t in transitions) {\r\n\t\tif(el.style[t] !== undefined) {\r\n\t\t\treturn transitions[t];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet transitionEvent = whichTransitionEvent();\r\n\r\nconst ToProgress = function(opt) {\r\n\t// Attributes\r\n\tthis.progress = 0;\r\n\tthis.options = {\r\n\t\tid: 'xsloader-top-progress-bar',\r\n\t\tcolor: '#F44336',\r\n\t\tbgColor:undefined,\r\n\t\theight: 2,\r\n\t\tduration: 0.2\r\n\t};\r\n\tif(opt && typeof opt === 'object') {\r\n\t\tfor(let key in opt) {\r\n\t\t\tthis.options[key] = opt[key];\r\n\t\t}\r\n\t}\r\n\tthis.options.opacityDuration = 0; //this.options.duration * 3;\r\n\tthis.progressBar = document.createElement('div');\r\n\tthis.container = document.createElement('div');\r\n\tthis.container.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\tthis.container.id = this.options.id;\r\n\r\n\tthis.progressBar.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\r\n\tthis.container.setCSS({\r\n\t\t\"position\": \"fixed\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"height\": (this.options.height + 1) + \"px\",\r\n\t\t\"width\": \"100%\",\r\n\t\t\"opacity\": \"1\",\r\n\t\t'z-index': '9999999999',\r\n\t\t'background-color': this.options.bgColor,\r\n\t});\r\n\r\n\tthis.progressBar.setCSS({\r\n\t\t\"position\": \"absolute\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"background-color\": this.options.color,\r\n\t\t\"height\": this.options.height + \"px\",\r\n\t\t\"width\": \"0%\",\r\n\t\t\"transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-moz-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-webkit-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\"\r\n\t});\r\n\tthis.container.appendChild(this.progressBar);\r\n\tdocument.body.appendChild(this.container);\r\n};\r\n\r\n////////////////////////////////////\r\nToProgress.prototype.setColor = function(color) {\r\n\tthis.progressBar.style.backgroundColor = color;\r\n};\r\n\r\nToProgress.prototype._isAuto = false;\r\nToProgress.prototype._timer = null;\r\n\r\nToProgress.prototype.stopAuto = function() {\r\n\tthis._isAuto = false;\r\n\tif(this._timer) {\r\n\t\tclearInterval(this._timer);\r\n\t\tthis._timer = null;\r\n\t}\r\n};\r\n\r\nToProgress.prototype.autoIncrement = function(time = 100) {\r\n\tthis.stopAuto();\r\n\tthis._isAuto = true;\r\n\tlet dt = time < 100 ? 100 : time;\r\n\r\n\tlet k = 100; //\r\n\tlet step = 0.05;\r\n\tlet x = 1 - step / 2;\r\n\tthis._timer = setInterval(() => {\r\n\t\tx += step;\r\n\t\tthis.setProgress(100 - k / x);\r\n\t}, dt);\r\n};\r\n\r\nToProgress.prototype.toError = function(errColor) {\r\n\tthis.setProgress(this.progress < 60 ? 60 : this.progress);\r\n\tthis.setColor(errColor);\r\n\tthis.stopAuto();\r\n};\r\n\r\n///////////////////////////////////\r\n\r\nToProgress.prototype.transit = function() {\r\n\tthis.progressBar.style.width = this.progress + '%';\r\n};\r\n\r\nToProgress.prototype.getProgress = function() {\r\n\treturn this.progress;\r\n};\r\n\r\nToProgress.prototype.setProgress = function(progress, callback) {\r\n\tthis.show();\r\n\tif(progress > 100) {\r\n\t\tthis.progress = 100;\r\n\t} else if(progress < 0) {\r\n\t\tthis.progress = 0;\r\n\t} else {\r\n\t\tthis.progress = progress;\r\n\t}\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.increase = function(toBeIncreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress + toBeIncreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.decrease = function(toBeDecreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress - toBeDecreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.finish = function(callback) {\r\n\tthis.setProgress(100, callback);\r\n\tsetTimeout(() => {\r\n\t\tthis.hide();\r\n//\t\tlet fun;\r\n//\t\tfun = (e) => {\r\n//\t\t\tthis.reset();\r\n//\t\t\tthis.progressBar.removeEventListener(e.type, fun);\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t};\r\n//\t\ttransitionEvent && this.progressBar.addEventListener(transitionEvent, fun);\r\n//\t\tif(!transitionEvent) {\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t}\r\n\t\tthis.container.parentNode.removeChild(this.container);\r\n\t}, 500);\r\n};\r\n\r\nToProgress.prototype.reset = function(callback) {\r\n\tthis.progress = 0;\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.hide = function() {\r\n\tthis.progressBar.style.opacity = '0';\r\n\tthis.container.style.display = 'none';\r\n};\r\n\r\nToProgress.prototype.show = function() {\r\n\tthis.progressBar.style.opacity = '1';\r\n\tthis.container.style.display = 'block';\r\n};\r\n\r\nexport default {\r\n\tToProgress\r\n};","function Base64() {\r\n\r\n\t// private property\r\n\tlet _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n\t// public method for encoding\r\n\tthis.encode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = _utf8_encode(input);\r\n\t\twhile(i < input.length) {\r\n\t\t\tchr1 = input.charCodeAt(i++);\r\n\t\t\tchr2 = input.charCodeAt(i++);\r\n\t\t\tchr3 = input.charCodeAt(i++);\r\n\t\t\tenc1 = chr1 >> 2;\r\n\t\t\tenc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\t\tenc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\t\tenc4 = chr3 & 63;\r\n\t\t\tif(isNaN(chr2)) {\r\n\t\t\t\tenc3 = enc4 = 64;\r\n\t\t\t} else if(isNaN(chr3)) {\r\n\t\t\t\tenc4 = 64;\r\n\t\t\t}\r\n\t\t\toutput = output +\r\n\t\t\t\t_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +\r\n\t\t\t\t_keyStr.charAt(enc3) + _keyStr.charAt(enc4);\r\n\t\t}\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// public method for decoding\r\n\tthis.decode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3;\r\n\t\tlet enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n\t\twhile(i < input.length) {\r\n\t\t\tenc1 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc2 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc3 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc4 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\r\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\r\n\t\t\toutput = output + String.fromCharCode(chr1);\r\n\t\t\tif(enc3 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr2);\r\n\t\t\t}\r\n\t\t\tif(enc4 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr3);\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput = _utf8_decode(output);\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// private method for UTF-8 encoding\r\n\tlet _utf8_encode = function(string) {\r\n\t\tstring = string.replace(/\\r\\n/g, \"\\n\");\r\n\t\tlet utftext = \"\";\r\n\t\tfor(let n = 0; n < string.length; n++) {\r\n\t\t\tlet c = string.charCodeAt(n);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tutftext += String.fromCharCode(c);\r\n\t\t\t} else if((c > 127) && (c < 2048)) {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 6) | 192);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t} else {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 12) | 224);\r\n\t\t\t\tutftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn utftext;\r\n\t};\r\n\r\n\t// private method for UTF-8 decoding\r\n\tlet _utf8_decode = function(utftext) {\r\n\t\tlet string = \"\";\r\n\t\tlet i = 0;\r\n\t\tlet c=0, c2=0, c3=0;\r\n\t\t\r\n\t\twhile(i < utftext.length) {\r\n\t\t\tc = utftext.charCodeAt(i);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tstring += String.fromCharCode(c);\r\n\t\t\t\ti++;\r\n\t\t\t} else if((c > 191) && (c < 224)) {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tstring += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n\t\t\t\ti += 2;\r\n\t\t\t} else {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tc3 = utftext.charCodeAt(i + 2);\r\n\t\t\t\tstring += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n\t\t\t\ti += 3;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn string;\r\n\t};\r\n}\r\n\r\nexport default Base64;","import urls from './urls.js';\r\nimport global from './global.js';\r\nimport base from './base.js';\r\nimport loading from './loading.js';\r\nimport base64 from './base64.js';\r\n\r\nexport default {\r\n\t...urls,\r\n\tglobal,\r\n\t...base,\r\n\t...loading,\r\n\tbase64,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//ie9\r\ntry {\r\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\r\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\r\n\t\t\tlet thiz = Function.prototype.bind;\r\n\t\t\tconsole[method] = thiz.call(console[method], console);\r\n\t\t});\r\n\t}\r\n} catch(e) {\r\n\tglobal.console = {\r\n\t\tlog: function() {},\r\n\t\terror: function() {},\r\n\t\twarn: function() {}\r\n\t};\r\n}\r\n\r\ntry {\r\n\r\n\tif(!Array.prototype.indexOf) {\r\n\t\tArray.prototype.indexOf = function(elem, offset) {\r\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\r\n\t\t\t\tif(this[i] == elem) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\t}\r\n\r\n\tif(!Array.pushAll) {\r\n\t\tArray.pushAll = function(thiz, arr) {\r\n\t\t\tif(!xsloader.isArray(arr)) {\r\n\t\t\t\tthrow new Error(\"not array:\" + arr);\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < arr.length; i++) {\r\n\t\t\t\tthiz.push(arr[i]);\r\n\t\t\t}\r\n\t\t\treturn thiz;\r\n\t\t};\r\n\t}\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}\r\n\r\nfunction startsWith(str, starts) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\treturn str.indexOf(starts) == 0;\r\n}\r\n\r\nfunction endsWith(str, ends) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\tlet index = str.lastIndexOf(ends);\r\n\tif(index >= 0 && (str.length - ends.length == index)) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction _indexInArray(array, ele, offset = 0, compare) {\r\n\tlet index = -1;\r\n\tif(array) {\r\n\t\tfor(let i = offset || 0; i < array.length; i++) {\r\n\t\t\tif(compare) {\r\n\t\t\t\tif(compare(array[i], ele, i, array)) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(array[i] == ele) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\treturn index;\r\n}\r\n\r\nfunction indexInArray(array, ele, compare) {\r\n\treturn _indexInArray(array, ele, 0, compare);\r\n}\r\n\r\nfunction indexInArrayFrom(array, ele, offset, compare) {\r\n\treturn _indexInArray(array, ele, offset, compare);\r\n}\r\n\r\nexport default {\r\n\tstartsWith,\r\n\tendsWith,\r\n\tindexInArray,\r\n\tindexInArrayFrom\r\n};","//https://github.com/douglascrockford/JSON-js\r\n//  json2.js\r\n//  2017-06-12\r\n//  Public Domain.\r\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\r\n\r\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\r\n//  NOT CONTROL.\r\nconst JSON = {};\r\n\r\nexport default JSON;\r\n\r\nlet rx_one = /^[\\],:{}\\s]*$/;\r\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\r\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\r\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\r\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\n\r\nfunction f(n) {\r\n\t// Format integers to have at least two digits.\r\n\treturn(n < 10) ?\r\n\t\t\"0\" + n :\r\n\t\tn;\r\n}\r\n\r\nfunction this_value() {\r\n\treturn this.valueOf();\r\n}\r\n\r\nif(typeof Date.prototype.toJSON !== \"function\") {\r\n\r\n\tDate.prototype.toJSON = function() {\r\n\t\treturn isFinite(this.valueOf()) ?\r\n\t\t\t(\r\n\t\t\t\tthis.getUTCFullYear() +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCMonth() + 1) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCDate()) +\r\n\t\t\t\t\"T\" +\r\n\t\t\t\tf(this.getUTCHours()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCMinutes()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCSeconds()) +\r\n\t\t\t\t\"Z\"\r\n\t\t\t) :\r\n\t\t\tnull;\r\n\t};\r\n\r\n\tBoolean.prototype.toJSON = this_value;\r\n\tNumber.prototype.toJSON = this_value;\r\n\tString.prototype.toJSON = this_value;\r\n}\r\n\r\nlet gap;\r\nlet indent;\r\nlet meta;\r\nlet rep;\r\n\r\nfunction quote(string) {\r\n\r\n\t// If the string contains no control characters, no quote characters, and no\r\n\t// backslash characters, then we can safely slap some quotes around it.\r\n\t// Otherwise we must also replace the offending characters with safe escape\r\n\t// sequences.\r\n\r\n\trx_escapable.lastIndex = 0;\r\n\treturn rx_escapable.test(string) ?\r\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\r\n\t\t\tlet c = meta[a];\r\n\t\t\treturn typeof c === \"string\" ?\r\n\t\t\t\tc :\r\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\r\n\t\t}) + \"\\\"\" :\r\n\t\t\"\\\"\" + string + \"\\\"\";\r\n}\r\n\r\nfunction str(key, holder) {\r\n\t// Produce a string from holder[key].\r\n\tlet i; // The loop counter.\r\n\tlet k; // The member key.\r\n\tlet v; // The member value.\r\n\tlet length;\r\n\tlet mind = gap;\r\n\tlet partial;\r\n\tlet value = holder[key];\r\n\r\n\t// If the value has a toJSON method, call it to obtain a replacement value.\r\n\tif(\r\n\t\tvalue &&\r\n\t\ttypeof value === \"object\" &&\r\n\t\ttypeof value.toJSON === \"function\"\r\n\t) {\r\n\t\tvalue = value.toJSON(key);\r\n\t}\r\n\r\n\t// If we were called with a replacer function, then call the replacer to\r\n\t// obtain a replacement value.\r\n\r\n\tif(typeof rep === \"function\") {\r\n\t\tvalue = rep.call(holder, key, value);\r\n\t}\r\n\r\n\t// What happens next depends on the value's type.\r\n\r\n\tswitch(typeof value) {\r\n\t\tcase \"string\":\r\n\t\t\treturn quote(value);\r\n\t\tcase \"number\":\r\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\r\n\t\t\treturn(isFinite(value)) ?\r\n\t\t\t\tString(value) :\r\n\t\t\t\t\"null\";\r\n\r\n\t\tcase \"boolean\":\r\n\t\tcase \"null\":\r\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\r\n\t\t\t// typeof null does not produce \"null\". The case is included here in\r\n\t\t\t// the remote chance that this gets fixed someday.\r\n\t\t\treturn String(value);\r\n\r\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\r\n\t\t\t// null.\r\n\t\tcase \"object\":\r\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\r\n\t\t\t// so watch out for that case.\r\n\t\t\tif(!value) {\r\n\t\t\t\treturn \"null\";\r\n\t\t\t}\r\n\r\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\r\n\r\n\t\t\tgap += indent;\r\n\t\t\tpartial = [];\r\n\t\t\t// Is the value an array?\r\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\r\n\r\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\r\n\t\t\t\t// for non-JSON values.\r\n\t\t\t\tlength = value.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\r\n\t\t\t\t}\r\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\r\n\t\t\t\t// brackets.\r\n\r\n\t\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\t\"[]\" :\r\n\t\t\t\t\tgap ?\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t\"[\\n\" +\r\n\t\t\t\t\t\tgap +\r\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\r\n\t\t\t\t\t\t\"\\n\" +\r\n\t\t\t\t\t\tmind +\r\n\t\t\t\t\t\t\"]\"\r\n\t\t\t\t\t) :\r\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\r\n\t\t\t\tgap = mind;\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\r\n\t\t\tif(rep && typeof rep === \"object\") {\r\n\t\t\t\tlength = rep.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\r\n\t\t\t\t\t\tk = rep[i];\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" : \":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" :\r\n\t\t\t\t\t\t\t\t\":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Join all of the member texts together, separated with commas,\r\n\t\t\t// and wrap them in braces.\r\n\r\n\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\"{}\" : gap ?\r\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\r\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\r\n\t\t\tgap = mind;\r\n\t\t\treturn v;\r\n\t}\r\n}\r\n\r\n// If the JSON object does not yet have a stringify method, give it one.\r\nif(typeof JSON.stringify !== \"function\") {\r\n\tmeta = { // table of character substitutions\r\n\t\t\"\\b\": \"\\\\b\",\r\n\t\t\"\\t\": \"\\\\t\",\r\n\t\t\"\\n\": \"\\\\n\",\r\n\t\t\"\\f\": \"\\\\f\",\r\n\t\t\"\\r\": \"\\\\r\",\r\n\t\t\"\\\"\": \"\\\\\\\"\",\r\n\t\t\"\\\\\": \"\\\\\\\\\"\r\n\t};\r\n\tJSON.stringify = function(value, replacer, space) {\r\n\r\n\t\t// The stringify method takes a value and an optional replacer, and an optional\r\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\r\n\t\t// that can replace values, or an array of strings that will select the keys.\r\n\t\t// A default replacer method can be provided. Use of the space parameter can\r\n\t\t// produce text that is more easily readable.\r\n\r\n\t\tlet i;\r\n\t\tgap = \"\";\r\n\t\tindent = \"\";\r\n\t\t// If the space parameter is a number, make an indent string containing that\r\n\t\t// many spaces.\r\n\t\tif(typeof space === \"number\") {\r\n\t\t\tfor(i = 0; i < space; i += 1) {\r\n\t\t\t\tindent += \" \";\r\n\t\t\t}\r\n\r\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\r\n\r\n\t\t} else if(typeof space === \"string\") {\r\n\t\t\tindent = space;\r\n\t\t}\r\n\r\n\t\t// If there is a replacer, it must be a function or an array.\r\n\t\t// Otherwise, throw an error.\r\n\r\n\t\trep = replacer;\r\n\t\tif(replacer && typeof replacer !== \"function\" && (\r\n\t\t\t\ttypeof replacer !== \"object\" ||\r\n\t\t\t\ttypeof replacer.length !== \"number\"\r\n\t\t\t)) {\r\n\t\t\tthrow new Error(\"JSON.stringify\");\r\n\t\t}\r\n\r\n\t\t// Make a fake root object containing our value under the key of \"\".\r\n\t\t// Return the result of stringifying the value.\r\n\r\n\t\treturn str(\"\", {\r\n\t\t\t\"\": value\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// If the JSON object does not yet have a parse method, give it one.\r\n\r\nif(typeof JSON.parse !== \"function\") {\r\n\tJSON.parse = function(text, reviver) {\r\n\t\t// The parse method takes a text and an optional reviver function, and returns\r\n\t\t// a JavaScript value if the text is a valid JSON text.\r\n\t\tlet j;\r\n\r\n\t\tfunction walk(holder, key) {\r\n\t\t\t// The walk method is used to recursively walk the resulting structure so\r\n\t\t\t// that modifications can be made.\r\n\t\t\tlet k;\r\n\t\t\tlet v;\r\n\t\t\tlet value = holder[key];\r\n\t\t\tif(value && typeof value === \"object\") {\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = walk(value, k);\r\n\t\t\t\t\t\tif(v !== undefined) {\r\n\t\t\t\t\t\t\tvalue[k] = v;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelete value[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn reviver.call(holder, key, value);\r\n\t\t}\r\n\r\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\r\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\r\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\r\n\t\ttext = String(text);\r\n\t\trx_dangerous.lastIndex = 0;\r\n\t\tif(rx_dangerous.test(text)) {\r\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\r\n\t\t\t\treturn(\r\n\t\t\t\t\t\"\\\\u\" +\r\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// In the second stage, we run the text against regular expressions that look\r\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\r\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\r\n\t\t// But just to be safe, we want to reject all unexpected forms.\r\n\r\n\t\t// We split the second stage into 4 regexp operations in order to work around\r\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\r\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\r\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\r\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\r\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\r\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\r\n\r\n\t\tif(\r\n\t\t\trx_one.test(\r\n\t\t\t\ttext\r\n\t\t\t\t.replace(rx_two, \"@\")\r\n\t\t\t\t.replace(rx_three, \"]\")\r\n\t\t\t\t.replace(rx_four, \"\")\r\n\t\t\t)\r\n\t\t) {\r\n\r\n\t\t\t// In the third stage we use the eval function to compile the text into a\r\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\r\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\r\n\t\t\t// in parens to eliminate the ambiguity.\r\n\t\t\tj = eval(\"(\" + text + \")\");\r\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\r\n\t\t\t// each name/value pair to a reviver function for possible transformation.\r\n\r\n\t\t\treturn(typeof reviver === \"function\") ?\r\n\t\t\t\twalk({\r\n\t\t\t\t\t\"\": j\r\n\t\t\t\t}, \"\") : j;\r\n\t\t}\r\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\r\n\t\tthrow new SyntaxError(\"JSON.parse\");\r\n\t};\r\n}","/*\r\n * Copyright 2016 Google Inc. All rights reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n * use this file except in compliance with the License. You may obtain a copy of\r\n * the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\r\n * License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\n//https://github.com/GoogleChrome/proxy-polyfill\r\nexport default function proxyPolyfill() {\r\n\tlet lastRevokeFn = null;\r\n\tlet ProxyPolyfill;\r\n\r\n\t/**\r\n\t * @param {*} o\r\n\t * @return {boolean} whether this is probably a (non-null) Object\r\n\t */\r\n\tfunction isObject(o) {\r\n\t\treturn o ? (typeof o === 'object' || typeof o === 'function') : false;\r\n\t}\r\n\r\n\t/**\r\n\t * @constructor\r\n\t * @param {!Object} target\r\n\t * @param {{apply, construct, get, set}} handler\r\n\t */\r\n\tProxyPolyfill = function(target, handler) {\r\n\t\tif(!isObject(target) || !isObject(handler)) {\r\n\t\t\tthrow new TypeError('Cannot create proxy with a non-object as target or handler');\r\n\t\t}\r\n\r\n\t\t// Construct revoke function, and set lastRevokeFn so that Proxy.revocable can steal it.\r\n\t\t// The caller might get the wrong revoke function if a user replaces or wraps scope.Proxy\r\n\t\t// to call itself, but that seems unlikely especially when using the polyfill.\r\n\t\tlet throwRevoked = function() {};\r\n\t\tlastRevokeFn = function() {\r\n\t\t\tthrowRevoked = function(trap) {\r\n\t\t\t\tthrow new TypeError(`Cannot perform '${trap}' on a proxy that has been revoked`);\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t// Fail on unsupported traps: Chrome doesn't do this, but ensure that users of the polyfill\r\n\t\t// are a bit more careful. Copy the internal parts of handler to prevent user changes.\r\n\t\tconst unsafeHandler = handler;\r\n\t\thandler = {\r\n\t\t\t'get': null,\r\n\t\t\t'set': null,\r\n\t\t\t'apply': null,\r\n\t\t\t'construct': null\r\n\t\t};\r\n\t\tfor(let k in unsafeHandler) {\r\n\t\t\tif(!(k in handler)) {\r\n\t\t\t\tthrow new TypeError(`Proxy polyfill does not support trap '${k}'`);\r\n\t\t\t}\r\n\t\t\thandler[k] = unsafeHandler[k];\r\n\t\t}\r\n\t\tif(typeof unsafeHandler === 'function') {\r\n\t\t\t// Allow handler to be a function (which has an 'apply' method). This matches what is\r\n\t\t\t// probably a bug in native versions. It treats the apply call as a trap to be configured.\r\n\t\t\thandler.apply = unsafeHandler.apply.bind(unsafeHandler);\r\n\t\t}\r\n\r\n\t\t// Define proxy as this, or a Function (if either it's callable, or apply is set).\r\n\t\t// TODO(samthor): Closure compiler doesn't know about 'construct', attempts to rename it.\r\n\t\tlet proxy = this;\r\n\t\tlet isMethod = false;\r\n\t\tlet isArray = false;\r\n\t\tif(typeof target === 'function') {\r\n\t\t\tproxy = function ProxyPolyfill() {\r\n\t\t\t\tconst usingNew = (this && this.constructor === proxy);\r\n\t\t\t\tconst args = Array.prototype.slice.call(arguments);\r\n\t\t\t\tthrowRevoked(usingNew ? 'construct' : 'apply');\r\n\r\n\t\t\t\tif(usingNew && handler['construct']) {\r\n\t\t\t\t\treturn handler['construct'].call(this, target, args);\r\n\t\t\t\t} else if(!usingNew && handler.apply) {\r\n\t\t\t\t\treturn handler.apply(target, this, args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// since the target was a function, fallback to calling it directly.\r\n\t\t\t\tif(usingNew) {\r\n\t\t\t\t\t// inspired by answers to https://stackoverflow.com/q/1606797\r\n\t\t\t\t\targs.unshift(target); // pass class as first arg to constructor, although irrelevant\r\n\t\t\t\t\t// nb. cast to convince Closure compiler that this is a constructor\r\n\t\t\t\t\tconst f = /** @type {!Function} */ (target.bind.apply(target, args));\r\n\t\t\t\t\treturn new f();\r\n\t\t\t\t}\r\n\t\t\t\treturn target.apply(this, args);\r\n\t\t\t};\r\n\t\t\tisMethod = true;\r\n\t\t} else if(target instanceof Array) {\r\n\t\t\tproxy = [];\r\n\t\t\tisArray = true;\r\n\t\t}\r\n\r\n\t\t// Create default getters/setters. Create different code paths as handler.get/handler.set can't\r\n\t\t// change after creation.\r\n\t\tconst getter = handler.get ? function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn handler.get(this, prop, proxy);\r\n\t\t} : function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn this[prop];\r\n\t\t};\r\n\t\tconst setter = handler.set ? function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tconst status = handler.set(this, prop, value, proxy);\r\n\t\t\t// TODO(samthor): If the calling code is in strict mode, throw TypeError.\r\n\t\t\t// if (!status) {\r\n\t\t\t// It's (sometimes) possible to work this out, if this code isn't strict- try to load the\r\n\t\t\t// callee, and if it's available, that code is non-strict. However, this isn't exhaustive.\r\n\t\t\t// }\r\n\t\t} : function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tthis[prop] = value;\r\n\t\t};\r\n\r\n\t\t// Clone direct properties (i.e., not part of a prototype).\r\n\t\tlet propertyNames = Object.getOwnPropertyNames(target);\r\n\r\n\t\t/////////用于代理Promise:then方法等\r\n\t\tif(target instanceof Promise && target.__proto__) {\r\n\t\t\tlet props = Object.getOwnPropertyNames(target.__proto__);\r\n\t\t\tlet obj = {};\r\n\t\t\tpropertyNames.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tprops.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tpropertyNames = [];\r\n\t\t\tfor(let prop in obj) {\r\n\t\t\t\tpropertyNames.push(prop);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst propertyMap = {};\r\n\t\tpropertyNames.forEach(function(prop) {\r\n\t\t\tif((isMethod || isArray) && prop in proxy) {\r\n\t\t\t\treturn; // ignore properties already here, e.g. 'bind', 'prototype' etc\r\n\t\t\t}\r\n\t\t\tconst real = Object.getOwnPropertyDescriptor(target, prop);\r\n\t\t\tconst desc = {\r\n\t\t\t\tenumerable: !!(real && real.enumerable),\r\n\t\t\t\tget: getter.bind(target, prop),\r\n\t\t\t\tset: setter.bind(target, prop),\r\n\t\t\t};\r\n\t\t\tObject.defineProperty(proxy, prop, desc);\r\n\t\t\tpropertyMap[prop] = true;\r\n\t\t});\r\n\r\n\t\t// Set the prototype, or clone all prototype methods (always required if a getter is provided).\r\n\t\t// TODO(samthor): We don't allow prototype methods to be set. It's (even more) awkward.\r\n\t\t// An alternative here would be to _just_ clone methods to keep behavior consistent.\r\n\t\tlet prototypeOk = true;\r\n\t\tif(Object.setPrototypeOf) {\r\n\t\t\tObject.setPrototypeOf(proxy, Object.getPrototypeOf(target));\r\n\t\t} else if(proxy.__proto__) {\r\n\t\t\tproxy.__proto__ = target.__proto__;\r\n\t\t} else {\r\n\t\t\tprototypeOk = false;\r\n\t\t}\r\n\t\tif(handler.get || !prototypeOk) {\r\n\t\t\tfor(let k in target) {\r\n\t\t\t\tif(propertyMap[k]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tObject.defineProperty(proxy, k, {\r\n\t\t\t\t\tget: getter.bind(target, k)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// The Proxy polyfill cannot handle adding new properties. Seal the target and proxy.\r\n\t\tObject.seal(target);\r\n\t\tObject.seal(proxy);\r\n\r\n\t\treturn proxy; // nb. if isMethod is true, proxy != this\r\n\t};\r\n\r\n\tProxyPolyfill.revocable = function(target, handler) {\r\n\t\tconst p = new ProxyPolyfill(target, handler);\r\n\t\treturn {\r\n\t\t\t'proxy': p,\r\n\t\t\t'revoke': lastRevokeFn\r\n\t\t};\r\n\t};\r\n\r\n\treturn ProxyPolyfill;\r\n}","import JSON from './json.js';\r\nimport \"./ie.js\";\r\nimport ProxyUtil from './proxy.js';\r\n\r\nfunction polyfillInit(global, xsloader) {\r\n\tlet proxy = ProxyUtil();\r\n\tif(!global['Proxy']) {\r\n\t\tglobal.Proxy = proxy;\r\n\t}\r\n\txsloader.Proxy = proxy;\r\n}\r\n\r\nexport {\r\n\tJSON,\r\n\tpolyfillInit\r\n};","import {\r\n\tJSON as xsJSON,\r\n\tpolyfillInit\r\n} from \"../polyfill/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst IE_VERSION = utils.IE_VERSION;\r\n\r\npolyfillInit(global, xsloader);\r\n\r\nif(!String.prototype.trim) {\r\n\tString.prototype.trim = function() {\r\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n\t};\r\n}\r\n\r\n//生成一个随机的id，只保证在本页面是唯一的\r\nfunction randId(suffix) {\r\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\r\n\tif(suffix !== undefined) {\r\n\t\tid += suffix;\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction xsEval(scriptString) {\r\n\ttry {\r\n\t\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\r\n\t\treturn rs;\r\n\t} catch(e) {\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\n/**\r\n * 注意key需要用引号包裹\r\n * @param {Object} str\r\n * @param {Object} option\r\n */\r\nfunction xsParseJson(str, option) {\r\n\ttry {\r\n\t\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\r\n\t\toption = xsloader.extend({\r\n\t\t\tfnStart: \"\", //\"/*{f}*/\",\r\n\t\t\tfnEnd: \"\", //\"/*{f}*/\",\r\n\t\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\r\n\t\t}, option);\r\n\r\n\t\tlet fnMap = {};\r\n\t\tlet fnOffset = 0;\r\n\t\tlet replacer = undefined;\r\n\t\tif(option.fnStart && option.fnEnd) {\r\n\t\t\twhile(true) {\r\n\t\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\r\n\t\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\r\n\t\t\t\tif(indexStart == -1 && indexEnd == -1) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(indexStart == -1) {\r\n\t\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if(indexEnd == -1) {\r\n\t\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\r\n\t\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\r\n\t\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\r\n\t\t\t\t\tthrow \"not a function:\" + fnStr;\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\r\n\t\t\t\t\tlet fn = xsloader.xsEval(fnStr);\r\n\t\t\t\t\tfnMap[fnId] = fn;\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.error(fnStr);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t\tfnOffset = indexStart + fnId.length;\r\n\t\t\t}\r\n\t\t\treplacer = function(key, val) {\r\n\t\t\t\tif(xsloader.isString(val) && fnMap[val]) {\r\n\t\t\t\t\treturn fnMap[val];\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif(option.rcomment) {\r\n\t\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\r\n\t\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\r\n\t\t}\r\n\r\n\t\tlet jsonObj = xsJSON;\r\n\t\treturn jsonObj.parse(str, replacer);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\r\n\t\t\tif(e.message && reg.test(e.message)) {\r\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\r\n\t\t\t\tlet pos = parseInt(posStr.trim());\r\n\t\t\t\tlet _str = str.substring(pos);\r\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\r\n\t\t\t}\r\n\t\t} catch(e2) {\r\n\t\t\tconsole.warn(e2);\r\n\t\t}\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\nfunction xsJson2String(obj) {\r\n\tlet jsonObj = xsJSON;\r\n\treturn jsonObj.stringify(obj);\r\n}\r\n\r\nconst getPathWithRelative = utils.getPathWithRelative;\r\n\r\nfunction _toParamsMap(argsStr, decode = true) {\r\n\tif(xsloader.isObject(argsStr)) {\r\n\t\treturn argsStr;\r\n\t}\r\n\tif(!argsStr) {\r\n\t\targsStr = location.search;\r\n\t}\r\n\r\n\tlet index = argsStr.indexOf(\"?\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(index + 1);\r\n\t} else {\r\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\tindex = argsStr.lastIndexOf(\"#\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(0, index);\r\n\t}\r\n\r\n\tlet ret = {},\r\n\t\tseg = argsStr.split('&'),\r\n\t\ts;\r\n\tfor(let i = 0; i < seg.length; i++) {\r\n\t\tif(!seg[i]) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ts = seg[i].split('=');\r\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\r\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} url\r\n * @param {Object} urlArgs \"a=b&b=c#hash\",\"#hash\",Object\r\n */\r\nfunction appendArgs2Url(url, urlArgs) {\r\n\tif(url === undefined || url === null || !urlArgs) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tlet index = url.lastIndexOf(\"?\");\r\n\tlet hashIndex = url.lastIndexOf(\"#\");\r\n\tif(hashIndex < 0) {\r\n\t\thashIndex = url.length;\r\n\t}\r\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\r\n\tlet newParams = _toParamsMap(urlArgs, false);\r\n\tlet has = false;\r\n\tfor(let k in newParams) {\r\n\t\tif(oldParams[k] != newParams[k]) {\r\n\t\t\toldParams[k] = newParams[k];\r\n\t\t\thas = true;\r\n\t\t}\r\n\t}\r\n\t//\tif(!has) {\r\n\t//\t\treturn url; //参数没有变化直接返回\r\n\t//\t}\r\n\r\n\tlet paramKeys = [];\r\n\tfor(let k in oldParams) {\r\n\t\tparamKeys.push(k);\r\n\t}\r\n\tparamKeys.sort();\r\n\r\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\r\n\tlet params = [];\r\n\r\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\r\n\t\tlet k = paramKeys[i];\r\n\t\tparams.push(k + \"=\" + oldParams[k]);\r\n\t}\r\n\tparams = params.join(\"&\");\r\n\tlet hash = \"\";\r\n\tif((typeof urlArgs == \"string\") && urlArgs.lastIndexOf(\"#\") >= 0) {\r\n\t\thash = urlArgs.substring(urlArgs.lastIndexOf(\"#\"));\r\n\t} else if(hashIndex >= 0 && hashIndex < url.length) {\r\n\t\thash = url.substring(hashIndex);\r\n\t}\r\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\r\n\r\n}\r\n\r\nfunction queryString2ParamsMap(argsStr, decode) {\r\n\treturn _toParamsMap(argsStr, decode);\r\n}\r\n\r\nexport default {\r\n\trandId,\r\n\txsEval,\r\n\txsParseJson,\r\n\txsJson2String,\r\n\tgetPathWithRelative,\r\n\tappendArgs2Url,\r\n\tqueryString2ParamsMap,\r\n\tIE_VERSION\r\n};","const ostring = Object.prototype.toString;\r\n\r\nfunction isArray(it) {\r\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\r\n}\r\n\r\nfunction isFunction(it) {\r\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\r\n}\r\n\r\nfunction isObject(it) {\r\n\tif(it === null || it === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\r\n}\r\n\r\nfunction isString(it) {\r\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\r\n}\r\n\r\nfunction isDate(it) {\r\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\r\n}\r\n\r\nfunction isRegExp(it) {\r\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\r\n}\r\n\r\nfunction isEmpty(it) {\r\n\treturn it === null || it === undefined || it === \"\";\r\n}\r\n\r\nexport default {\r\n\tisArray,\r\n\tisFunction,\r\n\tisObject,\r\n\tisString,\r\n\tisDate,\r\n\tisRegExp,\r\n\tisEmpty,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nfunction queryParam(name, otherValue, optionUrl) {\r\n\tlet search;\r\n\tif(optionUrl) {\r\n\t\tlet index = optionUrl.indexOf('?');\r\n\t\tif(index < 0) {\r\n\t\t\tindex = 0;\r\n\t\t} else {\r\n\t\t\tindex += 1;\r\n\t\t}\r\n\t\tsearch = optionUrl.substr(index);\r\n\t} else {\r\n\t\tsearch = window.location.search.substr(1);\r\n\t}\r\n\r\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n\tlet r = search.match(reg);\r\n\tif(r != null) return decodeURIComponent(r[2]);\r\n\treturn otherValue !== undefined ? otherValue : null;\r\n}\r\n\r\nfunction getUrl(relativeUrl, appendArgs=true, optionalAbsUrl) {\r\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\r\n\t}\r\n//\tif(appendArgs === undefined) {\r\n//\t\tappendArgs = true;\r\n//\t}\r\n\tlet theConfig = xsloader.config();\r\n\tlet thePageUrl = utils.thePageUrl;\r\n\tlet url;\r\n\tif(relativeUrl === undefined) {\r\n\t\turl = thePageUrl;\r\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\r\n\t} else {\r\n\t\turl = theConfig.baseUrl + relativeUrl;\r\n\t}\r\n\tif(appendArgs) {\r\n\t\tif(url == thePageUrl) {\r\n\t\t\turl += location.search + location.hash;\r\n\t\t}\r\n\t\treturn theConfig.dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction getUrl2(relativeUrl, appendArgs=true, optionalAbsUrl) {\r\n\tlet url = getUrl(relativeUrl, false, optionalAbsUrl);\r\n\tif(appendArgs) {\r\n\t\treturn xsloader.config().dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\r\n\tlet rs;\r\n\ttry {\r\n\t\tthiz = thiz === undefined ? this : thiz;\r\n\t\trs = fun.call(thiz);\r\n\t} catch(e) {\r\n\t\tif(xsloader.isFunction(exCallback)) {\r\n\t\t\texCallback(e);\r\n\t\t} else {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n\tif(rs === undefined || rs === null) {\r\n\t\trs = defaultReturn;\r\n\t}\r\n\treturn rs;\r\n}\r\n\r\nfunction dealProperties(obj, properties) {\r\n\treturn utils.propertiesDeal(obj, properties);\r\n}\r\n\r\nfunction extend(target) {\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\ttarget[x] = obj[x];\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction extendDeep(target) {\r\n\tif(!target) {\r\n\t\treturn target;\r\n\t}\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\r\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\r\n\t\t\t} else {\r\n\t\t\t\ttarget[x] = obj[x];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction _AsyncCall(useTimer) {\r\n\tlet thiz = this;\r\n\tlet count = 0;\r\n\tlet ctrlCallbackMap = {};\r\n\r\n\tfunction initCtrlCallback(callbackObj) {\r\n\t\tlet mineCount = count + \"\";\r\n\t\tif(!ctrlCallbackMap[mineCount]) {\r\n\t\t\tlet ctrlCallback = function() {\r\n\t\t\t\tcount++;\r\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\r\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\r\n\t\t\t\twhile(asyncCallQueue.length) {\r\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\r\n\t\t\t\t\tlet lastReturn = undefined;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif(callbackObj.callback) {\r\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet handle;\r\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\r\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\r\n\t\t\t\t\t\tif(!handle) {\r\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tctrlCallbackMap[mineCount] = [];\r\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\r\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout(ctrlCallback, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet queue = ctrlCallbackMap[mineCount];\r\n\t\tqueue.push(callbackObj);\r\n\t}\r\n\r\n\tthis.pushTask = function(callback, obj) {\r\n\t\tlet callbackObj;\r\n\t\tlet handle = {\r\n\t\t\tnext: function(nextCallback, lastReturn) {\r\n\t\t\t\tcallbackObj.nextCallback.push({\r\n\t\t\t\t\tcallback: nextCallback,\r\n\t\t\t\t\tlastReturn: lastReturn\r\n\t\t\t\t});\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t};\r\n\t\tcallbackObj = {\r\n\t\t\tcallback: callback,\r\n\t\t\tobj: obj,\r\n\t\t\tnextCallback: [],\r\n\t\t\thandle: handle\r\n\t\t};\r\n\r\n\t\tinitCtrlCallback(callbackObj);\r\n\r\n\t\treturn handle;\r\n\t};\r\n}\r\n\r\nconst theAsyncCall = new _AsyncCall();\r\nconst theAsyncCallOfTimer = new _AsyncCall(true);\r\n\r\nlet asyncCall = function(callback, useTimer) {\r\n\tif(useTimer) {\r\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\r\n\t} else {\r\n\t\treturn theAsyncCall.pushTask(callback);\r\n\t}\r\n};\r\n\r\n/**\r\n * 得到属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction getObjectAttr(obj, attrNames, defaultValue) {\r\n\tif(!obj || !attrNames) {\r\n\t\treturn undefined;\r\n\t}\r\n\tlet attrs = attrNames.split(\".\");\r\n\tlet rs = defaultValue;\r\n\tlet i = 0;\r\n\tfor(; i < attrs.length && obj; i++) {\r\n\t\tlet k = attrs[i];\r\n\t\tobj = obj[k];\r\n\t}\r\n\tif(i == attrs.length) {\r\n\t\trs = obj;\r\n\t}\r\n\r\n\treturn rs;\r\n}\r\n\r\n/**\r\n * 设置属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction setObjectAttr(obj, attrNames, value) {\r\n\tlet _obj = obj;\r\n\tlet attrs = attrNames.split(\".\");\r\n\r\n\tfor(let i = 0; i < attrs.length; i++) {\r\n\t\tlet k = attrs[i];\r\n\r\n\t\tif(i == attrs.length - 1) {\r\n\t\t\tobj[k] = value;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet o = obj[k];\r\n\t\tif(!o) {\r\n\t\t\to = {};\r\n\t\t\tobj[k] = o;\r\n\t\t}\r\n\t\tobj = o;\r\n\t}\r\n\treturn _obj;\r\n}\r\n\r\nfunction clone(obj, isDeep = false) {\r\n\t// Handle the 3 simple types, and null or undefined or function\r\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\r\n\r\n\tif(xsloader.isRegExp(obj)) {\r\n\t\treturn new RegExp(obj.source, obj.flags);\r\n\t}\r\n\r\n\t// Handle Date\r\n\tif(xsloader.isDate(obj)) {\r\n\t\tlet copy = new Date();\r\n\t\tcopy.setTime(obj.getTime());\r\n\t\treturn copy;\r\n\t}\r\n\t// Handle Array or Object\r\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\r\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\r\n\t\tfor(let attr in obj) {\r\n\t\t\tif(obj.hasOwnProperty(attr)) {\r\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn copy;\r\n\t}\r\n\treturn obj;\r\n}\r\n\r\nfunction sortObject(obj) {\r\n\tif(!obj || !xsloader.isObject(obj)) {\r\n\t\treturn obj;\r\n\t} else {\r\n\t\tlet keys = [];\r\n\t\tfor(let k in obj) {\r\n\t\t\tkeys.push(k);\r\n\t\t}\r\n\t\tkeys.sort();\r\n\t\tlet newObj = {};\r\n\t\tfor(let i = 0; i < keys.length; i++) {\r\n\t\t\tnewObj[keys[i]] = obj[keys[i]];\r\n\t\t}\r\n\t\treturn newObj;\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tqueryParam,\r\n\tgetUrl,\r\n\tgetUrl2,\r\n\ttryCall,\r\n\tdealProperties,\r\n\textend,\r\n\textendDeep,\r\n\tasyncCall,\r\n\tgetObjectAttr,\r\n\tsetObjectAttr,\r\n\tclone,\r\n\tsortObject,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet isDOM = (typeof HTMLElement === 'object') ?\r\n\tfunction(obj) {\r\n\t\treturn obj && (obj instanceof HTMLElement);\r\n\t} :\r\n\tfunction(obj) {\r\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\r\n\t};\r\n\r\nlet onReadyFun = (function() {\r\n\tlet isGlobalReady = false;\r\n\tlet bindReadyQueue = [];\r\n\r\n\tfunction BindReady(callback) {\r\n\t\tif(isGlobalReady) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet isReady = false;\r\n\r\n\t\tfunction ready() {\r\n\t\t\tif(isReady) return;\r\n\t\t\tisReady = true;\r\n\t\t\tisGlobalReady = true;\r\n\t\t\tcallback();\r\n\t\t}\r\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\r\n\t\tif(document.addEventListener) {\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\r\n\r\n\t\t} else if(document.attachEvent) {\r\n\t\t\t// ensure firing before onload,\r\n\t\t\t// maybe late but safe also for iframes\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tif(document.readyState === \"complete\") {\r\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\r\n\t\t\t\t\tready();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\r\n\t\t\t// If IE and not an iframe\r\n\t\t\t// continually check to see if the document is ready\r\n\r\n\t\t\tlet fun2;\r\n\t\t\tfun2 = function() {\r\n\t\t\t\tif(isReady) return;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\r\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tsetTimeout(fun2, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// and execute any waiting functions\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\r\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\r\n\t\t} else {\r\n\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\tready();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.readyCall = ready;\r\n\t}\r\n\tlet onReady = function(callback) {\r\n\t\tif(document.readyState === \"complete\") {\r\n\t\t\tisGlobalReady = true;\r\n\t\t}\r\n\t\tlet br = new BindReady(callback);\r\n\t\tif(!isGlobalReady) {\r\n\t\t\tbindReadyQueue.push(br);\r\n\t\t}\r\n\t};\r\n\tonReady(function() {\r\n\t\tisGlobalReady = true;\r\n\t});\r\n\r\n\tif(document.readyState === \"complete\") {\r\n\t\tisGlobalReady = true;\r\n\t} else {\r\n\t\tlet addEventHandle;\r\n\t\tif(global.addEventListener) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.addEventListener(type, callback, false);\r\n\t\t\t};\r\n\t\t} else if(global.attachEvent) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\taddEventHandle(\"load\", function() {\r\n\t\t\tisGlobalReady = true;\r\n\t\t\twhile(bindReadyQueue.length) {\r\n\t\t\t\tbindReadyQueue.shift().readyCall();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn onReady;\r\n})();\r\n\r\nexport default {\r\n\tisDOM,\r\n\tonReady: onReadyFun\r\n};","import utils from \"../util/index.js\";\r\n////////////////////\r\n\r\nimport deprecated from './global-deprecated.js';\r\nimport base from './global-base.js';\r\n//////////////////\r\nimport is from './is.js';\r\nimport funs from './funs.js';\r\nimport browser from './browser.js';\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst env = {\r\n\tversion: ENV_XSLOADER_VERSION\r\n}\r\n\r\nlet toGlobal = {\r\n\t...deprecated,\r\n\t...base\r\n};\r\nfor(let k in toGlobal) {\r\n\txsloader[k] = toGlobal[k];\r\n\tglobal[k] = toGlobal[k];\r\n}\r\n\r\nlet justLoader = {\r\n\t...is,\r\n\t...funs,\r\n\t...browser,\r\n\tignoreAspect_: {\r\n\r\n\t},\r\n\teach: utils.each,\r\n\tBase64: utils.base64,\r\n\tenv,\r\n};\r\nfor(let k in justLoader) {\r\n\txsloader[k] = justLoader[k];\r\n}","import utils from \"../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\n//global.__showModules=()=>{\r\n//\tconsole.log(theDefinedMap);\r\n//};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\t_preIndex;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif(isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\tpreDependModule: true,\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t//用于提前依赖\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tmodule.index = module.index || this._preIndex || 0;\r\n\t\tthis._preModule = null;\r\n\t\twhile(queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\n/**\r\n * 获取指定脚本、加载中模块的依赖，并添加到defineObject.deps末尾。(配置里的依赖、不一定被添加到实际模块中，模块别名的缘故)\r\n * @param {Object} src\r\n */\r\nfunction appendLoadingModuleDeps(defineObject) {\r\n\tlet src = defineObject.src;\r\n\tlet deps = defineObject.deps;\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tlet mod = moduleDef.defaultModule && moduleDef.defaultModule.state == \"loading\" && moduleDef.defaultModule;\r\n\t\tlet _deps = mod && mod.deps;\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(mod) {\r\n\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t}\r\n\t\tfor(let k in moduleDef.modules) {\r\n\t\t\tmod = moduleDef.modules[k].state == \"loading\" && moduleDef.modules[k];\r\n\t\t\t_deps = mod && mod.deps;\r\n\r\n\t\t\tif(mod) {\r\n\t\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t\t}\r\n\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} nameOrUrl\r\n * @param {Object} selfname\r\n * @param ifoneThenGet 如果没有找到(排除此模块)，且只有唯一的一个、且状态为loaded或defined、则返回该模块对象。获取的模块不等于此模块。\r\n */\r\nfunction getModule(nameOrUrl, selfname = null, ifoneThenGet = null) {\r\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif(moduleDef) {\r\n\t\tlet module;\r\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif(selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(module == ifoneThenGet) {\r\n\t\t\tmodule = null;\r\n\t\t}\r\n\r\n\t\tif(!module && ifoneThenGet) {\r\n\t\t\tlet count = 0;\r\n\t\t\tlet mod = moduleDef.defaultModule;\r\n\t\t\tmod && mod != ifoneThenGet && count++;\r\n\t\t\tfor(let k in moduleDef.modules) {\r\n\t\t\t\tmod = moduleDef.modules[k];\r\n\t\t\t\tmod != ifoneThenGet && count++;\r\n\t\t\t}\r\n\t\t\tif(count == 1 && (mod.state == \"loaded\" || mod.state == \"defined\")) {\r\n\t\t\t\tmodule = mod;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name, index) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif(isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if(theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, true);\r\n\t\tdef._preIndex = index;\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif(!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if(theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef && !moduleDef.defaultModule) {\r\n\t\tif(moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor(let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif(!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tif(name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif(name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n\tappendLoadingModuleDeps\r\n};","import utils from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs, index = 0) {\r\n\tlet instanceModule = {\r\n\t\tindex,\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif(module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif(theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif(xsloader.isObject(obj)) {\r\n\t\t\t\tif(module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\r\n\t\t\t} else if(xsloader.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tlet exports = {};\r\n\t\t\tthis._setDepModuleObjectGen(exports);\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif(this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif(this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinitInstance: function(justForSingle) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\t\t\tif(pluginArgs !== undefined) {\r\n\t\t\t\tif(!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif(this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif(result == undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif(this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new utils.PluginError(err || false));\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.args);\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\t//console.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tindex,\r\n\t\tmodule: module,\r\n\t\tsrc: module.src,\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tselfname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//\tif(module.selfname == \"css\") {\r\n\t//\t\tconsole.log(\"absUrl=\" + instanceModule.thiz.absUrl() + \",invoker.absUrl=\" + instanceModule.thiz.invoker().absUrl());\r\n\t//\t}\r\n\r\n\t//\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _newModule(name, src, thatInvoker, index) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlet defineObject = new script.DefineObject(src, null, [name, null, null]);\r\n\tdefineObject.index = index;\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(); //添加配置依赖，该模块对象是加载者、而不是define者\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tindex: defineObject.index || 0, //在上级依赖数组中所处的索引位置\r\n\t\tid: utils.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tparent: defineObject.parentDefine,\r\n\t\tdescription() {\r\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\tignoreAspect: false,\r\n\t\targs: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tabsUrlFromModule: () => defineObject.absUrlFromDefineObject(),\r\n\t\tgetCallback: () => defineObject.callback,\r\n\t\t_dealApplyArgs: (args) => args,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\texports: null,\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(defineObject) {\r\n\t\t\tthis.deps = defineObject.deps || [];\r\n\t\t\tthis.getCallback = () => defineObject.callback;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif(willCache) {\r\n\t\t\t\tif(!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\targs = this._dealApplyArgs(args);\r\n\t\t\tthis.args = args;\r\n\t\t\tlet obj;\r\n\t\t\tif(xsloader.isFunction(this.getCallback())) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.getCallback().apply(this.thiz, args);\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.getCallback();\r\n\t\t\t\tif(this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif(obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(this.loopObject) {\r\n\t\t\t\tif(!xsloader.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor(let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif(this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs, fun.index);\r\n\t\t\t\t\t\tdepModule.initInstance();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif(deps && deps.length > 0) {\r\n\t\t\t\t\txsloader.require(deps, () => {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: this.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif(fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif(!this._callback()) {\r\n\t\t\t\twhile(this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.state = this.refmodule.state; //状态同步,保持与refmodule状态相同\r\n\t\t\t\treturn this.refmodule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\trefmodule: undefined, //引用指定模块\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.refmodule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile(theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\tthis.refmodule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif(this.relys.length || this.refmodule && this.refmodule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs, index) {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.refmodule.relyIt(thatInvoker, callbackFun, pluginArgs, index); //传递给refmodule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs,\r\n\t\t\t\tindex,\r\n\t\t\t};\r\n\t\t\tif(this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tnew script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif(xsloader.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if(xsloader.isObject(name)) {\r\n\t\t\t\t\tfor(let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor(let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(mobj._modules_) {\r\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif(node.nodes.length) {\r\n\t\t\t\tutils.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tif(node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.error(\"{-----------------------------------------------------------------------------------------------\");\r\n\t\tconsole.error(\"load module error:id=\" + this.id + \",\" + (this.selfname ? \"selfname=\" + this.selfname + \",\" : \"\") + \"my page=\" + location.href);\r\n\t\tutils.each(leafs, function(leaf) {\r\n\t\t\tlet infos = [];\r\n\t\t\tgenErrs(leaf, infos);\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tfor(let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(\"\\n\\t--->\"));\r\n\t\t\t}\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\t\t\tif(errModule) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(dep + \":null\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tconsole.warn(\"\\t\" + dep + \":src=\" + depMod.src + \",absUrl=\" + (depMod.thiz && depMod.thiz.absUrl()));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(dep + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.error(\"}-----------------------------------------------------------------------------------------------\");\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif(this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.each(this.deps, function(dep) {\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif(indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif(mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif(mod) {\r\n\t\t\t\tmod._printOnNotDefined && mod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif(defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径,此时模块的依赖已经全部处理好了\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = xsloader.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_of_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if(isError) {\r\n\t\t\tmodule.setState('error', isError);\r\n\t\t\tif(!hasCallErr) {\r\n\t\t\t\thasCallErr = true;\r\n\t\t\t\tlet err = new utils.PluginError(isError, invoker_of_module, {\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t});\r\n\t\t\t\terrCallback(err, invoker_of_module);\r\n\t\t\t}\r\n\t\t}!isError && syncHandle && syncHandle();\r\n\t}\r\n\r\n\tutils.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\t//\t\tif(xsloader.startsWith(dep, \"css!\")) {\r\n\t\t//\t\t\tconsole.log(\"src=\" + module.src + \",absUrl=\" + invoker_of_module.absUrl() + \",absolute=\" + invoker_of_module.src());\r\n\t\t//\t\t}\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tmoduleDef.getModule(dep)\r\n\t\t\t\t.relyIt(invoker_of_module, function(depModule, err) {\r\n\t\t\t\t\tif(!err) {\r\n\t\t\t\t\t\tdepCount--;\r\n\t\t\t\t\t\tif(dep == \"exports\") {\r\n\t\t\t\t\t\t\tif(theExports) {\r\n\t\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tmodule.exports = theExports;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\t}, pluginArgs, index);\r\n\t\t};\r\n\r\n\t\tif(!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = utils.isJsFile(dep);\r\n\t\t\tdo {\r\n\t\t\t\tlet urls;\r\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif(i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif(i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = xsloader.resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if(config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if(isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\turls = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif(urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep, index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif(!invoker_of_module.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(invoker_of_module.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(urls[index] == dep) {\r\n\t\t\t\t\t\t\tdep = url; //替换为绝对路径\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url,true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!isError && urls.length) {\r\n\t\t\t\t\tutils.replaceModulePrefix(config, urls); //前缀替换\r\n\r\n\t\t\t\t\tif(isJsFile) {\r\n\t\t\t\t\t\tlet lastModule;\r\n\t\t\t\t\t\tutils.each([dep].concat(urls), (item) => {\r\n\t\t\t\t\t\t\tlastModule = moduleDef.getModule(item);\r\n\t\t\t\t\t\t\tif(lastModule) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif(lastModule) { //已经被加载过,在dep最初为相对地址、接着变成绝对地址、且该模块被多个其他模块依赖时会出现这种情况\r\n\t\t\t\t\t\t\tdep = lastModule.src;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], invoker_of_module, index);\r\n\t\t\t\t\tmodule2.setState(\"loading\"); //只有此处才设置loading状态\r\n\r\n\t\t\t\t\tlet configDeps = [];\r\n\t\t\t\t\tif(m2Name) {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(m2Name);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tutils.each(urls, (url) => {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(url);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(configDeps.length) {\r\n\t\t\t\t\t\t//先加载配置依赖\r\n\t\t\t\t\t\txsloader.require(configDeps, () => {\r\n\t\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif(index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif(index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = utils.removeQueryHash(url);\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\tlet defaultMod;\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块或者唯一的模块\r\n\t\t\t\t\t\t\t\t//(唯一的模块用于支持：脚本里只有一个define、且指定了模块名、且此处的模块名与其自己指定了不相等)\r\n\t\t\t\t\t\t\t\tdefaultMod = moduleDef.getModule(module2.src, null, module2);\r\n\t\t\t\t\t\t\t\tif(defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!defaultMod && module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//isError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//errCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t\t\tisError = e;\r\n\t\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif(!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};","import utils from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+)\\s+safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = utils.removeQueryHash(utils.getNodeAbsolutePath(theLoaderScript));\r\nconst thePageUrl = utils.thePageUrl;\r\nconst theHead = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif(this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastScriptSrc = thePageUrl;\r\nlet theRealDefine;\r\nif(safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps, defineObject) {\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif(xsloader.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\tabsUrl: defineObject.absUrlFromDefineObject(),\r\n\t\t\t\torderDep: isOrderDep,\r\n\t\t\t\tsrc: defineObject.src,\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\nclass Handle {\r\n\tdefineObject;\r\n\tconstructor(defineObject) {\r\n\t\tthis.defineObject = defineObject;\r\n\t}\r\n\r\n\tthen(option) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\r\n\t\treturn this;\r\n\t}\r\n\terror(onError) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle.onError = onError;\r\n\t\treturn this;\r\n\t}\r\n\tonError(err, invoker) {\r\n\t\tthis.defineObject.handle.onError(err, invoker);\r\n\t}\r\n}\r\n\r\nclass ThisInvoker {\r\n\tinvoker;\r\n\tconstructor(invoker) {\r\n\t\tthis.invoker = invoker;\r\n\t}\r\n}\r\n\r\nfunction _buildInvoker(module) {\r\n\tlet invoker = module[\"thiz\"];\r\n\tmodule = module.module || module;\r\n\tlet id = xsloader.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\r\n\t\tlet url;\r\n\t\tif(relativeUrl === undefined) {\r\n\t\t\turl = this.src();\r\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.absUrl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\r\n\t\t}\r\n\t\tif(appendArgs) {\r\n\t\t\tif(url == thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.getUrl2 = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tlet url = this.getUrl(relativeUrl, false, optionalAbsUrl);\r\n\t\tif(appendArgs) {\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.require = function() {\r\n\t\t//\t\tconsole.log(\"this.require:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0]);\r\n\t\tlet h = xsloader.require.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.require.get = function(name) {\r\n\t\treturn xsloader.require.get.apply(new ThisInvoker(invoker), [name]);\r\n\t};\r\n\r\n\tinvoker.define = function() {\r\n\t\t//\t\tconsole.log(\"this.define:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0] + (typeof arguments[0] == \"string\" ? (\",args[1]=\" + arguments[1]) : \"\"));\r\n\t\tlet h = xsloader.define.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrlFromDefineObject() || this.absUrl();\r\n\t};\r\n\r\n\t//deprecated\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = invoker.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.withAbsUrl = function(absUrlStr) {\r\n\t\tif(!absUrlStr) {\r\n\t\t\tabsUrlStr = invoker.absUrl();\r\n\t\t}\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tsrc: module.src,\r\n\t\t\tabsUrl: () => absUrlStr,\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\treturn new Invoker(moduleMap);\r\n\t};\r\n}\r\n\r\nclass Invoker {\r\n\t_im;\r\n\t_id;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new InVar(moduleMap);\r\n\t\tthis._id = utils.getAndIncIdCount();\r\n\t\tmoduleMap.thiz = this;\r\n\t\t_buildInvoker(moduleMap);\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址（弃用）\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址\r\n\t */\r\n\tsrc() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取在上级依赖数组中的索引位置\r\n\t */\r\n\tgetIndex() {\r\n\t\treturn this._im.get().index;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取当前调用者的调用者\r\n\t */\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrlFromModule();\r\n\t}\r\n\r\n\texports() {\r\n\t\treturn this._im.get().exports;\r\n\t}\r\n\r\n\troot() {\r\n\t\tlet p = this.invoker();\r\n\t\treturn p ? p.invoker() : this;\r\n\t}\r\n}\r\n\r\nfunction getMineInvoker(thiz) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thiz;\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = true) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else {\r\n\t\tlet parentModule = currentDefineModuleQueue.peek();\r\n\t\tif(parentModule) {\r\n\t\t\treturn parentModule.thiz;\r\n\t\t} else if(nullNew) {\r\n\t\t\tlet moduleMap = {\r\n\t\t\t\tmodule: \"\",\r\n\t\t\t\tsrc: thePageUrl,\r\n\t\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\t\tname: \"__root__\",\r\n\t\t\t\tinvoker: null\r\n\t\t\t};\r\n\t\t\treturn new Invoker(moduleMap);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tthiz;\r\n\tisRequire;\r\n\tsrc;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\t_directDepLength = 0;\r\n\tdirectDepLength = 0;\r\n\tnames = [];\r\n\tindex;\r\n\tconstructor(src, thiz, args = [], isRequire = false /*, willDealConfigDeps = false*/ ) {\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.handle = {\r\n\t\t\tonError(err, invoker) {\r\n\t\t\t\tconsole.error(utils.unwrapError(err));\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\r\n\t\tif(thiz instanceof ThisInvoker) {\r\n\t\t\t//this.handle.absUrl = thiz.invoker.src(); //设置默认参考地址\r\n\t\t\tthis.src = thiz.invoker.src();\r\n\t\t}\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif(args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if(typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif(deps && !xsloader.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif(!deps) {\r\n\t\t\tdeps = [];\r\n\t\t} else {\r\n\t\t\tdeps = xsloader.clone(deps);\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\t//if(!isRequire) {\r\n\t\tutils.appendInnerDeps(deps, callback);\r\n\t\t//}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.pushName(selfname);\r\n\t\tthis.callback = callback;\r\n\t\tthis._directDepLength = deps.length;\r\n\t\tthis.directDepLength = deps.length;\r\n\t}\r\n\r\n\tpushName(name) {\r\n\t\tif(name && xsloader.indexInArray(this.names, name) == -1) {\r\n\t\t\tthis.names.push(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理配置依赖及嵌套依赖,同时会替换前缀\r\n\t */\r\n\tappendConfigDepsAndEmbedDeps(module) {\r\n\t\tlet config = xsloader.config();\r\n\t\tlet src = this.src;\r\n\t\tlet deps = this.deps;\r\n\r\n\t\tlet _deps = config.getDeps(src);\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tutils.each(this.names, (name) => {\r\n\t\t\t_deps = config.getDeps(name);\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tif(this.handle.orderDep && this._directDepLength > 1 && deps.length > this._directDepLength) {\r\n\t\t\tlet odeps = [true]; //第一个true表示顺序依赖\r\n\t\t\twhile(this._directDepLength-- > 0) {\r\n\t\t\t\todeps.push(deps.shift());\r\n\t\t\t}\r\n\t\t\tdeps.unshift(odeps);\r\n\t\t\tthis.handle.orderDep = false;\r\n\t\t}\r\n\r\n\t\t_dealEmbedDeps(deps, this); //处理嵌套依赖\r\n\t\tutils.replaceModulePrefix(config, deps); //前缀替换\r\n\r\n\t\tif(module) {\r\n\t\t\tmodule.deps = deps;\r\n\t\t\tmodule._dealApplyArgs = (function(directDepLength, hasOrderDep) {\r\n\t\t\t\treturn function(applyArgs) {\r\n\t\t\t\t\tif(directDepLength == 0 || applyArgs.length == 0) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//顺序依赖,还原成最初的顺序,移除额外的依赖。\r\n\t\t\t\t\tlet args = new Array(directDepLength + 1);\r\n\t\t\t\t\tif(hasOrderDep) {\r\n\t\t\t\t\t\targs = applyArgs[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor(var i = 0; i < directDepLength; i++) {\r\n\t\t\t\t\t\t\targs[i] = applyArgs[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\targs[directDepLength] = applyArgs[applyArgs.length - 1].slice(0, directDepLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t})(this.directDepLength, this.directDepLength > 0 && this._directDepLength <= 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = utils.isJsFile(m);\r\n\r\n\t\t\t//替换相对路径为绝对路径\r\n\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\r\n\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\tdeps[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\tlet paths = utils.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif(paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrlFromDefineObject() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl || this.src;\r\n\t}\r\n\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n * @param {Object} isRemoveQueryHash\r\n */\r\nfunction getCurrentScript(isRemoveQueryHash = true) {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif(document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif(node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\t//\t\t\tutils.each(nodes, (node) => {\r\n\t\t\t//\t\t\t\tconsole.log(\"node.src=\" + node.src + \",node.readyState=\" + node.readyState);\r\n\t\t\t//\t\t\t});\r\n\t\t\tfor(let i = nodes.length - 1; i >= 0; i--) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif(node.readyState === \"interactive\" && node.src) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif(!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs;\r\n\tlet parentDefine = currentDefineModuleQueue.peek();\r\n\tif(parentDefine) {\r\n\t\trs = {\r\n\t\t\tsrc: parentDefine.src\r\n\t\t};\r\n\t} else {\r\n\t\trs = _getCurrentScriptOrSrc();\r\n\t}\r\n\r\n\tif(!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif(utils.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif(!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = utils.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif(src == utils.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(rs.node) {\r\n\t\trs.src = utils.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\tif(isRemoveQueryHash) {\r\n\t\trs.src = utils.removeQueryHash(rs.src);\r\n\t}\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = \"async\";\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif(node.detachEvent && !isOpera) {\r\n\t\tif(ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !xsloader.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif(useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tappendHeadDom(node);\r\n\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tnode.src = url; //在ie10-以下，必须在脚本插入head后再进行src的设置、且需要异步设置。\r\n\t\t});\r\n\t} else {\r\n\t\tnode.src = url;\r\n\t}\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif(!xsloader.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\ttheHead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif(isSrcFromScriptLoad) {\r\n\t\t\t\tlastScriptSrc = scriptData.src; //已经不含参数\r\n\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(utils.IE_VERSION > 0 || utils.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\t//\tconsole.log(\"**********************************[\");\r\n\tlet rs = getCurrentScript(); //已经不含参数\r\n\r\n\t//\tif(typeof args[0] == \"string\") {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",args[1]=\" + args[1] + \",src=\" + rs.src);\r\n\t//\t} else {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",src=\" + rs.src);\r\n\t//\t}\r\n\t//\tconsole.log(rs.node);\r\n\t//\tconsole.log(\"**********************************]\\n\");\r\n\tlet src = rs.src;\r\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire);\r\n\tif(!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif(defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\txsloader.config().error(e);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet handle = new Handle(defineObject);\r\n\r\n\tlet isLoaderEnd = utils.isLoaderEnd();\r\n\txsloader.asyncCall(() => {\r\n\t\tif(isSrcFromScriptLoad && isLoaderEnd) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastScriptSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastScriptSrc;\r\n\t\t}\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nlet isFirstRequire = true;\r\n\r\nfunction prerequire(deps, callback) {\r\n\tlet config = xsloader.config();\r\n\tif(!config) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\tlet thatInvoker = getInvoker(this);\r\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\r\n\t\tif(deps == \"exports\") { //当require(\"exports\")时，必须依赖了exports\r\n\t\t\tlet mineInvoker = getMineInvoker(this);\r\n\t\t\tlet exports = mineInvoker && mineInvoker.exports();\r\n\t\t\tif(!exports) {\r\n\t\t\t\tthrow new Error(\"not found exports\");\r\n\t\t\t} else {\r\n\t\t\t\treturn exports;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet originDeps = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = deps.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\r\n\t\t\tdeps = deps.substring(0, pluginIndex);\r\n\t\t\tif(pluginArgs) {\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tutils.replaceModulePrefix(config, argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet module = moduleScript.getModule(deps);\r\n\t\tif(!module) {\r\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\r\n\t\t\tmodule = moduleScript.getModule(deps);\r\n\t\t}\r\n\t\tif(!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t} else if(module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}, pluginArgs).initInstance(true);\r\n\t\tif(theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = xsloader.randId(\"_require\");\r\n\tif(xsloader.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t} else if(!xsloader.isArray(deps)) {\r\n\t\tthrow new Error(\"unexpected argument:\" + deps);\r\n\t}\r\n\tutils.appendInnerDeps(deps, callback);\r\n\tlet timeid;\r\n\tlet loading;\r\n\tlet isOk = false;\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\tif(isFirstRequire && config.plugins.loading.enable) {\r\n\t\tisFirstRequire = false;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif(!isOk) {\r\n\t\t\t\tloading = new utils.ToProgress(config.plugins.loading);\r\n\t\t\t\tloading.autoIncrement();\r\n\t\t\t\tif(isErr) {\r\n\t\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t\t\tloading = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config.plugins.loading.delay);\r\n\t}\r\n\tlet clearTimer = function(isErr = false) {\r\n\t\tif(loading) {\r\n\t\t\tif(isErr) {\r\n\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t} else {\r\n\t\t\t\tloading.stopAuto();\r\n\t\t\t\tloading.finish();\r\n\t\t\t}\r\n\t\t\tloading = null;\r\n\t\t}\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tisOk = true;\r\n\t\tclearTimer();\r\n\t\t//\t\tconsole.log(\"2======require:\"+selfname);\r\n\t\t//\t\tconsole.log(callback);\r\n\t\tif(xsloader.isFunction(callback)) {\r\n\t\t\ttry {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t} catch(e) {\r\n\t\t\t\thandle.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}], true);\r\n\thandle.waitTime = config.waitSeconds * 1000;\r\n\r\n\thandle.logError = function(err, invoker, logFun = \"error\") {\r\n\t\tinvoker && console[logFun](\"invoker.url=\", invoker.getUrl());\r\n\t\tthatInvoker && console[logFun](\"require.invoker.url=\", thatInvoker.getUrl());\r\n\t\tconsole[logFun](utils.unwrapError(err));\r\n\t};\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tisErr = !!err;\r\n\t\tclearTimer(true);\r\n\t\tif(customerErrCallback) {\r\n\t\t\tcustomerErrCallback.call(handle, err, invoker);\r\n\t\t} else {\r\n\t\t\thandle.logError(err, invoker);\r\n\t\t}\r\n\t});\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\txsloader.asyncCall(() => {\r\n\r\n\t\tif(handle.waitTime) {\r\n\t\t\tlet checkResultFun = function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\t\t\t\t//console.log(isErr)\r\n\t\t\t\t\tif((!ifmodule || ifmodule.state != 'defined') && !isErr) {\r\n\t\t\t\t\t\tlet module = ifmodule;\r\n\t\t\t\t\t\thandle.onError(\"require timeout:selfname=\" + selfname + \",\\n\\tdeps=[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\r\n\t\t\t\t\t\tif(module) {\r\n\t\t\t\t\t\t\tutils.each(module.deps, function(dep) {\r\n\t\t\t\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\t\t\t\tif(mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t\tclearTimer();\r\n\t\t\t};\r\n\t\t\ttimeid = setTimeout(checkResultFun, handle.waitTime);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tif(typeof Promise != \"undefined\" && arguments.length == 1 && !callback) {\r\n\t\tlet promise = new Promise((resolve, inject) => {\r\n\t\t\tcallback = function() {\r\n\t\t\t\tif(deps.length == 1) {\r\n\t\t\t\t\tresolve(arguments[0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(var i = 0; i < deps.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\thandle.error((err) => {\r\n\t\t\t\tcallback = null;\r\n\t\t\t\tinject(err);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn promise;\r\n\t}\r\n\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif(!xsloader.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile(globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\tlastAppendHeadDom: function() {\r\n\t\treturn lastAppendHeadDom;\r\n\t},\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\thead: function() {\r\n\t\treturn theHead;\r\n\t},\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tHandle,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};","import loader from './loader.js';\r\nimport \"../public/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nimport script from \"./script.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nlet theContext;\r\nlet theConfig;\r\nlet argsObject = {};\r\n\r\nxsloader.config = function() {\r\n\treturn theConfig;\r\n};\r\nxsloader.script = function() {\r\n\treturn script.theLoaderScript;\r\n};\r\n\r\nxsloader.lastAppendHeadDom = function() {\r\n\treturn script.lastAppendHeadDom();\r\n};\r\n\r\nxsloader.scriptSrc = function() {\r\n\treturn script.theLoaderUrl;\r\n};\r\n\r\nxsloader.putUrlArgs = function(argsObj) {\r\n\targsObject = xsloader.extend(argsObject, argsObj);\r\n};\r\n\r\nxsloader.getUrlArgs = function() {\r\n\tlet obj = xsloader.extend({}, argsObject);\r\n\treturn obj;\r\n};\r\n\r\nxsloader.clearUrlArgs = function() {\r\n\targsObject = {};\r\n};\r\n\r\nxsloader.appendHeadDom = script.appendHeadDom;\r\n\r\nxsloader.hasDefine = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif(!module || module.state == \"init\") {\r\n\r\n\t} else {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\r\nxsloader.resUrlBuilder = function(groupName) {\r\n\tthrow new Error('resUrlBuilder not found!');\r\n};\r\n\r\nxsloader.clear_module_ = function() {\r\n\tlet modules = arguments;\r\n\tfor(let i = 0; i < modules.length; i++) {\r\n\t\tif(modules[i]) {\r\n\t\t\tdelete modules[i]._module_;\r\n\t\t\tdelete modules[i]._modules_;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction _newContext() {\r\n\tlet context = {\r\n\t\tcontextName: script.contextName,\r\n\t\tdefQueue: []\r\n\t};\r\n\treturn context;\r\n}\r\n\r\nloader.loaderFun((option) => {\r\n\tif(theContext) {\r\n\t\tthrow new Error(\"already configed!\");\r\n\t}\r\n\toption = xsloader.extend({\r\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\r\n\t\turlArgs: {},\r\n\t\tignoreProperties: false,\r\n\t\tpaths: {},\r\n\t\tdepsPaths: {},\r\n\t\tdeps: {},\r\n\t\tjsExts: undefined,\r\n\t\tproperties: {},\r\n\t\tmodulePrefix: {},\r\n\t\tdefineFunction: {},\r\n\t\tmodulePrefixCount: 0,\r\n\t\twaitSeconds: 20,\r\n\t\tautoUrlArgs() {\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tinstance: \"single\",\r\n\t\tdealtDeps: {},\r\n\t\tdealProperties(obj) {\r\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\r\n\t\t},\r\n\t\tisInUrls(m) {\r\n\t\t\treturn !!this.getUrls(m);\r\n\t\t},\r\n\t\tgetUrls(m) {\r\n\t\t\treturn this.paths[m] || this.depsPaths[m];\r\n\t\t},\r\n\t\tgetDeps(m) {\r\n\t\t\tlet as = this.dealtDeps[m] || [];\r\n\t\t\tlet deps = [];\r\n\t\t\tlet hasOrderDep = undefined;\r\n\r\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\r\n\t\t\t\tif(as[0]) {\r\n\t\t\t\t\tdeps = [\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t];\r\n\t\t\t\t\thasOrderDep = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tas.splice(0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < as.length; i++) {\r\n\t\t\t\tif(hasOrderDep === true) {\r\n\t\t\t\t\tdeps[0].push(as[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeps.push(as[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deps;\r\n\t\t},\r\n\t\tdealUrl(module, url, addVersion = false) {\r\n\t\t\tlet urlArg;\r\n\t\t\tlet nameOrUrl;\r\n\t\t\tif(this.autoUrlArgs()) {\r\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\r\n\t\t\t} else {\r\n\t\t\t\tlet moduleName;\r\n\t\t\t\tlet src;\r\n\t\t\t\tif(xsloader.isString(module)) {\r\n\t\t\t\t\tmoduleName = module;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleName = module.selfname;\r\n\t\t\t\t\tsrc = module.src;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//精确匹配优先\r\n\r\n\t\t\t\t//先尝试模块名\r\n\t\t\t\turlArg = this.urlArgs[moduleName];\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(moduleName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//再尝试提供的url\r\n\t\t\t\tif(!urlArg && url) {\r\n\t\t\t\t\turlArg = this.urlArgs[url];\r\n\t\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(url);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//接着尝试模块src\r\n\t\t\t\tif(!urlArg && src) {\r\n\t\t\t\t\turlArg = this.urlArgs[src];\r\n\t\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(src);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//最后尝试通用的\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif(xsloader.isFunction(urlArg)) {\r\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\r\n\t\t\t}\r\n\r\n\t\t\tif(!urlArg) {\r\n\t\t\t\turlArg = \"\";\r\n\t\t\t}\r\n\r\n\t\t\tfor(let k in argsObject) { //加入全局的参数\r\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\r\n\t\t\t}\r\n\r\n\t\t\tif(addVersion && this.props.addVersion) {\r\n\t\t\t\turlArg += \"&_xsv=\" + encodeURIComponent(xsloader.env.version);\r\n\t\t\t}\r\n\r\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\r\n\t\t},\r\n\t\tdealUrlArgs(url) {\r\n\t\t\turl = utils.getPathWithRelative(location.href, url);\r\n\t\t\treturn this.dealUrl(url, url);\r\n\t\t},\r\n\t\tdefaultVersion: {},\r\n\t\tplugins: {},\r\n\t\tprops: {},\r\n\t}, option);\r\n\r\n\toption.props = xsloader.extend({\r\n\t\taddVersion: true,\r\n\t\tinnerDepType: \"auto\", //auto,require.get,require,disable\r\n\t}, option.props);\r\n\r\n\toption.plugins.loading = xsloader.extend({\r\n\t\tenable: true,\r\n\t\tcolor: '#2196f3',\r\n\t\tbgColor: 'rgba(0,0,0,0.1)',\r\n\t\terrColor: '#f5222d',\r\n\t\tduration: 0.2,\r\n\t\theight: 1,\r\n\t\tdelay: 500,\r\n\t}, option.plugins.loading);\r\n\r\n\tif(script.theLoaderScript.getAttribute(\"disable-loading\") !== undefined) {\r\n\t\toption.plugins.loading.enable = false;\r\n\t}\r\n\r\n\toption.plugins.image = xsloader.extend({\r\n\t\ttimeout: 10000, //超时时间，毫秒\r\n\t}, option.plugins.image);\r\n\r\n\toption.plugins.xsmsg = xsloader.extend({\r\n\t\ttimeout: 30000, //连接超时时间，毫秒\r\n\t\tsleep: 500, //连接检测的休眠时间，毫秒\r\n\t}, option.plugins.xsmsg);\r\n\r\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\r\n\t\toption.baseUrl += \"/\";\r\n\t}\r\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\r\n\r\n\tif(!option.ignoreProperties) {\r\n\t\toption = option.dealProperties(option);\r\n\t}\r\n\r\n\tutils.strValue2Arr(option.paths);\r\n\tutils.strValue2Arr(option.depsPaths);\r\n\tutils.strValue2Arr(option.deps);\r\n\r\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\r\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\r\n\t\toption.autoUrlArgs = function() {\r\n\t\t\treturn isAutoUrlArgs;\r\n\t\t};\r\n\t}\r\n\r\n\tlet modulePrefixCount = 0;\r\n\tfor(let prefix in option.modulePrefix) {\r\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\r\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\r\n\t\t}\r\n\t\tmodulePrefixCount++;\r\n\t}\r\n\toption.modulePrefixCount = modulePrefixCount;\r\n\tif(modulePrefixCount > 0) {\r\n\t\t//替换urlArgs中地址前缀\r\n\t\tlet star = option.urlArgs[\"*\"];\r\n\t\tdelete option.urlArgs[\"*\"];\r\n\r\n\t\tlet urlArgsArr = [];\r\n\t\tfor(let k in option.urlArgs) {\r\n\t\t\tlet url = k;\r\n\t\t\tif(utils.isJsFile(url)) { //处理相对\r\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\r\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\r\n\t\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\turlArgsArr.push({\r\n\t\t\t\turl: url,\r\n\t\t\t\targs: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor(let prefix in option.modulePrefix) {\r\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\r\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\t\tlet starP = \"\";\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\r\n\t\t\t\t\tstarP = \"*[\";\r\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\r\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\r\n\t\t\t\t}\r\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\r\n\t\t\t}\r\n\t\t}\r\n\t\toption.urlArgs = {};\r\n\t\toption.urlArgs[\"*\"] = star;\r\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\r\n\t\t}\r\n\t}\r\n\r\n\t//预处理urlArgs中的*[与*]\r\n\tlet _urlArgs_prefix = [];\r\n\tlet _urlArgs_suffix = [];\r\n\toption._urlArgs_prefix = _urlArgs_prefix;\r\n\toption._urlArgs_suffix = _urlArgs_suffix;\r\n\r\n\tfor(let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\t\tif(xsloader.startsWith(url, \"*[\")) {\r\n\t\t\tlet strfix = url.substring(2);\r\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\r\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\r\n\t\t\t} else {\r\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\r\n\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\tstrfix = absolute.path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_urlArgs_prefix.push({\r\n\t\t\t\tstrfix: strfix,\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\r\n\t\t\t_urlArgs_suffix.push({\r\n\t\t\t\tstrfix: url.substring(2),\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t}\r\n\t}\r\n\r\n\toption.forPrefixSuffix = function(urlOrName) {\r\n\t\t//前缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\r\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//后缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\r\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor(let name in option.paths) {\r\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\r\n\t}\r\n\tfor(let name in option.depsPaths) {\r\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\r\n\t}\r\n\r\n\t//处理依赖\r\n\tlet dealtDeps = option.dealtDeps;\r\n\r\n\tlet pushDeps = (dealtDepArray, depsArray) => {\r\n\t\tutils.each(depsArray, (dep) => {\r\n\t\t\tdealtDepArray.push(dep);\r\n\t\t});\r\n\t};\r\n\r\n\tfor(let keyName in option.deps) {\r\n\t\tlet paths = keyName.split('::');\r\n\t\tlet depsArray = option.deps[keyName];\r\n\t\tutils.each(paths, (path) => {\r\n\t\t\tif(path == '*') {\r\n\t\t\t\tfor(let m in option.depsPaths) {\r\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\r\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\r\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttheConfig = option;\r\n\ttheContext = _newContext();\r\n\tscript.onConfigedCallback(); //完成配置回调\r\n\treturn theConfig;\r\n});","import utils from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tutils.each(defines, (defineObject) => {\r\n\t\tif(xsloader.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\t//\t\t\t\tif(defineObject.isRequire) {\r\n\t\t\t\t//\t\t\t\t\tconsole.log(\"1======require:\" + defineObject.selfname);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(defineObject);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(originCallback);\r\n\t\t\t\t//\t\t\t\t}\r\n\t\t\t\tlet config = xsloader.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tutils.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\t//同一个模块可能分属于不同的module对象，加载者module当前处于loading状态、需要将其依赖追加进来、确保依赖完整\r\n\tmoduleScript.appendLoadingModuleDeps(defineObject);\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\tif(ifmodule) {\r\n\t\tif(ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t}\r\n\r\n\tif(defineObject.selfname != defineObject.src) {\r\n\t\tdefineObject.pushName(defineObject.selfname);\r\n\t}\r\n\r\n\tif(ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tdefineObject.pushName(ifmodule.selfname);\r\n\t}\r\n\t//一个模块的所有名字，包括src\r\n\tutils.each(defineObject.names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif(xsloader.ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(ifmodule); //添加配置依赖:在配置文件里直接通过src、名称配置的\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif(defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\r\n\r\n\tif(module.deps.length == 0) {\r\n\t\ttry {\r\n\t\t\tmodule.finish([]); //递归结束\r\n\t\t} catch(e) {\r\n\t\t\tdefineObject.handle.onError(e);\r\n\t\t}\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tutils.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodule.finish(args);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tdefineObject.handle.onError(e);\r\n\t\t\t\t}\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\tdefineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif(defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.get = function(name) {\r\n\tif(!xsloader.isString(name)) {\r\n\t\tthrow new Error(\"expected string type for module name\");\r\n\t} else {\r\n\t\treturn require.call(this, name);\r\n\t}\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif(args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor(var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif(!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nxsloader.define = define;\r\n//deprecated\r\nxsloader.defineAsync = define;\r\nxsloader.require = require;\r\nglobal.define = define;\r\nglobal.require = require;\r\n\r\ndefine.amd = true;\r\n\r\n//声明exports,内部会做特殊处理\r\ndefine(\"exports\", function() {});","import script from \"../script.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//内部依赖加载插件\r\n\r\nxsloader.define(script.INNER_DEPS_PLUGIN, {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tlet depsObj = script.innerDepsMap[depId];\r\n\t\tlet deps = depsObj.deps;\r\n\t\t//delete innerDepsMap[depId];\r\n\t\tlet newInvoker = this.invoker().withAbsUrl(depsObj.absUrl);\r\n\t\tnewInvoker.src = () => depsObj.src;\r\n\t\tnewInvoker.require(deps, function() {\r\n\t\t\tlet args = [];\r\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\r\n\t\t\t\targs.push(arguments[k]);\r\n\t\t\t}\r\n\t\t\tonload(args);\r\n\t\t}).then({\r\n\t\t\torderDep: depsObj.orderDep,\r\n\t\t\terror(err, invoker) {\r\n\t\t\t\tonerror(new utils.PluginError(err, invoker));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetCacheKey(depId) {\r\n\t\treturn depId;\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"ready\", {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\txsloader.onReady(function() {\r\n\t\t\tonload();\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!module\r\n */\r\nxsloader.define(\"try\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tlet handle = this.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(err, invoker) {\r\n\t\t\tconsole.info(`try!:require '${dep}' failed`);\r\n\t\t\tthis.logError(err, invoker, \"info\");\r\n\t\t\tonload(null);\r\n\t\t});\r\n\t\tif(handle.waitTime && handle.waitTime > 1000) {\r\n\t\t\thandle.waitTime -= 1000;\r\n\t\t}\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 插件用于加载某些js文件，忽略其所有依赖，可用于忽略在加载webpack等打包的模块时自动添加内部require('...')的依赖\r\n */\r\nxsloader.define(\"nodeps\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tthis.invoker().withAbsUrl().require([arg], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\tdepBefore(index, dep, depDeps) {\r\n\t\t\t\tdepDeps.splice(0, depDeps.length);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * exists!module1 or module2 or module3|windowVar1|windowVar2...\r\n */\r\nxsloader.define(\"exists\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet vars = arg.split(\"|\");\r\n\t\tfor(let i = 0; i < vars.length; i++) {\r\n\t\t\tvars[i] = vars[i].trim();\r\n\t\t}\r\n\t\tif(vars.length == 0) {\r\n\t\t\tonerror(\"args error for exists!\");\r\n\t\t} else {\r\n\t\t\tlet moduleNames = (vars[0].replace(/\\s/g, \" \")).split(\" or \");\r\n\t\t\tlet moduleName;\r\n\t\t\tlet module;\r\n\t\t\tfor(let i = 0; i < moduleNames.length; i++) {\r\n\t\t\t\tmoduleName = moduleNames[i].trim();\r\n\t\t\t\tmodule = moduleScript.getModule(moduleName);\r\n\t\t\t\tif(module) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(module) {\r\n\t\t\t\tthis.invoker().withAbsUrl().require([moduleName], function(mod, depModuleArgs) {\r\n\t\t\t\t\tonload(mod);\r\n\t\t\t\t}).error(function(e) {\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tlet obj = undefined;\r\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\r\n\t\t\t\t\tif(window[vars[i]]) {\r\n\t\t\t\t\t\tobj = window[vars[i]];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(obj === undefined) {\r\n\t\t\t\t\tonerror(\"not found:\" + arg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!moduleName=>>modulePath\r\n */\r\n\r\nxsloader.define(\"name\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tmoduleName = moduleName.replace(/，/g, ',');\r\n\t\tlet names = moduleName.split(\",\");\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tlet existsMods = [];\r\n\t\t\tfor(let i = 0; i < names.length; i++) {\r\n\t\t\t\tlet newName = names[i];\r\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\r\n\t\t\t\tif(lastM && lastM.state != \"init\" && !lastM.preDependModule) {\r\n\t\t\t\t\texistsMods.push(\"\\tselfname=\" + newName + \",state=\" + lastM.state + \",src=\" + lastM.src);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet module = depModuleArgs[0].module;\r\n\t\t\t\tif(lastM && !lastM.preDependModule) {\r\n\t\t\t\t\tlastM.toOtherModule(module);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleScript.setModule(newName, module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(existsMods.length) {\r\n\t\t\t\tonerror(\"already exists:\" + existsMods.join('\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tonload(mod);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nimport script from \"../script.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/*\r\n * Require-CSS RequireJS css! loader plugin\r\n * 0.1.8\r\n * Guy Bedford 2014\r\n * MIT\r\n */\r\nxsloader.define(\"css\", function() {\r\n\r\n\tlet lastDom; //始终执行最后一个style（inverse处理的）\r\n\t//层级之间，越顶层的、越在后面；同级之间，索引越大的、越在后面\r\n\tclass Node {\r\n\t\tparent;\r\n\t\tchildren = {};\r\n\t\t_maxindex = -1;\r\n\t\t_minindex;\r\n\t\tdoms = {}; //index:dom\r\n\t\tsrc;\r\n\t\tconstructor(src) {\r\n\t\t\tthis.src = src;\r\n\t\t}\r\n\r\n\t\taddChild(src, node) {\r\n\t\t\tthis.children[src] = node;\r\n\t\t\tnode.parent = this;\r\n\t\t}\r\n\t\tgetChild(src) {\r\n\t\t\treturn this.children[src];\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 将添加到返回节点之前\r\n\t\t */\r\n\t\tfindAnchor(index, dom) {\r\n\t\t\tif(dom) {\r\n\t\t\t\tthis.doms[index] = dom;\r\n\t\t\t}\r\n\r\n\t\t\tlet anchorDom;\r\n\t\t\tif(this._maxindex == -1) {\r\n\t\t\t\tthis._maxindex = index;\r\n\t\t\t\tthis._minindex = index;\r\n\t\t\t\t//层级之间,反向添加\r\n\t\t\t\tlet p = this.parent;\r\n\t\t\t\twhile(p) {\r\n\t\t\t\t\tif(p._maxindex == -1) {\r\n\t\t\t\t\t\tp = p.parent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tanchorDom = p.doms[p._minindex];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//同级之间、按照索引大小顺序添加\r\n\t\t\t\tif(index > this._maxindex) {\r\n\t\t\t\t\tanchorDom = this.doms[this._maxindex].nextSibling;\r\n\t\t\t\t\tthis._maxindex = index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(this._minindex > index) {\r\n\t\t\t\t\t\tthis._minindex = index;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let i = index + 1; i < this._maxindex; i++) {\r\n\t\t\t\t\t\tif(this.doms[i]) {\r\n\t\t\t\t\t\t\tanchorDom = this.doms[i];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!anchorDom) {\r\n\t\t\t\tanchorDom = lastDom ? lastDom.nextSibling : xsloader.script().nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn anchorDom;\r\n\t\t}\r\n\t}\r\n\r\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\r\n\tlet useImportLoad = false;\r\n\tlet useOnload = true;\r\n\tif(engine[1] || engine[7])\r\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\r\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\r\n\t\tuseOnload = false;\r\n\telse if(engine[4])\r\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\r\n\tlet cssAPI = {};\r\n\r\n\tlet cssIndex = 0;\r\n\t//src:Node\r\n\tconst rootNodes = {};\r\n\r\n\tfunction domIndex(dom) {\r\n\t\tlet index = 0;\r\n\t\twhile((dom = dom.previousSibling)) {\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\treturn index;\r\n\t}\r\n\r\n\tfunction buildAndGetNode(mthiz) {\r\n\t\tlet src = mthiz.src();\r\n\t\tlet p = mthiz.invoker();\r\n\r\n\t\twhile(p && p.src() == src) {\r\n\t\t\tp = p.invoker();\r\n\t\t}\r\n\r\n\t\tif(p) {\r\n\t\t\tlet pnode = buildAndGetNode(p);\r\n\t\t\tlet node = pnode.getChild(src);\r\n\t\t\tif(!node) {\r\n\t\t\t\tnode = new Node(src);\r\n\t\t\t\tpnode.addChild(src, node);\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t} else {\r\n\t\t\t//root\r\n\t\t\tif(!rootNodes[src]) {\r\n\t\t\t\trootNodes[src] = new Node(src);\r\n\t\t\t}\r\n\t\t\treturn rootNodes[src];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction appendCssDom(dom, cssThis, inverse) {\r\n\t\tif(cssThis && inverse) {\r\n\t\t\tlet mthis = cssThis.invoker();\r\n\t\t\tlet node = buildAndGetNode(mthis);\r\n\t\t\tdom.setAttribute(\"data-insert-index\", cssIndex++);\r\n\t\t\tlet index = cssThis.getIndex();\r\n\t\t\tlet nextDom = node.findAnchor(index, dom);\r\n\t\t\tscript.head().insertBefore(dom, nextDom);\r\n\r\n\t\t\tif(!lastDom || domIndex(dom) > domIndex(lastDom)) {\r\n\t\t\t\tlastDom = dom;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\txsloader.appendHeadDom(dom);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet curStyle, curSheet;\r\n\tlet createStyle = function(mthis, inverse) {\r\n\t\tcurStyle = document.createElement('style');\r\n\t\tappendCssDom(curStyle, mthis, inverse);\r\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\r\n\t};\r\n\tlet ieCnt = 0;\r\n\tlet ieLoads = [];\r\n\tlet ieCurCallback;\r\n\tlet createIeLoad = function(url, mthis, inverse) {\r\n\t\tcurSheet.addImport(url);\r\n\t\tcurStyle.onload = function() {\r\n\t\t\tprocessIeLoad(mthis, inverse);\r\n\t\t};\r\n\r\n\t\tieCnt++;\r\n\t\tif(ieCnt == 31) {\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\t\t\tieCnt = 0;\r\n\t\t}\r\n\t};\r\n\tlet processIeLoad = function(mthis, inverse) {\r\n\t\tieCurCallback();\r\n\t\tlet nextLoad = ieLoads.shift();\r\n\t\tif(!nextLoad) {\r\n\t\t\tieCurCallback = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tieCurCallback = nextLoad[1];\r\n\t\tcreateIeLoad(nextLoad[0], mthis, inverse);\r\n\t};\r\n\tlet importLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif(!curSheet || !curSheet.addImport)\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\r\n\t\tif(curSheet && curSheet.addImport) {\r\n\t\t\tif(ieCurCallback) {\r\n\t\t\t\tieLoads.push([url, callback]);\r\n\t\t\t} else {\r\n\t\t\t\tcreateIeLoad(url, mthis, inverse);\r\n\t\t\t\tieCurCallback = callback;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcurStyle.sheet.cssRules;\r\n\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t};\r\n\tlet linkLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tlet link = document.createElement('link');\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tif(useOnload)\r\n\t\t\tlink.onload = function() {\r\n\t\t\t\tlink.onload = function() {};\r\n\t\t\t\tsetTimeout(callback, 7);\r\n\t\t\t};\r\n\t\telse {\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\tlet sheet = document.styleSheets[i];\r\n\t\t\t\t\tif(sheet.href == link.href) {\r\n\t\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\t\treturn callback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t\tlink.href = url;\r\n\t\tappendCssDom(link, mthis, inverse);\r\n\t};\r\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\r\n\t\tlet inverse = !(config.plugins.css && config.plugins.css.inverse === false); //默认逆向\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\t//\t\tconsole.log(\"cssId=\"+cssId+\",cssSrc=\"+this.invoker().getUrl(cssId, true)+\",absUrl=\"+this.invoker().absUrl());\r\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload, this, inverse);\r\n\t};\r\n\tcssAPI.getCacheKey = function(cssId) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\tlet invoker = this.invoker();\r\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\r\n\t};\r\n\tcssAPI.loadCss = function(cssPath, callback) {\r\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\r\n\t};\r\n\r\n\tcssAPI.loadCsses = function() {\r\n\t\tlet args = arguments;\r\n\t\tfor(let i = 0; i < args.length; i++) {\r\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\r\n\t\t}\r\n\t};\r\n\treturn cssAPI;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"text\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"text\")\r\n\t\t\t.ok(function(text) {\r\n\t\t\t\tonload(text);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式：window!varNameInWindow=>>modulePath\r\n */\r\n//window插件,用于添加模块到window对象中\r\nxsloader.define(\"window\", {\r\n\tisSingle: true,\r\n\tpluginMain: function(arg, onload, onerror, config, http) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\twindow[moduleName] = mod;\r\n\t\t\tonload(mod);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式:withdeps!modulePath=>>[deps]\r\n */\r\nxsloader.define(\"withdeps\", {\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet depsStr = arg.substring(index + 3);\r\n\t\tlet deps;\r\n\t\ttry {\r\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\r\n\t\t\tif(!xsloader.isArray(deps)) {\r\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\tonerror(\"deps error:\" + depsStr);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.invoker().withAbsUrl().require([\r\n\t\t\t[false].concat(deps), moduleName\r\n\t\t], function(_deps, mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\torderDep: true\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 加载json对象\r\n */\r\nxsloader.define(\"json\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"json\")\r\n\t\t\t.ok(function(json) {\r\n\t\t\t\tonload(json);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\r\n/**\r\n * option._beforeOpenHook\r\n * option._onOkResponseHook\r\n * option._onFailResponseHook\r\n * \r\n * @param {Object} option\r\n */\r\nfunction httpRequest(option) {\r\n\tif(!option) {\r\n\t\toption = {};\r\n\t}\r\n\r\n\tfunction prop(obj, varName, defaultVal) {\r\n\t\tif(obj[varName] === undefined) {\r\n\t\t\treturn defaultVal;\r\n\t\t} else {\r\n\t\t\treturn obj[varName];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction putProp(obj, varName, toObj) {\r\n\t\tif(obj[varName]) {\r\n\t\t\tfor(let x in obj[varName]) {\r\n\t\t\t\tlet value = obj[varName][x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttoObj[x] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlet _url = prop(option, \"url\", \"\"),\r\n\t\t_method = prop(option, \"method\", \"GET\"),\r\n\t\t_params = {},\r\n\t\t_headers = {\r\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\r\n\t\t},\r\n\t\t_async = prop(option, \"async\", true),\r\n\t\t_multiPart = prop(option, \"multiPart\", false),\r\n\t\t_handleType = prop(option, \"handleType\", \"json\");\r\n\tlet _timeout = option.timeout;\r\n\tputProp(option, \"params\", _params);\r\n\tputProp(option, \"headers\", _headers);\r\n\r\n\tlet okCallback = option.ok;\r\n\tlet failCallback = option.fail;\r\n\tlet uploadStartCallback = option.uploadStart;\r\n\tlet uploadProgressCallback = option.uploadProgress;\r\n\tlet uploadOkCallback = option.uploadOk;\r\n\tlet uploadErrorCallback = option.uploadError;\r\n\tlet uploadEndCallback = option.uploadEnd;\r\n\r\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\r\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\r\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\r\n\r\n\tfunction createXhr() {\r\n\t\tlet xhr, i, progId;\r\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\r\n\t\t\tfor(i = 0; i < 3; i += 1) {\r\n\t\t\t\tprogId = progIds[i];\r\n\t\t\t\ttry {\r\n\t\t\t\t\txhr = new ActiveXObject(progId);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(xhr) {\r\n\t\t\t\t\tprogIds = [progId];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction conn() {\r\n\t\t_conn(createXhr());\r\n\t}\r\n\r\n\tfunction _conn(xhr) {\r\n\t\tlet option = {\r\n\t\t\turl: _url,\r\n\t\t\tmethod: _method.toUpperCase(),\r\n\t\t\tparams: _params,\r\n\t\t\theaders: _headers,\r\n\t\t\thandleType: _handleType,\r\n\t\t\tasync: _async,\r\n\t\t\tmultiPart: _multiPart,\r\n\t\t\ttimeout: _timeout\r\n\t\t};\r\n\t\t_beforeOpenHook(option, function() {\r\n\t\t\t_connAfterOpenHook(option, xhr);\r\n\t\t}, xhr);\r\n\t}\r\n\r\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\r\n\t\t_onFailResponseHook(option, function(result) {\r\n\t\t\tif(result !== false && result !== undefined) {\r\n\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else if(typeof failCallback == \"function\") {\r\n\t\t\t\tfailCallback(err);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}, xhr, extraErr);\r\n\t}\r\n\r\n\tfunction _connAfterOpenHook(option, xhr) {\r\n\t\tlet body;\r\n\t\tif(option.multiPart) {\r\n\t\t\tlet formData = new FormData();\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(xsloader.isArray(value)) {\r\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformData.append(x, value);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tbody = formData;\r\n\t\t} else {\r\n\t\t\tbody = \"\";\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof value == \"object\") {\r\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\r\n\t\t\t\t}\r\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\r\n\t\t\t}\r\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\r\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\r\n\t\t\t\t\toption.url += \"?\";\r\n\t\t\t\t}\r\n\t\t\t\toption.url += body;\r\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\r\n\t\t\t\tbody = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\txhr.open(option.method, option.url, option.async);\r\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\r\n\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\r\n\t\t}\r\n\t\tfor(let header in option.headers) {\r\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\r\n\t\t}\r\n\r\n\t\tif(typeof uploadStartCallback == \"function\") {\r\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadProgressCallback == \"function\") {\r\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadOkCallback == \"function\") {\r\n\t\t\txhr.upload.onload = uploadOkCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadErrorCallback == \"function\") {\r\n\t\t\txhr.upload.onerror = uploadErrorCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadEndCallback == \"function\") {\r\n\t\t\txhr.upload.onloadend = uploadEndCallback;\r\n\t\t}\r\n\r\n\t\tlet timeoutTimer;\r\n\t\tlet isTimeout = false;\r\n\t\tif(option.timeout) {\r\n\t\t\ttimeoutTimer = setTimeout(function() {\r\n\t\t\t\tisTimeout = true;\r\n\t\t\t\txhr.abort();\r\n\t\t\t\tclearTimeout(timeoutTimer);\r\n\t\t\t}, option.timeout);\r\n\t\t}\r\n\r\n\t\txhr.onreadystatechange = function(evt) {\r\n\t\t\tlet status, err;\r\n\t\t\tif(xhr.readyState === 4) {\r\n\t\t\t\tstatus = xhr.status || 0;\r\n\t\t\t\tif(status > 399 && status < 600 || !status) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet result;\r\n\t\t\t\t\tif(option.handleType === \"json\") {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\r\n\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(option.handleType === \"text\") {\r\n\t\t\t\t\t\tresult = xhr.responseText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\r\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xhr);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif(timeoutTimer && isTimeout) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send(body);\r\n\t}\r\n\r\n\tlet requestObj = {\r\n\t\tmultiPart(multiPart) {\r\n\t\t\t_multiPart = multiPart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadStart(uploadStart) {\r\n\t\t\tuploadStartCallback = uploadStart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadProgress(uploadProgress) {\r\n\t\t\tuploadProgressCallback = uploadProgress;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadOk(callback) {\r\n\t\t\tuploadOkCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadError(callback) {\r\n\t\t\tuploadErrorCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadEnd(uploadEnd) {\r\n\t\t\tuploadEndCallback = uploadEnd;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\turl(urlStr) {\r\n\t\t\t_url = urlStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tmethod(methodStr) {\r\n\t\t\t_method = methodStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttimeout(timeout) {\r\n\t\t\t_timeout = timeout;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tasync(isAsync) {\r\n\t\t\t_async = isAsync;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tparams(paramsObj) {\r\n\t\t\tif(paramsObj) {\r\n\t\t\t\tfor(let x in paramsObj) {\r\n\t\t\t\t\tlet value = paramsObj[x];\r\n\t\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_params[x] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\theaders(headersObj) {\r\n\t\t\tif(headersObj) {\r\n\t\t\t\tfor(let x in headersObj) {\r\n\t\t\t\t\t_headers[x] = headersObj[x];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\thandleType(_handleType) {\r\n\t\t\treturn this.handleAs(_handleType);\r\n\t\t},\r\n\t\thandleAs(handleType) {\r\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\r\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\r\n\t\t\t}\r\n\t\t\t_handleType = handleType;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tok(callback) {\r\n\t\t\tokCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfail(callback) {\r\n\t\t\tfailCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_beforeOpenHook(callback) {\r\n\t\t\t_beforeOpenHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onOkResponseHook(callback) {\r\n\t\t\t_onOkResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onFailResponseHook(callback) {\r\n\t\t\t_onFailResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tdone() {\r\n\t\t\ttry {\r\n\t\t\t\tconn();\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif(typeof failCallback == \"function\") {\r\n\t\t\t\t\tfailCallback(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn requestObj;\r\n}\r\n/**\r\n */\r\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\r\n\tcallback();\r\n};\r\n\r\n/**\r\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\r\n */\r\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\r\n\tcallback(result);\r\n};\r\n/**\r\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\r\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\r\n */\r\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\r\n\tcallback(undefined);\r\n};\r\n\r\nwindow._xshttp_request_ = httpRequest;\r\n\r\nxsloader.define(\"xshttp\", [], function() {\r\n\treturn httpRequest;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 返回Request返回一个Promise\r\n */\r\nxsloader.define(\"request\", [\"xshttp\"], function(http) {\r\n\t/**\r\n\t * 参数列表:\r\n\t * async:始终为true\r\n\t * ok与fail失效\r\n\t * 其他参数同xshttp\r\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\r\n\t * @param {Object} option\r\n\t */\r\n\tlet Request = function(option) {\r\n\t\toption = xsloader.extend({\r\n\t\t\tparams: undefined,\r\n\t\t\theaders: undefined,\r\n\t\t\tmethod: undefined,\r\n\t\t\turl: undefined,\r\n\t\t\tcallback: undefined\r\n\t\t}, option);\r\n\t\toption.async = true;\r\n\r\n\t\tlet promise = new Promise((resolve, reject) => {\r\n\t\t\toption.ok = function(rs) {\r\n\t\t\t\tresolve(rs);\r\n\t\t\t};\r\n\t\t\toption.fail = function(err) {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t\thttp(option).done();\r\n\t\t});\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\treturn Request;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\ntry {\r\n\tlet isXsMsgDebug = false;\r\n\tlet api = {};\r\n\r\n\tfunction isDebug(type) {\r\n\t\treturn isXsMsgDebug;\r\n\t}\r\n\r\n\tapi.linkedList = function() {\r\n\t\treturn new LinkedList();\r\n\t};\r\n\r\n\tfunction LinkedList() {\r\n\t\tfunction newNode(element) {\r\n\t\t\tlet node = {\r\n\t\t\t\telement: element,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tpre: null\r\n\t\t\t};\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\tlet length = 0;\r\n\t\tlet headNode = newNode(),\r\n\t\t\tlastNode = headNode;\r\n\r\n\t\t/**\r\n\t\t * 在链表末尾添加元素\r\n\t\t */\r\n\t\tthis.append = function(element) {\r\n\t\t\tlet current = newNode(element);\r\n\r\n\t\t\tlastNode.next = current;\r\n\t\t\tcurrent.pre = lastNode;\r\n\t\t\tlastNode = current;\r\n\t\t\tlength++;\r\n\t\t};\r\n\r\n\t\t//在链表的任意位置插入元素\r\n\t\tthis.insert = function(position, element) {\r\n\t\t\tif(position >= 0 && position <= length) {\r\n\r\n\t\t\t\tlet node = newNode(element);\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tpNode.next.pre = node;\r\n\t\t\t\t\tnode.next = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t\tpNode.next = node;\r\n\t\t\t\tnode.pre = pNode;\r\n\t\t\t\tlength++;\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.elementAt = function(position) {\r\n\t\t\treturn getElement(position);\r\n\t\t};\r\n\r\n\t\tfunction getElement(position, willRemove) {\r\n\t\t\tif(position >= 0 && position < length) {\r\n\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tlet currentNode = pNode.next;\r\n\t\t\t\t\tif(willRemove) {\r\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlength--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn currentNode.element;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @param callback function 返回true表示移除\r\n\t\t */\r\n\t\tthis.eachForRemove = function(callback) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tlet currentNode = pNode;\r\n\t\t\t\tif(callback(currentNode)) {\r\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlength--;\r\n\t\t\t\t\tpNode = nextCurrentNode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//从链表中移除元素\r\n\t\tthis.removeAt = function(position) {\r\n\t\t\treturn getElement(position, true);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 移除并获取第一个元素\r\n\t\t * @param callback function(elem,index)\r\n\t\t */\r\n\t\tthis.pop = function(callback) {\r\n\t\t\treturn this.removeAt(0);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 返回元素在链表中的位置\r\n\t\t * @param element object|function(elem)\r\n\t\t */\r\n\t\tthis.indexOf = function(element) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\tlet index = 0;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tif(typeof element == \"function\") {\r\n\t\t\t\t\tif(element(pNode.element)) {\r\n\t\t\t\t\t\treturn index;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(pNode.element === element) {\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t}\r\n\t\t\t\tindex++;\r\n\t\t\t\tpNode = pNode.next;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tthis.find = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\r\n\t\t};\r\n\r\n\t\t//移除某个元素\r\n\t\tthis.remove = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn this.removeAt(index);\r\n\t\t};\r\n\r\n\t\t//判断链表是否为空\r\n\r\n\t\tthis.isEmpty = function() {\r\n\t\t\treturn length === 0;\r\n\t\t};\r\n\r\n\t\t//返回链表的长度\r\n\t\tthis.size = function() {\r\n\t\t\treturn length;\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tif(window.addEventListener) {\r\n\t\tlet postMessageBridge = (function() {\r\n\t\t\tlet handle = {};\r\n\r\n\t\t\tlet instanceMap = {}; //id:listener\r\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\r\n\t\t\tlet instanceBindMap = {}; //instanceid:true\r\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\r\n\r\n\t\t\t//isActive为false表示监听者\r\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\r\n\r\n\t\t\t\tlet listener = {\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t_onConned: _onConned,\r\n\t\t\t\t\t_onMsg: _onMsg,\r\n\t\t\t\t\t_onResponse: _onResponse,\r\n\t\t\t\t\t_onElse: _onElse,\r\n\t\t\t\t\tconndata: conndata,\r\n\t\t\t\t\tosource: source,\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\tconnectingSource: connectingSource,\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\trefused: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\r\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\r\n\t\t\t\t}\r\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\r\n\r\n\t\t\t\tlet instanceid = listener.id;\r\n\t\t\t\tinstanceMap[instanceid] = listener;\r\n\t\t\t\treturn instanceid;\r\n\t\t\t};\r\n\r\n\t\t\thandle.remove = function(instanceid) {\r\n\t\t\t\t//TODO !!!!!!!\r\n\t\t\t\t/*let listener = listeners[id];\r\n\t\t\t\tdelete listeners[id];\r\n\t\t\t\tif(listener.active) {\r\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\r\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\r\n\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\r\n\t\t\t\t\t\t\tif(as[k] == id) {\r\n\t\t\t\t\t\t\t\tas.splice(k, 1);\r\n\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(found) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}*/\r\n\t\t\t};\r\n\r\n\t\t\thandle.send = function(data, instanceid, msgid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendConn = function(instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendResponse = function(data, instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\r\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\r\n\t\t\t\tlet listener = instanceMap[minstanceid];\r\n\t\t\t\tlistener._onElse(\"binded\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\r\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\r\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\r\n\t\t\t\t\tthrow new Error(\"source changed!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onConned(listener.osource, data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onMsg(data, msgid);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onResponse(data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\tid: instanceid,\r\n\t\t\t\t\tmsgid: msgid\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\r\n\t\t\t\t\tconsole.log(msg);\r\n\t\t\t\t}\r\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener('message', function(event) {\r\n\t\t\t\tif(event.data && (typeof event.data == \"string\") && event.data.substring(0, 1) == \"{\") {\r\n\t\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\r\n\t\t\t\t\t\tconsole.log(event.data);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet data;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(\"error data:\", event.data);\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!data || !(data.cmd && data.type)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet cmd = data.cmd;\r\n\t\t\t\t\t\tlet oinstanceid = data.id;\r\n\t\t\t\t\t\tlet rdata = data.data;\r\n\t\t\t\t\t\tlet type = data.type;\r\n\t\t\t\t\t\tlet msgid = data.msgid;\r\n\r\n\t\t\t\t\t\tif(type == \"conn\") {\r\n\t\t\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"accept\") {\r\n\t\t\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"conned\") {\r\n\t\t\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"msg\") {\r\n\t\t\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"response\") {\r\n\t\t\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"binded\") {\r\n\t\t\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\thandle.runAfter = function(time, callback) {\r\n\t\t\t\tsetTimeout(callback, time);\r\n\t\t\t};\r\n\r\n\t\t\treturn handle;\r\n\t\t})();\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} cmd\r\n\t\t * @param {Object} source\r\n\t\t * @param {Object} connectingSource\r\n\t\t * @param {Object} onfailed\r\n\t\t * @param {Object} isActive\r\n\t\t * @param {Object} conndata 连接传送的数据\r\n\t\t * @param {Object} timeout 连接超时时间，毫秒\r\n\t\t * @param {Object} sleep 连接检测的休眠时间，毫秒\r\n\t\t */\r\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata, timeout, sleep) {\r\n\t\t\tlet msgQueue = new LinkedList();\r\n\r\n\t\t\tlet SLEEP = sleep;\r\n\t\t\tlet starttime;\r\n\t\t\tlet isFailed = false;\r\n\t\t\tlet isConnected = false;\r\n\t\t\tlet isCanceled = false;\r\n\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet handleId;\r\n\r\n\t\t\tthis.onConnectedListener = null;\r\n\t\t\tthis.onReceiveListener = null;\r\n\t\t\tthis.send = function(data) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t};\r\n\t\t\t\tmsgQueue.append(msg);\r\n\t\t\t\tsendTop();\r\n\t\t\t};\r\n\r\n\t\t\tthis.send.release = function() {\r\n\t\t\t\tpostMessageBridge.remove(handleId);\r\n\t\t\t};\r\n\r\n\t\t\tfunction couldChat() {\r\n\t\t\t\treturn !isFailed && !isCanceled;\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onConned(_source, data) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\tthiz.onConnectedListener.call(thiz, data);\r\n\t\t\t\t\tisConnected = true;\r\n\t\t\t\t\tsendTop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onMsg(data, msgid) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\r\n\t\t\t\t\t\tid: msgid\r\n\t\t\t\t\t}, handleId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onResponse(data) {\r\n\t\t\t\tmsgQueue.remove(function(elem) {\r\n\t\t\t\t\treturn elem.id = data.id;\r\n\t\t\t\t});\r\n\t\t\t\tcouldChat() && sendTop();\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onElse(type) {\r\n\t\t\t\tif(type == \"binded\") {\r\n\t\t\t\t\tisCanceled = true;\r\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\tonfailed(\"canceled\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction initListen() {\r\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\r\n\t\t\t}\r\n\r\n\t\t\tfunction sendTop() {\r\n\t\t\t\tif(isConnected) {\r\n\t\t\t\t\tlet msg;\r\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\r\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isTimeout() {\r\n\t\t\t\tlet dt = new Date().getTime() - starttime;\r\n\t\t\t\treturn dt > timeout;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 主动方初始化\r\n\t\t\t */\r\n\t\t\tfunction initActively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.sendConn(handleId);\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, initActively);\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 被动方检查\r\n\t\t\t */\r\n\t\t\tfunction checkPassively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:wait connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, checkPassively);\r\n\t\t\t}\r\n\r\n\t\t\t{\r\n\t\t\t\tstarttime = new Date().getTime();\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t} else if(!isActive) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tcheckPassively();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setSource = function(_source) {\r\n\t\t\t\tsource = _source;\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet handleApi = api;\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} winObjOrCallback\r\n\t\t * @param {Object} option\r\n\t\t * @param {Object} notActive\r\n\t\t */\r\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\r\n\t\t\tconst gconfig = xsloader.config().plugins.xsmsg;\r\n\t\t\toption = xsloader.extendDeep({\r\n\t\t\t\tcmd: \"default-cmd\",\r\n\t\t\t\tlistener: null,\r\n\t\t\t\tconnected: null,\r\n\t\t\t\tconndata: null,\r\n\t\t\t\ttimeout: gconfig.timeout,\r\n\t\t\t\tsleep: gconfig.sleep,\r\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\r\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\t\t\tcallback(mine == origin, \"default\");\r\n\t\t\t\t},\r\n\t\t\t\tonfailed: function(errtype) {\r\n\t\t\t\t\tif(errtype.indexOf(\"timeout:\") == 0) {\r\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \" ,err='\" + errtype + \"' ,my page=\" + location.href);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, option);\r\n\r\n\t\t\tlet cmd = option.cmd;\r\n\t\t\tlet connectedCallback = option.connected;\r\n\t\t\tlet receiveCallback = option.listener;\r\n\t\t\tlet conndata = option.conndata;\r\n\t\t\tlet onfailed = option.onfailed;\r\n\t\t\tlet timeout = option.timeout;\r\n\t\t\tlet sleep = option.sleep;\r\n\r\n\t\t\tlet isActive = !notActive;\r\n\t\t\tlet connectingSource = option.connectingSource;\r\n\r\n\t\t\tlet unit;\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t} else {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\r\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\r\n\t\t\t};\r\n\t\t\tif(connectedCallback) {\r\n\t\t\t\tunit.onConnectedListener = function(conndata) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(receiveCallback) {\r\n\t\t\t\tunit.onReceiveListener = function(data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treceiveCallback(data, this.send);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\twinObjOrCallback(function(winObj) {\r\n\t\t\t\t\tunit.setSource(winObj);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn unit.send;\r\n\t\t}\r\n\r\n\t\tfunction _connectIFrame(iframe, option) {\r\n\t\t\tlet winObj;\r\n\t\t\tif(typeof iframe == \"string\") {\r\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\r\n\t\t\t\twinObj = function(callback) {\r\n\t\t\t\t\tiframe.onload = function() {\r\n\t\t\t\t\t\tcallback(this.contentWindow);\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\twinObj = iframe.contentWindow;\r\n\t\t\t}\r\n\t\t\treturn _connectWindow(winObj, option);\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 用于连接iframe.\r\n\t\t * @param {Object} iframe iframe或selector\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectIFrame = function(iframe, option) {\r\n\t\t\treturn _connectIFrame(iframe, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接父页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectParent = function(option) {\r\n\t\t\treturn _connectWindow(window.parent, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接顶层页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectTop = function(option) {\r\n\t\t\treturn _connectWindow(window.top, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接打开者.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectOpener = function(option) {\r\n\t\t\treturn _connectWindow(window.opener, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于监听其他页面发送消息.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回一个sender\r\n\t\t */\r\n\t\thandleApi.listenMessage = function(option) {\r\n\t\t\treturn _connectWindow(null, option, true);\r\n\t\t};\r\n\r\n\t\thandleApi.debug = function(isDebug) {\r\n\t\t\tisXsMsgDebug = isDebug;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * *******************\r\n\t\t * option参数\r\n\t\t *********************\r\n\t\t * option.cmd:\r\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\r\n\t\t * option.listener: function(data,sender)\r\n\t\t * option.connected:function(sender,conndata)\r\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\r\n\t\t * option.conndata:\r\n\t\t * option.timeout:连接超时时间\r\n\t\t * option.sleep:连接检测休眠时间\r\n\t\t **************\r\n\t\t * 回调的extra参数\r\n\t\t **************\r\n\t\t * originStr:对方页面的地址\r\n\t\t */\r\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\r\n\t}\r\n\r\n\txsloader.define(\"XsLinkedList\", function() {\r\n\t\treturn LinkedList;\r\n\t});\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 用于图片加载\r\n */\r\nxsloader.define(\"image\", {\r\n\tpluginMain(name, onload, onerror, config) {\r\n\t\tlet src = this.invoker().getUrl(name, false);\r\n\t\tlet img = new Image();\r\n\t\tlet callback = (ok) => {\r\n\t\t\tlet image = img;\r\n\t\t\timg = null;\r\n\t\t\timage.onload = null;\r\n\t\t\timage.οnerrοr = null;\r\n\t\t\tonload(ok ? image : null);\r\n\t\t};\r\n\t\timg.onload = function() {\r\n\t\t\tcallback(true);\r\n\t\t};\r\n\t\timg.οnerrοr = function() {\r\n\t\t\tcallback(false);\r\n\t\t};\r\n\t\timg.src = src;\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tif(img) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif(img) {\r\n\t\t\t\t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, config.plugins.image.timeout);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:default!module\r\n */\r\nxsloader.define(\"default\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tlet handle = this.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tif(xsloader.isObject(mod)) {\r\n\t\t\t\tmod = mod[\"default\"];\r\n\t\t\t\tif(mod === undefined) {\r\n\t\t\t\t\tmod = null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmod = null;\r\n\t\t\t}\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(err, invoker) {\r\n\t\t\tonerror(err);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"xsloader4j-server-bridge\", [], function() {\n\tconst base64 = new xsloader.Base64();\n\tlet isDebug = false;\n\n\t/**\n\t * 用于支持jsx代码\n\t * @param {Object} vm\n\t */\n\tfunction __renderJsx(vm) {\n\t\treturn function(component, props /*, ...children*/ ) {\n\t\t\tif(!vm || !vm.$createElement) {\n\t\t\t\tlet Vue = xsloader.require.get(\"vue\");\n\t\t\t\tvm = new Vue();\n\t\t\t}\n\t\t\tlet $createElement = vm.$createElement;\n\t\t\tif(!$createElement) {\n\t\t\t\tthrow new Error(\"not found function '$createElement'\");\n\t\t\t}\n\t\t\tlet children = [];\n\t\t\tfor(let i = 2; i < arguments.length; i++) {\n\t\t\t\tchildren.push(arguments[i]);\n\t\t\t}\n\t\t\treturn $createElement(component, props, children);\n\t\t};\n\t}\n\n\tconst mod = {\n\t\tgetDefine(thiz) {\n\t\t\treturn thiz.define;\n\t\t},\n\t\tgetRequire(thiz) {\n\t\t\treturn thiz.require;\n\t\t},\n\t\tgetInvoker(thiz) {\n\t\t\treturn thiz.invoker();\n\t\t},\n\t\trenderJsx(vm) {\n\t\t\treturn __renderJsx(vm);\n\t\t},\n\t\tgetVueCompiler(thiz) {\n\t\t\tlet rt = function(exports) {\n\t\t\t\tlet Vue = xsloader.require(\"vue\");\n\t\t\t\tlet _default = exports['default'] || exports;\n\t\t\t\tif(_default.template) {\n\n\t\t\t\t\t//处理src,href,url(...)\n\t\t\t\t\tlet dealUrl = function(reg, group, str, appendArgs, fun) {\n\t\t\t\t\t\tfun = fun || function(regResult, url) {\n\t\t\t\t\t\t\treturn url;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlet result = \"\";\n\t\t\t\t\t\twhile(true) {\n\t\t\t\t\t\t\tlet rs = reg.exec(str);\n\t\t\t\t\t\t\tif(!rs) {\n\t\t\t\t\t\t\t\tresult += str;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet rurl = rs[group].trim();\n\n\t\t\t\t\t\t\t\tresult += str.substring(0, rs.index);\n\t\t\t\t\t\t\t\tif(xsloader.startsWith(rurl, \"url(\")) {\n\t\t\t\t\t\t\t\t\tresult += rs[0];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresult += fun(rs, thiz.getUrl(rurl, appendArgs));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tstr = str.substring(rs.index + rs[0].length);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\t//排除掉':src'等属性\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)(src|href)\\s*=\\s*('|\")([^'\"\\(\\)]+)('|\")/, 4, _default.template, false, function(regResult, url) {\n\t\t\t\t\t\treturn regResult[2] + \"=\" + regResult[3] + url + regResult[5];\n\t\t\t\t\t});\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)url\\(([^\\(\\)]+)\\)/, 2, _default.template, true); //后处理url，src与href中可能包含url(...)\n\t\t\t\t\tlet res;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(isDebug) {\n\t\t\t\t\t\t\tconsole.log(\"compile vue template content,url=\", thiz.getUrl());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = Vue.compile(_default.template); //用template有bug，根元素有多个时出现死循环\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(\"url=\", thiz.getUrl());\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t\t_default.render = res.render;\n\t\t\t\t\t_default.staticRenderFns = res.staticRenderFns;\n\t\t\t\t}\n\t\t\t\tdelete _default.template;\n\t\t\t};\n\t\t\treturn rt;\n\t\t},\n\t\tgetVtemplate(thiz) {\n\t\t\tlet vtemplate = (component) => {\n\t\t\t\treturn(resolve, reject) => {\n\t\t\t\t\tlet invoker = thiz.invoker();\n\t\t\t\t\tthiz.require([component], (comp) => {\n\t\t\t\t\t\tresolve(comp);\n\t\t\t\t\t}).error((err) => {\n\t\t\t\t\t\treject(err.err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn vtemplate;\n\t\t},\n\t\tgetImporter(thiz) {\n\t\t\tlet vtemplate = this.getVtemplate(thiz);\n\t\t\treturn function(name) {\n\t\t\t\treturn new Promise(vtemplate(name));\n\t\t\t};\n\t\t},\n\t\tgetStyleBuilder(thiz) {\n\t\t\treturn function(cssContent) {\n\t\t\t\tif(cssContent) {\n\t\t\t\t\tlet id = xsloader.randId();\n\t\t\t\t\tlet count = 0;\n\t\t\t\t\tlet styleDom = document.createElement(\"style\");\n\t\t\t\t\tstyleDom.setAttribute(\"id\", id);\n\t\t\t\t\tstyleDom.setAttribute(\"type\", \"text/css\");\n\t\t\t\t\tstyleDom.innerHTML = cssContent;\n\n\t\t\t\t\tlet obj = {\n\t\t\t\t\t\tinit() {\n\t\t\t\t\t\t\tif(count <= 0) {\n\t\t\t\t\t\t\t\txsloader.appendHeadDom(styleDom);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tdestroy() {\n\t\t\t\t\t\t\t\t\tif(--count <= 0) {\n\t\t\t\t\t\t\t\t\t\tlet element = document.getElementById(id);\n\t\t\t\t\t\t\t\t\t\tif(element) {\n\t\t\t\t\t\t\t\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t};\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tdecodeBase64(base64Content) {\n\t\t\tif(base64Content) {\n\t\t\t\treturn base64.decode(base64Content);\n\t\t\t}\n\t\t}\n\n\t};\n\n\treturn mod;\n});","// 静态资源服务\r\nimport utils from \"./util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst http = global._xshttp_request_;\r\nconst DATA_CONF = \"data-conf\",\r\n\tDATA_CONFX = \"data-xsloader-conf\";\r\nconst DATA_CONF2 = \"data-conf2\",\r\n\tDATA_CONF2X = \"data-xsloader-conf2\";\r\nconst DATA_MAIN = \"data-main\",\r\n\tDATA_MAINX = \"data-xsloader-main\";\r\nconst DATA_CONF_TYPE = \"data-conf-type\";\r\n\r\nlet serviceConfigUrl;\r\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\r\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\r\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\r\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\r\n\tdataConfType = \"auto\";\r\n}\r\n\r\nlet initFun = () => {\r\n\tfunction getMainPath(config) {\r\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\r\n\t\tlet path = location.pathname;\r\n\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tlet name = path.substring(index + 1);\r\n\t\tif(name === \"\") {\r\n\t\t\tname = \"index\";\r\n\t\t}\r\n\t\tif(xsloader.endsWith(name, \".html\")) {\r\n\t\t\tname = name.substring(0, name.length - 5);\r\n\t\t}\r\n\t\tif(!mainPath) {\r\n\t\t\tmainPath = \"./main/{name}.js\";\r\n\t\t}\r\n\t\tmainPath = mainPath.replace(\"{name}\", name);\r\n\t\treturn mainPath;\r\n\t}\r\n\r\n\tfunction extendConfig(config) {\r\n\t\tconfig = xsloader.extendDeep({\r\n\t\t\tproperties: {},\r\n\t\t\tmain: {\r\n\t\t\t\tgetPath() {\r\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\r\n\t\t\t\t},\r\n\t\t\t\tname: \"main\",\r\n\t\t\t\tlocalConfigVar: \"lconfig\",\r\n\t\t\t\tglobalConfigVar: \"gconfig\",\r\n\t\t\t\tbefore(name) {\r\n\t\t\t\t\tconsole.log(\"before:\" + name);\r\n\t\t\t\t},\r\n\t\t\t\tafter(name) {\r\n\t\t\t\t\tconsole.log(\"after:\" + name);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tservice: {\r\n\t\t\t\thasGlobal: false,\r\n\t\t\t\tresUrls: []\r\n\t\t\t},\r\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\r\n\t\t\t\treturn \"default\";\r\n\t\t\t},\r\n\t\t\tloader: {\r\n\t\t\t\t\"default\": {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config);\r\n\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\r\n\t\thttp({\r\n\t\t\turl: url,\r\n\t\t\tmethod: \"get\",\r\n\t\t\ttimeout: 20000,\r\n\t\t\thandleType: \"text\",\r\n\t\t\tok(confText) {\r\n\r\n\t\t\t\tlet conf;\r\n\t\t\t\tif(dataConfType == \"js\") {\r\n\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t} else if(dataConfType == \"json\") {\r\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\r\n\t\t\t\t\t\t//同域则默认用脚本解析\r\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconf = extendConfig(conf);\r\n\t\t\t\tif(conf.beforeDealProperties) {\r\n\t\t\t\t\tconf.beforeDealProperties();\r\n\t\t\t\t}\r\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\r\n\r\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\r\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\r\n\t\t\t\t\t\tfunction(globalConfig) {\r\n\t\t\t\t\t\t\tlet localConfig = conf;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\r\n\r\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\r\n\r\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\r\n\t\t\t\t\t\t\tlet conf;\r\n\t\t\t\t\t\t\tlet loader;\r\n\t\t\t\t\t\t\tif(loaderName != null) {\r\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\r\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = globalConfig;\r\n\t\t\t\t\t\t\t\tif(loader){\r\n\t\t\t\t\t\t\t\t\tglobalConfig.current=loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\r\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = localConfig;\r\n\t\t\t\t\t\t\t\tif(loader){\r\n\t\t\t\t\t\t\t\t\tlocalConfig.current=loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(conf);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\r\n\t\t\t}\r\n\t\t}).done();\r\n\t}\r\n\r\n\tfunction startLoad() {\r\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\r\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\r\n\r\n\t\t\tlet mainName = localConfig.main.name;\r\n\r\n\t\t\tlet href = location.href;\r\n\t\t\tlet index = href.lastIndexOf(\"?\");\r\n\t\t\tif(index >= 0) {\r\n\t\t\t\thref = href.substring(0, index);\r\n\t\t\t}\r\n\r\n\t\t\tlet mainPath = getMainPath(localConfig);\r\n\r\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\r\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\r\n\t\t\tlet loader = localConfig.loader[loaderName];\r\n\t\t\tif(!loader) {\r\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlocalConfig.current=loaderName;\r\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\r\n\t\tlet resUrls = [];\r\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\r\n\r\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\r\n\r\n\t\txsloader.resUrlBuilder = function(groupModule) {\r\n\t\t\tlet as = [];\r\n\t\t\tutils.each(resUrls, function(url) {\r\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\r\n\t\t\t});\r\n\t\t\treturn as;\r\n\t\t};\r\n\t\tloader.ignoreProperties = true;\r\n\t\tloader.defineFunction = loader.defineFunction || {};\r\n\t\tloader.depsPaths = loader.depsPaths || {};\r\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\r\n\t\t\tlet theConfig = xsloader(loader);\r\n\r\n\t\t\tmainName = \"_plugin_main_\";\r\n\t\t\tlet deps = [];\r\n\t\t\tif(theConfig.deps) { //手动添加*依赖\r\n\t\t\t\tif(theConfig.deps[\"*\"]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\r\n\t\t\t\t}\r\n\t\t\t\tif(theConfig.deps[mainName]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdeps.push(mainPath);\r\n\t\t\txsloader.define(mainName, deps, function() {\r\n\r\n\t\t\t}).then({\r\n\t\t\t\tabsUrl: pageHref\r\n\t\t\t});\r\n\t\t} else if(!xsloader.hasDefine(mainName)) {\r\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\r\n\t\t\txsloader(loader);\r\n\t\t} else {\r\n\t\t\txsloader(loader);\r\n\t\t}\r\n\r\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\r\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\r\n\t\t\t\tconf.main.before.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\r\n\r\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\r\n\t\t\t\tconf.main.after.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\treturn rt;\r\n\t\t};\r\n\r\n\t\txsloader.require([mainName], function(main) {}).error((err, invoker) => {\r\n\t\t\tif(invoker) {\r\n\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\r\n\t\t\t}\r\n\t\t\tconsole.error(\"invoke main err:\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\txsloader.asyncCall(startLoad, true);\r\n};\r\n\r\nif(dataConf) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\r\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\r\n} else {\r\n\tinitFun = null;\r\n}\r\ninitFun && initFun();","import \"./core/index.js\";\r\nimport \"./define.js\";\r\nimport \"./core/plugins/index.js\";\r\nimport \"./service.js\"; //放在最后\r\nimport utils from \"./util/index.js\";\r\nutils.loaderEnd();"],"names":["g","window","undefined","self","global","Error","InVar","val","get","set","newVal","old","loaderFun","xsloader","apply","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","indexOf","pluginIndex","substring","index","theConfig","config","jsExts","i","length","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","rs","exec","finalPath","absolute","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","str","push","result","join","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","string","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","call","replaceModulePrefix","deps","m","pluginParam","query","is","test","startsWith","modulePrefixCount","modulePrefix","replaceStr","replace","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","thePageUrl","COMMENT_REGEXP","REPLACE_REQUIRE_GET_REGEXP","REPLACE_REQUIRE_REGEXP","GraphPath","pathEdges","vertexMap","depMap","addEdge","begin","end","hasDep","name","tryAddEdge","paths","hasLoop","visited","recursionStack","checkLoop","v","edges","edge","strValue2Arr","each","ary","func","isSync","fromEnd","handle","__commentReplace","match","singlePrefix","__appendInnerDeps","callbackString","reg","depIndex","indexInArray","appendInnerDeps","callback","innerDepType","props","toString","idCount","getAndIncIdCount","PluginError","err","invoker","extra","unwrapError","n","isXsLoaderEnd","IE_VERSION","getIEVersion","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","graphPath","loaderEnd","isLoaderEnd","whichTransitionEvent","t","el","createElement","transitions","style","transitionEvent","ToProgress","opt","progress","options","id","color","bgColor","height","duration","key","opacityDuration","progressBar","container","setCSS","appendChild","body","prototype","setColor","backgroundColor","_isAuto","_timer","stopAuto","clearInterval","autoIncrement","time","dt","k","step","setInterval","setProgress","toError","errColor","transit","width","getProgress","show","increase","toBeIncreasedProgress","decrease","toBeDecreasedProgress","finish","setTimeout","hide","parentNode","removeChild","reset","opacity","display","Base64","_keyStr","encode","input","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","_utf8_encode","charCodeAt","isNaN","charAt","decode","String","fromCharCode","_utf8_decode","utftext","c","c2","c3","urls","base","loading","base64","utils","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArrayFrom","JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","f","this_value","valueOf","Date","toJSON","isFinite","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","gap","indent","meta","rep","quote","lastIndex","a","slice","holder","mind","partial","value","Object","hasOwnProperty","stringify","replacer","space","parse","text","reviver","j","walk","eval","SyntaxError","proxyPolyfill","lastRevokeFn","ProxyPolyfill","o","target","handler","TypeError","throwRevoked","trap","unsafeHandler","proxy","isMethod","usingNew","constructor","args","unshift","getter","prop","setter","status","propertyNames","getOwnPropertyNames","Promise","__proto__","forEach","propertyMap","real","getOwnPropertyDescriptor","desc","enumerable","defineProperty","prototypeOk","setPrototypeOf","getPrototypeOf","seal","revocable","p","polyfillInit","ProxyUtil","Proxy","trim","randId","suffix","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","fn","jsonObj","xsJSON","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","search","ret","seg","s","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","isEmpty","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","baseUrl","dealUrl","getUrl2","tryCall","defaultReturn","exCallback","dealProperties","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","initCtrlCallback","callbackObj","mineCount","ctrlCallback","asyncCallQueue","shift","lastReturn","nextCallback","nextObj","pushTask","next","resolve","then","queue","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","clone","isDeep","source","flags","copy","setTime","attr","sortObject","keys","newObj","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","ready","addEventListener","removeEventListener","attachEvent","readyState","detachEvent","fun2","documentElement","doScroll","frameElement","readyCall","onReady","br","addEventHandle","type","env","version","toGlobal","deprecated","justLoader","funs","browser","ignoreAspect_","theDefinedMap","lastDefinObjectMap","ModuleDef","isPreDependOn","modules","defaultModule","targetDef","_preModule","preDependModule","relyQueue","relyIt","module","_preIndex","_isSrc","nameOrUrl","isSrc","setLastDefineObject","defineObject","getLastDefineObject","appendLoadingModuleDeps","moduleDef","mod","state","_deps","pushName","selfname","getModule","ifoneThenGet","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","exports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","initInstance","justForSingle","dealInstance","hasFinished","onload","__default","onerror","last","concat","pluginMain","waitSeconds","moduleMap","absUrl","getName","Invoker","_newModule","DefineObject","appendConfigDepsAndEmbedDeps","newModule","instances","parent","parentDefine","relys","absUrlFromModule","absUrlFromDefineObject","getCallback","_dealApplyArgs","_loadCallback","reinitByDefineObject","setInstanceType","_singlePluginResult","currentDefineModuleQueue","setState","isDefault","errinfo","_callback","_state","theCallback","depModule","getDeps","require","defined_module_for_deps","refmodule","toOtherModule","otherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","genErrs","infos","leaf","reverse","as","errModule","depMod","indexPlguin","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","hasCallErr","theExports","depCount","depModules","invoker_of_module","checkFinish","dep_name","syncHandle","originDep","relyItFun","i1","i2","i3","groupModule","defaultVersion","_url","resUrlBuilder","isInUrls","getUrls","rurl","loadModule","module2","loadScript","scriptData","defaultMod","lastModule","m2Name","configDeps","d","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","ua","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","theHead","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","Handle","onError","ThisInvoker","_buildInvoker","getId","h","define","defineAsync","withAbsUrl","absUrlStr","_im","_id","getMineInvoker","getInvoker","nullNew","parentModule","isRequire","before","depBefore","depDeps","absoluteUrl","instance","_directDepLength","directDepLength","names","odeps","hasOrderDep","applyArgs","jsFilePath","moduleLoop","getCurrentScript","isRemoveQueryHash","_getCurrentScriptOrSrc","b","sourceURL","stacktrace","__createNode","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","useAttach","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","isFirstRequire","prerequire","mineInvoker","originDeps","argArr","theMod","timeid","isOk","customerErrCallback","isErr","plugins","enable","delay","clearTimer","clearTimeout","waitTime","logError","logFun","checkResultFun","ifmodule","promise","inject","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","_newContext","context","contextName","defQueue","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","splice","addVersion","urlArg","forPrefixSuffix","encodeURIComponent","dealUrlArgs","image","timeout","xsmsg","sleep","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","newInvoker","arg","info","vars","moduleNames","existsMods","newName","lastM","lastDom","Node","children","doms","anchorDom","_maxindex","_minindex","engine","useImportLoad","useOnload","cssAPI","cssIndex","rootNodes","domIndex","previousSibling","buildAndGetNode","mthiz","pnode","getChild","addChild","appendCssDom","cssThis","inverse","mthis","getIndex","findAnchor","curStyle","curSheet","createStyle","styleSheet","sheet","ieCnt","ieLoads","ieCurCallback","createIeLoad","addImport","processIeLoad","nextLoad","importLoad","textContent","loadInterval","cssRules","linkLoad","link","rel","styleSheets","cssId","css","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","createXhr","xhr","progId","XMLHttpRequest","ActiveXObject","conn","_conn","toUpperCase","headers","handleType","multiPart","_connAfterOpenHook","_doOnFailResponseHook","extraErr","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","timeoutTimer","isTimeout","abort","onreadystatechange","responseText","send","requestObj","urlStr","methodStr","isAsync","paramsObj","headersObj","extraErrorType","_xshttp_request_","Request","reject","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","current","insert","position","pNode","elementAt","getElement","willRemove","currentNode","nextCurrentNode","eachForRemove","removeAt","find","remove","size","api","linkedList","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","msgQueue","SLEEP","starttime","isFailed","isConnected","isCanceled","handleId","onConnectedListener","onReceiveListener","data","msg","sendTop","release","postMessageBridge","couldChat","_onConned","_source","_onMsg","msgid","sendResponse","_onResponse","_onElse","initListen","listen","initActively","sendConn","runAfter","checkPassively","setSource","_connectWindow","winObjOrCallback","notActive","gconfig","listener","connected","origin","mine","errtype","connectedCallback","receiveCallback","unit","sender","winObj","_connectIFrame","iframe","contentWindow","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","osource","active","refused","instanceid","_sendData","handleConn","fromSource","originStr","oinstanceid","listeners","Callback","isAccept","handleAccept","minstanceid","handleBinded","checkSource","handleConned","handleMsg","handleResponse","postMessage","event","rdata","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","img","Image","οnerrοr","__renderJsx","vm","component","$createElement","Vue","getDefine","getRequire","renderJsx","getVueCompiler","_default","template","group","regResult","res","compile","render","staticRenderFns","getVtemplate","vtemplate","comp","getImporter","getStyleBuilder","cssContent","styleDom","innerHTML","init","destroy","getElementById","decodeBase64","base64Content","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","extendConfig","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","loadServiceConfig","tag","isLocal","confText","conf","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","startLoad","pageHref","resUrl","originThis","originArgs"],"mappings":"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"}