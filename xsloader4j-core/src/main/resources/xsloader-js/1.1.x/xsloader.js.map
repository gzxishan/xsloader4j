{"version":3,"file":"xsloader.js","sources":["../xsloader-src/util/global.js","../xsloader-src/core/loader.js","../xsloader-src/util/urls.js","../xsloader-src/util/base.js","../xsloader-src/util/loading.js","../xsloader-src/util/base64.js","../xsloader-src/util/index.js","../xsloader-src/public/global-deprecated.js","../xsloader-src/polyfill/json.js","../xsloader-src/polyfill/proxy.js","../xsloader-src/polyfill/index.js","../xsloader-src/public/global-base.js","../xsloader-src/public/is.js","../xsloader-src/public/funs.js","../xsloader-src/public/browser.js","../xsloader-src/public/index.js","../xsloader-src/core/module-def.js","../xsloader-src/core/module.js","../xsloader-src/core/script.js","../xsloader-src/core/index.js","../xsloader-src/define.js","../xsloader-src/core/lib/xshttp.js","../xsloader-src/core/lib/request.js","../xsloader-src/core/lib/xsmsg.js","../xsloader-src/core/lib/xsloader4j-server-bridge.js","../xsloader-src/core/lib/ifmsg.js","../xsloader-src/core/plugins/inner-dep.js","../xsloader-src/core/plugins/ready.js","../xsloader-src/core/plugins/try.js","../xsloader-src/core/plugins/nodeps.js","../xsloader-src/core/plugins/exists.js","../xsloader-src/core/plugins/name.js","../xsloader-src/core/plugins/css.js","../xsloader-src/core/plugins/text.js","../xsloader-src/core/plugins/window.js","../xsloader-src/core/plugins/withdeps.js","../xsloader-src/core/plugins/json.js","../xsloader-src/core/plugins/image.js","../xsloader-src/core/plugins/default.js","../xsloader-src/service.js","../xsloader-src/main.js"],"sourcesContent":["let G;\r\nif(typeof window !== undefined) {\r\n\tG = window;\r\n} else if(typeof self !== undefined) {\r\n\tG = self;\r\n} else if(typeof global !== undefined) {\r\n\tG = global;\r\n} else {\r\n\tthrow new Error(\"not found global var!\");\r\n}\r\n\r\nexport default G;","import global from '../util/global.js';\r\nlet loaderFun;\r\nlet xsloader = global.xsloader = function() {\r\n\treturn loaderFun.apply(this, arguments);\r\n};\r\n\r\nexport default {\r\n\tloaderFun: (fun) => {\r\n\t\tloaderFun = fun;\r\n\t}\r\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\r\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\r\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\", \".*\", \".htmv_vue\"];\r\n\r\nimport global from './global.js';\r\nconst L = global.xsloader;\r\n\r\nfunction isJsFile(path) {\r\n\tif (!L.isString(path) || path.indexOf(\".\") == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif (pluginIndex > 0) {\r\n\t\tpath = path.substring(0, pluginIndex);\r\n\t}\r\n\tlet index = path.indexOf(\"?\");\r\n\tif (index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tindex = path.indexOf(\"#\");\r\n\tif (index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tlet theConfig = L.config();\r\n\r\n\tlet jsExts = theConfig && theConfig.jsExts || defaultJsExts;\r\n\tfor (let i = 0; i < jsExts.length; i++) {\r\n\t\tif (L.endsWith(path, jsExts[i])) {\r\n\t\t\treturn {\r\n\t\t\t\text: jsExts[i],\r\n\t\t\t\tpath: path\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction dealPathMayAbsolute(path, currentUrl) {\r\n\tcurrentUrl = currentUrl || path;\r\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\r\n\r\n\tlet finalPath;\r\n\tlet absolute;\r\n\tif (rs) {\r\n\t\tlet protocol = rs[1];\r\n\t\tabsolute = true;\r\n\r\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\r\n\t\tlet _protocol = rs && rs[1] || location.protocol;\r\n\t\tlet _host = rs && rs[2] || location.host;\r\n\r\n\t\tif (protocol == \"//\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + path;\r\n\t\t} else if (protocol == \"/\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\r\n\t\t} else {\r\n\t\t\tfinalPath = path;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tabsolute = false;\r\n\t\tfinalPath = path;\r\n\t}\r\n\treturn {\r\n\t\tabsolute: absolute,\r\n\t\tpath: finalPath\r\n\t};\r\n}\r\n\r\nfunction getPathWithRelative(path, relative, isPathDir) {\r\n\r\n\tlet relativeQuery = \"\";\r\n\tlet qIndex = path.lastIndexOf(\"?\");\r\n\tif (qIndex >= 0) {\r\n\t\tpath = path.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = path.lastIndexOf(\"#\");\r\n\t\tif (qIndex >= 0) {\r\n\t\t\tpath = path.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tqIndex = relative.lastIndexOf(\"?\");\r\n\tif (qIndex >= 0) {\r\n\t\trelativeQuery = relative.substring(qIndex);\r\n\t\trelative = relative.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = relative.lastIndexOf(\"#\");\r\n\t\tif (qIndex >= 0) {\r\n\t\t\trelativeQuery = relative.substring(qIndex);\r\n\t\t\trelative = relative.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tlet absolute = dealPathMayAbsolute(relative, path);\r\n\tif (absolute.absolute) {\r\n\t\treturn absolute.path + relativeQuery;\r\n\t}\r\n\r\n\tif (isPathDir === undefined) {\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tif (index == path.length - 1) {\r\n\t\t\tisPathDir = true;\r\n\t\t} else {\r\n\t\t\tif (index == -1) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\r\n\t\t}\r\n\t}\r\n\r\n\tif (L.endsWith(path, \"/\")) {\r\n\t\tpath = path.substring(0, path.length - 1);\r\n\t}\r\n\r\n\tlet isRelativeDir = false;\r\n\tif (relative == \".\" || L.endsWith(relative, \"/\")) {\r\n\t\trelative = relative.substring(0, relative.length - 1);\r\n\t\tisRelativeDir = true;\r\n\t} else if (relative == \".\" || relative == \"..\" || L.endsWith(\"/.\") || L.endsWith(\"/..\")) {\r\n\t\tisRelativeDir = true;\r\n\t}\r\n\r\n\tlet prefix = \"\";\r\n\tlet index = -1;\r\n\tlet absolute2 = dealPathMayAbsolute(path);\r\n\tif (absolute2.absolute) {\r\n\t\tpath = absolute2.path;\r\n\t\tlet index2 = path.indexOf(\"//\");\r\n\t\tindex = path.indexOf(\"/\", index2 + 2);\r\n\t\tif (index == -1) {\r\n\t\t\tindex = path.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprefix = path.substring(0, index + 1);\r\n\tpath = path.substring(index + 1);\r\n\r\n\tlet stack = path.split(\"/\");\r\n\tif (!isPathDir && stack.length > 0) {\r\n\t\tstack.pop();\r\n\t}\r\n\tlet relatives = relative.split(\"/\");\r\n\tfor (let i = 0; i < relatives.length; i++) {\r\n\t\tlet str = relatives[i];\r\n\t\tif (\"..\" == str) {\r\n\t\t\tif (stack.length == 0) {\r\n\r\n\t\t\t\tthrow new Error(\"no more upper path:path=\" + arguments[0] + \",relative=\" + arguments[1]);\r\n\t\t\t}\r\n\t\t\tstack.pop();\r\n\t\t} else if (\".\" != str) {\r\n\t\t\tstack.push(str);\r\n\t\t}\r\n\t}\r\n\t//\tif(stack.length == 0) {\r\n\t//\t\treturn \"\";\r\n\t//\t}\r\n\tlet result = prefix + stack.join(\"/\");\r\n\tif (isRelativeDir && !L.endsWith(result, \"/\")) {\r\n\t\tresult += \"/\";\r\n\t}\r\n\tresult = L.appendArgs2Url(result, relativeQuery);\r\n\treturn result;\r\n}\r\n\r\nfunction getNodeAbsolutePath(node) {\r\n\tlet src = node.src || node.getAttribute(\"src\");\r\n\treturn getPathWithRelative(location.href, src);\r\n}\r\n\r\n//去掉url的query参数和#参数\r\nfunction removeQueryHash(url) {\r\n\tif (url) {\r\n\t\tlet index = url.indexOf(\"?\");\r\n\t\tif (index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\r\n\t\tindex = url.indexOf(\"#\");\r\n\t\tif (index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\r\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\r\n\r\nfunction propertiesDeal(configObject, properties) {\r\n\tif (!properties) {\r\n\t\treturn configObject;\r\n\t}\r\n\r\n\tfunction replaceStringProperties(string, properties, property) {\r\n\t\tlet rs;\r\n\t\tlet str = string;\r\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\r\n\t\tif (rs) {\r\n\t\t\tlet propKey = rs[1];\r\n\t\t\tlet propValue = L.getObjectAttr(properties, propKey);\r\n\t\t\tif (propValue === undefined) {\r\n\t\t\t\treturn str;\r\n\t\t\t} else {\r\n\t\t\t\treturn propValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet result = \"\";\r\n\t\twhile (true) {\r\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\r\n\t\t\tif (!rs) {\r\n\t\t\t\tresult += str;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tlet propKey = rs[1];\r\n\t\t\t\tif (property !== undefined && property.propertyKey == propKey) {\r\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\r\n\t\t\t\t} else if (property) {\r\n\t\t\t\t\tproperty.has = true;\r\n\t\t\t\t}\r\n\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\tresult += L.getObjectAttr(properties, propKey);\r\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//处理属性引用\r\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\r\n\t\tif (!obj) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\tif (L.isFunction(obj)) {\r\n\t\t\treturn obj;\r\n\t\t} else if (L.isArray(obj)) {\r\n\t\t\tfor (let i = 0; i < obj.length; i++) {\r\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\r\n\t\t\t}\r\n\t\t} else if (L.isString(obj)) {\r\n\t\t\tobj = replaceStringProperties(obj, properties, property);\r\n\t\t} else if (L.isObject(obj)) {\r\n\t\t\tif (property) {\r\n\t\t\t\tproperty.has = false;\r\n\t\t\t}\r\n\t\t\tlet replaceKeyMap = {};\r\n\t\t\tfor (let x in obj) {\r\n\t\t\t\tif (property) {\r\n\t\t\t\t\tproperty.propertyKey = x;\r\n\t\t\t\t}\r\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\r\n\t\t\t\tif (enableKeyAttr) {\r\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\r\n\t\t\t\t\tif (_x !== x) {\r\n\t\t\t\t\t\t//属性变化后，且不存在该属性，则修改属性\r\n\t\t\t\t\t\tif (_x in obj) {\r\n\t\t\t\t\t\t\tdelete obj[x];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treplaceKeyMap[x] = _x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let x in replaceKeyMap) {\r\n\t\t\t\tlet objx = obj[x];\r\n\t\t\t\tdelete obj[x];\r\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\r\n\t}\r\n\r\n\tif (!properties.__dealt__) {\r\n\t\tlet property = {\r\n\t\t\thas: false\r\n\t\t};\r\n\r\n\t\tfor (let x in properties) {\r\n\t\t\tlet fun = properties[x];\r\n\t\t\tif (L.isFunction(fun)) {\r\n\t\t\t\tproperties[x] = fun.call(properties);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo {\r\n\t\t\treplaceProperties(properties, property);\r\n\t\t} while (property.has);\r\n\t\tproperties.__dealt__ = true;\r\n\t}\r\n\r\n\treturn replaceProperties(configObject, undefined, true);\r\n}\r\n\r\nfunction replaceModulePrefix(config, deps) {\r\n\r\n\tif (!deps || deps.length == 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor (let i = 0; i < deps.length; i++) {\r\n\t\tlet m = deps[i];\r\n\t\tif (typeof m == \"string\") {\r\n\t\t\tlet index = m.indexOf(\"!\");\r\n\t\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tindex = m.indexOf(\"?\");\r\n\t\t\tlet query = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tlet is = isJsFile(m);\r\n\t\t\tif (config.autoExt && /\\/[^\\/\\.]+$/.test(m)) { //自动后缀，需要后台支持\r\n\t\t\t\tdeps[i] = m + config.autoExtSuffix + query + pluginParam;\r\n\t\t\t} else if (!is && !/\\.[^\\/\\s]*$/.test(m) && (L.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\r\n\t\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (config.modulePrefixCount) {\r\n\t\t//模块地址的前缀替换\r\n\t\tfor (let prefix in config.modulePrefix) {\r\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\r\n\t\t\tlet len = prefix.length;\r\n\t\t\tfor (let i = 0; i < deps.length; i++) {\r\n\t\t\t\tlet m = deps[i];\r\n\t\t\t\tif (typeof m == \"string\") {\r\n\t\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\r\n\t\t\t\t\tlet pluginName = null;\r\n\t\t\t\t\tif (pluginIndex >= 0) {\r\n\t\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\r\n\t\t\t\t\t\tm = m.substring(pluginIndex + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (L.startsWith(m, prefix)) {\r\n\t\t\t\t\t\tlet dep = replaceStr + m.substring(len);\r\n\t\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getScriptBySubname(subname) {\r\n\tlet ss = document.getElementsByTagName('script');\r\n\tif (subname) {\r\n\t\tfor (let i = 0; i < ss.length; i++) {\r\n\t\t\tlet script = ss[i];\r\n\t\t\tlet src = script.src;\r\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\r\n\t\t\tif (src.indexOf(subname) >= 0) {\r\n\t\t\t\treturn script;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn ss;\r\n\t}\r\n}\r\n\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = removeQueryHash(url);\r\n\treturn url;\r\n})();\r\n\r\nexport default {\r\n\tgetPathWithRelative,\r\n\tgetNodeAbsolutePath,\r\n\tdealPathMayAbsolute,\r\n\tremoveQueryHash,\r\n\tpropertiesDeal,\r\n\treplaceModulePrefix,\r\n\tisJsFile,\r\n\tgetScriptBySubname,\r\n\tthePageUrl,\r\n};\r\n","import G from './global.js';\r\nconst L = G.xsloader;\r\nconst COMMENT_REGEXP = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst REPLACE_REQUIRE_GET_REGEXP = /(^|[\\s\\(\\),;.\\?:]+)require\\s*\\.\\s*get\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\nconst REPLACE_REQUIRE_REGEXP = /(^|[\\s\\(\\),;.\\?:]+)require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\nconst NOT_REQUIRE_REGEXP = /\\.\\s*$/;\r\n\r\n/**\r\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\r\n * @param {Object} val\r\n */\r\nfunction InVar(val) {\r\n\tthis.get = function() {\r\n\t\treturn val;\r\n\t};\r\n\r\n\tthis.set = function(newVal) {\r\n\t\tlet old = val;\r\n\t\tval = newVal;\r\n\t\treturn old;\r\n\t};\r\n}\r\nL.InVar = G.InVar = InVar;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif (!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif (!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif (!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif (paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor (let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor (let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif (checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif (!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif (pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor (let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif (!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if (recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif (!obj || L.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor (let x in obj) {\r\n\t\tif (L.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func(item,index,array)\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif (ary) {\r\n\t\tif (isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif (fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif (rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif (fromEnd) {\r\n\t\t\t\tfor (let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif (func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n\r\nfunction __appendInnerDeps(deps, callbackString, reg, depIndex, notIndex) {\r\n\tcallbackString.replace(reg, function() {\r\n\t\tlet dep = arguments[depIndex];\r\n\t\tif ((!notIndex || !NOT_REQUIRE_REGEXP.test(arguments[notIndex])) && L.indexInArray(deps, dep) == -1) {\r\n\t\t\tdeps.push(dep);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//添加内部直接require.get('...')或require('...')的模块\r\n//调用的地方：\r\n//1)script.js:prerequire\r\n//2)script.js:DefineObject.constructor\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif (L.isFunction(callback)) {\r\n\t\tlet theConfig = L.config();\r\n\t\tlet innerDepType = !theConfig ? \"disable\" : theConfig.props.innerDepType;\r\n\t\tif (innerDepType != \"disable\") {\r\n\r\n\t\t\tconst callbackString = callback\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(COMMENT_REGEXP, __commentReplace);\r\n\r\n\t\t\tif (innerDepType == \"auto\") {\r\n\t\t\t\tif (callbackString.indexOf(\"__webpack_require__\") >= 0) {\r\n\t\t\t\t\tinnerDepType = \"disable\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (innerDepType == \"auto\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2, 1);\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2, 1);\r\n\t\t\t} else if (innerDepType == \"require\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_REGEXP, 2, 1);\r\n\t\t\t} else if (innerDepType == \"require.get\") {\r\n\t\t\t\t__appendInnerDeps(deps, callbackString, REPLACE_REQUIRE_GET_REGEXP, 2, 1);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker, extra) {\r\n\t\tthis.err = err;\r\n\t\tthis.invoker = invoker;\r\n\t\tthis.extra = extra;\r\n\t}\r\n}\r\n\r\nfunction unwrapError(err) {\r\n\tif (err) {\r\n\t\tlet n = 0;\r\n\t\twhile (err instanceof PluginError && n++ < 100) {\r\n\t\t\terr = err.err;\r\n\t\t}\r\n\t}\r\n\treturn err;\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif (isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if (isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if (isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nfunction isEmptyObject(obj) {\r\n\tif (obj === null || obj === undefined) {\r\n\t\treturn true;\r\n\t} else if (!L.isObject(obj)) {\r\n\t\tthrow new Error(\"expected object:\" + obj);\r\n\t} else {\r\n\t\tfor (let k in obj) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tunwrapError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n\tisEmptyObject,\r\n};\r\n","//顶部加载条功能\r\n/*\r\n ** ToProgress v0.1.1\r\n ** http://github.com/djyde/ToProgress\r\n */\r\n\r\n// Animation Detection\r\nfunction whichTransitionEvent() {\r\n\tlet t,\r\n\t\tel = document.createElement(\"fakeelement\");\r\n\r\n\tlet transitions = {\r\n\t\t\"transition\": \"transitionend\",\r\n\t\t\"OTransition\": \"oTransitionEnd\",\r\n\t\t\"MozTransition\": \"transitionend\",\r\n\t\t\"WebkitTransition\": \"webkitTransitionEnd\"\r\n\t};\r\n\r\n\tfor(t in transitions) {\r\n\t\tif(el.style[t] !== undefined) {\r\n\t\t\treturn transitions[t];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet transitionEvent = whichTransitionEvent();\r\n\r\nconst ToProgress = function(opt) {\r\n\t// Attributes\r\n\tthis.progress = 0;\r\n\tthis.options = {\r\n\t\tid: 'xsloader-top-progress-bar',\r\n\t\tcolor: '#F44336',\r\n\t\tbgColor:undefined,\r\n\t\theight: 2,\r\n\t\tduration: 0.2\r\n\t};\r\n\tif(opt && typeof opt === 'object') {\r\n\t\tfor(let key in opt) {\r\n\t\t\tthis.options[key] = opt[key];\r\n\t\t}\r\n\t}\r\n\tthis.options.opacityDuration = 0; //this.options.duration * 3;\r\n\tthis.progressBar = document.createElement('div');\r\n\tthis.container = document.createElement('div');\r\n\tthis.container.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\tthis.container.id = this.options.id;\r\n\r\n\tthis.progressBar.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\r\n\tthis.container.setCSS({\r\n\t\t\"position\": \"fixed\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"height\": (this.options.height + 1) + \"px\",\r\n\t\t\"width\": \"100%\",\r\n\t\t\"opacity\": \"1\",\r\n\t\t'z-index': '9999999999',\r\n\t\t'background-color': this.options.bgColor,\r\n\t});\r\n\r\n\tthis.progressBar.setCSS({\r\n\t\t\"position\": \"absolute\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"background-color\": this.options.color,\r\n\t\t\"height\": this.options.height + \"px\",\r\n\t\t\"width\": \"0%\",\r\n\t\t\"transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-moz-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-webkit-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\"\r\n\t});\r\n\tthis.container.appendChild(this.progressBar);\r\n\tdocument.body.appendChild(this.container);\r\n};\r\n\r\n////////////////////////////////////\r\nToProgress.prototype.setColor = function(color) {\r\n\tthis.progressBar.style.backgroundColor = color;\r\n};\r\n\r\nToProgress.prototype._isAuto = false;\r\nToProgress.prototype._timer = null;\r\n\r\nToProgress.prototype.stopAuto = function() {\r\n\tthis._isAuto = false;\r\n\tif(this._timer) {\r\n\t\tclearInterval(this._timer);\r\n\t\tthis._timer = null;\r\n\t}\r\n};\r\n\r\nToProgress.prototype.autoIncrement = function(time = 100) {\r\n\tthis.stopAuto();\r\n\tthis._isAuto = true;\r\n\tlet dt = time < 100 ? 100 : time;\r\n\r\n\tlet k = 100; //\r\n\tlet step = 0.05;\r\n\tlet x = 1 - step / 2;\r\n\tthis._timer = setInterval(() => {\r\n\t\tx += step;\r\n\t\tthis.setProgress(100 - k / x);\r\n\t}, dt);\r\n};\r\n\r\nToProgress.prototype.toError = function(errColor) {\r\n\tthis.setProgress(this.progress < 60 ? 60 : this.progress);\r\n\tthis.setColor(errColor);\r\n\tthis.stopAuto();\r\n};\r\n\r\n///////////////////////////////////\r\n\r\nToProgress.prototype.transit = function() {\r\n\tthis.progressBar.style.width = this.progress + '%';\r\n};\r\n\r\nToProgress.prototype.getProgress = function() {\r\n\treturn this.progress;\r\n};\r\n\r\nToProgress.prototype.setProgress = function(progress, callback) {\r\n\tthis.show();\r\n\tif(progress > 100) {\r\n\t\tthis.progress = 100;\r\n\t} else if(progress < 0) {\r\n\t\tthis.progress = 0;\r\n\t} else {\r\n\t\tthis.progress = progress;\r\n\t}\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.increase = function(toBeIncreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress + toBeIncreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.decrease = function(toBeDecreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress - toBeDecreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.finish = function(callback) {\r\n\tthis.setProgress(100, callback);\r\n\tsetTimeout(() => {\r\n\t\tthis.hide();\r\n//\t\tlet fun;\r\n//\t\tfun = (e) => {\r\n//\t\t\tthis.reset();\r\n//\t\t\tthis.progressBar.removeEventListener(e.type, fun);\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t};\r\n//\t\ttransitionEvent && this.progressBar.addEventListener(transitionEvent, fun);\r\n//\t\tif(!transitionEvent) {\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t}\r\n\t\tthis.container.parentNode.removeChild(this.container);\r\n\t}, 500);\r\n};\r\n\r\nToProgress.prototype.reset = function(callback) {\r\n\tthis.progress = 0;\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.hide = function() {\r\n\tthis.progressBar.style.opacity = '0';\r\n\tthis.container.style.display = 'none';\r\n};\r\n\r\nToProgress.prototype.show = function() {\r\n\tthis.progressBar.style.opacity = '1';\r\n\tthis.container.style.display = 'block';\r\n};\r\n\r\nexport default {\r\n\tToProgress\r\n};","function Base64() {\r\n\r\n\t// private property\r\n\tlet _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n\t// public method for encoding\r\n\tthis.encode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = _utf8_encode(input);\r\n\t\twhile(i < input.length) {\r\n\t\t\tchr1 = input.charCodeAt(i++);\r\n\t\t\tchr2 = input.charCodeAt(i++);\r\n\t\t\tchr3 = input.charCodeAt(i++);\r\n\t\t\tenc1 = chr1 >> 2;\r\n\t\t\tenc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\t\tenc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\t\tenc4 = chr3 & 63;\r\n\t\t\tif(isNaN(chr2)) {\r\n\t\t\t\tenc3 = enc4 = 64;\r\n\t\t\t} else if(isNaN(chr3)) {\r\n\t\t\t\tenc4 = 64;\r\n\t\t\t}\r\n\t\t\toutput = output +\r\n\t\t\t\t_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +\r\n\t\t\t\t_keyStr.charAt(enc3) + _keyStr.charAt(enc4);\r\n\t\t}\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// public method for decoding\r\n\tthis.decode = function(input) {\r\n\t\tlet output = \"\";\r\n\t\tlet chr1, chr2, chr3;\r\n\t\tlet enc1, enc2, enc3, enc4;\r\n\t\tlet i = 0;\r\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n\t\twhile(i < input.length) {\r\n\t\t\tenc1 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc2 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc3 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc4 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\r\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\r\n\t\t\toutput = output + String.fromCharCode(chr1);\r\n\t\t\tif(enc3 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr2);\r\n\t\t\t}\r\n\t\t\tif(enc4 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr3);\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput = _utf8_decode(output);\r\n\t\treturn output;\r\n\t};\r\n\r\n\t// private method for UTF-8 encoding\r\n\tlet _utf8_encode = function(string) {\r\n\t\tstring = string.replace(/\\r\\n/g, \"\\n\");\r\n\t\tlet utftext = \"\";\r\n\t\tfor(let n = 0; n < string.length; n++) {\r\n\t\t\tlet c = string.charCodeAt(n);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tutftext += String.fromCharCode(c);\r\n\t\t\t} else if((c > 127) && (c < 2048)) {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 6) | 192);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t} else {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 12) | 224);\r\n\t\t\t\tutftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn utftext;\r\n\t};\r\n\r\n\t// private method for UTF-8 decoding\r\n\tlet _utf8_decode = function(utftext) {\r\n\t\tlet string = \"\";\r\n\t\tlet i = 0;\r\n\t\tlet c=0, c2=0, c3=0;\r\n\t\t\r\n\t\twhile(i < utftext.length) {\r\n\t\t\tc = utftext.charCodeAt(i);\r\n\t\t\tif(c < 128) {\r\n\t\t\t\tstring += String.fromCharCode(c);\r\n\t\t\t\ti++;\r\n\t\t\t} else if((c > 191) && (c < 224)) {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tstring += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n\t\t\t\ti += 2;\r\n\t\t\t} else {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tc3 = utftext.charCodeAt(i + 2);\r\n\t\t\t\tstring += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n\t\t\t\ti += 3;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn string;\r\n\t};\r\n}\r\n\r\nexport default Base64;","import urls from './urls.js';\r\nimport global from './global.js';\r\nimport base from './base.js';\r\nimport loading from './loading.js';\r\nimport base64 from './base64.js';\r\n\r\nexport default {\r\n\t...urls,\r\n\tglobal,\r\n\t...base,\r\n\t...loading,\r\n\tbase64,\r\n};","import U from \"../util/index.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\n//ie9\r\ntry {\r\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\r\n\t\tU.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\r\n\t\t\tlet thiz = Function.prototype.bind;\r\n\t\t\tconsole[method] = thiz.call(console[method], console);\r\n\t\t});\r\n\t}\r\n} catch(e) {\r\n\tG.console = {\r\n\t\tlog: function() {},\r\n\t\terror: function() {},\r\n\t\twarn: function() {}\r\n\t};\r\n}\r\n\r\ntry {\r\n\r\n\tif(!Array.prototype.indexOf) {\r\n\t\tArray.prototype.indexOf = function(elem, offset) {\r\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\r\n\t\t\t\tif(this[i] == elem) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\t}\r\n\r\n\tif(!Array.pushAll) {\r\n\t\tArray.pushAll = function(thiz, arr) {\r\n\t\t\tif(!L.isArray(arr)) {\r\n\t\t\t\tthrow new Error(\"not array:\" + arr);\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < arr.length; i++) {\r\n\t\t\t\tthiz.push(arr[i]);\r\n\t\t\t}\r\n\t\t\treturn thiz;\r\n\t\t};\r\n\t}\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}\r\n\r\nfunction startsWith(str, starts) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\treturn str.indexOf(starts) == 0;\r\n}\r\n\r\nfunction endsWith(str, ends) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\tlet index = str.lastIndexOf(ends);\r\n\tif(index >= 0 && (str.length - ends.length == index)) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction _indexInArray(array, ele, offset = 0, compare) {\r\n\tlet index = -1;\r\n\tif(array) {\r\n\t\tfor(let i = offset || 0; i < array.length; i++) {\r\n\t\t\tif(compare) {\r\n\t\t\t\tif(compare(array[i], ele, i, array)) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(array[i] == ele) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\treturn index;\r\n}\r\n\r\nfunction indexInArray(array, ele, compare) {\r\n\treturn _indexInArray(array, ele, 0, compare);\r\n}\r\n\r\nfunction indexInArrayFrom(array, ele, offset, compare) {\r\n\treturn _indexInArray(array, ele, offset, compare);\r\n}\r\n\r\nexport default {\r\n\tstartsWith,\r\n\tendsWith,\r\n\tindexInArray,\r\n\tindexInArrayFrom\r\n};","//https://github.com/douglascrockford/JSON-js\r\n//  json2.js\r\n//  2017-06-12\r\n//  Public Domain.\r\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\r\n\r\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\r\n//  NOT CONTROL.\r\nconst JSON = {};\r\n\r\nexport default JSON;\r\n\r\nlet rx_one = /^[\\],:{}\\s]*$/;\r\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\r\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\r\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\r\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\n\r\nfunction f(n) {\r\n\t// Format integers to have at least two digits.\r\n\treturn(n < 10) ?\r\n\t\t\"0\" + n :\r\n\t\tn;\r\n}\r\n\r\nfunction this_value() {\r\n\treturn this.valueOf();\r\n}\r\n\r\nif(typeof Date.prototype.toJSON !== \"function\") {\r\n\r\n\tDate.prototype.toJSON = function() {\r\n\t\treturn isFinite(this.valueOf()) ?\r\n\t\t\t(\r\n\t\t\t\tthis.getUTCFullYear() +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCMonth() + 1) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCDate()) +\r\n\t\t\t\t\"T\" +\r\n\t\t\t\tf(this.getUTCHours()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCMinutes()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCSeconds()) +\r\n\t\t\t\t\"Z\"\r\n\t\t\t) :\r\n\t\t\tnull;\r\n\t};\r\n\r\n\tBoolean.prototype.toJSON = this_value;\r\n\tNumber.prototype.toJSON = this_value;\r\n\tString.prototype.toJSON = this_value;\r\n}\r\n\r\nlet gap;\r\nlet indent;\r\nlet meta;\r\nlet rep;\r\n\r\nfunction quote(string) {\r\n\r\n\t// If the string contains no control characters, no quote characters, and no\r\n\t// backslash characters, then we can safely slap some quotes around it.\r\n\t// Otherwise we must also replace the offending characters with safe escape\r\n\t// sequences.\r\n\r\n\trx_escapable.lastIndex = 0;\r\n\treturn rx_escapable.test(string) ?\r\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\r\n\t\t\tlet c = meta[a];\r\n\t\t\treturn typeof c === \"string\" ?\r\n\t\t\t\tc :\r\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\r\n\t\t}) + \"\\\"\" :\r\n\t\t\"\\\"\" + string + \"\\\"\";\r\n}\r\n\r\nfunction str(key, holder) {\r\n\t// Produce a string from holder[key].\r\n\tlet i; // The loop counter.\r\n\tlet k; // The member key.\r\n\tlet v; // The member value.\r\n\tlet length;\r\n\tlet mind = gap;\r\n\tlet partial;\r\n\tlet value = holder[key];\r\n\r\n\t// If the value has a toJSON method, call it to obtain a replacement value.\r\n\tif(\r\n\t\tvalue &&\r\n\t\ttypeof value === \"object\" &&\r\n\t\ttypeof value.toJSON === \"function\"\r\n\t) {\r\n\t\tvalue = value.toJSON(key);\r\n\t}\r\n\r\n\t// If we were called with a replacer function, then call the replacer to\r\n\t// obtain a replacement value.\r\n\r\n\tif(typeof rep === \"function\") {\r\n\t\tvalue = rep.call(holder, key, value);\r\n\t}\r\n\r\n\t// What happens next depends on the value's type.\r\n\r\n\tswitch(typeof value) {\r\n\t\tcase \"string\":\r\n\t\t\treturn quote(value);\r\n\t\tcase \"number\":\r\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\r\n\t\t\treturn(isFinite(value)) ?\r\n\t\t\t\tString(value) :\r\n\t\t\t\t\"null\";\r\n\r\n\t\tcase \"boolean\":\r\n\t\tcase \"null\":\r\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\r\n\t\t\t// typeof null does not produce \"null\". The case is included here in\r\n\t\t\t// the remote chance that this gets fixed someday.\r\n\t\t\treturn String(value);\r\n\r\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\r\n\t\t\t// null.\r\n\t\tcase \"object\":\r\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\r\n\t\t\t// so watch out for that case.\r\n\t\t\tif(!value) {\r\n\t\t\t\treturn \"null\";\r\n\t\t\t}\r\n\r\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\r\n\r\n\t\t\tgap += indent;\r\n\t\t\tpartial = [];\r\n\t\t\t// Is the value an array?\r\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\r\n\r\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\r\n\t\t\t\t// for non-JSON values.\r\n\t\t\t\tlength = value.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\r\n\t\t\t\t}\r\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\r\n\t\t\t\t// brackets.\r\n\r\n\t\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\t\"[]\" :\r\n\t\t\t\t\tgap ?\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t\"[\\n\" +\r\n\t\t\t\t\t\tgap +\r\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\r\n\t\t\t\t\t\t\"\\n\" +\r\n\t\t\t\t\t\tmind +\r\n\t\t\t\t\t\t\"]\"\r\n\t\t\t\t\t) :\r\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\r\n\t\t\t\tgap = mind;\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\r\n\t\t\tif(rep && typeof rep === \"object\") {\r\n\t\t\t\tlength = rep.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\r\n\t\t\t\t\t\tk = rep[i];\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" : \":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" :\r\n\t\t\t\t\t\t\t\t\":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Join all of the member texts together, separated with commas,\r\n\t\t\t// and wrap them in braces.\r\n\r\n\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\"{}\" : gap ?\r\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\r\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\r\n\t\t\tgap = mind;\r\n\t\t\treturn v;\r\n\t}\r\n}\r\n\r\n// If the JSON object does not yet have a stringify method, give it one.\r\nif(typeof JSON.stringify !== \"function\") {\r\n\tmeta = { // table of character substitutions\r\n\t\t\"\\b\": \"\\\\b\",\r\n\t\t\"\\t\": \"\\\\t\",\r\n\t\t\"\\n\": \"\\\\n\",\r\n\t\t\"\\f\": \"\\\\f\",\r\n\t\t\"\\r\": \"\\\\r\",\r\n\t\t\"\\\"\": \"\\\\\\\"\",\r\n\t\t\"\\\\\": \"\\\\\\\\\"\r\n\t};\r\n\tJSON.stringify = function(value, replacer, space) {\r\n\r\n\t\t// The stringify method takes a value and an optional replacer, and an optional\r\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\r\n\t\t// that can replace values, or an array of strings that will select the keys.\r\n\t\t// A default replacer method can be provided. Use of the space parameter can\r\n\t\t// produce text that is more easily readable.\r\n\r\n\t\tlet i;\r\n\t\tgap = \"\";\r\n\t\tindent = \"\";\r\n\t\t// If the space parameter is a number, make an indent string containing that\r\n\t\t// many spaces.\r\n\t\tif(typeof space === \"number\") {\r\n\t\t\tfor(i = 0; i < space; i += 1) {\r\n\t\t\t\tindent += \" \";\r\n\t\t\t}\r\n\r\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\r\n\r\n\t\t} else if(typeof space === \"string\") {\r\n\t\t\tindent = space;\r\n\t\t}\r\n\r\n\t\t// If there is a replacer, it must be a function or an array.\r\n\t\t// Otherwise, throw an error.\r\n\r\n\t\trep = replacer;\r\n\t\tif(replacer && typeof replacer !== \"function\" && (\r\n\t\t\t\ttypeof replacer !== \"object\" ||\r\n\t\t\t\ttypeof replacer.length !== \"number\"\r\n\t\t\t)) {\r\n\t\t\tthrow new Error(\"JSON.stringify\");\r\n\t\t}\r\n\r\n\t\t// Make a fake root object containing our value under the key of \"\".\r\n\t\t// Return the result of stringifying the value.\r\n\r\n\t\treturn str(\"\", {\r\n\t\t\t\"\": value\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// If the JSON object does not yet have a parse method, give it one.\r\n\r\nif(typeof JSON.parse !== \"function\") {\r\n\tJSON.parse = function(text, reviver) {\r\n\t\t// The parse method takes a text and an optional reviver function, and returns\r\n\t\t// a JavaScript value if the text is a valid JSON text.\r\n\t\tlet j;\r\n\r\n\t\tfunction walk(holder, key) {\r\n\t\t\t// The walk method is used to recursively walk the resulting structure so\r\n\t\t\t// that modifications can be made.\r\n\t\t\tlet k;\r\n\t\t\tlet v;\r\n\t\t\tlet value = holder[key];\r\n\t\t\tif(value && typeof value === \"object\") {\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = walk(value, k);\r\n\t\t\t\t\t\tif(v !== undefined) {\r\n\t\t\t\t\t\t\tvalue[k] = v;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelete value[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn reviver.call(holder, key, value);\r\n\t\t}\r\n\r\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\r\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\r\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\r\n\t\ttext = String(text);\r\n\t\trx_dangerous.lastIndex = 0;\r\n\t\tif(rx_dangerous.test(text)) {\r\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\r\n\t\t\t\treturn(\r\n\t\t\t\t\t\"\\\\u\" +\r\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// In the second stage, we run the text against regular expressions that look\r\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\r\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\r\n\t\t// But just to be safe, we want to reject all unexpected forms.\r\n\r\n\t\t// We split the second stage into 4 regexp operations in order to work around\r\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\r\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\r\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\r\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\r\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\r\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\r\n\r\n\t\tif(\r\n\t\t\trx_one.test(\r\n\t\t\t\ttext\r\n\t\t\t\t.replace(rx_two, \"@\")\r\n\t\t\t\t.replace(rx_three, \"]\")\r\n\t\t\t\t.replace(rx_four, \"\")\r\n\t\t\t)\r\n\t\t) {\r\n\r\n\t\t\t// In the third stage we use the eval function to compile the text into a\r\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\r\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\r\n\t\t\t// in parens to eliminate the ambiguity.\r\n\t\t\tj = eval(\"(\" + text + \")\");\r\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\r\n\t\t\t// each name/value pair to a reviver function for possible transformation.\r\n\r\n\t\t\treturn(typeof reviver === \"function\") ?\r\n\t\t\t\twalk({\r\n\t\t\t\t\t\"\": j\r\n\t\t\t\t}, \"\") : j;\r\n\t\t}\r\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\r\n\t\tthrow new SyntaxError(\"JSON.parse\");\r\n\t};\r\n}","/*\r\n * Copyright 2016 Google Inc. All rights reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n * use this file except in compliance with the License. You may obtain a copy of\r\n * the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\r\n * License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\n//https://github.com/GoogleChrome/proxy-polyfill\r\nexport default function proxyPolyfill() {\r\n\tlet lastRevokeFn = null;\r\n\tlet ProxyPolyfill;\r\n\r\n\t/**\r\n\t * @param {*} o\r\n\t * @return {boolean} whether this is probably a (non-null) Object\r\n\t */\r\n\tfunction isObject(o) {\r\n\t\treturn o ? (typeof o === 'object' || typeof o === 'function') : false;\r\n\t}\r\n\r\n\t/**\r\n\t * @constructor\r\n\t * @param {!Object} target\r\n\t * @param {{apply, construct, get, set}} handler\r\n\t */\r\n\tProxyPolyfill = function(target, handler) {\r\n\t\tif(!isObject(target) || !isObject(handler)) {\r\n\t\t\tthrow new TypeError('Cannot create proxy with a non-object as target or handler');\r\n\t\t}\r\n\r\n\t\t// Construct revoke function, and set lastRevokeFn so that Proxy.revocable can steal it.\r\n\t\t// The caller might get the wrong revoke function if a user replaces or wraps scope.Proxy\r\n\t\t// to call itself, but that seems unlikely especially when using the polyfill.\r\n\t\tlet throwRevoked = function() {};\r\n\t\tlastRevokeFn = function() {\r\n\t\t\tthrowRevoked = function(trap) {\r\n\t\t\t\tthrow new TypeError(`Cannot perform '${trap}' on a proxy that has been revoked`);\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\t// Fail on unsupported traps: Chrome doesn't do this, but ensure that users of the polyfill\r\n\t\t// are a bit more careful. Copy the internal parts of handler to prevent user changes.\r\n\t\tconst unsafeHandler = handler;\r\n\t\thandler = {\r\n\t\t\t'get': null,\r\n\t\t\t'set': null,\r\n\t\t\t'apply': null,\r\n\t\t\t'construct': null\r\n\t\t};\r\n\t\tfor(let k in unsafeHandler) {\r\n\t\t\tif(!(k in handler)) {\r\n\t\t\t\tthrow new TypeError(`Proxy polyfill does not support trap '${k}'`);\r\n\t\t\t}\r\n\t\t\thandler[k] = unsafeHandler[k];\r\n\t\t}\r\n\t\tif(typeof unsafeHandler === 'function') {\r\n\t\t\t// Allow handler to be a function (which has an 'apply' method). This matches what is\r\n\t\t\t// probably a bug in native versions. It treats the apply call as a trap to be configured.\r\n\t\t\thandler.apply = unsafeHandler.apply.bind(unsafeHandler);\r\n\t\t}\r\n\r\n\t\t// Define proxy as this, or a Function (if either it's callable, or apply is set).\r\n\t\t// TODO(samthor): Closure compiler doesn't know about 'construct', attempts to rename it.\r\n\t\tlet proxy = this;\r\n\t\tlet isMethod = false;\r\n\t\tlet isArray = false;\r\n\t\tif(typeof target === 'function') {\r\n\t\t\tproxy = function ProxyPolyfill() {\r\n\t\t\t\tconst usingNew = (this && this.constructor === proxy);\r\n\t\t\t\tconst args = Array.prototype.slice.call(arguments);\r\n\t\t\t\tthrowRevoked(usingNew ? 'construct' : 'apply');\r\n\r\n\t\t\t\tif(usingNew && handler['construct']) {\r\n\t\t\t\t\treturn handler['construct'].call(this, target, args);\r\n\t\t\t\t} else if(!usingNew && handler.apply) {\r\n\t\t\t\t\treturn handler.apply(target, this, args);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// since the target was a function, fallback to calling it directly.\r\n\t\t\t\tif(usingNew) {\r\n\t\t\t\t\t// inspired by answers to https://stackoverflow.com/q/1606797\r\n\t\t\t\t\targs.unshift(target); // pass class as first arg to constructor, although irrelevant\r\n\t\t\t\t\t// nb. cast to convince Closure compiler that this is a constructor\r\n\t\t\t\t\tconst f = /** @type {!Function} */ (target.bind.apply(target, args));\r\n\t\t\t\t\treturn new f();\r\n\t\t\t\t}\r\n\t\t\t\treturn target.apply(this, args);\r\n\t\t\t};\r\n\t\t\tisMethod = true;\r\n\t\t} else if(target instanceof Array) {\r\n\t\t\tproxy = [];\r\n\t\t\tisArray = true;\r\n\t\t}\r\n\r\n\t\t// Create default getters/setters. Create different code paths as handler.get/handler.set can't\r\n\t\t// change after creation.\r\n\t\tconst getter = handler.get ? function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn handler.get(this, prop, proxy);\r\n\t\t} : function(prop) {\r\n\t\t\tthrowRevoked('get');\r\n\t\t\treturn this[prop];\r\n\t\t};\r\n\t\tconst setter = handler.set ? function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tconst status = handler.set(this, prop, value, proxy);\r\n\t\t\t// TODO(samthor): If the calling code is in strict mode, throw TypeError.\r\n\t\t\t// if (!status) {\r\n\t\t\t// It's (sometimes) possible to work this out, if this code isn't strict- try to load the\r\n\t\t\t// callee, and if it's available, that code is non-strict. However, this isn't exhaustive.\r\n\t\t\t// }\r\n\t\t} : function(prop, value) {\r\n\t\t\tthrowRevoked('set');\r\n\t\t\tthis[prop] = value;\r\n\t\t};\r\n\r\n\t\t// Clone direct properties (i.e., not part of a prototype).\r\n\t\tlet propertyNames = Object.getOwnPropertyNames(target);\r\n\r\n\t\t/////////用于代理Promise:then方法等\r\n\t\tif(target instanceof Promise && target.__proto__) {\r\n\t\t\tlet props = Object.getOwnPropertyNames(target.__proto__);\r\n\t\t\tlet obj = {};\r\n\t\t\tpropertyNames.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tprops.forEach((prop) => {\r\n\t\t\t\tobj[prop] = true;\r\n\t\t\t});\r\n\t\t\tpropertyNames = [];\r\n\t\t\tfor(let prop in obj) {\r\n\t\t\t\tpropertyNames.push(prop);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst propertyMap = {};\r\n\t\tpropertyNames.forEach(function(prop) {\r\n\t\t\tif((isMethod || isArray) && prop in proxy) {\r\n\t\t\t\treturn; // ignore properties already here, e.g. 'bind', 'prototype' etc\r\n\t\t\t}\r\n\t\t\tconst real = Object.getOwnPropertyDescriptor(target, prop);\r\n\t\t\tconst desc = {\r\n\t\t\t\tenumerable: !!(real && real.enumerable),\r\n\t\t\t\tget: getter.bind(target, prop),\r\n\t\t\t\tset: setter.bind(target, prop),\r\n\t\t\t};\r\n\t\t\tObject.defineProperty(proxy, prop, desc);\r\n\t\t\tpropertyMap[prop] = true;\r\n\t\t});\r\n\r\n\t\t// Set the prototype, or clone all prototype methods (always required if a getter is provided).\r\n\t\t// TODO(samthor): We don't allow prototype methods to be set. It's (even more) awkward.\r\n\t\t// An alternative here would be to _just_ clone methods to keep behavior consistent.\r\n\t\tlet prototypeOk = true;\r\n\t\tif(Object.setPrototypeOf) {\r\n\t\t\tObject.setPrototypeOf(proxy, Object.getPrototypeOf(target));\r\n\t\t} else if(proxy.__proto__) {\r\n\t\t\tproxy.__proto__ = target.__proto__;\r\n\t\t} else {\r\n\t\t\tprototypeOk = false;\r\n\t\t}\r\n\t\tif(handler.get || !prototypeOk) {\r\n\t\t\tfor(let k in target) {\r\n\t\t\t\tif(propertyMap[k]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tObject.defineProperty(proxy, k, {\r\n\t\t\t\t\tget: getter.bind(target, k)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// The Proxy polyfill cannot handle adding new properties. Seal the target and proxy.\r\n\t\tObject.seal(target);\r\n\t\tObject.seal(proxy);\r\n\r\n\t\treturn proxy; // nb. if isMethod is true, proxy != this\r\n\t};\r\n\r\n\tProxyPolyfill.revocable = function(target, handler) {\r\n\t\tconst p = new ProxyPolyfill(target, handler);\r\n\t\treturn {\r\n\t\t\t'proxy': p,\r\n\t\t\t'revoke': lastRevokeFn\r\n\t\t};\r\n\t};\r\n\r\n\treturn ProxyPolyfill;\r\n}","import JSON from './json.js';\r\nimport \"./ie.js\";\r\nimport ProxyUtil from './proxy.js';\r\n\r\nfunction polyfillInit(G, L) {\r\n\tlet proxy = ProxyUtil();\r\n\tif(!G['Proxy']) {\r\n\t\tG.Proxy = proxy;\r\n\t}\r\n\tL.Proxy = proxy;\r\n}\r\n\r\nexport {\r\n\tJSON,\r\n\tpolyfillInit\r\n};","import {\r\n\tJSON as xsJSON,\r\n\tpolyfillInit\r\n} from \"../polyfill/index.js\";\r\nimport U from \"../util/index.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\nconst IE_VERSION = U.IE_VERSION;\r\n\r\npolyfillInit(G, L);\r\n\r\nif (!String.prototype.trim) {\r\n\tString.prototype.trim = function() {\r\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n\t};\r\n}\r\n\r\n//生成一个随机的id，只保证在本页面是唯一的\r\nfunction randId(suffix) {\r\n\tlet id = \"r\" + parseInt(new Date().getTime() / 50).toString(16) + parseInt(Math.random() * 1000).toString(16) +\r\n\t\tU.getAndIncIdCount().toString(16);\r\n\tif (suffix !== undefined) {\r\n\t\tid += suffix;\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction xsEval(scriptString) {\r\n\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\r\n\treturn rs;\r\n}\r\n\r\n/**\r\n * 注意key需要用引号包裹\r\n * @param {Object} str\r\n * @param {Object} option\r\n */\r\nfunction xsParseJson(str, option) {\r\n\ttry {\r\n\t\tif (str === \"\" || str === null || str === undefined || !L.isString(str)) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\r\n\t\toption = L.extend({\r\n\t\t\tfnStart: \"\", //\"/*{f}*/\",\r\n\t\t\tfnEnd: \"\", //\"/*{f}*/\",\r\n\t\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\r\n\t\t}, option);\r\n\r\n\t\tlet fnMap = {};\r\n\t\tlet fnOffset = 0;\r\n\t\tlet replacer = undefined;\r\n\t\tif (option.fnStart && option.fnEnd) {\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\r\n\t\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\r\n\t\t\t\tif (indexStart == -1 && indexEnd == -1) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (indexStart == -1) {\r\n\t\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (indexEnd == -1) {\r\n\t\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\r\n\t\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\r\n\t\t\t\tif (!L.startsWith(fnStr, \"function(\")) {\r\n\t\t\t\t\tthrow \"not a function:\" + fnStr;\r\n\t\t\t\t}\r\n\t\t\t\ttry {\r\n\t\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\r\n\t\t\t\t\tlet fn = L.xsEval(fnStr);\r\n\t\t\t\t\tfnMap[fnId] = fn;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(fnStr);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t\tfnOffset = indexStart + fnId.length;\r\n\t\t\t}\r\n\t\t\treplacer = function(key, val) {\r\n\t\t\t\tif (L.isString(val) && fnMap[val]) {\r\n\t\t\t\t\treturn fnMap[val];\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (option.rcomment) {\r\n\t\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\r\n\t\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\r\n\t\t}\r\n\r\n\t\tlet jsonObj = xsJSON;\r\n\t\treturn jsonObj.parse(str, replacer);\r\n\t} catch (e) {\r\n\t\ttry {\r\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\r\n\t\t\tif (e.message && reg.test(e.message)) {\r\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\r\n\t\t\t\tlet pos = parseInt(posStr.trim());\r\n\t\t\t\tlet _str = str.substring(pos);\r\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\r\n\t\t\t}\r\n\t\t} catch (e2) {\r\n\t\t\tconsole.warn(e2);\r\n\t\t}\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\nfunction xsJson2String(obj) {\r\n\tlet jsonObj = xsJSON;\r\n\treturn jsonObj.stringify(obj);\r\n}\r\n\r\nconst getPathWithRelative = U.getPathWithRelative;\r\n\r\nfunction _toParamsMap(argsStr, decode = true) {\r\n\tif (L.isObject(argsStr)) {\r\n\t\treturn argsStr;\r\n\t}\r\n\tif (!argsStr) {\r\n\t\targsStr = location.search;\r\n\t}\r\n\r\n\tlet index = argsStr.indexOf(\"?\");\r\n\tif (index >= 0) {\r\n\t\targsStr = argsStr.substring(index + 1);\r\n\t} else {\r\n\t\tif (U.dealPathMayAbsolute(argsStr).absolute) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\tindex = argsStr.lastIndexOf(\"#\");\r\n\tif (index >= 0) {\r\n\t\targsStr = argsStr.substring(0, index);\r\n\t}\r\n\r\n\tlet ret = {},\r\n\t\tseg = argsStr.split('&'),\r\n\t\ts;\r\n\tfor (let i = 0; i < seg.length; i++) {\r\n\t\tif (!seg[i]) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ts = seg[i].split('=');\r\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\r\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} url\r\n * @param {Object} urlArgs \"a=b&b=c#hash\",\"#hash\",Object\r\n */\r\nfunction appendArgs2Url(url, urlArgs) {\r\n\tif (url === undefined || url === null || !urlArgs) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tlet index = url.lastIndexOf(\"?\");\r\n\tlet hashIndex = url.lastIndexOf(\"#\");\r\n\tif (hashIndex < 0) {\r\n\t\thashIndex = url.length;\r\n\t}\r\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\r\n\tlet newParams = _toParamsMap(urlArgs, false);\r\n\tlet has = false;\r\n\tfor (let k in newParams) {\r\n\t\tif (oldParams[k] != newParams[k]) {\r\n\t\t\toldParams[k] = newParams[k];\r\n\t\t\thas = true;\r\n\t\t}\r\n\t}\r\n\t//\tif(!has) {\r\n\t//\t\treturn url; //参数没有变化直接返回\r\n\t//\t}\r\n\r\n\tlet paramKeys = [];\r\n\tfor (let k in oldParams) {\r\n\t\tparamKeys.push(k);\r\n\t}\r\n\tparamKeys.sort();\r\n\r\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\r\n\tlet params = [];\r\n\r\n\tfor (let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\r\n\t\tlet k = paramKeys[i];\r\n\t\tparams.push(k + \"=\" + oldParams[k]);\r\n\t}\r\n\tparams = params.join(\"&\");\r\n\tlet hash = \"\";\r\n\tif ((typeof urlArgs == \"string\") && urlArgs.lastIndexOf(\"#\") >= 0) {\r\n\t\thash = urlArgs.substring(urlArgs.lastIndexOf(\"#\"));\r\n\t} else if (hashIndex >= 0 && hashIndex < url.length) {\r\n\t\thash = url.substring(hashIndex);\r\n\t}\r\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\r\n\r\n}\r\n\r\nfunction domAttr(dom, name) {\r\n\tlet attr;\r\n\tif (dom && (attr = dom.getAttribute(name)) !== null && attr !== undefined) {\r\n\t\treturn attr;\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n}\r\n\r\nfunction queryString2ParamsMap(argsStr, decode) {\r\n\treturn _toParamsMap(argsStr, decode);\r\n}\r\n\r\nexport default {\r\n\tdomAttr,\r\n\trandId,\r\n\txsEval,\r\n\txsParseJson,\r\n\txsJson2String,\r\n\tgetPathWithRelative,\r\n\tappendArgs2Url,\r\n\tqueryString2ParamsMap,\r\n\tIE_VERSION\r\n};\r\n","const ostring = Object.prototype.toString;\r\n\r\nfunction isArray(it) {\r\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\r\n}\r\n\r\nfunction isFunction(it) {\r\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\r\n}\r\n\r\nfunction isObject(it) {\r\n\tif(it === null || it === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\r\n}\r\n\r\nfunction isString(it) {\r\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\r\n}\r\n\r\nfunction isDate(it) {\r\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\r\n}\r\n\r\nfunction isRegExp(it) {\r\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\r\n}\r\n\r\nfunction isEmpty(it) {\r\n\treturn it === null || it === undefined || it === \"\";\r\n}\r\n\r\nexport default {\r\n\tisArray,\r\n\tisFunction,\r\n\tisObject,\r\n\tisString,\r\n\tisDate,\r\n\tisRegExp,\r\n\tisEmpty,\r\n};","import U from \"../util/index.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\nfunction queryParam(name, otherValue, optionUrl) {\r\n\tlet search;\r\n\tif (optionUrl) {\r\n\t\tlet index = optionUrl.indexOf('?');\r\n\t\tif (index < 0) {\r\n\t\t\tindex = 0;\r\n\t\t} else {\r\n\t\t\tindex += 1;\r\n\t\t}\r\n\t\tsearch = optionUrl.substr(index);\r\n\t} else {\r\n\t\tsearch = window.location.search.substr(1);\r\n\t}\r\n\r\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n\tlet r = search.match(reg);\r\n\tlet result = null;\r\n\tif (r != null) {\r\n\t\tresult = decodeURIComponent(r[2]);\r\n\t}\r\n\r\n\tif ((result === null || result === \"\") && otherValue !== undefined) {\r\n\t\tresult = otherValue;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction getUrl(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\tif (optionalAbsUrl && !U.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\r\n\t}\r\n\t//\tif(appendArgs === undefined) {\r\n\t//\t\tappendArgs = true;\r\n\t//\t}\r\n\tlet theConfig = L.config();\r\n\tlet thePageUrl = U.thePageUrl;\r\n\tlet url;\r\n\tif (relativeUrl === undefined) {\r\n\t\turl = thePageUrl;\r\n\t} else if (L.startsWith(relativeUrl, \".\") || U.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\turl = U.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\r\n\t} else {\r\n\t\turl = theConfig.baseUrl + relativeUrl;\r\n\t}\r\n\tif (appendArgs) {\r\n\t\tif (url == thePageUrl) {\r\n\t\t\turl += location.search + location.hash;\r\n\t\t}\r\n\t\treturn theConfig.dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction getUrl2(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\tlet url = getUrl(relativeUrl, false, optionalAbsUrl);\r\n\tif (appendArgs) {\r\n\t\treturn L.config().dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\r\n\tlet rs;\r\n\ttry {\r\n\t\tthiz = thiz === undefined ? this : thiz;\r\n\t\trs = fun.call(thiz);\r\n\t} catch (e) {\r\n\t\tif (L.isFunction(exCallback)) {\r\n\t\t\texCallback(e);\r\n\t\t} else {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n\tif (rs === undefined || rs === null) {\r\n\t\trs = defaultReturn;\r\n\t}\r\n\treturn rs;\r\n}\r\n\r\nfunction dealProperties(obj, properties) {\r\n\treturn U.propertiesDeal(obj, properties);\r\n}\r\n\r\nfunction extend(target) {\r\n\tfor (let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif (!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\ttarget[x] = obj[x];\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction extendDeep(target) {\r\n\tif (!target) {\r\n\t\treturn target;\r\n\t}\r\n\tfor (let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif (!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tfor (let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (L.isObject(value) && L.isObject(target[x])) {\r\n\t\t\t\ttarget[x] = L.extendDeep(target[x], value);\r\n\t\t\t} else {\r\n\t\t\t\ttarget[x] = obj[x];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction _AsyncCall(useTimer) {\r\n\tlet thiz = this;\r\n\tlet count = 0;\r\n\tlet ctrlCallbackMap = {};\r\n\r\n\tfunction initCtrlCallback(callbackObj) {\r\n\t\tlet mineCount = count + \"\";\r\n\t\tif (!ctrlCallbackMap[mineCount]) {\r\n\t\t\tlet ctrlCallback = function() {\r\n\t\t\t\tcount++;\r\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\r\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\r\n\t\t\t\twhile (asyncCallQueue.length) {\r\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\r\n\t\t\t\t\tlet lastReturn = undefined;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (callbackObj.callback) {\r\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet handle;\r\n\t\t\t\t\twhile (callbackObj.nextCallback.length) {\r\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\r\n\t\t\t\t\t\tif (!handle) {\r\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tctrlCallbackMap[mineCount] = [];\r\n\t\t\tif (!useTimer && G.Promise && G.Promise.resolve) {\r\n\t\t\t\tG.Promise.resolve().then(ctrlCallback);\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout(ctrlCallback, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet queue = ctrlCallbackMap[mineCount];\r\n\t\tqueue.push(callbackObj);\r\n\t}\r\n\r\n\tthis.pushTask = function(callback, obj) {\r\n\t\tlet callbackObj;\r\n\t\tlet handle = {\r\n\t\t\tnext: function(nextCallback, lastReturn) {\r\n\t\t\t\tcallbackObj.nextCallback.push({\r\n\t\t\t\t\tcallback: nextCallback,\r\n\t\t\t\t\tlastReturn: lastReturn\r\n\t\t\t\t});\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t};\r\n\t\tcallbackObj = {\r\n\t\t\tcallback: callback,\r\n\t\t\tobj: obj,\r\n\t\t\tnextCallback: [],\r\n\t\t\thandle: handle\r\n\t\t};\r\n\r\n\t\tinitCtrlCallback(callbackObj);\r\n\r\n\t\treturn handle;\r\n\t};\r\n}\r\n\r\nconst theAsyncCall = new _AsyncCall();\r\nconst theAsyncCallOfTimer = new _AsyncCall(true);\r\n\r\nlet asyncCall = function(callback, useTimer) {\r\n\tif (useTimer) {\r\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\r\n\t} else {\r\n\t\treturn theAsyncCall.pushTask(callback);\r\n\t}\r\n};\r\n\r\n/**\r\n * 得到属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction getObjectAttr(obj, attrNames, defaultValue) {\r\n\tif (!obj || !attrNames) {\r\n\t\treturn undefined;\r\n\t}\r\n\tlet attrs = attrNames.split(\".\");\r\n\tlet rs = defaultValue;\r\n\tlet i = 0;\r\n\tfor (; i < attrs.length && obj; i++) {\r\n\t\tlet k = attrs[i];\r\n\t\tobj = obj[k];\r\n\t}\r\n\tif (i == attrs.length) {\r\n\t\trs = obj;\r\n\t}\r\n\r\n\treturn rs;\r\n}\r\n\r\n/**\r\n * 设置属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction setObjectAttr(obj, attrNames, value) {\r\n\tlet _obj = obj;\r\n\tlet attrs = attrNames.split(\".\");\r\n\r\n\tfor (let i = 0; i < attrs.length; i++) {\r\n\t\tlet k = attrs[i];\r\n\r\n\t\tif (i == attrs.length - 1) {\r\n\t\t\tobj[k] = value;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet o = obj[k];\r\n\t\tif (!o) {\r\n\t\t\to = {};\r\n\t\t\tobj[k] = o;\r\n\t\t}\r\n\t\tobj = o;\r\n\t}\r\n\treturn _obj;\r\n}\r\n\r\nfunction clone(obj, isDeep = false) {\r\n\t// Handle the 3 simple types, and null or undefined or function\r\n\tif (!obj || L.isFunction(obj) || L.isString(obj)) return obj;\r\n\r\n\tif (L.isRegExp(obj)) {\r\n\t\treturn new RegExp(obj.source, obj.flags);\r\n\t}\r\n\r\n\t// Handle Date\r\n\tif (L.isDate(obj)) {\r\n\t\tlet copy = new Date();\r\n\t\tcopy.setTime(obj.getTime());\r\n\t\treturn copy;\r\n\t}\r\n\t// Handle Array or Object\r\n\tif (L.isArray(obj) || L.isObject(obj)) {\r\n\t\tlet copy = L.isArray(obj) ? [] : {};\r\n\t\tfor (let attr in obj) {\r\n\t\t\tlet v = obj[attr];\r\n\t\t\tcopy[attr] = isDeep ? clone(v) : v;\r\n\t\t}\r\n\t\treturn copy;\r\n\t}\r\n\treturn obj;\r\n}\r\n\r\nfunction sortObject(obj) {\r\n\tif (!obj || !L.isObject(obj)) {\r\n\t\treturn obj;\r\n\t} else {\r\n\t\tlet keys = [];\r\n\t\tfor (let k in obj) {\r\n\t\t\tkeys.push(k);\r\n\t\t}\r\n\t\tkeys.sort();\r\n\t\tlet newObj = {};\r\n\t\tfor (let i = 0; i < keys.length; i++) {\r\n\t\t\tnewObj[keys[i]] = obj[keys[i]];\r\n\t\t}\r\n\t\treturn newObj;\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tqueryParam,\r\n\tgetUrl,\r\n\tgetUrl2,\r\n\ttryCall,\r\n\tdealProperties,\r\n\textend,\r\n\textendDeep,\r\n\tasyncCall,\r\n\tgetObjectAttr,\r\n\tsetObjectAttr,\r\n\tclone,\r\n\tsortObject,\r\n};\r\n","import U from \"../util/index.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\nlet isDOM = (typeof HTMLElement === 'object') ?\r\n\tfunction(obj) {\r\n\t\treturn obj && (obj instanceof HTMLElement);\r\n\t} :\r\n\tfunction(obj) {\r\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\r\n\t};\r\n\r\nlet onReadyFun = (function() {\r\n\tlet isGlobalReady = false;\r\n\tlet bindReadyQueue = [];\r\n\r\n\tfunction BindReady(callback) {\r\n\t\tif(isGlobalReady) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet isReady = false;\r\n\t\tlet removeListener;\r\n\r\n\t\tfunction ready() {\r\n\t\t\tif(isReady) return;\r\n\t\t\tisReady = true;\r\n\t\t\tisGlobalReady = true;\r\n\t\t\tif(removeListener) {\r\n\t\t\t\tremoveListener();\r\n\t\t\t\tremoveListener = null;\r\n\t\t\t}\r\n\t\t\tcallback();\r\n\t\t}\r\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\r\n\t\tif(document.addEventListener) {\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\t\t\tremoveListener = function() {\r\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\r\n\t\t\t};\r\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\r\n\r\n\t\t} else if(document.attachEvent) {\r\n\t\t\t// ensure firing before onload,\r\n\t\t\t// maybe late but safe also for iframes\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tif(document.readyState === \"complete\") {\r\n\t\t\t\t\tready();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tremoveListener = function() {\r\n\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\r\n\t\t\t};\r\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\r\n\t\t\t// If IE and not an iframe\r\n\t\t\t// continually check to see if the document is ready\r\n\r\n\t\t\tlet fun2;\r\n\t\t\tfun2 = function() {\r\n\t\t\t\tif(isReady) return;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\r\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tsetTimeout(fun2, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// and execute any waiting functions\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\r\n\t\t\tif(document.documentElement.doScroll && typeof G.frameElement === \"undefined\")(fun2)();\r\n\t\t} else {\r\n\t\t\tL.asyncCall(null, true).next(function() {\r\n\t\t\t\tready();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.readyCall = ready;\r\n\t}\r\n\tlet onReady = function(callback) {\r\n\t\tif(document.readyState === \"complete\") {\r\n\t\t\tisGlobalReady = true;\r\n\t\t}\r\n\r\n\t\tif(isGlobalReady) {\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\tlet br = new BindReady(callback);\r\n\t\t\tbindReadyQueue.push(br);\r\n\t\t}\r\n\t};\r\n\r\n\tlet addEventHandle;\r\n\tonReady(function() {\r\n\t\tisGlobalReady = true;\r\n\t\tif(addEventHandle && addEventHandle.remove) {\r\n\t\t\taddEventHandle.remove();\r\n\t\t\taddEventHandle = null;\r\n\t\t}\r\n\t});\r\n\r\n\tif(document.readyState === \"complete\") {\r\n\t\tisGlobalReady = true;\r\n\t} else {\r\n\t\tif(G.addEventListener) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tlet fun = function() {\r\n\t\t\t\t\taddEventHandle.remove();\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t};\r\n\t\t\t\tG.addEventListener(type, fun, false);\r\n\t\t\t\taddEventHandle.remove = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tG.removeEventListener(type, fun);\r\n\t\t\t\t\t\tfun = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t} else if(G.attachEvent) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tlet fun = function() {\r\n\t\t\t\t\taddEventHandle.remove();\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t};\r\n\t\t\t\tG.attachEvent(\"on\" + type, fun);\r\n\t\t\t\taddEventHandle.remove = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tG.detachEvent(\"on\" + type, fun);\r\n\t\t\t\t\t\tfun = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tL.asyncCall(null, true).next(function() {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\taddEventHandle(\"load\", function() {\r\n\t\t\tisGlobalReady = true;\r\n\t\t\twhile(bindReadyQueue.length) {\r\n\t\t\t\tbindReadyQueue.shift().readyCall();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn onReady;\r\n})();\r\n\r\nexport default {\r\n\tisDOM,\r\n\tonReady: onReadyFun\r\n};","import U from \"../util/index.js\";\r\n////////////////////\r\n\r\nimport deprecated from './global-deprecated.js';\r\nimport base from './global-base.js';\r\n//////////////////\r\nimport is from './is.js';\r\nimport funs from './funs.js';\r\nimport browser from './browser.js';\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\nconst env = {\r\n\tversion: ENV_XSLOADER_VERSION\r\n};\r\n\r\nlet toGlobal = {\r\n\t...deprecated,\r\n\t...base\r\n};\r\nfor(let k in toGlobal) {\r\n\tL[k] = toGlobal[k];\r\n\tG[k] = toGlobal[k];\r\n}\r\n\r\nlet justLoader = {\r\n\t...is,\r\n\t...funs,\r\n\t...browser,\r\n\tignoreAspect_: {\r\n\r\n\t},\r\n\teach: U.each,\r\n\tBase64: U.base64,\r\n\tenv,\r\n};\r\nfor(let k in justLoader) {\r\n\tL[k] = justLoader[k];\r\n}","import U from \"../util/index.js\";\r\nconst L = U.global.xsloader;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\nL.__showModules = () => {\r\n\tconsole.log(theDefinedMap);\r\n};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\t_preIndex;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif (isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\tpreDependModule: true,\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t//用于提前依赖\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tmodule.index = module.index || this._preIndex || 0;\r\n\t\tthis._preModule = null;\r\n\t\twhile (queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = U.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = U.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\n/**\r\n * 获取指定脚本、加载中模块的依赖，并添加到defineObject.deps末尾。(配置里的依赖、不一定被添加到实际模块中，模块别名的缘故)\r\n * @param {Object} src\r\n */\r\nfunction appendLoadingModuleDeps(defineObject) {\r\n\tlet src = defineObject.src;\r\n\tlet deps = defineObject.deps;\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif (moduleDef) {\r\n\t\tlet mod = moduleDef.defaultModule && moduleDef.defaultModule.state == \"loading\" && moduleDef.defaultModule;\r\n\t\tlet _deps = mod && mod.deps;\r\n\t\tU.each(_deps, (dep) => {\r\n\t\t\tif (L.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (mod) {\r\n\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t}\r\n\t\tfor (let k in moduleDef.modules) {\r\n\t\t\tmod = moduleDef.modules[k].state == \"loading\" && moduleDef.modules[k];\r\n\t\t\t_deps = mod && mod.deps;\r\n\r\n\t\t\tif (mod) {\r\n\t\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t\t}\r\n\r\n\t\t\tU.each(_deps, (dep) => {\r\n\t\t\t\tif (L.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} nameOrUrl\r\n * @param {Object} selfname\r\n * @param ifoneThenGet 如果没有找到(排除此模块)，且只有唯一的一个、且状态为loaded或defined、则返回该模块对象。获取的模块不等于此模块。\r\n */\r\nfunction getModule(nameOrUrl, selfname = null, ifoneThenGet = null) {\r\n\tnameOrUrl = U.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\tlet config = L.config();\r\n\tif (config && config.autoExt && /\\/[^\\/.]+$/.test(nameOrUrl)) { //自动后缀\r\n\t\tnameOrUrl += config.autoExtSuffix;\r\n\t}\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif (moduleDef) {\r\n\t\tlet module;\r\n\t\tif (isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif (selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (module == ifoneThenGet) {\r\n\t\t\tmodule = null;\r\n\t\t}\r\n\r\n\t\tif (!module && ifoneThenGet) {\r\n\t\t\tlet count = 0;\r\n\t\t\tlet mod = moduleDef.defaultModule;\r\n\t\t\tmod && mod != ifoneThenGet && count++;\r\n\t\t\tfor (let k in moduleDef.modules) {\r\n\t\t\t\tmod = moduleDef.modules[k];\r\n\t\t\t\tmod != ifoneThenGet && count++;\r\n\t\t\t}\r\n\t\t\tif (count == 1 && (mod.state == \"loaded\" || mod.state == \"defined\")) {\r\n\t\t\t\tmodule = mod;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name, index) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif (isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if (theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, true);\r\n\t\tdef._preIndex = index;\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif (!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if (theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif (moduleDef && !moduleDef.defaultModule) {\r\n\t\tif (moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor (let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif (!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif (moduleDef) {\r\n\t\tif (name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif (theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn &&\r\n\t\t\t\t!(lasfDef.modules[name] && lasfDef.modules[name].id == module.id)) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[\r\n\t\t\t\t\tname].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif (lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif (moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif (name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif (lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[\r\n\t\t\t\t\tname].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif (lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n\tappendLoadingModuleDeps\r\n};\r\n","import U from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst L = U.global.xsloader;\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, index = 0) {\r\n\r\n\tlet instanceModule = {\r\n\t\tindex,\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif (module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif (theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif (L.isObject(obj)) {\r\n\t\t\t\tif (module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : L.clone(obj));\r\n\t\t\t} else if (L.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tlet exports = {};\r\n\t\t\tthis._setDepModuleObjectGen(exports);\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_dealPluginArgs: function(pluginArgs) {\r\n\t\t\tif (this._object && this._object.dealPluginArgs) {\r\n\t\t\t\treturn this._object.dealPluginArgs.call(this.thiz, pluginArgs);\r\n\t\t\t} else {\r\n\t\t\t\tlet config = L.config();\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tU.replaceModulePrefix(config, argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t\treturn pluginArgs;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif (this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif (this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinitInstance: function(justForSingle, originPluginArgs) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\r\n\t\t\tlet pluginArgs = undefined;\r\n\t\t\tif (!L.isEmpty(originPluginArgs)) {\r\n\t\t\t\tpluginArgs = this._dealPluginArgs(originPluginArgs);\r\n\t\t\t} else {\r\n\t\t\t\tpluginArgs = originPluginArgs;\r\n\t\t\t}\r\n\r\n\t\t\tif (pluginArgs !== undefined) {\r\n\t\t\t\tif (!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif (this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif (justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif (result === undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif (this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new U.PluginError(err || false));\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif (this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !==\r\n\t\t\t\t\t\tundefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet args = [pluginArgs, onload, onerror, L.config()].concat(this.module.args);\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t//console.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif (!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif (!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" +\r\n\t\t\t\t\t\t\t\tmodule.selfname + \"!\" +\r\n\t\t\t\t\t\t\t\tpluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, L.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tindex,\r\n\t\tmodule: module,\r\n\t\tsrc: module.src,\r\n\t\tscriptSrc: module.scriptSrc,\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tselfname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//\tif(module.selfname == \"css\") {\r\n\t//\t\tconsole.log(\"absUrl=\" + instanceModule.thiz.absUrl() + \",invoker.absUrl=\" + instanceModule.thiz.invoker().absUrl());\r\n\t//\t}\r\n\r\n\t//\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _preNewModule(name, scriptSrc, thatInvoker, index) {\r\n\tlet src = U.removeQueryHash(scriptSrc);\r\n\tlet defineObject = new script.DefineObject(scriptSrc, src, null, [name, null, null]);\r\n\tdefineObject.ignoreCurrentRequireDep=false;\r\n\tdefineObject.index = index;\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(); //添加配置依赖，该模块对象是加载者、而不是define者\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tindex: defineObject.index || 0, //在上级依赖数组中所处的索引位置\r\n\t\tid: U.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tparent: defineObject.parentDefine,\r\n\t\tdescription() {\r\n\t\t\treturn `id=${this.id},selfname=${this.selfname || \"\"},src=${this.src}`;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\tignoreAspect: false,\r\n\t\targs: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tscriptSrc: defineObject.scriptSrc, //含地址参数\r\n\t\tabsUrlFromModule: () => defineObject.absUrlFromDefineObject(),\r\n\t\tgetCallback: () => defineObject.callback,\r\n\t\t_dealApplyArgs: (args) => args,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\texports: null,\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(newDefineObject) {\r\n\t\t\tthis.deps = newDefineObject.deps || [];\r\n\t\t\tthis.getCallback = () => newDefineObject.callback;\r\n\t\t\tdefineObject.ignoreCurrentRequireDep=newDefineObject.ignoreCurrentRequireDep;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif (this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif (willCache) {\r\n\t\t\t\tif (!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif (this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tignoreCurrentRequireDep() {\r\n\t\t\treturn defineObject.ignoreCurrentRequireDep;\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\targs = this._dealApplyArgs(args);\r\n\t\t\tthis.args = args;\r\n\t\t\tlet obj;\r\n\t\t\tif (L.isFunction(this.getCallback())) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.getCallback().apply(this.thiz, args);\r\n\t\t\t\t\tdefineObject.ignoreCurrentRequireDep = false;\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.getCallback();\r\n\t\t\t\tif (this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif (obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (this.loopObject) {\r\n\t\t\t\tif (!L.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor (let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif (this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif (_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif (fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.index);\r\n\t\t\t\t\t\tdepModule.initInstance(false, fun.pluginArgs);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && L.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif (deps && deps.length > 0) {\r\n\t\t\t\t\tL.require(deps, () => {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: this.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif (fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif (!this._callback()) {\r\n\t\t\t\twhile (this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif (this.refmodule) {\r\n\t\t\t\tthis.state = this.refmodule.state; //状态同步,保持与refmodule状态相同\r\n\t\t\t\treturn this.refmodule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\trefmodule: undefined, //引用指定模块\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.refmodule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile (theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\tthis.refmodule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif (this.relys.length || this.refmodule && this.refmodule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs, index) {\r\n\t\t\tif (this.refmodule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.refmodule.relyIt(thatInvoker, callbackFun, pluginArgs, index); //传递给refmodule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs,\r\n\t\t\t\tindex,\r\n\t\t\t};\r\n\t\t\tif (this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif (this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tnew script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif (opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif (L.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if (L.isObject(name)) {\r\n\t\t\t\t\tfor (let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tU.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor (let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (mobj._modules_) {\r\n\t\t\t\t\t\tU.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\r\n\t\tif (this.refmodule && this.refmodule.printOnNotDefined) {\r\n\t\t\tthis.refmodule.printOnNotDefined();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif (node.nodes.length) {\r\n\t\t\t\tU.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos, nodePaths) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tnodePaths.push(node);\r\n\t\t\tif (node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos, nodePaths);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.error(\r\n\t\t\t\"{-----------------------------------------------------------------------------------------------\");\r\n\t\tconsole.error(\"load module error:id=\" + this.id + \",\" + (this.selfname ? \"selfname=\" + this.selfname + \",\" :\r\n\t\t\t\t\"\") +\r\n\t\t\t\"my page=\" + location.href);\r\n\r\n\t\tlet logedPathMap = {};\r\n\t\tU.each(leafs, (leaf) => {\r\n\t\t\tlet infos = [];\r\n\t\t\tlet nodePaths = [];\r\n\t\t\tgenErrs(leaf, infos, nodePaths);\r\n\r\n\t\t\tif (nodePaths.length) {\r\n\t\t\t\tlet key = nodePaths[0].id + \"-\" + nodePaths[nodePaths.length - 1].id;\r\n\t\t\t\tif (logedPathMap[key]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlogedPathMap[key] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tfor (let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor (let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(`\\n-----[${this.id}]-->`));\r\n\t\t\t\tconsole.log(\"\");\r\n\t\t\t}\r\n\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif (leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\r\n\t\t\tif (errModule) {\r\n\r\n\t\t\t\tfunction getName(dep) {\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"/\");\r\n\t\t\t\t\treturn dep.substring(index + 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction getState(state) {\r\n\t\t\t\t\treturn state == \"defined\" ? state : \"【\" + (state || \"\") + \"】\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor (let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif (index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (i % 5 == 0) {\r\n\t\t\t\t\t\tas.push(\"\\t\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif (depMod) {\r\n\t\t\t\t\t\tas.push(getName(dep) + \":\" + getState(depMod.state));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(getName(dep) + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (i < errModule.deps.length - 1) {\r\n\t\t\t\t\t\tas.push(\",\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((i + 1) % 5 == 0) {\r\n\t\t\t\t\t\tas.push(\"\\n\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description());\r\n\t\t\t\tconsole.warn(\"deps state infos:{\");\r\n\t\t\t\tconsole.warn(as.join(\"\"));\r\n\t\t\t\tconsole.warn(\"}\");\r\n\t\t\t\tfor (let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif (index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif (depMod) {\r\n\t\t\t\t\t\tconsole.warn(\"[dep]\" + getName(dep) + \":\" + \"state=\" + getState(depMod.state) +\r\n\t\t\t\t\t\t\t\"\\n\\tsrc=\" + depMod.src +\r\n\t\t\t\t\t\t\t\"\\n\\tabsUrl=\" +\r\n\t\t\t\t\t\t\t(depMod\r\n\t\t\t\t\t\t\t\t.thiz && depMod.thiz.absUrl()));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(\"[dep]\" + getName(dep) + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.error(\r\n\t\t\t\"}-----------------------------------------------------------------------------------------------\");\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tid: this.id,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif (this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tU.each(this.deps, (dep) => {\r\n\t\t\tif (dep == \"exports\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif (indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif (!mod && dep.indexOf(\"/\") >= 0) {\r\n\t\t\t\tdep = this.thiz.getUrl(dep, false);\r\n\t\t\t\tmod = moduleDef.getModule(dep);\r\n\t\t\t}\r\n\r\n\t\t\tif (mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif (mod) {\r\n\t\t\t\tmod._printOnNotDefined && mod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tid: U.getAndIncIdCount(),\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif (defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径,此时模块的依赖已经全部处理好了\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = L.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_of_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tlet isFinish = /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError;\r\n\t\tlet customerResult;\r\n\r\n\t\tif (isFinish) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if (isError) {\r\n\t\t\tif (!hasCallErr) {\r\n\t\t\t\tlet err = new U.PluginError(isError, invoker_of_module, {\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t});\r\n\t\t\t\tcustomerResult = errCallback(err, invoker_of_module);\r\n\t\t\t\tif (customerResult && customerResult.ignoreErrState) {\r\n\t\t\t\t\tif (customerResult.onGetModule) {\r\n\t\t\t\t\t\tmodule.moduleObject = customerResult.onGetModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isFinish) {\r\n\t\t\t\t\t\teveryOkCallback(depModules, module);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\thasCallErr = true;\r\n\t\t\t\t\tmodule.setState('error', isError);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!isError && syncHandle) {\r\n\t\t\tsyncHandle();\r\n\t\t}\r\n\t\treturn customerResult;\r\n\t}\r\n\r\n\tU.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\t//\t\tif(L.startsWith(dep, \"css!\")) {\r\n\t\t//\t\t\tconsole.log(\"src=\" + module.src + \",absUrl=\" + invoker_of_module.absUrl() + \",absolute=\" + invoker_of_module.src());\r\n\t\t//\t\t}\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif (pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tlet dmod = moduleDef.getModule(dep);\r\n\t\t\tif (!dmod) {\r\n\t\t\t\tconsole.warn(`not found module define: dep=${dep}`);\r\n\t\t\t}\r\n\r\n\t\t\tdmod.relyIt(invoker_of_module, function(depModule, err) {\r\n\t\t\t\tif (!err) {\r\n\t\t\t\t\tdepCount--;\r\n\t\t\t\t\tif (dep == \"exports\") {\r\n\t\t\t\t\t\tif (theExports) {\r\n\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmodule.exports = theExports;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisError = err;\r\n\t\t\t\t}\r\n\t\t\t\tlet customerResult = checkFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\tif (customerResult && customerResult.ignoreErrState) {\r\n\t\t\t\t\tisError = false;\r\n\t\t\t\t\tif (customerResult.onFinish) {\r\n\t\t\t\t\t\tcustomerResult.onFinish();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, pluginArgs, index);\r\n\t\t};\r\n\r\n\t\tif (!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = U.isJsFile(dep);\r\n\t\t\tdo {\r\n\t\t\t\tlet urls;\r\n\t\t\t\tif (!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif (i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif (i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = L.resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = L.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if (config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if (isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (config.autoExt && /\\/[^\\/.]+$/.test(dep)) { //自动后缀，需要后台支持\r\n\t\t\t\t\t\turls = [dep + config.autoExtSuffix];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\turls = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif (urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep, index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tU.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif (L.startsWith(url, \".\") || L.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif (!invoker_of_module.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = U.getPathWithRelative(invoker_of_module.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = U.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif (absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (urls[index] == dep) {\r\n\t\t\t\t\t\t\tdep = url; //替换为绝对路径\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url, true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!isError && urls.length) {\r\n\t\t\t\t\tU.replaceModulePrefix(config, urls); //前缀替换\r\n\r\n\t\t\t\t\tif (isJsFile) {\r\n\t\t\t\t\t\tlet lastModule;\r\n\t\t\t\t\t\tU.each([dep].concat(urls), (item) => {\r\n\t\t\t\t\t\t\tlastModule = moduleDef.getModule(item);\r\n\t\t\t\t\t\t\tif (lastModule) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (lastModule) { //已经被加载过,在dep最初为相对地址、接着变成绝对地址、且该模块被多个其他模块依赖时会出现这种情况\r\n\t\t\t\t\t\t\tdep = lastModule.src;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _preNewModule(m2Name, urls[0], invoker_of_module, index);\r\n\t\t\t\t\tmoduleDef.setModule(null, module2); //直接通过地址加载的设置默认模块\r\n\t\t\t\t\tmodule2.setState(\"loading\"); //只有此处才设置loading状态\r\n\r\n\t\t\t\t\tlet configDeps = [];\r\n\t\t\t\t\tif (m2Name) {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(m2Name);\r\n\t\t\t\t\t\tU.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif (L.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tU.each(urls, (url) => {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(url);\r\n\t\t\t\t\t\tU.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif (L.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (configDeps.length) {\r\n\t\t\t\t\t\t//先加载配置依赖\r\n\t\t\t\t\t\tL.require(configDeps, () => {\r\n\t\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif (index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif (index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = U.removeQueryHash(url);\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\tlet defaultMod;\r\n\t\t\t\t\t\t\tif (module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块或者唯一的模块\r\n\t\t\t\t\t\t\t\t//(唯一的模块用于支持：脚本里只有一个define、且指定了模块名、且此处的模块名与其自己指定了不相等)\r\n\t\t\t\t\t\t\t\tdefaultMod = moduleDef.getModule(module2.src, null, module2);\r\n\t\t\t\t\t\t\t\tif (defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!defaultMod && module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//isError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//errCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tisError = e;\r\n\t\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif (index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif (!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};\r\n","import U from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst L = U.global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+)\\s+safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || U.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = U.removeQueryHash(U.getNodeAbsolutePath(theLoaderScript));\r\nconst thePageUrl = U.thePageUrl;\r\nconst theHead = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif (this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastSrc = thePageUrl;\r\nlet lastScriptSrc = location.href;\r\n\r\nlet theRealDefine;\r\nif (safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps, defineObject) {\r\n\tfor (let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif (L.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif (dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\tabsUrl: defineObject.absUrlFromDefineObject(),\r\n\t\t\t\torderDep: isOrderDep,\r\n\t\t\t\tsrc: defineObject.src,\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif (pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\nclass Handle {\r\n\tdefineObject;\r\n\tconstructor(defineObject) {\r\n\t\tthis.defineObject = defineObject;\r\n\t}\r\n\r\n\tthen(option) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle = L.extend(defineObject.handle, option);\r\n\t\treturn this;\r\n\t}\r\n\terror(onError) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle.onError = onError;\r\n\t\treturn this;\r\n\t}\r\n\tonError(err, invoker) {\r\n\t\treturn this.defineObject.handle.onError(err, invoker);\r\n\t}\r\n}\r\n\r\nclass ThisInvoker {\r\n\tinvoker;\r\n\tconstructor(invoker) {\r\n\t\tthis.invoker = invoker;\r\n\t}\r\n}\r\n\r\nfunction _buildInvoker(module) {\r\n\tlet invoker = module[\"thiz\"];\r\n\tmodule = module.module || module;\r\n\tlet id = L.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tif (optionalAbsUrl && !U.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\r\n\t\tlet url;\r\n\t\tif (relativeUrl === undefined) {\r\n\t\t\turl = this.src();\r\n\t\t} else if (L.startsWith(relativeUrl, \".\") || U.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = U.getPathWithRelative(optionalAbsUrl || this.absUrl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\tlet config = L.config();\r\n\t\t\tlet argArr = [relativeUrl];\r\n\t\t\tU.replaceModulePrefix(config, argArr); //前缀替换\r\n\r\n\t\t\tif (L.startsWith(argArr[0], relativeUrl)) {\r\n\t\t\t\turl = L.config().baseUrl + relativeUrl;\r\n\t\t\t} else {\r\n\t\t\t\turl = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (appendArgs) {\r\n\t\t\tif (url == thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn L.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.getUrl2 = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tlet url = this.getUrl(relativeUrl, false, optionalAbsUrl);\r\n\t\tif (appendArgs) {\r\n\t\t\treturn L.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\r\n\tinvoker.appendArgs = function(url, forArgsUrl = U.global.location.href) {\r\n\t\tlet urlArgs = L.config().getUrlArgs(module, forArgsUrl);\r\n\t\treturn L.appendArgs2Url(url, urlArgs);\r\n\t};\r\n\r\n\tinvoker.require = function() {\r\n\t\t//\t\tconsole.log(\"this.require:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0]);\r\n\t\tlet h = L.require.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif (h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.require.get = function(name) {\r\n\t\treturn L.require.get.apply(new ThisInvoker(invoker), [name]);\r\n\t};\r\n\r\n\tinvoker.define = function() {\r\n\t\t//\t\tconsole.log(\"this.define:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0] + (typeof arguments[0] == \"string\" ? (\",args[1]=\" + arguments[1]) : \"\"));\r\n\t\tlet h = L.define.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif (h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrlFromDefineObject() || this.absUrl();\r\n\t};\r\n\r\n\t//deprecated\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = invoker.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\r\n\tinvoker.withAbsUrl = function(absUrlStr) {\r\n\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tget src() {\r\n\t\t\t\treturn invoker.src();\r\n\t\t\t},\r\n\t\t\tset src(val) {\r\n\t\t\t\tthrow \"not support!\";\r\n\t\t\t},\r\n\t\t\tget scriptSrc() {\r\n\t\t\t\treturn invoker.scriptSrc();\r\n\t\t\t},\r\n\t\t\tset scriptSrc(val) {\r\n\t\t\t\tthrow \"not support!\";\r\n\t\t\t},\r\n\t\t\tabsUrl: () => {\r\n\t\t\t\tlet url = absUrlStr || invoker.absUrl();\r\n\t\t\t\treturn url;\r\n\t\t\t},\r\n\t\t\tabsUrlFromModule() {\r\n\t\t\t\treturn this.absUrl();\r\n\t\t\t},\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\treturn new Invoker(moduleMap);\r\n\t};\r\n}\r\n\r\nclass Invoker {\r\n\t_im;\r\n\t_id;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new L.InVar(moduleMap);\r\n\t\tthis._id = U.getAndIncIdCount();\r\n\t\tmoduleMap.thiz = this;\r\n\t\t_buildInvoker(moduleMap);\r\n\t}\r\n\r\n\tgetId() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址（弃用）\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址(不含地址参数)\r\n\t */\r\n\tsrc() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址(含地址参数)\r\n\t */\r\n\tscriptSrc() {\r\n\t\treturn this._im.get().scriptSrc;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取在上级依赖数组中的索引位置\r\n\t */\r\n\tgetIndex() {\r\n\t\treturn this._im.get().index;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取当前调用者的调用者\r\n\t */\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrlFromModule();\r\n\t}\r\n\r\n\texports() {\r\n\t\treturn this._im.get().exports;\r\n\t}\r\n\r\n\troot() {\r\n\t\tlet p = this.invoker();\r\n\t\treturn p ? p.invoker() : this;\r\n\t}\r\n}\r\n\r\nfunction getMineInvoker(thiz) {\r\n\tif (thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if (thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if (thiz instanceof DefineObject) {\r\n\t\treturn thiz.thiz;\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = true) {\r\n\tif (thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if (thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if (thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else {\r\n\t\tlet parentModule = currentDefineModuleQueue.peek();\r\n\t\tif (parentModule) {\r\n\t\t\treturn parentModule.thiz;\r\n\t\t} else if (nullNew) {\r\n\t\t\tlet moduleMap = {\r\n\t\t\t\tmodule: \"\",\r\n\t\t\t\tsrc: thePageUrl,\r\n\t\t\t\tscriptSrc: location.href,\r\n\t\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\t\tname: \"__root__\",\r\n\t\t\t\tinvoker: null\r\n\t\t\t};\r\n\t\t\treturn new Invoker(moduleMap);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tid = U.getAndIncIdCount();\r\n\tthiz;\r\n\tisRequire;\r\n\t_scriptSrc;\r\n\t_src;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\t_directDepLength = 0;\r\n\tdirectDepLength = 0;\r\n\tnames = [];\r\n\tindex;\r\n\tignoreCurrentRequireDep;\r\n\tconstructor(scriptSrc, src, thiz, args = [], isRequire = false /*, willDealConfigDeps = false*/ ) {\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tthis.ignoreCurrentRequireDep = !U.isLoaderEnd() || L.__ignoreCurrentRequireDep || this.parentDefine && this\r\n\t\t\t.parentDefine.ignoreCurrentRequireDep() || false;\r\n\r\n\t\tthis.scriptSrc = scriptSrc;\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.handle = {\r\n\t\t\tonError(err, invoker) {\r\n\t\t\t\tconsole.error(U.unwrapError(err));\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\r\n\t\tif (thiz instanceof ThisInvoker) {\r\n\t\t\t//this.handle.absUrl = thiz.invoker.src(); //设置默认参考地址\r\n\t\t\tthis.src = thiz.invoker.src();\r\n\t\t}\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif (args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if (typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif (deps && !L.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif (!deps) {\r\n\t\t\tdeps = [];\r\n\t\t} else {\r\n\t\t\tdeps = L.clone(deps);\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\tif (!this.ignoreCurrentRequireDep) {\r\n\t\t\tU.appendInnerDeps(deps, callback);\r\n\t\t}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.pushName(selfname);\r\n\t\tthis.callback = callback;\r\n\t\tthis._directDepLength = deps.length;\r\n\t\tthis.directDepLength = deps.length;\r\n\t}\r\n\r\n\tget src() {\r\n\t\treturn this._src;\r\n\t}\r\n\tset src(val) {\r\n\t\tthis._src = val;\r\n\t}\r\n\r\n\tget scriptSrc() {\r\n\t\treturn this._scriptSrc;\r\n\t}\r\n\r\n\tset scriptSrc(val) {\r\n\t\tthis._scriptSrc = val;\r\n\t}\r\n\r\n\tpushName(name) {\r\n\t\tif (name && L.indexInArray(this.names, name) == -1) {\r\n\t\t\tthis.names.push(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理配置依赖及嵌套依赖,同时会替换前缀\r\n\t */\r\n\tappendConfigDepsAndEmbedDeps(module) {\r\n\t\tlet config = L.config();\r\n\t\tlet src = this.src;\r\n\t\tlet deps = this.deps;\r\n\r\n\t\tlet _deps = config.getDeps(src);\r\n\t\tU.each(_deps, (dep) => {\r\n\t\t\tif (L.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tU.each(this.names, (name) => {\r\n\t\t\t_deps = config.getDeps(name);\r\n\t\t\tU.each(_deps, (dep) => {\r\n\t\t\t\tif (L.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (this.handle.orderDep && this._directDepLength > 1 && deps.length > this._directDepLength) {\r\n\t\t\tlet odeps = [true]; //第一个true表示顺序依赖\r\n\t\t\twhile (this._directDepLength-- > 0) {\r\n\t\t\t\todeps.push(deps.shift());\r\n\t\t\t}\r\n\t\t\tdeps.unshift(odeps);\r\n\t\t\tthis.handle.orderDep = false;\r\n\t\t}\r\n\r\n\t\t_dealEmbedDeps(deps, this); //处理嵌套依赖\r\n\r\n\t\t//替换项目别名；另见：prerequire\r\n\t\tfor (let i = 0; i < deps.length; i++) {\r\n\t\t\tlet dep = deps[i];\r\n\t\t\tdeps[i] = config.replaceDepAlias(deps[i]);\r\n\t\t}\r\n\r\n\t\tU.replaceModulePrefix(config, deps); //前缀替换\r\n\r\n\t\tif (module) {\r\n\t\t\tmodule.deps = deps;\r\n\t\t\tmodule._dealApplyArgs = (function(directDepLength, hasOrderDep) {\r\n\t\t\t\treturn function(applyArgs) {\r\n\t\t\t\t\tif (directDepLength == 0 || applyArgs.length == 0) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//顺序依赖,还原成最初的顺序,移除额外的依赖。\r\n\t\t\t\t\tlet args = new Array(directDepLength + 1);\r\n\t\t\t\t\tif (hasOrderDep) {\r\n\t\t\t\t\t\targs = applyArgs[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (var i = 0; i < directDepLength; i++) {\r\n\t\t\t\t\t\t\targs[i] = applyArgs[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\targs[directDepLength] = applyArgs[applyArgs.length - 1].slice(0,\r\n\t\t\t\t\t\t\tdirectDepLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t})(this.directDepLength, this.directDepLength > 0 && this._directDepLength <= 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor (let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = U.isJsFile(m);\r\n\r\n\t\t\t//替换相对路径为绝对路径\r\n\t\t\tif (jsFilePath && L.startsWith(m, \".\")) {\r\n\t\t\t\tm = U.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\tdeps[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\tlet paths = U.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif (paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrlFromDefineObject() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl || this.src;\r\n\t}\r\n\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n */\r\nlet hasCurrentPath = false;\r\n\r\nfunction getCurrentScript() {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif (document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif (node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (U.IE_VERSION > 0 && U.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\t//\t\t\tU.each(nodes, (node) => {\r\n\t\t\t//\t\t\t\tconsole.log(\"node.src=\" + node.src + \",node.readyState=\" + node.readyState);\r\n\t\t\t//\t\t\t});\r\n\t\t\tfor (let i = nodes.length - 1; i >= 0; i--) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif (node.readyState === \"interactive\" && node.src) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch (e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif (!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs;\r\n\tlet parentDefine = currentDefineModuleQueue.peek();\r\n\tif (parentDefine) {\r\n\t\trs = {\r\n\t\t\tsrc: parentDefine.src\r\n\t\t};\r\n\t} else {\r\n\t\trs = _getCurrentScriptOrSrc();\r\n\t}\r\n\r\n\tif (!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif (U.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif (!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = U.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor (let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif (src == U.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (rs.node) {\r\n\t\tlet __src = rs.node.getAttribute(\"_current_path_src_\");\r\n\t\trs.src = __src || U.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\r\n\thasCurrentPath = !!L.__currentPath;\r\n\r\n\tif (hasCurrentPath) {\r\n\t\tlet oldSrc = rs.src;\r\n\t\trs.srcBeforeCurrentPath = U.removeQueryHash(oldSrc);\r\n\t\trs.__currentPath = L.__currentPath;\r\n\t\trs.src = L.getPathWithRelative(oldSrc, L.__currentPath, false);\r\n\t\trs.src = L.appendArgs2Url(rs.src, oldSrc);\r\n\t\tL.__currentPath = undefined;\r\n\r\n\t\tif (rs.srcBeforeCurrentPath != U.removeQueryHash(rs.src)) {\r\n\t\t\trs.node.setAttribute(\"_current_path_src_\", rs.src);\r\n\t\t}\r\n\t}\r\n\r\n\trs.scriptSrc = rs.src;\r\n\trs.src = U.removeQueryHash(rs.src);\r\n\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = \"async\";\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif (node.detachEvent && !isOpera) {\r\n\t\tif (ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !L.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif (useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tappendHeadDom(node);\r\n\tif (U.IE_VERSION > 0 && U.IE_VERSION <= 10) {\r\n\t\tL.asyncCall(() => {\r\n\t\t\tnode.src = url; //在ie10-以下，必须在脚本插入head后再进行src的设置、且需要异步设置。\r\n\t\t});\r\n\t} else {\r\n\t\tnode.src = url;\r\n\t}\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\tlet scriptSrc = node && U.getNodeAbsolutePath(node);\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: U.removeQueryHash(scriptSrc),\r\n\t\tscriptSrc,\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif (!L.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\ttheHead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif (callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif (isSrcFromScriptLoad) {\r\n\t\t\t\tlastSrc = scriptData.src; //已经不含参数\r\n\t\t\t\tlastScriptSrc = scriptData.lastScriptSrc;\r\n\t\t\t\tL.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (U.IE_VERSION > 0 || U.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\tL.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t\tL.__ignoreCurrentRequireDep = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\tL.__ignoreCurrentRequireDep = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif (callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\t//\tconsole.log(\"**********************************[\");\r\n\tlet rs = getCurrentScript(); //已经不含参数\r\n\r\n\t//\tif(typeof args[0] == \"string\") {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",args[1]=\" + args[1] + \",src=\" + rs.src);\r\n\t//\t} else {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",src=\" + rs.src);\r\n\t//\t}\r\n\t//\tconsole.log(rs.node);\r\n\t//\tconsole.log(\"**********************************]\\n\");\r\n\tlet src = rs.src;\r\n\tlet scriptSrc = rs.scriptSrc;\r\n\tlet defineObject = new DefineObject(scriptSrc, src, thiz, args, isRequire);\r\n\tdefineObject.srcBeforeCurrentPath = rs.srcBeforeCurrentPath; //处理__currentPath前的\r\n\r\n\tif (!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif (defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif (node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + L.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tL.config().error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tlet handle = new Handle(defineObject);\r\n\r\n\tlet isLoaderEnd = U.isLoaderEnd();\r\n\tL.asyncCall(() => {\r\n\t\tif (isSrcFromScriptLoad && isLoaderEnd && !hasCurrentPath) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastSrc;\r\n\t\t\tdefineObject.lastScriptSrc = lastScriptSrc;\r\n\t\t}\r\n\t\thasCurrentPath = false;\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nlet isFirstRequire = true;\r\n\r\nfunction prerequire(deps, callback) {\r\n\tlet config = L.config();\r\n\tif (!config) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\r\n\tlet thatInvoker = getInvoker(this);\r\n\tif (arguments.length == 1 && L.isString(deps)) { //获取已经加载的模块\r\n\t\tif (deps == \"exports\") { //当require(\"exports\")时，必须依赖了exports\r\n\t\t\tlet mineInvoker = getMineInvoker(this);\r\n\t\t\tlet exports = mineInvoker && mineInvoker.exports();\r\n\t\t\tif (!exports) {\r\n\t\t\t\tthrow new Error(\"not found exports\");\r\n\t\t\t} else {\r\n\t\t\t\treturn exports;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet originDep = deps;\r\n\t\tlet oneDep = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = oneDep.indexOf(\"!\");\r\n\t\tif (pluginIndex > 0) {\r\n\t\t\tpluginArgs = oneDep.substring(pluginIndex + 1);\r\n\t\t\toneDep = oneDep.substring(0, pluginIndex);\r\n\t\t}\r\n\r\n\t\toneDep = config.replaceDepAlias(oneDep);\r\n\r\n\t\tlet module = moduleScript.getModule(oneDep);\r\n\t\tif (!module) {\r\n\t\t\toneDep = thatInvoker.getUrl(oneDep, false);\r\n\t\t\tmodule = moduleScript.getModule(oneDep);\r\n\t\t}\r\n\r\n\t\tif (!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDep + \"' is not load!\");\r\n\t\t} else if (module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDep + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}).initInstance(true, pluginArgs);\r\n\r\n\t\tif (theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDep + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = L.randId(\"_require\");\r\n\tif (L.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t} else if (!L.isArray(deps)) {\r\n\t\tthrow new Error(\"unexpected argument:\" + deps);\r\n\t}\r\n\tU.appendInnerDeps(deps, callback);\r\n\r\n\tlet timeid;\r\n\tlet tagString;\r\n\tlet loading;\r\n\tlet isOk = false;\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\tif (isFirstRequire && config.plugins.loading.enable) {\r\n\t\tisFirstRequire = false;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (!isOk) {\r\n\t\t\t\tloading = new U.ToProgress(config.plugins.loading);\r\n\t\t\t\tloading.autoIncrement();\r\n\t\t\t\tif (isErr) {\r\n\t\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t\t\tloading = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config.plugins.loading.delay);\r\n\t}\r\n\tlet clearTimer = function(isErr = false) {\r\n\t\tif (loading) {\r\n\t\t\tif (isErr) {\r\n\t\t\t\tloading.toError(config.plugins.loading.errColor);\r\n\t\t\t} else {\r\n\t\t\t\tloading.stopAuto();\r\n\t\t\t\tloading.finish();\r\n\t\t\t}\r\n\t\t\tloading = null;\r\n\t\t}\r\n\t\tif (timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tisOk = true;\r\n\t\tclearTimer();\r\n\t\t//\t\tconsole.log(\"2======require:\"+selfname);\r\n\t\t//\t\tconsole.log(callback);\r\n\t\tif (L.isFunction(callback)) {\r\n\t\t\ttry {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t} catch (e) {\r\n\t\t\t\thandle.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}], true);\r\n\thandle.waitTime = config.waitSeconds * 1000;\r\n\r\n\thandle.logError = function(err, invoker, logFun = \"error\") {\r\n\t\tinvoker && console[logFun](\"invoker.url=\", invoker.getUrl());\r\n\t\tthatInvoker && console[logFun](\"require.invoker.url=\", thatInvoker.getUrl());\r\n\t\tconsole[logFun](U.unwrapError(err));\r\n\t};\r\n\r\n\tlet checkResultFun = (forTimeout = false) => {\r\n\t\ttry {\r\n\t\t\tif (!checkResultFun) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\t\t//console.log(isErr)\r\n\t\t\tif ((!ifmodule || ifmodule.state != 'defined') && (isErr || forTimeout)) {\r\n\r\n\t\t\t\tif (forTimeout) {\r\n\t\t\t\t\thandle.onError(\r\n\t\t\t\t\t\t`require timeout:${tagString?'tag='+tagString:''},\\n` +\r\n\t\t\t\t\t\t`\\tdeps=[${deps ? deps.join(\",\") : \"\"}]\\n` +\r\n\t\t\t\t\t\t`${thatInvoker?'\\tinvokerSrc='+thatInvoker.src():''}`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ifmodule) {\r\n\t\t\t\t\tU.each(ifmodule.deps, (dep) => {\r\n\t\t\t\t\t\tif (thatInvoker) {\r\n\t\t\t\t\t\t\tdep = thatInvoker.getUrl(dep, false);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\t\tif (mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t\tclearTimer();\r\n\t};\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tclearTimer(true);\r\n\t\tif (customerErrCallback) {\r\n\t\t\tlet result = customerErrCallback.call(handle, err, invoker);\r\n\t\t\tif (result && result.ignoreErrState) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tisErr = !!err;\r\n\t\ttry {\r\n\t\t\thandle.logError(err, invoker);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\r\n\t\tif (checkResultFun) {\r\n\t\t\tlet fun = checkResultFun;\r\n\t\t\tcheckResultFun = null;\r\n\t\t\tfun();\r\n\t\t}\r\n\t});\r\n\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\thandle.setTag = function(tag) {\r\n\t\ttagString = tag;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tif (handle.waitTime) {\r\n\t\ttimeid = setTimeout(() => {\r\n\t\t\tcheckResultFun(true)\r\n\t\t}, handle.waitTime);\r\n\t}\r\n\r\n\tif (typeof Promise != \"undefined\" && arguments.length == 1 && !callback) {\r\n\t\tlet promise = new Promise((resolve, inject) => {\r\n\t\t\tcallback = function() {\r\n\t\t\t\tif (deps.length == 1) {\r\n\t\t\t\t\tresolve(arguments[0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor (var i = 0; i < deps.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\thandle.error((err) => {\r\n\t\t\t\tcallback = null;\r\n\t\t\t\tinject(err);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn promise;\r\n\t}\r\n\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\n//initDefine在../define.js里进行初始化\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif (!L.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile (globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\tlastAppendHeadDom: function() {\r\n\t\treturn lastAppendHeadDom;\r\n\t},\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\thead: function() {\r\n\t\treturn theHead;\r\n\t},\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tHandle,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};\r\n","import loader from './loader.js';\r\nimport \"../public/index.js\";\r\nimport U from \"../util/index.js\";\r\n\r\nconst L = U.global.xsloader;\r\n\r\nimport script from \"./script.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nlet theContext;\r\nlet theConfig;\r\nlet argsObject = {};\r\n\r\nL.config = function() {\r\n\treturn theConfig;\r\n};\r\nL.script = function() {\r\n\treturn script.theLoaderScript;\r\n};\r\n\r\nL.lastAppendHeadDom = function() {\r\n\treturn script.lastAppendHeadDom();\r\n};\r\n\r\nL.scriptSrc = function() {\r\n\treturn script.theLoaderUrl;\r\n};\r\n\r\nL.putUrlArgs = function(argsObj) {\r\n\targsObject = L.extend(argsObject, argsObj);\r\n};\r\n\r\nL.getUrlArgs = function() {\r\n\tlet obj = L.extend({}, argsObject);\r\n\treturn obj;\r\n};\r\n\r\nL.clearUrlArgs = function() {\r\n\targsObject = {};\r\n};\r\n\r\nL.appendHeadDom = script.appendHeadDom;\r\n\r\nL.hasDefine = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif (!module || module.state === undefined //可能是preDependModule：预依赖模块\r\n\t\t||\r\n\t\tmodule.state == \"init\") {\r\n\t\thas = false;\r\n\t} else {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\nL.hasDefined = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif (module && module.state == \"defined\") {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\r\nL.resUrlBuilder = function(groupName) {\r\n\tthrow new Error('resUrlBuilder not found!');\r\n};\r\n\r\nL.clear_module_ = function() {\r\n\tlet modules = arguments;\r\n\tfor (let i = 0; i < modules.length; i++) {\r\n\t\tif (modules[i]) {\r\n\t\t\tdelete modules[i]._module_;\r\n\t\t\tdelete modules[i]._modules_;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction _newContext() {\r\n\tlet context = {\r\n\t\tcontextName: script.contextName,\r\n\t\tdefQueue: []\r\n\t};\r\n\treturn context;\r\n}\r\n\r\nloader.loaderFun((option) => {\r\n\tif (theContext) {\r\n\t\tthrow new Error(\"already configed!\");\r\n\t}\r\n\toption = L.extend({\r\n\t\tbaseUrl: U.getPathWithRelative(location.pathname, \"./\", L.endsWith(location.pathname, \"/\")),\r\n\t\turlArgs: {},\r\n\t\tignoreProperties: false,\r\n\t\tpaths: {},\r\n\t\tdepsPaths: {},\r\n\t\taliasPaths: {},\r\n\t\tdeps: {},\r\n\t\tjsExts: undefined,\r\n\t\tautoExt: true,\r\n\t\tautoExtSuffix: \".*\",\r\n\t\tproperties: {},\r\n\t\tmodulePrefix: {},\r\n\t\tdefineFunction: {},\r\n\t\tmodulePrefixCount: 0,\r\n\t\twaitSeconds: 20,\r\n\t\tautoUrlArgs() {\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tinstance: \"single\",\r\n\t\tdealtDeps: {},\r\n\t\tdealProperties(obj) {\r\n\t\t\treturn U.propertiesDeal(obj, option.properties);\r\n\t\t},\r\n\t\tisInUrls(m) {\r\n\t\t\treturn !!this.getUrls(m);\r\n\t\t},\r\n\t\tgetUrls(m) {\r\n\t\t\treturn this.paths[m] || this.depsPaths[m];\r\n\t\t},\r\n\t\tgetDeps(m) {\r\n\t\t\tlet as = this.dealtDeps[m] || [];\r\n\t\t\tlet deps = [];\r\n\t\t\tlet hasOrderDep = undefined;\r\n\r\n\t\t\tif (as.length > 0 && (as[0] === true || as[0] === false)) {\r\n\t\t\t\tif (as[0]) {\r\n\t\t\t\t\tdeps = [\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t];\r\n\t\t\t\t\thasOrderDep = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tas.splice(0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i = 0; i < as.length; i++) {\r\n\t\t\t\tif (hasOrderDep === true) {\r\n\t\t\t\t\tdeps[0].push(as[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeps.push(as[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deps;\r\n\t\t},\r\n\t\tdealUrl(module, url, addVersion = false) {\r\n\t\t\tlet urlArgs;\r\n\t\t\tlet index = url.indexOf(\"?\");\r\n\t\t\tif (index > 0) {\r\n\t\t\t\tlet index2 = url.indexOf(\"#\", index);\r\n\t\t\t\turlArgs = url.substring(index + 1, index2 > 0 ? index2 : url.length);\r\n\t\t\t}\r\n\r\n\t\t\tlet newUrlArgs = this.getUrlArgs(module, url, addVersion);\r\n\t\t\tlet newUrl = L.appendArgs2Url(url, newUrlArgs);\r\n\t\t\tif (urlArgs) {\r\n\t\t\t\tnewUrl = L.appendArgs2Url(url, urlArgs);\r\n\t\t\t}\r\n\r\n\t\t\treturn newUrl;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取待添加的参数\r\n\t\t */\r\n\t\tgetUrlArgs(module, url, addVersion = false) {\r\n\t\t\tlet urlArg;\r\n\t\t\tlet nameOrUrl;\r\n\t\t\tif (this.autoUrlArgs()) {\r\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\r\n\t\t\t} else {\r\n\t\t\t\tlet moduleName;\r\n\t\t\t\tlet src;\r\n\t\t\t\tif (L.isString(module)) {\r\n\t\t\t\t\tmoduleName = module;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleName = module.selfname;\r\n\t\t\t\t\tsrc = module.src;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//精确匹配优先\r\n\r\n\t\t\t\t//先尝试模块名\r\n\t\t\t\turlArg = this.urlArgs[moduleName];\r\n\t\t\t\tif (!urlArg) {\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(moduleName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//再尝试提供的url\r\n\t\t\t\tif (!urlArg && url) {\r\n\t\t\t\t\turlArg = this.urlArgs[url];\r\n\t\t\t\t\tif (!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(url);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//接着尝试模块src\r\n\t\t\t\tif (!urlArg && src) {\r\n\t\t\t\t\turlArg = this.urlArgs[src];\r\n\t\t\t\t\tif (!urlArg) {\r\n\t\t\t\t\t\turlArg = this.forPrefixSuffix(src);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//最后尝试通用的\r\n\t\t\t\tif (!urlArg) {\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (L.isFunction(urlArg)) {\r\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\r\n\t\t\t}\r\n\r\n\t\t\tif (!urlArg) {\r\n\t\t\t\turlArg = \"\";\r\n\t\t\t}\r\n\r\n\t\t\tfor (let k in argsObject) { //加入全局的参数\r\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\r\n\t\t\t}\r\n\r\n\t\t\tif (addVersion && this.props.addVersion) {\r\n\t\t\t\turlArg += \"&_xsv=\" + encodeURIComponent(L.env.version);\r\n\t\t\t}\r\n\r\n\t\t\treturn urlArg;\r\n\t\t},\r\n\t\tdealUrlArgs(url) {\r\n\t\t\turl = U.getPathWithRelative(location.href, url);\r\n\t\t\treturn this.dealUrl(url, url);\r\n\t\t},\r\n\t\t/**\r\n\t\t * 替换模块别名\r\n\t\t * @param {Object} dep 不以\".\"开头\r\n\t\t */\r\n\t\treplaceDepAlias(dep) {\r\n\t\t\tif (!L.startsWith(dep, '.') && this.aliasPaths[dep]) {\r\n\t\t\t\tdep = this.aliasPaths[dep];\r\n\t\t\t}\r\n\r\n\t\t\treturn dep;\r\n\t\t},\r\n\t\tdefaultVersion: {},\r\n\t\tplugins: {},\r\n\t\tprops: {},\r\n\t}, option);\r\n\r\n\toption.props = L.extend({\r\n\t\taddVersion: true,\r\n\t\tinnerDepType: \"auto\", //auto,require.get,require,disable\r\n\t}, option.props);\r\n\r\n\toption.plugins.loading = L.extend({\r\n\t\tenable: true,\r\n\t\tcolor: '#2196f3',\r\n\t\tbgColor: 'rgba(0,0,0,0.1)',\r\n\t\terrColor: '#f5222d',\r\n\t\tduration: 0.2,\r\n\t\theight: 1,\r\n\t\tdelay: 500,\r\n\t}, option.plugins.loading);\r\n\r\n\tif (L.domAttr(script.theLoaderScript, \"disable-loading\") !== undefined) {\r\n\t\toption.plugins.loading.enable = false;\r\n\t}\r\n\r\n\toption.plugins.image = L.extend({\r\n\t\ttimeout: 10000, //超时时间，毫秒\r\n\t}, option.plugins.image);\r\n\r\n\toption.plugins.xsmsg = L.extend({\r\n\t\ttimeout: 30000, //连接超时时间，毫秒\r\n\t\tsleep: 500, //连接检测的休眠时间，毫秒\r\n\t}, option.plugins.xsmsg);\r\n\r\n\toption.plugins.ifmsg = L.extend({\r\n\t\tconnTimeout: 30000, //连接超时时间，毫秒\r\n\t\tsleepTimeout: 20, //连接检测的休眠时间，毫秒\r\n\t}, option.plugins.ifmsg);\r\n\r\n\tif (!L.endsWith(option.baseUrl, \"/\")) {\r\n\t\toption.baseUrl += \"/\";\r\n\t}\r\n\toption.baseUrl = U.getPathWithRelative(location.href, option.baseUrl);\r\n\r\n\tif (!option.ignoreProperties) {\r\n\t\toption = option.dealProperties(option);\r\n\t}\r\n\r\n\tU.strValue2Arr(option.paths);\r\n\tU.strValue2Arr(option.depsPaths);\r\n\tU.strValue2Arr(option.deps);\r\n\r\n\tif (!L.isFunction(option.autoUrlArgs)) {\r\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\r\n\t\toption.autoUrlArgs = function() {\r\n\t\t\treturn isAutoUrlArgs;\r\n\t\t};\r\n\t}\r\n\r\n\tlet modulePrefixCount = 0;\r\n\tfor (let prefix in option.modulePrefix) {\r\n\t\tif (L.startsWith(prefix, \".\") || L.startsWith(prefix, \"/\")) {\r\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\r\n\t\t}\r\n\t\tmodulePrefixCount++;\r\n\t}\r\n\toption.modulePrefixCount = modulePrefixCount;\r\n\r\n\tlet star = option.urlArgs[\"*\"];\r\n\tdelete option.urlArgs[\"*\"];\r\n\r\n\tlet urlArgsArr = [];\r\n\tfor (let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\r\n\t\t//处理相对\r\n\t\tif (L.startsWith(url, \".\") || L.startsWith(url, \"/\") && !L.startsWith(url, \"//\")) {\r\n\t\t\turl = U.getPathWithRelative(script.theLoaderUrl, url);\r\n\t\t} else {\r\n\t\t\tlet absolute = U.dealPathMayAbsolute(url);\r\n\t\t\tif (absolute.absolute) {\r\n\t\t\t\turl = absolute.path;\r\n\t\t\t} else if (!L.startsWith(url, \"*]\") && !L.startsWith(url, \"*[\")) { //排除*]；但*[可以有前缀\r\n\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\turlArgsArr.push({\r\n\t\t\turl: url,\r\n\t\t\targs: option.urlArgs[k]\r\n\t\t});\r\n\t}\r\n\r\n\t//替换urlArgs中地址前缀\r\n\tif (modulePrefixCount > 0) {\r\n\t\tfor (let prefix in option.modulePrefix) {\r\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\r\n\t\t\tfor (let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\t\tlet starP = \"\";\r\n\t\t\t\tif (L.startsWith(urlArgObj.url, \"*[\")) {\r\n\t\t\t\t\tstarP = \"*[\";\r\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (L.startsWith(urlArgObj.url, prefix)) {\r\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\r\n\t\t\t\t}\r\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\toption.urlArgs = {};\r\n\toption.urlArgs[\"*\"] = star;\r\n\tfor (let i = 0; i < urlArgsArr.length; i++) {\r\n\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\r\n\t}\r\n\r\n\t//预处理urlArgs中的*[与*]\r\n\tlet _urlArgs_prefix = [];\r\n\tlet _urlArgs_suffix = [];\r\n\toption._urlArgs_prefix = _urlArgs_prefix;\r\n\toption._urlArgs_suffix = _urlArgs_suffix;\r\n\r\n\tfor (let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\t\tif (L.startsWith(url, \"*[\")) {\r\n\t\t\tlet strfix = url.substring(2);\r\n\t\t\tif (L.startsWith(strfix, \".\") || L.startsWith(strfix, \"/\") && !L.startsWith(strfix, \"//\")) {\r\n\t\t\t\tstrfix = U.getPathWithRelative(script.theLoaderUrl, strfix);\r\n\t\t\t} else {\r\n\t\t\t\tlet absolute = U.dealPathMayAbsolute(strfix);\r\n\t\t\t\tif (absolute.absolute) {\r\n\t\t\t\t\tstrfix = absolute.path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_urlArgs_prefix.push({\r\n\t\t\t\tstrfix: strfix,\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t} else if (L.startsWith(url, \"*]\")) {\r\n\t\t\t_urlArgs_suffix.push({\r\n\t\t\t\tstrfix: url.substring(2),\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t}\r\n\t}\r\n\r\n\toption.forPrefixSuffix = function(urlOrName) {\r\n\t\t//前缀判断\r\n\t\tfor (let i = 0; i < _urlArgs_prefix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\r\n\t\t\tif (L.startsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif (L.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//后缀判断\r\n\t\tfor (let i = 0; i < _urlArgs_suffix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\r\n\t\t\tif (L.endsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif (L.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor (let name in option.paths) {\r\n\t\tU.replaceModulePrefix(option, option.paths[name]); //前缀替换\r\n\t}\r\n\tfor (let name in option.depsPaths) {\r\n\t\tU.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\r\n\t}\r\n\r\n\t//处理依赖\r\n\tlet dealtDeps = option.dealtDeps;\r\n\r\n\tlet pushDeps = (dealtDepArray, depsArray) => {\r\n\t\tU.each(depsArray, (dep) => {\r\n\t\t\tdealtDepArray.push(dep);\r\n\t\t});\r\n\t};\r\n\r\n\tfor (let keyName in option.deps) {\r\n\t\tlet paths = keyName.split('::');\r\n\t\tlet depsArray = option.deps[keyName];\r\n\t\tU.each(paths, (path) => {\r\n\t\t\tif (path == '*') {\r\n\t\t\t\tfor (let m in option.depsPaths) {\r\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\r\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\r\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttheConfig = option;\r\n\ttheContext = _newContext();\r\n\tscript.onConfigedCallback(); //完成配置回调\r\n\treturn theConfig;\r\n});\n","import U from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tU.each(defines, (defineObject) => {\r\n\t\tif (L.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\t//\t\t\t\tif(defineObject.isRequire) {\r\n\t\t\t\t//\t\t\t\t\tconsole.log(\"1======require:\" + defineObject.selfname);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(defineObject);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(originCallback);\r\n\t\t\t\t//\t\t\t\t}\r\n\t\t\t\tlet config = L.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tU.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif (L.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor (let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\t//同一个模块可能分属于不同的module对象，加载者module当前处于loading状态、需要将其依赖追加进来、确保依赖完整\r\n\tmoduleScript.appendLoadingModuleDeps(defineObject);\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\r\n\tlet moduleBeforeCurrentPath;\r\n\tif (!ifmodule && defineObject.srcBeforeCurrentPath) { //根据处理__currentPath前的地址获取模块\r\n\t\tmoduleBeforeCurrentPath = moduleScript.getModule(defineObject.srcBeforeCurrentPath);\r\n\t}\r\n\r\n\tif (ifmodule) {\r\n\t\tif (ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t\tmoduleBeforeCurrentPath && moduleBeforeCurrentPath.toOtherModule(ifmodule);\r\n\t}\r\n\r\n\tif (defineObject.selfname != defineObject.src) {\r\n\t\tdefineObject.pushName(defineObject.selfname);\r\n\t}\r\n\r\n\tif (ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tdefineObject.pushName(ifmodule.selfname);\r\n\t}\r\n\t//一个模块的所有名字，包括src\r\n\tU.each(defineObject.names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif (L.ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(ifmodule); //添加配置依赖:在配置文件里直接通过src、名称配置的\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif (defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif (lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || L.config().instance);\r\n\r\n\tif (module.deps.length == 0) {\r\n\t\ttry {\r\n\t\t\tmodule.finish([]); //递归结束\r\n\t\t} catch (e) {\r\n\t\t\tdefineObject.handle.onError(e);\r\n\t\t}\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tU.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodule.finish(args);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tdefineObject.handle.onError(e);\r\n\t\t\t\t}\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\treturn defineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif (defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.get = function(name) {\r\n\tif (!L.isString(name)) {\r\n\t\tthrow new Error(\"expected string type for module name\");\r\n\t} else {\r\n\t\treturn require.call(this, name);\r\n\t}\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif (args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor (var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif (!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nL.define = define;\r\n//deprecated\r\nL.defineAsync = define;\r\nL.require = require;\r\nG.define = define;\r\nG.require = require;\r\n\r\ndefine.amd = true;\r\n\r\n//声明exports,内部会做特殊处理\r\ndefine(\"exports\", function() {});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\nconst G = U.global;\r\n\r\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\r\n/**\r\n * option._beforeOpenHook\r\n * option._onOkResponseHook\r\n * option._onFailResponseHook\r\n * \r\n * @param {Object} option\r\n */\r\nfunction httpRequest(option) {\r\n\tif (!option) {\r\n\t\toption = {};\r\n\t}\r\n\r\n\tfunction prop(obj, varName, defaultVal) {\r\n\t\tif (obj[varName] === undefined) {\r\n\t\t\treturn defaultVal;\r\n\t\t} else {\r\n\t\t\treturn obj[varName];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction putProp(obj, varName, toObj) {\r\n\t\tif (obj[varName]) {\r\n\t\t\tfor (let x in obj[varName]) {\r\n\t\t\t\tlet value = obj[varName][x];\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttoObj[x] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlet _url = prop(option, \"url\", \"\"),\r\n\t\t_method = prop(option, \"method\", \"GET\"),\r\n\t\t_params = {},\r\n\t\t_headers = {\r\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\r\n\t\t},\r\n\t\t_async = prop(option, \"async\", true),\r\n\t\t_multiPart = prop(option, \"multiPart\", false),\r\n\t\t_handleType = prop(option, \"handleType\", \"json\");\r\n\tlet _timeout = option.timeout;\r\n\tputProp(option, \"params\", _params);\r\n\tputProp(option, \"headers\", _headers);\r\n\r\n\tlet okCallback = option.ok;\r\n\tlet failCallback = option.fail;\r\n\tlet uploadStartCallback = option.uploadStart;\r\n\tlet uploadProgressCallback = option.uploadProgress;\r\n\tlet uploadOkCallback = option.uploadOk;\r\n\tlet uploadErrorCallback = option.uploadError;\r\n\tlet uploadEndCallback = option.uploadEnd;\r\n\r\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\r\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\r\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\r\n\r\n\tfunction createXhr() {\r\n\t\tlet xhr, i, progId;\r\n\t\tif (typeof XMLHttpRequest !== \"undefined\") {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t} else if (typeof ActiveXObject !== \"undefined\") {\r\n\t\t\tfor (i = 0; i < 3; i += 1) {\r\n\t\t\t\tprogId = progIds[i];\r\n\t\t\t\ttry {\r\n\t\t\t\t\txhr = new ActiveXObject(progId);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (xhr) {\r\n\t\t\t\t\tprogIds = [progId];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction conn() {\r\n\t\t_conn(createXhr());\r\n\t}\r\n\r\n\tfunction _conn(xhr) {\r\n\t\tlet option = {\r\n\t\t\turl: _url,\r\n\t\t\tmethod: _method.toUpperCase(),\r\n\t\t\tparams: _params,\r\n\t\t\theaders: _headers,\r\n\t\t\thandleType: _handleType,\r\n\t\t\tasync: _async,\r\n\t\t\tmultiPart: _multiPart,\r\n\t\t\ttimeout: _timeout\r\n\t\t};\r\n\t\t_beforeOpenHook(option, function() {\r\n\t\t\t_connAfterOpenHook(option, xhr);\r\n\t\t}, xhr);\r\n\t}\r\n\r\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\r\n\t\t_onFailResponseHook(option, function(result) {\r\n\t\t\tif (result !== false && result !== undefined) {\r\n\t\t\t\tif (typeof okCallback == \"function\") {\r\n\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else if (typeof failCallback == \"function\") {\r\n\t\t\t\tfailCallback(err);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}, xhr, extraErr);\r\n\t}\r\n\r\n\tfunction _connAfterOpenHook(option, xhr) {\r\n\t\tlet body;\r\n\t\tif (option.multiPart) {\r\n\t\t\tlet formData = new FormData();\r\n\t\t\tfor (let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (L.isArray(value)) {\r\n\t\t\t\t\tformData.append(x, L.xsJson2String(value));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (G.File && value instanceof G.File || G.Blob && value instanceof G.Blob) {\r\n\t\t\t\t\t\tformData.append(x, value);\r\n\t\t\t\t\t} else if(L.isObject(value)){\r\n\t\t\t\t\t\tformData.append(x, L.xsJson2String(value));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tformData.append(x, value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tbody = formData;\r\n\t\t} else {\r\n\t\t\tbody = \"\";\r\n\t\t\tfor (let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (L.isArray(value) || L.isObject(value)) {\r\n\t\t\t\t\tvalue = L.xsJson2String(value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!(option.method == \"POST\" || option.method == \"PUT\")) {\r\n\t\t\t\tif (option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\r\n\t\t\t\t\toption.url += \"?\";\r\n\t\t\t\t}\r\n\t\t\t\toption.url += body;\r\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\r\n\t\t\t\tbody = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\txhr.open(option.method, option.url, option.async);\r\n\t\tif ((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && option.headers[\"Content-Type\"] ===\r\n\t\t\tundefined) {\r\n\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\r\n\t\t}\r\n\t\tfor (let header in option.headers) {\r\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\r\n\t\t}\r\n\r\n\t\tif (typeof uploadStartCallback == \"function\") {\r\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\r\n\t\t}\r\n\r\n\t\tif (typeof uploadProgressCallback == \"function\") {\r\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\r\n\t\t}\r\n\r\n\t\tif (typeof uploadOkCallback == \"function\") {\r\n\t\t\txhr.upload.onload = uploadOkCallback;\r\n\t\t}\r\n\r\n\t\tif (typeof uploadErrorCallback == \"function\") {\r\n\t\t\txhr.upload.onerror = uploadErrorCallback;\r\n\t\t}\r\n\r\n\t\tif (typeof uploadEndCallback == \"function\") {\r\n\t\t\txhr.upload.onloadend = uploadEndCallback;\r\n\t\t}\r\n\r\n\t\tlet timeoutTimer;\r\n\t\tlet isTimeout = false;\r\n\t\tif (option.timeout) {\r\n\t\t\ttimeoutTimer = setTimeout(function() {\r\n\t\t\t\tisTimeout = true;\r\n\t\t\t\txhr.abort();\r\n\t\t\t\tclearTimeout(timeoutTimer);\r\n\t\t\t}, option.timeout);\r\n\t\t}\r\n\r\n\t\txhr.onreadystatechange = function(evt) {\r\n\t\t\tlet status, err;\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\tstatus = xhr.status || 0;\r\n\t\t\t\tif (status > 399 && status < 600 || !status) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet result;\r\n\t\t\t\t\tif (option.handleType === \"json\") {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tresult = L.xsParseJson(xhr.responseText);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (option.handleType === \"text\") {\r\n\t\t\t\t\t\tresult = xhr.responseText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\r\n\t\t\t\t\t\tif (typeof okCallback == \"function\") {\r\n\t\t\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xhr);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif (timeoutTimer && isTimeout) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send(body);\r\n\t}\r\n\r\n\tlet requestObj = {\r\n\t\tmultiPart(multiPart) {\r\n\t\t\t_multiPart = multiPart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadStart(uploadStart) {\r\n\t\t\tuploadStartCallback = uploadStart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadProgress(uploadProgress) {\r\n\t\t\tuploadProgressCallback = uploadProgress;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadOk(callback) {\r\n\t\t\tuploadOkCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadError(callback) {\r\n\t\t\tuploadErrorCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadEnd(uploadEnd) {\r\n\t\t\tuploadEndCallback = uploadEnd;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\turl(urlStr) {\r\n\t\t\t_url = urlStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tmethod(methodStr) {\r\n\t\t\t_method = methodStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttimeout(timeout) {\r\n\t\t\t_timeout = timeout;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tasync (isAsync) {\r\n\t\t\t_async = isAsync;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tparams(paramsObj) {\r\n\t\t\tif (paramsObj) {\r\n\t\t\t\tfor (let x in paramsObj) {\r\n\t\t\t\t\tlet value = paramsObj[x];\r\n\t\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_params[x] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\theaders(headersObj) {\r\n\t\t\tif (headersObj) {\r\n\t\t\t\tfor (let x in headersObj) {\r\n\t\t\t\t\t_headers[x] = headersObj[x];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\thandleType(_handleType) {\r\n\t\t\treturn this.handleAs(_handleType);\r\n\t\t},\r\n\t\thandleAs(handleType) {\r\n\t\t\tif (handleType !== \"json\" && handleType !== \"text\") {\r\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\r\n\t\t\t}\r\n\t\t\t_handleType = handleType;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tok(callback) {\r\n\t\t\tokCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfail(callback) {\r\n\t\t\tfailCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_beforeOpenHook(callback) {\r\n\t\t\t_beforeOpenHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onOkResponseHook(callback) {\r\n\t\t\t_onOkResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onFailResponseHook(callback) {\r\n\t\t\t_onFailResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tdone() {\r\n\t\t\ttry {\r\n\t\t\t\tconn();\r\n\t\t\t} catch (e) {\r\n\t\t\t\tif (typeof failCallback == \"function\") {\r\n\t\t\t\t\tfailCallback(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn requestObj;\r\n}\r\n/**\r\n */\r\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\r\n\tcallback();\r\n};\r\n\r\n/**\r\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\r\n */\r\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\r\n\tcallback(result);\r\n};\r\n/**\r\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\r\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\r\n */\r\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\r\n\tcallback(undefined);\r\n};\r\n\r\nwindow._xshttp_request_ = httpRequest;\r\n\r\nL.define(\"xshttp\", [], function() {\r\n\treturn httpRequest;\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 返回Request返回一个Promise\r\n */\r\nL.define(\"request\", [\"xshttp\"], function(http) {\r\n\t/**\r\n\t * 参数列表:\r\n\t * async:始终为true\r\n\t * ok与fail失效\r\n\t * 其他参数同xshttp\r\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\r\n\t * @param {Object} option\r\n\t */\r\n\tlet Request = function(option) {\r\n\t\toption = L.extend({\r\n\t\t\tparams: undefined,\r\n\t\t\theaders: undefined,\r\n\t\t\tmethod: undefined,\r\n\t\t\turl: undefined,\r\n\t\t\tcallback: undefined\r\n\t\t}, option);\r\n\t\toption.async = true;\r\n\r\n\t\tlet promise = new Promise((resolve, reject) => {\r\n\t\t\toption.ok = function(rs) {\r\n\t\t\t\tresolve(rs);\r\n\t\t\t};\r\n\t\t\toption.fail = function(err) {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t\thttp(option).done();\r\n\t\t});\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\treturn Request;\r\n});","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\ntry {\r\n\tlet isXsMsgDebug = false;\r\n\tlet api = {};\r\n\r\n\tfunction isDebug(type) {\r\n\t\treturn isXsMsgDebug;\r\n\t}\r\n\r\n\tapi.linkedList = function() {\r\n\t\treturn new LinkedList();\r\n\t};\r\n\r\n\tfunction LinkedList() {\r\n\t\tfunction newNode(element) {\r\n\t\t\tlet node = {\r\n\t\t\t\telement: element,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tpre: null\r\n\t\t\t};\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\tlet length = 0;\r\n\t\tlet headNode = newNode(),\r\n\t\t\tlastNode = headNode;\r\n\r\n\t\t/**\r\n\t\t * 在链表末尾添加元素\r\n\t\t */\r\n\t\tthis.append = function(element) {\r\n\t\t\tlet current = newNode(element);\r\n\r\n\t\t\tlastNode.next = current;\r\n\t\t\tcurrent.pre = lastNode;\r\n\t\t\tlastNode = current;\r\n\t\t\tlength++;\r\n\t\t};\r\n\r\n\t\t//在链表的任意位置插入元素\r\n\t\tthis.insert = function(position, element) {\r\n\t\t\tif(position >= 0 && position <= length) {\r\n\r\n\t\t\t\tlet node = newNode(element);\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tpNode.next.pre = node;\r\n\t\t\t\t\tnode.next = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t\tpNode.next = node;\r\n\t\t\t\tnode.pre = pNode;\r\n\t\t\t\tlength++;\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.elementAt = function(position) {\r\n\t\t\treturn getElement(position);\r\n\t\t};\r\n\r\n\t\tfunction getElement(position, willRemove) {\r\n\t\t\tif(position >= 0 && position < length) {\r\n\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tlet currentNode = pNode.next;\r\n\t\t\t\t\tif(willRemove) {\r\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlength--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn currentNode.element;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @param callback function 返回true表示移除\r\n\t\t */\r\n\t\tthis.eachForRemove = function(callback) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tlet currentNode = pNode;\r\n\t\t\t\tif(callback(currentNode)) {\r\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlength--;\r\n\t\t\t\t\tpNode = nextCurrentNode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//从链表中移除元素\r\n\t\tthis.removeAt = function(position) {\r\n\t\t\treturn getElement(position, true);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 移除并获取第一个元素\r\n\t\t * @param callback function(elem,index)\r\n\t\t */\r\n\t\tthis.pop = function(callback) {\r\n\t\t\treturn this.removeAt(0);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 返回元素在链表中的位置\r\n\t\t * @param element object|function(elem)\r\n\t\t */\r\n\t\tthis.indexOf = function(element) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\tlet index = 0;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tif(typeof element == \"function\") {\r\n\t\t\t\t\tif(element(pNode.element)) {\r\n\t\t\t\t\t\treturn index;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(pNode.element === element) {\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t}\r\n\t\t\t\tindex++;\r\n\t\t\t\tpNode = pNode.next;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tthis.find = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\r\n\t\t};\r\n\r\n\t\t//移除某个元素\r\n\t\tthis.remove = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn this.removeAt(index);\r\n\t\t};\r\n\r\n\t\t//判断链表是否为空\r\n\r\n\t\tthis.isEmpty = function() {\r\n\t\t\treturn length === 0;\r\n\t\t};\r\n\r\n\t\t//返回链表的长度\r\n\t\tthis.size = function() {\r\n\t\t\treturn length;\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tif(window.addEventListener) {\r\n\t\tlet postMessageBridge;\r\n\r\n\t\tfunction initPostMessageBridge() {\r\n\t\t\tif(postMessageBridge){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet handle = {};\r\n\r\n\t\t\tlet instanceMap = {}; //id:listener\r\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\r\n\t\t\tlet instanceBindMap = {}; //instanceid:true\r\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\r\n\r\n\t\t\t//isActive为false表示监听者\r\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\r\n\r\n\t\t\t\tlet listener = {\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t_onConned: _onConned,\r\n\t\t\t\t\t_onMsg: _onMsg,\r\n\t\t\t\t\t_onResponse: _onResponse,\r\n\t\t\t\t\t_onElse: _onElse,\r\n\t\t\t\t\tconndata: conndata,\r\n\t\t\t\t\tosource: source,\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\tconnectingSource: connectingSource,\r\n\t\t\t\t\tid: L.randId(),\r\n\t\t\t\t\trefused: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\r\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\r\n\t\t\t\t}\r\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\r\n\r\n\t\t\t\tlet instanceid = listener.id;\r\n\t\t\t\tinstanceMap[instanceid] = listener;\r\n\t\t\t\treturn instanceid;\r\n\t\t\t};\r\n\r\n\t\t\thandle.remove = function(instanceid) {\r\n\t\t\t\t//TODO !!!!!!!\r\n\t\t\t\t/*let listener = listeners[id];\r\n\t\t\t\tdelete listeners[id];\r\n\t\t\t\tif(listener.active) {\r\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\r\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\r\n\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\r\n\t\t\t\t\t\t\tif(as[k] == id) {\r\n\t\t\t\t\t\t\t\tas.splice(k, 1);\r\n\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(found) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}*/\r\n\t\t\t};\r\n\r\n\t\t\thandle.send = function(data, instanceid, msgid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendConn = function(instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendResponse = function(data, instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\r\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\r\n\t\t\t\tlet listener = instanceMap[minstanceid];\r\n\t\t\t\tlistener._onElse(\"binded\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\r\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\r\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\r\n\t\t\t\t\tthrow new Error(\"source changed!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onConned(listener.osource, data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onMsg(data, msgid);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onResponse(data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\tid: instanceid,\r\n\t\t\t\t\tmsgid: msgid\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\r\n\t\t\t\t\tconsole.log(msg);\r\n\t\t\t\t}\r\n\t\t\t\tsource.postMessage(L.xsJson2String(msg), \"*\");\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener('message', function(event) {\r\n\t\t\t\tif(event.data && (typeof event.data == \"string\") && event.data.substring(0, 1) == \"{\") {\r\n\t\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\r\n\t\t\t\t\t\tconsole.log(event.data);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet data;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdata = L.xsParseJson(event.data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(\"error data:\", event.data);\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!data || !(data.cmd && data.type)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet cmd = data.cmd;\r\n\t\t\t\t\t\tlet oinstanceid = data.id;\r\n\t\t\t\t\t\tlet rdata = data.data;\r\n\t\t\t\t\t\tlet type = data.type;\r\n\t\t\t\t\t\tlet msgid = data.msgid;\r\n\r\n\t\t\t\t\t\tif(type == \"conn\") {\r\n\t\t\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"accept\") {\r\n\t\t\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"conned\") {\r\n\t\t\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"msg\") {\r\n\t\t\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t\t\t} else if(type == \"response\") {\r\n\t\t\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t\t\t} else if(type == \"binded\") {\r\n\t\t\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\thandle.runAfter = function(time, callback) {\r\n\t\t\t\tsetTimeout(callback, time);\r\n\t\t\t};\r\n\r\n\t\t\tpostMessageBridge = handle;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} cmd\r\n\t\t * @param {Object} source\r\n\t\t * @param {Object} connectingSource\r\n\t\t * @param {Object} onfailed\r\n\t\t * @param {Object} isActive\r\n\t\t * @param {Object} conndata 连接传送的数据\r\n\t\t * @param {Object} timeout 连接超时时间，毫秒\r\n\t\t * @param {Object} sleep 连接检测的休眠时间，毫秒\r\n\t\t */\r\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata, timeout, sleep) {\r\n\t\t\tinitPostMessageBridge();\r\n\t\t\t\r\n\t\t\tlet msgQueue = new LinkedList();\r\n\r\n\t\t\tlet SLEEP = sleep;\r\n\t\t\tlet starttime;\r\n\t\t\tlet isFailed = false;\r\n\t\t\tlet isConnected = false;\r\n\t\t\tlet isCanceled = false;\r\n\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet handleId;\r\n\r\n\t\t\tthis.onConnectedListener = null;\r\n\t\t\tthis.onReceiveListener = null;\r\n\t\t\tthis.send = function(data) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\tid: L.randId(),\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t};\r\n\t\t\t\tmsgQueue.append(msg);\r\n\t\t\t\tsendTop();\r\n\t\t\t};\r\n\r\n\t\t\tthis.send.release = function() {\r\n\t\t\t\tpostMessageBridge.remove(handleId);\r\n\t\t\t};\r\n\r\n\t\t\tfunction couldChat() {\r\n\t\t\t\treturn !isFailed && !isCanceled;\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onConned(_source, data) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\tthiz.onConnectedListener.call(thiz, data);\r\n\t\t\t\t\tisConnected = true;\r\n\t\t\t\t\tsendTop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onMsg(data, msgid) {\r\n\t\t\t\tif(couldChat()) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\r\n\t\t\t\t\t\tid: msgid\r\n\t\t\t\t\t}, handleId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onResponse(data) {\r\n\t\t\t\tmsgQueue.remove(function(elem) {\r\n\t\t\t\t\treturn elem.id = data.id;\r\n\t\t\t\t});\r\n\t\t\t\tcouldChat() && sendTop();\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onElse(type) {\r\n\t\t\t\tif(type == \"binded\") {\r\n\t\t\t\t\tisCanceled = true;\r\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\tonfailed(\"canceled\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction initListen() {\r\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\r\n\t\t\t}\r\n\r\n\t\t\tfunction sendTop() {\r\n\t\t\t\tif(isConnected) {\r\n\t\t\t\t\tlet msg;\r\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\r\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isTimeout() {\r\n\t\t\t\tlet dt = new Date().getTime() - starttime;\r\n\t\t\t\treturn dt > timeout;\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 主动方初始化\r\n\t\t\t */\r\n\t\t\tfunction initActively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.sendConn(handleId);\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, initActively);\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * 被动方检查\r\n\t\t\t */\r\n\t\t\tfunction checkPassively() {\r\n\t\t\t\tif(isConnected || isTimeout() || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tisFailed = true;\r\n\t\t\t\t\t\tonfailed(\"timeout:wait connect\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, checkPassively);\r\n\t\t\t}\r\n\r\n\t\t\t{\r\n\t\t\t\tstarttime = new Date().getTime();\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t} else if(!isActive) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tcheckPassively();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setSource = function(_source) {\r\n\t\t\t\tsource = _source;\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinitActively();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet handleApi = api;\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} winObjOrCallback\r\n\t\t * @param {Object} option\r\n\t\t * @param {Object} notActive\r\n\t\t */\r\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\r\n\t\t\tconst gconfig = L.config().plugins.xsmsg;\r\n\t\t\toption = L.extendDeep({\r\n\t\t\t\tcmd: \"default-cmd\",\r\n\t\t\t\tlistener: null,\r\n\t\t\t\tconnected: null,\r\n\t\t\t\tconndata: null,\r\n\t\t\t\ttimeout: gconfig.timeout,\r\n\t\t\t\tsleep: gconfig.sleep,\r\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\r\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\t\t\tcallback(mine == origin, \"default\");\r\n\t\t\t\t},\r\n\t\t\t\tonfailed: function(errtype) {\r\n\t\t\t\t\tif(errtype.indexOf(\"timeout:\") == 0) {\r\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \" ,err='\" + errtype + \"' ,my page=\" + location.href);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, option);\r\n\r\n\t\t\tlet cmd = option.cmd;\r\n\t\t\tlet connectedCallback = option.connected;\r\n\t\t\tlet receiveCallback = option.listener;\r\n\t\t\tlet conndata = option.conndata;\r\n\t\t\tlet onfailed = option.onfailed;\r\n\t\t\tlet timeout = option.timeout;\r\n\t\t\tlet sleep = option.sleep;\r\n\r\n\t\t\tlet isActive = !notActive;\r\n\t\t\tlet connectingSource = option.connectingSource;\r\n\r\n\t\t\tlet unit;\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t} else {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata, timeout, sleep);\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\r\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\r\n\t\t\t};\r\n\t\t\tif(connectedCallback) {\r\n\t\t\t\tunit.onConnectedListener = function(conndata) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(receiveCallback) {\r\n\t\t\t\tunit.onReceiveListener = function(data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treceiveCallback(data, this.send);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\twinObjOrCallback(function(winObj) {\r\n\t\t\t\t\tunit.setSource(winObj);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn unit.send;\r\n\t\t}\r\n\r\n\t\tfunction _connectIFrame(iframe, option) {\r\n\t\t\tlet winObj;\r\n\t\t\tif(typeof iframe == \"string\") {\r\n\t\t\t\tiframe = document.getElementById(iframe);\r\n\t\t\t\twinObj = function(callback) {\r\n\t\t\t\t\tiframe.onload = function() {\r\n\t\t\t\t\t\tcallback(this.contentWindow);\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\twinObj = iframe.contentWindow;\r\n\t\t\t}\r\n\t\t\treturn _connectWindow(winObj, option);\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 用于连接iframe.\r\n\t\t * @param {Object} iframe iframe或selector\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectIFrame = function(iframe, option) {\r\n\t\t\treturn _connectIFrame(iframe, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接父页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectParent = function(option) {\r\n\t\t\treturn _connectWindow(window.parent, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接顶层页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectTop = function(option) {\r\n\t\t\treturn _connectWindow(window.top, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接打开者.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectOpener = function(option) {\r\n\t\t\treturn _connectWindow(window.opener, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于监听其他页面发送消息.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回一个sender\r\n\t\t */\r\n\t\thandleApi.listenMessage = function(option) {\r\n\t\t\treturn _connectWindow(null, option, true);\r\n\t\t};\r\n\r\n\t\thandleApi.debug = function(isDebug) {\r\n\t\t\tisXsMsgDebug = isDebug;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * *******************\r\n\t\t * option参数\r\n\t\t *********************\r\n\t\t * option.cmd:\r\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\r\n\t\t * option.listener: function(data,sender)\r\n\t\t * option.connected:function(sender,conndata)\r\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\r\n\t\t * option.conndata:\r\n\t\t * option.timeout:连接超时时间\r\n\t\t * option.sleep:连接检测休眠时间\r\n\t\t **************\r\n\t\t * 回调的extra参数\r\n\t\t **************\r\n\t\t * originStr:对方页面的地址\r\n\t\t */\r\n\t\tL.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\r\n\t}\r\n\r\n\tL.define(\"XsLinkedList\", function() {\r\n\t\treturn LinkedList;\r\n\t});\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * <vnodex :v=\"\">\r\n */\r\nL.define(\"xsloader4j-server-bridge\", [], function() {\r\n\tconst base64 = new L.Base64();\r\n\tlet isDebug = false;\r\n\tlet hasRegVnodex = false;\r\n\r\n\t/**\r\n\t * 用于支持jsx代码\r\n\t * @param {Object} vm\r\n\t */\r\n\tfunction __renderJsx(vm) {\r\n\t\treturn function(component, props /*, ...children*/ ) {\r\n\t\t\tif (!vm || !vm.$createElement) {\r\n\t\t\t\tlet Vue = L.require.get(\"vue\");\r\n\t\t\t\tvm = new Vue();\r\n\t\t\t}\r\n\t\t\tlet $createElement = vm.$createElement;\r\n\t\t\tif (!$createElement) {\r\n\t\t\t\tthrow new Error(\"not found function '$createElement'\");\r\n\t\t\t}\r\n\t\t\tlet children = [];\r\n\t\t\tfor (let i = 2; i < arguments.length; i++) {\r\n\t\t\t\tchildren.push(arguments[i]);\r\n\t\t\t}\r\n\t\t\treturn $createElement(component, props, children);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction regVnodex(requiredVue = false) {\r\n\t\tif (hasRegVnodex || !requiredVue && !L.hasDefined(\"vue\")) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet Vue = L.require.get(\"vue\");\r\n\t\tVue.component(\"jsx\", {\r\n\t\t\tprops: {\r\n\t\t\t\tx: {\r\n\t\t\t\t\t//type: [Object, Function],\r\n\t\t\t\t\trequired: false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trender(h) {\r\n\t\t\t\tconst {\r\n\t\t\t\t\t$listeners,\r\n\t\t\t\t\t$attrs,\r\n\t\t\t\t} = this;\r\n\t\t\t\tdelete $attrs.x;\r\n\t\t\t\tconst wrapProps = {\r\n\t\t\t\t\ton: $listeners,\r\n\t\t\t\t\tattrs: $attrs,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet Comp = this.x;\r\n\r\n\t\t\t\tif (!L.isEmpty(Comp)) {\r\n\t\t\t\t\tif (L.isFunction(Comp)) {\r\n\t\t\t\t\t\tComp = Comp();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (L.isObject(Comp)) {\r\n\t\t\t\t\t\tlet data = Comp.data || (Comp.data = {});\r\n\t\t\t\t\t\tfor (let k in wrapProps) {\r\n\t\t\t\t\t\t\tdata[k] = L.extend({}, data[k], wrapProps[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!L.isObject(Comp)) {\r\n\t\t\t\t\t\tlet content = L.isString(Comp) ? Comp : JSON.stringify(Comp);\r\n\t\t\t\t\t\tComp = h(\"span\", {\r\n\t\t\t\t\t\t\t\"class\": \"jsx-text\",\r\n\t\t\t\t\t\t\t\"domProps\": {\r\n\t\t\t\t\t\t\t\tinnerText: content,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn Comp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\thasRegVnodex = true;\r\n\t}\r\n\r\n\tconst mod = {\r\n\t\tgetDefine(thiz) {\r\n\t\t\tregVnodex();\r\n\t\t\treturn thiz.define;\r\n\t\t},\r\n\t\tgetRequire(thiz) {\r\n\t\t\treturn thiz.require;\r\n\t\t},\r\n\t\tgetInvoker(thiz) {\r\n\t\t\treturn thiz.invoker();\r\n\t\t},\r\n\t\trenderJsx(vm) {\r\n\t\t\ttry {\r\n\t\t\t\tregVnodex(true);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"jsx need vue!\");\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t\treturn __renderJsx(vm);\r\n\t\t},\r\n\t\tgetVueCompiler(thiz) {\r\n\t\t\tlet rt = function(exports) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tregVnodex(true);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(\"jsx need vue!\");\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet Vue = L.require.get(\"vue\");\r\n\t\t\t\tlet _default = exports['default'] || exports;\r\n\t\t\t\tif (_default.template) {\r\n\r\n\t\t\t\t\t//处理src,href,url(...)\r\n\t\t\t\t\tlet dealUrl = function(reg, group, str, appendArgs, fun) {\r\n\t\t\t\t\t\tfun = fun || function(regResult, url) {\r\n\t\t\t\t\t\t\treturn url;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tlet result = \"\";\r\n\t\t\t\t\t\twhile (true) {\r\n\t\t\t\t\t\t\tlet rs = reg.exec(str);\r\n\t\t\t\t\t\t\tif (!rs) {\r\n\t\t\t\t\t\t\t\tresult += str;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlet rurl = rs[group].trim();\r\n\r\n\t\t\t\t\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\t\t\t\t\tif (L.startsWith(rurl, \"url(\")) {\r\n\t\t\t\t\t\t\t\t\tresult += rs[0];\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tresult += fun(rs, thiz.getUrl(rurl, appendArgs));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t//排除掉':src'等属性\r\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)(src|href)\\s*=\\s*('|\")([^'\"\\(\\)]+)('|\")/, 4, _default.template, false,\r\n\t\t\t\t\t\tfunction(regResult, url) {\r\n\t\t\t\t\t\t\treturn regResult[2] + \"=\" + regResult[3] + url + regResult[5];\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t_default.template = dealUrl(/(^|\\s)url\\(([^\\(\\)]+)\\)/, 2, _default.template, true); //后处理url，src与href中可能包含url(...)\r\n\t\t\t\t\tlet res;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (isDebug) {\r\n\t\t\t\t\t\t\tconsole.log(\"compile vue template content,url=\", thiz.getUrl());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tres = Vue.compile(_default.template); //用template有bug，根元素有多个时出现死循环\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error(\"url=\", thiz.getUrl());\r\n\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_default.render = res.render;\r\n\t\t\t\t\t_default.staticRenderFns = res.staticRenderFns;\r\n\t\t\t\t}\r\n\t\t\t\tdelete _default.template;\r\n\t\t\t};\r\n\t\t\treturn rt;\r\n\t\t},\r\n\t\tgetVtemplate(thiz) {\r\n\t\t\tlet vtemplate = (component) => {\r\n\t\t\t\treturn (resolve, reject) => {\r\n\t\t\t\t\tlet invoker = thiz.invoker();\r\n\t\t\t\t\tthiz.require([component], (comp) => {\r\n\t\t\t\t\t\tresolve(comp);\r\n\t\t\t\t\t}).error((err) => {\r\n\t\t\t\t\t\treject(err.err);\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\treturn vtemplate;\r\n\t\t},\r\n\t\tgetImporter(thiz) {\r\n\t\t\tlet vtemplate = this.getVtemplate(thiz);\r\n\t\t\treturn function(name) {\r\n\t\t\t\treturn new Promise(vtemplate(name));\r\n\t\t\t};\r\n\t\t},\r\n\t\tgetStyleBuilder(thiz) {\r\n\t\t\treturn function(cssContent, name = \"\") {\r\n\t\t\t\tif (cssContent) {\r\n\t\t\t\t\tlet id = L.randId() + \"_\" + name;\r\n\t\t\t\t\tlet count = 0;\r\n\t\t\t\t\tlet styleDom = document.createElement(\"style\");\r\n\t\t\t\t\tstyleDom.setAttribute(\"id\", id);\r\n\t\t\t\t\tstyleDom.setAttribute(\"type\", \"text/css\");\r\n\t\t\t\t\tstyleDom.innerHTML = cssContent;\r\n\r\n\t\t\t\t\tlet obj = {\r\n\t\t\t\t\t\tinit() {\r\n\t\t\t\t\t\t\tif (count <= 0) {\r\n\t\t\t\t\t\t\t\tL.appendHeadDom(styleDom);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tdestroy() {\r\n\t\t\t\t\t\t\t\t\tif (--count <= 0) {\r\n\t\t\t\t\t\t\t\t\t\tlet element = document.getElementById(id);\r\n\t\t\t\t\t\t\t\t\t\tif (element) {\r\n\t\t\t\t\t\t\t\t\t\t\telement.parentNode.removeChild(element);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn obj;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tdecodeBase64(base64Content) {\r\n\t\t\tif (base64Content) {\r\n\t\t\t\treturn base64.decode(base64Content);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn mod;\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n{\r\n\t cmd:{\r\n\t\t selfclients:{//自己连接服务端的实例\r\n\t\t\t id:Client\r\n\t\t },\r\n\t\t server:Connector,//服务端\r\n\t\t clients:{//作为服务端接收的客户端实例\r\n\t\t\t id:Client\r\n\t\t }\r\n\t}\r\n }\r\n */\r\nconst CONNS_MAP = {};\r\nconst DEBUG_OPTION = {\r\n\tlogMessage: false,\r\n};\r\n\r\nclass Debug {\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\tset logMessage(log) {\r\n\t\tDEBUG_OPTION.logMessage = !!log;\r\n\t}\r\n\r\n\tget logMessage() {\r\n\t\treturn DEBUG_OPTION.logMessage;\r\n\t}\r\n}\r\n\r\n\r\nfunction currentTimemillis() {\r\n\treturn new Date().getTime();\r\n}\r\n\r\nfunction runAfter(time, callback) {\r\n\treturn setTimeout(callback, time);\r\n}\r\n\r\nfunction clearRunAfter(timer) {\r\n\tclearTimeout(timer);\r\n}\r\n\r\nlet timer = null;\r\n\r\nfunction destroyTimer() {\r\n\tif (timer) {\r\n\t\tclearInterval(timer);\r\n\t\ttimer = null;\r\n\t}\r\n}\r\n\r\nfunction startTimer() {\r\n\tdestroyTimer();\r\n\ttimer = setInterval(() => {\r\n\t\tfor (let cmd in CONNS_MAP) {\r\n\t\t\tlet obj = CONNS_MAP[cmd];\r\n\t\t\tfor (let id in obj.clients) {\r\n\t\t\t\tobj.clients[id].checkHeart();\r\n\t\t\t}\r\n\r\n\t\t\tfor (let id in obj.selfclients) {\r\n\t\t\t\tobj.selfclients[id].checkHeart();\r\n\t\t\t}\r\n\t\t}\r\n\t}, parseInt(5 + Math.random() * 10) * 1000);\r\n}\r\n\r\n\r\nfunction doSendMessage(isserver, source, msg) {\r\n\tmsg = {\r\n\t\tisserver: !!isserver, //是否是服务端发送的\r\n\t\t...msg,\r\n\t\t__ifmsg: true,\r\n\t};\r\n\ttry {\r\n\t\tsource.postMessage(msg, \"*\");\r\n\t} catch (e) {\r\n\t\tconsole.error(e);\r\n\t\tconsole.error(msg);\r\n\t}\r\n}\r\n\r\nfunction checkSource(client, source) {\r\n\tif (client && client.source != source) { //防止其他窗口发过来\r\n\t\tconsole.error(\"source error:\", client.source, source);\r\n\t\tthrow new Error(\"source error:not match\");\r\n\t}\r\n}\r\n\r\nconst MESSAGE_LISTENER = (event) => {\r\n\tlet {\r\n\t\tdata,\r\n\t\tsource,\r\n\t\torigin,\r\n\t} = event;\r\n\tif (L.isObject(data) && data.__ifmsg === true) {\r\n\t\tlet {\r\n\t\t\tcmd,\r\n\t\t\tfromid,\r\n\t\t\ttoid,\r\n\t\t\tmdata,\r\n\t\t\ttype,\r\n\t\t\terr,\r\n\t\t\tisserver,\r\n\t\t} = data;\r\n\r\n\t\tif (DEBUG_OPTION.logMessage) {\r\n\t\t\tconsole.log(location.href, \" receive:\");\r\n\t\t\tconsole.log(data);\r\n\t\t}\r\n\r\n\t\tlet obj = CONNS_MAP[cmd];\r\n\t\tif (!obj) {\r\n\t\t\tif (type != \"ignore\") {\r\n\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\tcmd,\r\n\t\t\t\t\ttype: \"ignore\",\r\n\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (type == \"connecting\") { //服务端\r\n\t\t\t\tif (!obj.server) {\r\n\t\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\t\tcmd,\r\n\t\t\t\t\t\ttype: \"connecting-fail\",\r\n\t\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\t\terr: \"not a server,cmd=${cmd}\"\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (obj.clients[fromid]) {\r\n\t\t\t\t\t\tif (currentTimemillis() - obj.clients[fromid]._createTime > 10 * 1000) {\r\n\t\t\t\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\t\t\t\tcmd,\r\n\t\t\t\t\t\t\t\ttype: \"connecting-fail:duplicate\",\r\n\t\t\t\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\t\t\t\terr: `duplicate fromid[${fromid}],cmd=${cmd}`\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet client = new Client(cmd, source, origin, fromid);\r\n\t\t\t\t\t\tclient._conntimeout = obj.server._connTimeout;\r\n\t\t\t\t\t\tclient._sleeptimeout = obj.server._sleepTimeout;\r\n\t\t\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\t\t\tcmd,\r\n\t\t\t\t\t\t\ttype: \"connect\",\r\n\t\t\t\t\t\t\tfromid: obj.server.id,\r\n\t\t\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tobj.server.onConnect(client, mdata);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"connecting-fail:duplicate\") { //客户端\r\n\t\t\t\tconsole.warn(err);\r\n\t\t\t} else if (type == \"connecting-fail\") { //客户端\r\n\t\t\t\tlet client = obj.selfclients[toid];\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tclient.gotConnectingFail(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(err);\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"connect\") { //客户端\r\n\t\t\t\tlet client = obj.selfclients[toid];\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (!client) {\r\n\t\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\t\tcmd,\r\n\t\t\t\t\t\ttype: \"connect-fail\",\r\n\t\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\t\tfromid: toid,\r\n\t\t\t\t\t\terr: `client not found:clientid=${toid}`\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (type == \"connect-fail\") { //服务端\r\n\t\t\t\tconsole.warn(err);\r\n\t\t\t} else if (type == \"connected\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\t\tclient.gotConnect(fromid, source, origin, mdata);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"message\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\t\tclient.gotMessage(mdata);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tclient.gotMessage(mdata);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"close\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tclient.close();\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"closed\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//!!!!!source为空，可能为假冒页面？，关闭时不应直接执行安全相关操作\r\n\t\t\t\tsource && checkSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tclient.close(false, undefined, mdata);\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"heart\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tclient.gotHeart();\r\n\t\t\t\t\tdoSendMessage(!isserver, source, {\r\n\t\t\t\t\t\tcmd,\r\n\t\t\t\t\t\ttype: \"rheart\",\r\n\t\t\t\t\t\ttoid: fromid,\r\n\t\t\t\t\t\tfromid: toid,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else if (type == \"rheart\") {\r\n\t\t\t\tlet client;\r\n\t\t\t\tif (isserver) { //来自服务端\r\n\t\t\t\t\tclient = obj.selfclients[toid];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclient = obj.clients[fromid];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcheckSource(client, source);\r\n\r\n\t\t\t\tif (client) {\r\n\t\t\t\t\tclient.gotHeart();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nclass Callback {\r\n\tthiz;\r\n\tcallback;\r\n\tconstructor(thiz, callback) {\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.callback = callback;\r\n\t}\r\n\r\n\tinvoke(args) {\r\n\t\treturn this.callback.apply(this.thiz, args);\r\n\t}\r\n}\r\n\r\nCallback.call = function(self, callback) {\r\n\tif (callback) {\r\n\r\n\t\tlet args = [];\r\n\t\tfor (var i = 2; i < arguments.length; i++) {\r\n\t\t\targs.push(arguments[i]);\r\n\t\t}\r\n\r\n\t\tif (callback instanceof Callback) {\r\n\t\t\treturn callback.invoke(args);\r\n\t\t} else {\r\n\t\t\treturn callback.apply(self, args);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\nlet autoClosablesOnWindowClose = {};\r\n//页面关闭时，发送关闭消息\r\nwindow.addEventListener('beforeunload', (event) => {\r\n\tlet as = autoClosablesOnWindowClose;\r\n\tautoClosablesOnWindowClose = {};\r\n\tlet evt = {\r\n\t\ttype: \"beforeunload\",\r\n\t};\r\n\r\n\tfor (let id in as) {\r\n\t\ttry {\r\n\t\t\tlet closable = as[id];\r\n\t\t\tlet data = closable.getUnloadData({\r\n\t\t\t\t...evt\r\n\t\t\t});\r\n\t\t\tclosable.close(true, {\r\n\t\t\t\t...evt,\r\n\t\t\t\tdata,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nwindow.addEventListener('unload', (event) => {\r\n\tlet as = autoClosablesOnWindowClose;\r\n\tautoClosablesOnWindowClose = {};\r\n\r\n\tlet evt = {\r\n\t\ttype: \"unload\",\r\n\t};\r\n\r\n\tfor (let id in as) {\r\n\t\ttry {\r\n\t\t\tlet closable = as[id];\r\n\t\t\tlet data = closable.getUnloadData({\r\n\t\t\t\t...evt\r\n\t\t\t});\r\n\t\t\tclosable.close(true, {\r\n\t\t\t\t...evt,\r\n\t\t\t\tdata,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nfunction autoCloseOnWindowClose(closable) {\r\n\tlet id = L.randId();\r\n\tautoClosablesOnWindowClose[id] = closable;\r\n\treturn () => {\r\n\t\tdelete autoClosablesOnWindowClose[id];\r\n\t}\r\n}\r\n\r\nclass Base {\r\n\t_cmd;\r\n\t_id;\r\n\t#onclose;\r\n\tconstructor(cmd = \"default\") {\r\n\t\tthis._cmd = cmd;\r\n\t\tthis._id = L.randId();\r\n\t\tthis.#onclose = autoCloseOnWindowClose(this);\r\n\t}\r\n\r\n\tget cmd() {\r\n\t\treturn this._cmd;\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tcloseBase() {\r\n\t\tlet obj = CONNS_MAP[this.cmd];\r\n\t\tif (obj) {\r\n\t\t\tif (!obj.server && U.isEmptyObject(obj.clients) && U.isEmptyObject(obj.selfclients)) {\r\n\t\t\t\tdelete CONNS_MAP[this.cmd];\r\n\t\t\t\tif (U.isEmptyObject(CONNS_MAP)) {\r\n\t\t\t\t\twindow.removeEventListener('message', MESSAGE_LISTENER);\r\n\t\t\t\t\tdestroyTimer();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.#onclose) {\r\n\t\t\tthis.#onclose();\r\n\t\t\tthis.#onclose = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass Client extends Base {\r\n\t#source;\r\n\t_origin;\r\n\t_fromid;\r\n\t//////////////////////\r\n\t_connect;\r\n\t_connected = false;\r\n\t_destroyed = false;\r\n\t_onConnect;\r\n\t_onConnectFail;\r\n\t#isself;//为false，则表示服务端连接得到的客户端\r\n\t_conntimeout;\r\n\t_sleeptimeout;\r\n\t_rtimer;\r\n\t_starttime;\r\n\t_failed;\r\n\t////////////////\r\n\t_heartTimeout = 30 * 1000; //心跳超时时间\r\n\t_heartTime = 10 * 1000; //发送心跳的最小间隔\r\n\t_lastSendHeartTime = 0;\r\n\t_lastReceiveHeartTime = 0;\r\n\t_onHeartTimeout;\r\n\t_onUnload;\r\n\t_onClosed;\r\n\t_onMessage;\r\n\t_onConnected;\r\n\t_createTime = currentTimemillis();\r\n\tconstructor(cmd, source, origin, fromid, isself = false) {\r\n\t\tsuper(cmd);\r\n\t\tthis.#source = source;\r\n\t\tthis._origin = origin;\r\n\t\tthis._fromid = fromid;\r\n\t\tthis.#isself = isself;\r\n\t}\r\n\r\n\tget source() {\r\n\t\treturn this.#source;\r\n\t}\r\n\r\n\tset source(source) {\r\n\t\tif (this.#source) {\r\n\t\t\tthrow new Error(`already exists source:id=${this.id}`);\r\n\t\t}\r\n\r\n\t\tthis.#source = source;\r\n\t}\r\n\r\n\tget isself() {\r\n\t\treturn this.#isself;\r\n\t}\r\n\r\n\tget origin() {\r\n\t\treturn this._origin;\r\n\t}\r\n\r\n\tget fromid() {\r\n\t\treturn this._fromid;\r\n\t}\r\n\r\n\tget connected() {\r\n\t\treturn this._connected;\r\n\t}\r\n\r\n\tget destroyed() {\r\n\t\treturn this._destroyed;\r\n\t}\r\n\r\n\tisTimeout() {\r\n\t\tlet dt = currentTimemillis() - this._starttime;\r\n\t\treturn dt > this._conntimeout;\r\n\t}\r\n\r\n\tconnect(conndata) {\r\n\t\tif (!this.isself) {\r\n\t\t\tthrow new Error(\"not allowed for server client!\");\r\n\t\t} else if (this.connected) {\r\n\t\t\t//throw new Error(\"already connected!\");\r\n\t\t} else if (this.destroyed) {\r\n\t\t\tthrow new Error(\"destroyed!\");\r\n\t\t} else if (!this.source) {\r\n\t\t\tthrow new Error(\"no source!\");\r\n\t\t} else {\r\n\t\t\tif (!this._starttime || this._failed) {\r\n\t\t\t\tthis._failed = false;\r\n\t\t\t\tthis._starttime = currentTimemillis();\r\n\t\t\t\tthis._connect = false;\r\n\t\t\t} else if (this._connect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (U.isEmptyObject(CONNS_MAP)) {\r\n\t\t\t\twindow.addEventListener('message', MESSAGE_LISTENER);\r\n\t\t\t\tstartTimer();\r\n\t\t\t}\r\n\r\n\t\t\tlet msg = {\r\n\t\t\t\tcmd: this.cmd,\r\n\t\t\t\ttype: \"connecting\",\r\n\t\t\t\tfromid: this.id,\r\n\t\t\t\tmdata: conndata\r\n\t\t\t};\r\n\r\n\t\t\tif (!CONNS_MAP[this.cmd]) {\r\n\t\t\t\tCONNS_MAP[this.cmd] = {\r\n\t\t\t\t\tserver: null,\r\n\t\t\t\t\tclients: {},\r\n\t\t\t\t\tselfclients: {}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tCONNS_MAP[this.cmd].selfclients[this.id] = this;\r\n\t\t\tdoSendMessage(false, this.source, msg);\r\n\r\n\t\t\tthis._rtimer = runAfter(this._sleeptimeout, () => {\r\n\t\t\t\tif (this.connected || this._failed || this._connect || this._destroyed) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else if (this.isTimeout()) {\r\n\t\t\t\t\tif (!this.connected) {\r\n\t\t\t\t\t\tthis._failed = true;\r\n\t\t\t\t\t\tCallback.call(this, this._onConnectFail, {\r\n\t\t\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\t\t\ttype: \"timeout:connecting\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.connect(conndata);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcheckHeart() {\r\n\t\tif (this.connected && !this._destroyed) {\r\n\t\t\tlet time = currentTimemillis();\r\n\t\t\tif (time - this._lastReceiveHeartTime > this._heartTimeout) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tCallback.call(this, this._onHeartTimeout);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t}\r\n\t\t\t} else if (time - this._lastSendHeartTime > this._heartTime) {\r\n\t\t\t\tthis._lastSendHeartTime = time;\r\n\t\t\t\tdoSendMessage(!this.isself, this.source, {\r\n\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\ttype: \"heart\",\r\n\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\ttoid: this.fromid\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgotHeart() {\r\n\t\tthis._lastReceiveHeartTime = currentTimemillis();\r\n\t}\r\n\r\n\t//服务端调用\r\n\tcheckClientConnected(server) {\r\n\t\tif (!this._connected && !this._destroyed && !this._failed) {\r\n\t\t\tif (!this._starttime) {\r\n\t\t\t\tthis._starttime = currentTimemillis();\r\n\t\t\t\tthis._connect = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.isTimeout()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tCallback.call(this, server._onConnectTimeout, this);\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._rtimer = runAfter(this._sleeptimeout, () => {\r\n\t\t\t\t\tthis.checkClientConnected(server);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgotConnectingFail(err) {\r\n\t\tthis._failed = true;\r\n\t\tCallback.call(this, this._onConnectFail, {\r\n\t\t\tcmd: this.cmd,\r\n\t\t\ttype: \"fail:connecting\",\r\n\t\t\terr,\r\n\t\t});\r\n\t}\r\n\t//客户端调用\r\n\tgotConnect(fromid, source, origin, conndata) {\r\n\t\tthis._fromid = fromid;\r\n\t\tif (!this._connect && !this._connected && !this._destroyed && !this._failed) {\r\n\t\t\tthis._connect = true;\r\n\t\t\tlet onConn = this._onConnect || ((source, origin, conndata, callback) => {\r\n\t\t\t\t//默认只允许同域\r\n\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\t\tcallback(mine == origin, null);\r\n\t\t\t});\r\n\r\n\t\t\tlet callback = (isAccept, errOrConndata) => {\r\n\t\t\t\tif (isAccept) {\r\n\t\t\t\t\tthis.gotConnected();\r\n\t\t\t\t\tdoSendMessage(false, this.source, {\r\n\t\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\t\ttype: \"connected\",\r\n\t\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\t\ttoid: this.fromid,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlet onConnected = this._onConnected;\r\n\t\t\t\t\t// || (() => {\r\n\t\t\t\t\t// \tthis.close(false);\r\n\t\t\t\t\t// \tdoSendMessage(true, this.source, {\r\n\t\t\t\t\t// \t\tcmd: this.cmd,\r\n\t\t\t\t\t// \t\ttype: \"close\",\r\n\t\t\t\t\t// \t\tmdata: \"not exists connected handle\",\r\n\t\t\t\t\t// \t\tfromid: this.id,\r\n\t\t\t\t\t// \t\ttoid: this.fromid,\r\n\t\t\t\t\t// \t});\r\n\t\t\t\t\t// });\r\n\t\t\t\t\tCallback.call(this, onConnected);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdoSendMessage(false, this.source, {\r\n\t\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\t\ttype: \"connected-fail\",\r\n\t\t\t\t\t\terr: errOrConndata,\r\n\t\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\t\ttoid: this.fromid,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tCallback.call(this, onConn, source, origin, conndata, callback);\r\n\t\t}\r\n\t}\r\n\r\n\tgotConnected() {\r\n\t\tclearRunAfter(this._rtimer);\r\n\t\tthis._rtimer = null;\r\n\r\n\t\tlet time = currentTimemillis();\r\n\t\tthis._lastSendHeartTime = time;\r\n\t\tthis._lastReceiveHeartTime = time;\r\n\t\tthis._connected = true;\r\n\t}\r\n\r\n\tgotMessage(mdata) {\r\n\t\tCallback.call(this, this._onMessage, mdata);\r\n\t}\r\n\r\n\tgetUnloadData(e) {\r\n\t\tif (this.connected) {\r\n\t\t\treturn Callback.call(this, this._onUnload, e);\r\n\t\t}\r\n\t}\r\n\r\n\tclose(sendClosed = true, closeMessage, recvMessage) {\r\n\t\tif (this.connected) {\r\n\t\t\ttry {\r\n\t\t\t\tlet obj = CONNS_MAP[this.cmd];\r\n\t\t\t\tif (obj) {\r\n\t\t\t\t\tif (this.isself) {\r\n\t\t\t\t\t\tif (obj.selfclients) {\r\n\t\t\t\t\t\t\tdelete obj.selfclients[this.id];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (obj.clients) {\r\n\t\t\t\t\t\t\tdelete obj.clients[this.fromid];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._rtimer) {\r\n\t\t\t\t\tclearRunAfter(this._rtimer);\r\n\t\t\t\t\tthis._rtimer = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._connected = false;\r\n\t\t\t\tthis._destroyed = true;\r\n\t\t\t\tthis.closeBase();\r\n\r\n\t\t\t\tif (sendClosed && this.source) {\r\n\t\t\t\t\tdoSendMessage(!this.isself, this.source, {\r\n\t\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\t\ttype: \"closed\",\r\n\t\t\t\t\t\tmdata: closeMessage,\r\n\t\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\t\ttoid: this.fromid\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tCallback.call(this, this._onClosed, recvMessage);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onHeartTimeout\r\n\t */\r\n\tset onHeartTimeout(onHeartTimeout) {\r\n\t\tthis._onHeartTimeout = onHeartTimeout ? new Callback(this, onHeartTimeout) : null;\r\n\t}\r\n\r\n\tget onHeartTimeout() {\r\n\t\treturn this._onHeartTimeout && this._onHeartTimeout.callback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onUnload(e) 返回的结果用于发送给对方\r\n\t */\r\n\tset onUnload(onUnload) {\r\n\t\tthis._onUnload = onUnload ? new Callback(this, onUnload) : null;\r\n\t}\r\n\r\n\tget onUnload() {\r\n\t\treturn this._onUnload && this._onUnload.callback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onClosed(data)\r\n\t */\r\n\tset onClosed(onClosed) {\r\n\t\tthis._onClosed = onClosed ? new Callback(this, onClosed) : null;\r\n\t}\r\n\r\n\tget onClosed() {\r\n\t\treturn this._onClosed && this._onClosed.callback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onMessage funcation(data)\r\n\t */\r\n\tset onMessage(onMessage) {\r\n\t\tthis._onMessage = onMessage ? new Callback(this, onMessage) : null;\r\n\t}\r\n\r\n\tget onMessage() {\r\n\t\treturn this._onMessage && this._onMessage.callback;\r\n\t}\r\n\r\n\tsendMessage(data) {\r\n\t\tif (this.destroyed) {\r\n\t\t\tthrow new Error(\"destroyed!\");\r\n\t\t} else if (this.connected) {\r\n\t\t\tdoSendMessage(!this.isself, this.source, {\r\n\t\t\t\tcmd: this.cmd,\r\n\t\t\t\ttype: \"message\",\r\n\t\t\t\tmdata: data,\r\n\t\t\t\tfromid: this.id,\r\n\t\t\t\ttoid: this.fromid\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"not connected!\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 负责建立连接。\r\n */\r\nclass Server extends Base {\r\n\t_start;\r\n\t_destroyed = false;\r\n\t_onConnect;\r\n\t_onConnectTimeout;\r\n\t_onConnected;\r\n\t_conntimeout;\r\n\t_sleeptimeout;\r\n\t#singleMode;\r\n\t#singleClient;//用于单例模式\r\n\tconstructor(cmd, singleMode) {\r\n\t\tsuper(cmd);\r\n\t\tthis.#singleMode = singleMode;\r\n\t\tthis._id = L.randId();\r\n\t\tthis.onConnectTimeout = (client) => {\r\n\t\t\tconsole.warn(\"client connect timeout:\", client);\r\n\t\t};\r\n\t}\r\n\r\n\tget isSingle() {\r\n\t\treturn this.#singleMode;\r\n\t}\r\n\r\n\tget client() {\r\n\t\tif (!this.#singleMode) {\r\n\t\t\tthrow new Error(\"not single mode\");\r\n\t\t} else {\r\n\t\t\treturn this.#singleClient;\r\n\t\t}\r\n\t}\r\n\r\n\tonConnect(client, conndata) {\r\n\t\tlet obj = CONNS_MAP[this.cmd];\r\n\t\tobj.clients[client.fromid] = client;\r\n\r\n\t\tlet onConn = this._onConnect || ((client, conndata, callback) => {\r\n\t\t\t//默认只允许同域\r\n\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\tcallback(mine == client.origin, null);\r\n\t\t});\r\n\r\n\t\tlet callback = (isAccept, errOrConndata) => {\r\n\t\t\tif (isAccept) {\r\n\t\t\t\tclient.gotConnected();\r\n\t\t\t\tdoSendMessage(true, client.source, {\r\n\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\ttype: \"connected\",\r\n\t\t\t\t\tmdata: errOrConndata,\r\n\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\ttoid: client.fromid,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (this.#singleMode && this.#singleClient) {\r\n\t\t\t\t\tthis.#singleClient.close();\r\n\t\t\t\t\tthis.#singleClient = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet onConnected = this._onConnected || (() => {\r\n\t\t\t\t\tif (this.#singleMode) {\r\n\t\t\t\t\t\tthis.#singleClient = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclient.close(false);\r\n\t\t\t\t\tdoSendMessage(true, client.source, {\r\n\t\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\t\ttype: \"close\",\r\n\t\t\t\t\t\tmdata: \"not exists connected handle\",\r\n\t\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\t\ttoid: client.fromid,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (this.#singleMode) {\r\n\t\t\t\t\tthis.#singleClient = client;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tCallback.call(this, onConnected, client);\r\n\t\t\t\tclient.checkClientConnected(this);\r\n\t\t\t} else {\r\n\t\t\t\tclient.close(false);\r\n\t\t\t\tdoSendMessage(true, client.source, {\r\n\t\t\t\t\tcmd: this.cmd,\r\n\t\t\t\t\ttype: \"connected-fail\",\r\n\t\t\t\t\terr: errOrConndata,\r\n\t\t\t\t\tfromid: this.id,\r\n\t\t\t\t\ttoid: client.fromid,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tCallback.call(this, onConn, client, conndata, callback);\r\n\t}\r\n\r\n\tclose(sendClosed, closeMessage) {\r\n\t\tif (this._destroyed) {\r\n\t\t\tthrow new Error(\"already destroyed!\");\r\n\t\t} else {\r\n\t\t\tlet obj = CONNS_MAP[this.cmd];\r\n\t\t\tif (!obj.server || obj.server != this) {\r\n\t\t\t\tthrow new Error(`server cmd not match:cmd=${this.cmd}`);\r\n\t\t\t} else {\r\n\t\t\t\tthis._destroyed = true;\r\n\t\t\t\tthis._start = false;\r\n\t\t\t\tfor (let k in obj.clients) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet client = obj.clients[k];\r\n\t\t\t\t\t\tif (client.connected) {\r\n\t\t\t\t\t\t\tclient.close(sendClosed, closeMessage);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tobj.clients = {};\r\n\t\t\t\tobj.server = null;\r\n\t\t\t\tthis.#singleClient = null;\r\n\t\t\t\tthis.closeBase();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlisten() {\r\n\t\tif (CONNS_MAP[this.cmd]) {\r\n\t\t\tthrow new Error(`already listened:cmd=${this.cmd}`);\r\n\t\t} else {\r\n\t\t\tif (U.isEmptyObject(CONNS_MAP)) {\r\n\t\t\t\twindow.addEventListener('message', MESSAGE_LISTENER);\r\n\t\t\t\tstartTimer();\r\n\t\t\t}\r\n\r\n\t\t\tif (!CONNS_MAP[this.cmd]) {\r\n\t\t\t\tCONNS_MAP[this.cmd] = {\r\n\t\t\t\t\tserver: null,\r\n\t\t\t\t\tclients: {},\r\n\t\t\t\t\tselfclients: {}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tCONNS_MAP[this.cmd].server = this;\r\n\t\t\tthis._start = true;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\nclass IfmsgServer {\r\n\t#server;\r\n\tconstructor(cmd, option) {\r\n\t\tconst gconfig = L.config().plugins.ifmsg;\r\n\r\n\t\tif (option === true || option === false) {\r\n\t\t\toption = {\r\n\t\t\t\tsingleMode: option\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\toption = L.extend({\r\n\t\t\tconnTimeout: gconfig.connTimeout,\r\n\t\t\tsleepTimeout: gconfig.sleepTimeout,\r\n\t\t\tsingleMode: false,\r\n\t\t}, option);\r\n\r\n\t\tthis.#server = new Server(cmd, option.singleMode);\r\n\t\tthis.#server._conntimeout = option.connTimeout;\r\n\t\tthis.#server._sleeptimeout = option.sleepTimeout;\r\n\t}\r\n\r\n\t/**\r\n\t *@param {Function} onConnect  function(client,conndata,callback(isAccept,errOrConndata))\r\n\t */\r\n\tset onConnect(onConnect) {\r\n\t\tthis.#server._onConnect = onConnect ? new Callback(this, onConnect) : null;\r\n\t}\r\n\r\n\tget onConnect() {\r\n\t\treturn this.#server._onConnect && this.#server._onConnect.callback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onConnectTimeout function(client)\r\n\t */\r\n\tset onConnectTimeout(onConnectTimeout) {\r\n\t\tthis.#server._onConnectTimeout = onConnectTimeout ? new Callback(this, onConnectTimeout) : null;\r\n\t}\r\n\r\n\tget onConnectTimeout() {\r\n\t\treturn this.#server._onConnectTimeout && this.#server._onConnectTimeout.callback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onConnected function(client)\r\n\t */\r\n\tset onConnected(onConnected) {\r\n\t\tthis.#server._onConnected = onConnected ? new Callback(this, onConnected) : null;\r\n\t}\r\n\r\n\tget onConnected() {\r\n\t\treturn this.#server._onConnected && this.#server._onConnected.callback;\r\n\t}\r\n\r\n\tget isStart() {\r\n\t\treturn this.#server._start;\r\n\t}\r\n\r\n\tget isDestroyed() {\r\n\t\treturn this.#server._destroyed;\r\n\t}\r\n\r\n\tget cmd() {\r\n\t\treturn this.#server.cmd;\r\n\t}\r\n\r\n\tlisten() {\r\n\t\tthis.#server.listen();\r\n\t}\r\n\r\n\tclose(data) {\r\n\t\tthis.#server.close(true, data);\r\n\t}\r\n\r\n\tget isSingle() {\r\n\t\treturn this.#server.isSingle;\r\n\t}\r\n\r\n\tget client() {\r\n\t\treturn this.#server.client;\r\n\t}\r\n\r\n}\r\n\r\nclass IfmsgClient {\r\n\t#client;\r\n\tconstructor(cmd, option) {\r\n\t\tconst gconfig = L.config().plugins.ifmsg;\r\n\t\toption = L.extend({\r\n\t\t\tconnTimeout: gconfig.connTimeout,\r\n\t\t\tsleepTimeout: gconfig.sleepTimeout,\r\n\t\t}, option);\r\n\r\n\t\tthis.#client = new Client(cmd, null, null, null, true);\r\n\t\tthis.#client._conntimeout = option.connTimeout;\r\n\t\tthis.#client._sleeptimeout = option.sleepTimeout;\r\n\t\tthis.onConnectFail = (err) => {\r\n\t\t\tconsole.warn(err);\r\n\t\t};\r\n\t}\r\n\r\n\tconnIframe(iframe, conndata) {\r\n\t\tlet winObj;\r\n\t\tif (typeof iframe == \"string\") {\r\n\t\t\tiframe = document.getElementById(iframe);\r\n\t\t\tlet fun = () => {\r\n\t\t\t\tiframe.removeEventListener(\"load\", fun);\r\n\t\t\t\tlet source = iframe.contentWindow;\r\n\t\t\t\tthis.#client.source = source;\r\n\t\t\t\tthis.#client.connect(conndata);\r\n\t\t\t};\r\n\t\t\tiframe.addEventListener(\"load\", fun);\r\n\t\t} else {\r\n\t\t\tlet source = iframe.contentWindow;\r\n\t\t\tthis.#client.source = source;\r\n\t\t\tthis.#client.connect(conndata);\r\n\t\t}\r\n\t}\r\n\r\n\tconnParent(conndata) {\r\n\t\tthis.#client.source = window.parent;\r\n\t\tthis.#client.connect(conndata);\r\n\t}\r\n\r\n\tconnTop(conndata) {\r\n\t\tthis.#client.source = window.top;\r\n\t\tthis.#client.connect(conndata);\r\n\t}\r\n\r\n\tconnOpener(conndata) {\r\n\t\tthis.#client.source = window.opener;\r\n\t\tthis.#client.connect(conndata);\r\n\t}\r\n\r\n\t/**\r\n\t *@param {Function} onConnect  function(source,origin,conndata,callback(isAccept,err))\r\n\t */\r\n\tset onConnect(onConnect) {\r\n\t\tthis.#client._onConnect = onConnect ? new Callback(this, onConnect) : null;\r\n\t}\r\n\r\n\tget onConnect() {\r\n\t\treturn this.#client._onConnect && this.#client._onConnect.callback;\r\n\t}\r\n\r\n\t/**\r\n\t *@param {Function} onConnected\r\n\t */\r\n\tset onConnected(onConnected) {\r\n\t\tthis.#client._onConnected = onConnected ? new Callback(this, onConnected) : null;\r\n\t}\r\n\r\n\tget onConnected() {\r\n\t\treturn this.#client._onConnected && this.#client._onConnected.callback;\r\n\t}\r\n\r\n\tsendMessage(data) {\r\n\t\tthis.#client.sendMessage(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onHeartTimeout\r\n\t */\r\n\tset onHeartTimeout(onHeartTimeout) {\r\n\t\tthis.#client.onHeartTimeout = onHeartTimeout;\r\n\t}\r\n\r\n\tget onHeartTimeout() {\r\n\t\treturn this.#client.onHeartTimeout;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onUnload() 返回的结果用于发送给对方\r\n\t */\r\n\tset onUnload(onUnload) {\r\n\t\tthis.#client.onUnload = onUnload;\r\n\t}\r\n\r\n\tget onUnload() {\r\n\t\treturn this.#client.onUnload;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onClosed(data)\r\n\t */\r\n\tset onClosed(onClosed) {\r\n\t\tthis.#client.onClosed = onClosed;\r\n\t}\r\n\r\n\tget onClosed() {\r\n\t\treturn this.#client.onClosed;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} onMessage funcation(data)\r\n\t */\r\n\tset onMessage(onMessage) {\r\n\t\tthis.#client.onMessage = onMessage;\r\n\t}\r\n\r\n\tget onMessage() {\r\n\t\treturn this.#client.onMessage;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Function} callback function(err)\r\n\t */\r\n\tset onConnectFail(callback) {\r\n\t\tthis.#client._onConnectFail = callback ? new Callback(this, callback) : null;\r\n\t}\r\n\r\n\tget onConnectFail() {\r\n\t\treturn this.#client._onConnectFail && this.#client._onConnectFail.callback;\r\n\t}\r\n\r\n\tget connected() {\r\n\t\treturn this.#client.connected;\r\n\t}\r\n\r\n\tget destroyed() {\r\n\t\treturn this.#client.destroyed;\r\n\t}\r\n\r\n\tclose(data) {\r\n\t\tthis.#client.close(true, data);\r\n\t}\r\n\r\n}\r\n\r\nL.define(\"ifmsg\", {\r\n\tServer: IfmsgServer,\r\n\tClient: IfmsgClient,\r\n\tdebug: new Debug(),\r\n});\r\n","import script from \"../script.js\";\r\nimport U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n//内部依赖加载插件\r\n\r\nL.define(script.INNER_DEPS_PLUGIN, {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tlet depsObj = script.innerDepsMap[depId];\r\n\t\tlet deps = depsObj.deps;\r\n\t\t//delete innerDepsMap[depId];\r\n\t\tlet newInvoker = this.invoker().withAbsUrl(depsObj.absUrl);\r\n\t\tnewInvoker.src = () => depsObj.src;\r\n\t\tnewInvoker.require(deps, function() {\r\n\t\t\tlet args = [];\r\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\r\n\t\t\t\targs.push(arguments[k]);\r\n\t\t\t}\r\n\t\t\tonload(args);\r\n\t\t}).then({\r\n\t\t\torderDep: depsObj.orderDep,\r\n\t\t\terror(err, invoker) {\r\n\t\t\t\tonerror(new U.PluginError(err, invoker));\r\n\t\t\t}\r\n\t\t}).setTag(`${script.INNER_DEPS_PLUGIN}![${deps.join(',')}]`);\r\n\t},\r\n\tgetCacheKey(depId) {\r\n\t\treturn depId;\r\n\t}\r\n});","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\nL.define(\"ready\", {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tL.onReady(function() {\r\n\t\t\tonload();\r\n\t\t});\r\n\t}\r\n});","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\nclass TryModule {\r\n\t#state=\"loading\";\r\n\t#mod=undefined;\r\n\t#err=undefined;\r\n\t#successArray=[];\r\n\t#failedArray=[];\r\n\t#finishArray=[];\r\n\r\n\tconstructor(promise) {\r\n\t\tpromise.then((mod) => {\r\n\t\t\tthis.#state = \"defined\";\r\n\t\t\tthis.#mod = mod;\r\n\t\t\tthis.#invokeFuns(this.#successArray, [mod]);\r\n\t\t\tthis.#invokeFuns(this.#finishArray, [true, mod]);\r\n\t\t}, (err) => {\r\n\t\t\tthis.#state = \"failed\";\r\n\t\t\tthis.#mod = err;\r\n\t\t\tthis.#invokeFuns(this.#failedArray, [err]);\r\n\t\t\tthis.#invokeFuns(this.#finishArray, [false, err]);\r\n\t\t});\r\n\t}\r\n\r\n\t#invokeFuns\r\n\t(funs, args) {\r\n\t\tfor (let i = 0; i < funs.length; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tfuns[i].apply(this, args);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget state() {\r\n\t\treturn this.#state;\r\n\t}\r\n\r\n\tget module() {\r\n\t\treturn this.#mod;\r\n\t}\r\n\r\n\tget err() {\r\n\t\treturn this.#err;\r\n\t}\r\n\r\n\tget isOk() {\r\n\t\treturn this.#state == \"defined\";\r\n\t}\r\n\r\n\tset success(callback) {\r\n\t\tif (this.#state == \"defined\") {\r\n\t\t\tcallback(this.#mod);\r\n\t\t} else if (this.#state == \"loading\") {\r\n\t\t\tthis.#successArray.push(callback);\r\n\t\t}\r\n\t}\r\n\r\n\tset failed(callback) {\r\n\t\tif (this.#state == \"failed\") {\r\n\t\t\tcallback(this.#err);\r\n\t\t} else if (this.#state == \"loading\") {\r\n\t\t\tthis.#failedArray.push(callback);\r\n\t\t}\r\n\t}\r\n\r\n\tset finish(callback) {\r\n\t\tif (this.#state == \"failed\" || this.#state == \"defined\") {\r\n\t\t\tlet isOk = this.#state == \"defined\";\r\n\t\t\tlet res = isOk ? this.#mod : this.#err;\r\n\t\t\tcallback(isOk, res);\r\n\t\t} else if (this.#state == \"loading\") {\r\n\t\t\tthis.#finishArray.push(callback);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nL.TryModule = TryModule;\r\n\r\n/**\r\n * 格式:try!module\r\n */\r\nL.define(\"try\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\r\n\t\tlet tryModule = new TryModule(new Promise((resolve, reject) => {\r\n\t\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\t\tresolve(mod);\r\n\t\t\t}).error(function(err, invoker) {\r\n\t\t\t\tconsole.warn(`try!:require '${dep}' failed`);\r\n\t\t\t\treject(err);\r\n\r\n\t\t\t\t// return {\r\n\t\t\t\t// \tignoreErrState: true,\r\n\t\t\t\t// \tonGetModule: () => {\r\n\t\t\t\t// \t\treturn null;\r\n\t\t\t\t// \t},\r\n\t\t\t\t// \tonFinish: () => {\r\n\t\t\t\t// \t\ttryModule.state = \"failed\";\r\n\t\t\t\t// \t\ttryModule.failed(err, invoker);\r\n\t\t\t\t// \t\treject(err);\r\n\t\t\t\t// \t}\r\n\t\t\t\t// }\r\n\t\t\t}).setTag(`try!${arg}`);\r\n\r\n\t\t}));\r\n\r\n\t\tonload(tryModule);\r\n\t}\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 插件用于加载某些js文件，忽略其所有依赖，可用于忽略在加载webpack等打包的模块时自动添加内部require('...')的依赖\r\n */\r\nL.define(\"nodeps\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tthis.invoker().withAbsUrl().require([arg], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\tdepBefore(index, dep, depDeps) {\r\n\t\t\t\tdepDeps.splice(0, depDeps.length);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t}).setTag(`nodeps!${arg}`);\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * exists!module1 or module2 or module3|windowVar1|windowVar2...\r\n */\r\nL.define(\"exists\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet vars = arg.split(\"|\");\r\n\t\tfor(let i = 0; i < vars.length; i++) {\r\n\t\t\tvars[i] = vars[i].trim();\r\n\t\t}\r\n\t\tif(vars.length == 0) {\r\n\t\t\tonerror(\"args error for exists!\");\r\n\t\t} else {\r\n\t\t\tlet moduleNames = (vars[0].replace(/\\s/g, \" \")).split(\" or \");\r\n\t\t\tlet moduleName;\r\n\t\t\tlet module;\r\n\t\t\tfor(let i = 0; i < moduleNames.length; i++) {\r\n\t\t\t\tmoduleName = moduleNames[i].trim();\r\n\t\t\t\tmodule = moduleScript.getModule(moduleName);\r\n\t\t\t\tif(module) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(module) {\r\n\t\t\t\tthis.invoker().withAbsUrl().require([moduleName], function(mod, depModuleArgs) {\r\n\t\t\t\t\tonload(mod);\r\n\t\t\t\t}).error(function(e) {\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}).setTag(`exists!${arg}`);\r\n\t\t\t} else {\r\n\t\t\t\tlet obj = undefined;\r\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\r\n\t\t\t\t\tif(window[vars[i]]) {\r\n\t\t\t\t\t\tobj = window[vars[i]];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(obj === undefined) {\r\n\t\t\t\t\tonerror(\"not found:\" + arg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 格式:name!moduleName=>>modulePath\r\n */\r\n\r\nL.define(\"name\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif (index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tmoduleName = moduleName.replace(/，/g, ',');\r\n\t\tlet names = moduleName.split(\",\");\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tlet existsMods = [];\r\n\t\t\tfor (let i = 0; i < names.length; i++) {\r\n\t\t\t\tlet newName = names[i];\r\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\r\n\t\t\t\tif (lastM && lastM.state != \"init\" && !lastM.preDependModule) {\r\n\t\t\t\t\tlet errinfo = \"\\tselfname=\" + newName + \",state=\" + lastM.state + \",src=\" + lastM.src;\r\n\t\t\t\t\tif (lastM.id === depModuleArgs[0].module.id) { //模块自己已经定义了\r\n\t\t\t\t\t\tconsole.info(\"already define name by self:\" + errinfo);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\texistsMods.push(errinfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet module = depModuleArgs[0].module;\r\n\t\t\t\tif (lastM && !lastM.preDependModule) {\r\n\t\t\t\t\tlastM.toOtherModule(module);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleScript.setModule(newName, module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (existsMods.length) {\r\n\t\t\t\tonerror(\"already exists:\" + existsMods.join('\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tonload(mod);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t}).setTag(`name!${arg}`);\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nimport script from \"../script.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/*\r\n * Require-CSS RequireJS css! loader plugin\r\n * 0.1.8\r\n * Guy Bedford 2014\r\n * MIT\r\n */\r\nL.define(\"css\", function() {\r\n\r\n\tlet lastDom; //始终执行最后一个style（inverse处理的）\r\n\t//层级之间，越顶层的、越在后面；同级之间，索引越大的、越在后面\r\n\tclass Node {\r\n\t\tparent;\r\n\t\tchildren = {};\r\n\t\t_maxindex = -1;\r\n\t\t_minindex;\r\n\t\tdoms = {}; //index:dom\r\n\t\tsrc;\r\n\t\tconstructor(src) {\r\n\t\t\tthis.src = src;\r\n\t\t}\r\n\r\n\t\taddChild(src, node) {\r\n\t\t\tthis.children[src] = node;\r\n\t\t\tnode.parent = this;\r\n\t\t}\r\n\t\tgetChild(src) {\r\n\t\t\treturn this.children[src];\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 将添加到返回节点之前\r\n\t\t */\r\n\t\tfindAnchor(index, dom) {\r\n\t\t\tif(dom) {\r\n\t\t\t\tthis.doms[index] = dom;\r\n\t\t\t}\r\n\r\n\t\t\tlet anchorDom;\r\n\t\t\tif(this._maxindex == -1) {\r\n\t\t\t\tthis._maxindex = index;\r\n\t\t\t\tthis._minindex = index;\r\n\t\t\t\t//层级之间,反向添加\r\n\t\t\t\tlet p = this.parent;\r\n\t\t\t\twhile(p) {\r\n\t\t\t\t\tif(p._maxindex == -1) {\r\n\t\t\t\t\t\tp = p.parent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tanchorDom = p.doms[p._minindex];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//同级之间、按照索引大小顺序添加\r\n\t\t\t\tif(index > this._maxindex) {\r\n\t\t\t\t\tanchorDom = this.doms[this._maxindex].nextSibling;\r\n\t\t\t\t\tthis._maxindex = index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(this._minindex > index) {\r\n\t\t\t\t\t\tthis._minindex = index;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let i = index + 1; i < this._maxindex; i++) {\r\n\t\t\t\t\t\tif(this.doms[i]) {\r\n\t\t\t\t\t\t\tanchorDom = this.doms[i];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!anchorDom) {\r\n\t\t\t\tanchorDom = lastDom ? lastDom.nextSibling : L.script().nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\treturn anchorDom;\r\n\t\t}\r\n\t}\r\n\r\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\r\n\tlet useImportLoad = false;\r\n\tlet useOnload = true;\r\n\tif(engine[1] || engine[7])\r\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\r\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\r\n\t\tuseOnload = false;\r\n\telse if(engine[4])\r\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\r\n\tlet cssAPI = {};\r\n\r\n\tlet cssIndex = 0;\r\n\t//src:Node\r\n\tconst rootNodes = {};\r\n\r\n\tfunction domIndex(dom) {\r\n\t\tlet index = 0;\r\n\t\twhile((dom = dom.previousSibling)) {\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\treturn index;\r\n\t}\r\n\r\n\tfunction buildAndGetNode(mthiz) {\r\n\t\tlet src = mthiz.src();\r\n\t\tlet p = mthiz.invoker();\r\n\r\n\t\twhile(p && p.src() == src) {\r\n\t\t\tp = p.invoker();\r\n\t\t}\r\n\r\n\t\tif(p) {\r\n\t\t\tlet pnode = buildAndGetNode(p);\r\n\t\t\tlet node = pnode.getChild(src);\r\n\t\t\tif(!node) {\r\n\t\t\t\tnode = new Node(src);\r\n\t\t\t\tpnode.addChild(src, node);\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t} else {\r\n\t\t\t//root\r\n\t\t\tif(!rootNodes[src]) {\r\n\t\t\t\trootNodes[src] = new Node(src);\r\n\t\t\t}\r\n\t\t\treturn rootNodes[src];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction appendCssDom(dom, cssThis, inverse) {\r\n\t\tif(cssThis && inverse) {\r\n\t\t\tlet mthis = cssThis.invoker();\r\n\t\t\tlet node = buildAndGetNode(mthis);\r\n\t\t\tdom.setAttribute(\"data-insert-index\", cssIndex++);\r\n\t\t\tlet index = cssThis.getIndex();\r\n\t\t\tlet nextDom = node.findAnchor(index, dom);\r\n\t\t\tscript.head().insertBefore(dom, nextDom);\r\n\r\n\t\t\tif(!lastDom || domIndex(dom) > domIndex(lastDom)) {\r\n\t\t\t\tlastDom = dom;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tL.appendHeadDom(dom);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet curStyle, curSheet;\r\n\tlet createStyle = function(mthis, inverse) {\r\n\t\tcurStyle = document.createElement('style');\r\n\t\tappendCssDom(curStyle, mthis, inverse);\r\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\r\n\t};\r\n\tlet ieCnt = 0;\r\n\tlet ieLoads = [];\r\n\tlet ieCurCallback;\r\n\tlet createIeLoad = function(url, mthis, inverse) {\r\n\t\tcurSheet.addImport(url);\r\n\t\tcurStyle.onload = function() {\r\n\t\t\tprocessIeLoad(mthis, inverse);\r\n\t\t};\r\n\r\n\t\tieCnt++;\r\n\t\tif(ieCnt == 31) {\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\t\t\tieCnt = 0;\r\n\t\t}\r\n\t};\r\n\tlet processIeLoad = function(mthis, inverse) {\r\n\t\tieCurCallback();\r\n\t\tlet nextLoad = ieLoads.shift();\r\n\t\tif(!nextLoad) {\r\n\t\t\tieCurCallback = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tieCurCallback = nextLoad[1];\r\n\t\tcreateIeLoad(nextLoad[0], mthis, inverse);\r\n\t};\r\n\tlet importLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif(!curSheet || !curSheet.addImport)\r\n\t\t\tcreateStyle(mthis, inverse);\r\n\r\n\t\tif(curSheet && curSheet.addImport) {\r\n\t\t\tif(ieCurCallback) {\r\n\t\t\t\tieLoads.push([url, callback]);\r\n\t\t\t} else {\r\n\t\t\t\tcreateIeLoad(url, mthis, inverse);\r\n\t\t\t\tieCurCallback = callback;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcurStyle.sheet.cssRules;\r\n\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t};\r\n\tlet linkLoad = function(url, callback, mthis, inverse) {\r\n\t\tcallback = callback || function() {};\r\n\t\tlet link = document.createElement('link');\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tif(useOnload)\r\n\t\t\tlink.onload = function() {\r\n\t\t\t\tlink.onload = function() {};\r\n\t\t\t\tsetTimeout(callback, 7);\r\n\t\t\t};\r\n\t\telse {\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\tlet sheet = document.styleSheets[i];\r\n\t\t\t\t\tif(sheet.href == link.href) {\r\n\t\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\t\treturn callback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t\tlink.href = url;\r\n\t\tappendCssDom(link, mthis, inverse);\r\n\t};\r\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\r\n\t\tlet inverse = !(config.plugins.css && config.plugins.css.inverse === false); //默认逆向\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\t//\t\tconsole.log(\"cssId=\"+cssId+\",cssSrc=\"+this.invoker().getUrl(cssId, true)+\",absUrl=\"+this.invoker().absUrl());\r\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload, this, inverse);\r\n\t};\r\n\tcssAPI.getCacheKey = function(cssId) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\tlet invoker = this.invoker();\r\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\r\n\t};\r\n\tcssAPI.loadCss = function(cssPath, callback) {\r\n\t\t(useImportLoad ? importLoad : linkLoad)(L.getUrl(cssPath), callback);\r\n\t};\r\n\r\n\tcssAPI.loadCsses = function() {\r\n\t\tlet args = arguments;\r\n\t\tfor(let i = 0; i < args.length; i++) {\r\n\t\t\t(useImportLoad ? importLoad : linkLoad)(L.getUrl(args[i]), null);\r\n\t\t}\r\n\t};\r\n\treturn cssAPI;\r\n});","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\nL.define(\"text\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"text\")\r\n\t\t\t.ok(function(text) {\r\n\t\t\t\tonload(text);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t},\r\n\tdealPluginArgs(pluginArgs) {\r\n\t\treturn pluginArgs;\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n/**\r\n * 格式：window!varNameInWindow=>>modulePath\r\n */\r\n//window插件,用于添加模块到window对象中\r\nL.define(\"window\", {\r\n\tisSingle: true,\r\n\tpluginMain: function(arg, onload, onerror, config, http) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif (index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\twindow[moduleName] = mod;\r\n\t\t\tonload(mod);\r\n\t\t}).setTag(`window!${arg}`);\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n/**\r\n * 格式:withdeps!modulePath=>>[deps]\r\n */\r\nL.define(\"withdeps\", {\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif (index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet depsStr = arg.substring(index + 3);\r\n\t\tlet deps;\r\n\t\ttry {\r\n\t\t\tdeps = L.xsParseJson(depsStr);\r\n\t\t\tif (!L.isArray(deps)) {\r\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tonerror(\"deps error:\" + depsStr);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.invoker().withAbsUrl().require([\r\n\t\t\t[false].concat(deps), moduleName\r\n\t\t], function(_deps, mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\torderDep: true\r\n\t\t}).setTag(`withdeps!${arg}`);\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 加载json对象\r\n */\r\nL.define(\"json\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"json\")\r\n\t\t\t.ok(function(json) {\r\n\t\t\t\tonload(json);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t},\r\n\tdealPluginArgs(pluginArgs) {\r\n\t\treturn pluginArgs;\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 用于图片加载\r\n */\r\nL.define(\"image\", {\r\n\tpluginMain(name, onload, onerror, config) {\r\n\t\tlet src = this.invoker().getUrl(name, false);\r\n\t\tlet img = new Image();\r\n\t\tlet callback = (ok) => {\r\n\t\t\tlet image = img;\r\n\t\t\timg = null;\r\n\t\t\timage.onload = null;\r\n\t\t\timage.οnerrοr = null;\r\n\t\t\tonload(ok ? image : null);\r\n\t\t};\r\n\t\timg.onload = function() {\r\n\t\t\tcallback(true);\r\n\t\t};\r\n\t\timg.οnerrοr = function() {\r\n\t\t\tcallback(false);\r\n\t\t};\r\n\t\timg.src = src;\r\n\t\tL.asyncCall(() => {\r\n\t\t\tif (img) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (img) {\r\n\t\t\t\t\t\tcallback(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, config.plugins.image.timeout);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tdealPluginArgs(pluginArgs) {\r\n\t\treturn pluginArgs;\r\n\t},\r\n});\r\n","import U from \"../../util/index.js\";\r\nconst L = U.global.xsloader;\r\n\r\n/**\r\n * 格式:default!module\r\n */\r\nL.define(\"default\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tlet handle = this.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tif (L.isObject(mod)) {\r\n\t\t\t\tif (\"default\" in mod) {\r\n\t\t\t\t\tmod = mod[\"default\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (mod === undefined) {\r\n\t\t\t\t\tmod = null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmod = null;\r\n\t\t\t}\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(err, invoker) {\r\n\t\t\tonerror(err);\r\n\t\t}).setTag(`default!${arg}`);\r\n\t},\r\n});\r\n","// 静态资源服务\r\nimport U from \"./util/index.js\";\r\n\r\nconst G = U.global;\r\nconst L = G.xsloader;\r\n\r\nconst http = G._xshttp_request_;\r\nconst DATA_CONF = \"data-conf\",\r\n\tDATA_CONFX = \"data-xsloader-conf\";\r\nconst DATA_CONF2 = \"data-conf2\",\r\n\tDATA_CONF2X = \"data-xsloader-conf2\";\r\nconst DATA_MAIN = \"data-main\",\r\n\tDATA_MAINX = \"data-xsloader-main\";\r\nconst DATA_CONF_TYPE = \"data-conf-type\";\r\n\r\nlet serviceConfigUrl;\r\nlet dataConf = L.script().getAttribute(DATA_CONF) || L.script().getAttribute(DATA_CONFX);\r\nlet dataMain = L.script().getAttribute(DATA_MAIN) || L.script().getAttribute(DATA_MAINX);\r\nlet dataConfType = L.script().getAttribute(DATA_CONF_TYPE);\r\nif (dataConfType !== \"json\" && dataConfType != \"js\") {\r\n\tdataConfType = \"auto\";\r\n}\r\n\r\nlet initFun = () => {\r\n\tfunction getMainPath(config) {\r\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\r\n\t\tlet path = location.pathname;\r\n\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tlet name = path.substring(index + 1);\r\n\t\tif (name === \"\") {\r\n\t\t\tname = \"index\";\r\n\t\t}\r\n\t\tif (L.endsWith(name, \".html\")) {\r\n\t\t\tname = name.substring(0, name.length - 5);\r\n\t\t}\r\n\t\tif (!mainPath) {\r\n\t\t\tmainPath = \"./main/{name}.js\";\r\n\t\t}\r\n\t\tmainPath = mainPath.replace(\"{name}\", name);\r\n\t\treturn mainPath;\r\n\t}\r\n\r\n\tfunction extendConfig(config) {\r\n\t\tconfig = L.extendDeep({\r\n\t\t\tproperties: {},\r\n\t\t\tmain: {\r\n\t\t\t\tgetPath() {\r\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\r\n\t\t\t\t},\r\n\t\t\t\tname: \"main\",\r\n\t\t\t\tlocalConfigVar: \"lconfig\",\r\n\t\t\t\tglobalConfigVar: \"gconfig\",\r\n\t\t\t\tbefore(name) {\r\n\t\t\t\t\tconsole.log(\"before:\" + name);\r\n\t\t\t\t},\r\n\t\t\t\tafter(name) {\r\n\t\t\t\t\tconsole.log(\"after:\" + name);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tservice: {\r\n\t\t\t\thasGlobal: false,\r\n\t\t\t\tresUrls: []\r\n\t\t\t},\r\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\r\n\t\t\t\treturn \"default\";\r\n\t\t\t},\r\n\t\t\tloader: {\r\n\t\t\t\t\"default\": {\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config);\r\n\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\r\n\t\thttp({\r\n\t\t\turl: url,\r\n\t\t\tmethod: \"get\",\r\n\t\t\ttimeout: 20000,\r\n\t\t\thandleType: \"text\",\r\n\t\t\tok(confText) {\r\n\r\n\t\t\t\tlet conf;\r\n\t\t\t\tif (dataConfType == \"js\") {\r\n\t\t\t\t\tconf = L.xsEval(confText);\r\n\t\t\t\t} else if (dataConfType == \"json\") {\r\n\t\t\t\t\tconf = L.xsParseJson(confText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (L.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\r\n\t\t\t\t\t\t//同域则默认用脚本解析\r\n\t\t\t\t\t\tconf = L.xsEval(confText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconf = L.xsParseJson(confText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconf = extendConfig(conf);\r\n\t\t\t\tif (conf.beforeDealProperties) {\r\n\t\t\t\t\tconf.beforeDealProperties();\r\n\t\t\t\t}\r\n\t\t\t\tconf = L.dealProperties(conf, conf.properties); //参数处理\r\n\r\n\t\t\t\tif (isLocal && conf.service.hasGlobal) {\r\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\r\n\t\t\t\t\t\tfunction(globalConfig) {\r\n\t\t\t\t\t\t\tlet localConfig = conf;\r\n\t\t\t\t\t\t\tG[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\r\n\t\t\t\t\t\t\tG[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\r\n\r\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\r\n\r\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\r\n\t\t\t\t\t\t\tlet conf;\r\n\t\t\t\t\t\t\tlet loader;\r\n\t\t\t\t\t\t\tif (loaderName != null) {\r\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = U.getPathWithRelative(location.href, getMainPath(globalConfig));\r\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = globalConfig;\r\n\t\t\t\t\t\t\t\tif (loader) {\r\n\t\t\t\t\t\t\t\t\tglobalConfig.current = loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!loader) {\r\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = U.getPathWithRelative(location.href, getMainPath(localConfig));\r\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = localConfig;\r\n\t\t\t\t\t\t\t\tif (loader) {\r\n\t\t\t\t\t\t\t\t\tlocalConfig.current = loaderName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!loader) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(conf);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\r\n\t\t\t}\r\n\t\t}).done();\r\n\t}\r\n\r\n\tfunction startLoad() {\r\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\r\n\t\t\tG[localConfig.main.localConfigVar] = localConfig;\r\n\r\n\t\t\tlet mainName = localConfig.main.name;\r\n\r\n\t\t\tlet href = location.href;\r\n\t\t\tlet index = href.lastIndexOf(\"?\");\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\thref = href.substring(0, index);\r\n\t\t\t}\r\n\r\n\t\t\tlet mainPath = getMainPath(localConfig);\r\n\r\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? U.getPathWithRelative(href, mainPath) : mainPath;\r\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\r\n\t\t\tlet loader = localConfig.loader[loaderName];\r\n\t\t\tif (!loader) {\r\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlocalConfig.current = loaderName;\r\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\r\n\t\tlet resUrls = [];\r\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\r\n\r\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\r\n\r\n\t\tL.resUrlBuilder = function(groupModule) {\r\n\t\t\tlet as = [];\r\n\t\t\tU.each(resUrls, function(url) {\r\n\t\t\t\tas.push(L.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\r\n\t\t\t});\r\n\t\t\treturn as;\r\n\t\t};\r\n\t\tloader.ignoreProperties = true;\r\n\t\tloader.defineFunction = loader.defineFunction || {};\r\n\t\tloader.depsPaths = loader.depsPaths || {};\r\n\r\n\t\tif (L.endsWith(location.pathname, \".htmv\")) { //用于支持htmv\r\n\t\t\tif (G.__htmv_init_bridge_) {\r\n\t\t\t\tG.__htmv_init_bridge_();\r\n\t\t\t}\r\n\t\t\tmainName = \"htmv-main\";\r\n\t\t\tloader.depsPaths[mainName] = location.href; //让其依赖*中的所有依赖\r\n\t\t\tL(loader);\r\n\t\t} else if (mainPath.indexOf(\"!\") != -1) { //插件调用\r\n\t\t\tlet theConfig = L(loader);\r\n\r\n\t\t\tmainName = \"_plugin_main_\";\r\n\t\t\tlet deps = [];\r\n\t\t\tif (theConfig.deps) { //手动添加*依赖\r\n\t\t\t\tif (theConfig.deps[\"*\"]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\r\n\t\t\t\t}\r\n\t\t\t\tif (theConfig.deps[mainName]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdeps.push(mainPath);\r\n\t\t\tL.define(mainName, deps, function() {\r\n\r\n\t\t\t}).then({\r\n\t\t\t\tabsUrl: pageHref\r\n\t\t\t});\r\n\t\t} else if (!L.hasDefine(mainName)) {\r\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\r\n\t\t\tL(loader);\r\n\t\t} else {\r\n\t\t\tL(loader);\r\n\t\t}\r\n\r\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\r\n\t\t\tif (L.isFunction(conf.main.before)) {\r\n\t\t\t\tconf.main.before.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\r\n\r\n\t\t\tif (L.isFunction(conf.main.after)) {\r\n\t\t\t\tconf.main.after.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\treturn rt;\r\n\t\t};\r\n\t\tL.require([mainName], function(main) {\r\n\t\t\t//console.log(main);\r\n\t\t}).error((err, invoker) => {\r\n\t\t\tif (invoker) {\r\n\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\r\n\t\t\t}\r\n\t\t\tconsole.error(\"invoke main err:\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\r\n\t}\r\n\tL.asyncCall(startLoad, true);\r\n};\r\n\r\nif (dataConf) {\r\n\tserviceConfigUrl = U.getPathWithRelative(location.href, dataConf);\r\n} else if ((dataConf = (L.script().getAttribute(DATA_CONF2) || L.script().getAttribute(DATA_CONF2X)))) {\r\n\tserviceConfigUrl = U.getPathWithRelative(L.scriptSrc(), dataConf);\r\n} else {\r\n\tinitFun = null;\r\n}\r\ninitFun && initFun();\r\n","import \"./core/index.js\";\r\nimport \"./define.js\";\r\nimport \"./core/lib/index.js\";\r\nimport \"./core/plugins/index.js\";\r\nimport \"./service.js\";\r\nimport U from \"./util/index.js\";\r\nU.loaderEnd();"],"names":["G","window","undefined","self","global","Error","loaderFun","xsloader","apply","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","L","isJsFile","path","isString","indexOf","pluginIndex","substring","index","theConfig","config","jsExts","i","length","endsWith","ext","dealPathMayAbsolute","currentUrl","rs","exec","finalPath","absolute","protocol","_protocol","location","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","str","push","result","join","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","href","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","string","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","call","replaceModulePrefix","deps","m","pluginParam","query","is","autoExt","test","autoExtSuffix","startsWith","modulePrefixCount","modulePrefix","replaceStr","replace","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","thePageUrl","COMMENT_REGEXP","REPLACE_REQUIRE_GET_REGEXP","REPLACE_REQUIRE_REGEXP","NOT_REQUIRE_REGEXP","InVar","val","get","set","newVal","old","GraphPath","pathEdges","vertexMap","depMap","addEdge","begin","end","hasDep","name","tryAddEdge","paths","hasLoop","visited","recursionStack","checkLoop","v","edges","edge","strValue2Arr","each","ary","func","isSync","fromEnd","handle","__commentReplace","match","singlePrefix","__appendInnerDeps","callbackString","reg","depIndex","notIndex","indexInArray","appendInnerDeps","callback","innerDepType","props","toString","idCount","getAndIncIdCount","PluginError","err","invoker","extra","unwrapError","n","isXsLoaderEnd","IE_VERSION","getIEVersion","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","isEmptyObject","k","graphPath","loaderEnd","isLoaderEnd","whichTransitionEvent","t","el","createElement","transitions","style","transitionEvent","ToProgress","opt","progress","options","id","color","bgColor","height","duration","key","opacityDuration","progressBar","container","setCSS","appendChild","body","prototype","setColor","backgroundColor","_isAuto","_timer","stopAuto","clearInterval","autoIncrement","time","dt","step","setInterval","setProgress","toError","errColor","transit","width","getProgress","show","increase","toBeIncreasedProgress","decrease","toBeDecreasedProgress","finish","setTimeout","hide","parentNode","removeChild","reset","opacity","display","Base64","_keyStr","encode","input","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","_utf8_encode","charCodeAt","isNaN","charAt","decode","String","fromCharCode","_utf8_decode","utftext","c","c2","c3","urls","base","loading","base64","U","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArrayFrom","JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","f","this_value","valueOf","Date","toJSON","isFinite","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","gap","indent","meta","rep","quote","lastIndex","a","slice","holder","mind","partial","value","Object","hasOwnProperty","stringify","replacer","space","parse","text","reviver","j","walk","eval","SyntaxError","proxyPolyfill","lastRevokeFn","ProxyPolyfill","o","target","handler","TypeError","throwRevoked","trap","unsafeHandler","proxy","isMethod","usingNew","constructor","args","unshift","getter","prop","setter","status","propertyNames","getOwnPropertyNames","Promise","__proto__","forEach","propertyMap","real","getOwnPropertyDescriptor","desc","enumerable","defineProperty","prototypeOk","setPrototypeOf","getPrototypeOf","seal","revocable","p","polyfillInit","ProxyUtil","Proxy","trim","randId","suffix","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","fn","jsonObj","xsJSON","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","search","ret","seg","s","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","domAttr","dom","attr","queryString2ParamsMap","ostring","it","isDate","isRegExp","isEmpty","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","baseUrl","dealUrl","getUrl2","tryCall","defaultReturn","exCallback","dealProperties","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","initCtrlCallback","callbackObj","mineCount","ctrlCallback","asyncCallQueue","shift","lastReturn","nextCallback","nextObj","pushTask","next","resolve","then","queue","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","clone","isDeep","source","flags","copy","setTime","sortObject","keys","newObj","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","removeListener","ready","addEventListener","removeEventListener","attachEvent","readyState","detachEvent","fun2","documentElement","doScroll","frameElement","readyCall","onReady","br","addEventHandle","remove","type","env","version","toGlobal","deprecated","justLoader","funs","browser","ignoreAspect_","theDefinedMap","lastDefinObjectMap","__showModules","ModuleDef","isPreDependOn","defaultModule","modules","_preModule","_preIndex","targetDef","preDependModule","relyQueue","relyIt","module","_isSrc","nameOrUrl","isSrc","setLastDefineObject","defineObject","getLastDefineObject","appendLoadingModuleDeps","moduleDef","mod","state","_deps","pushName","selfname","getModule","ifoneThenGet","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","newModuleInstance","thatInvoker","relyCallback","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","exports","_dealPluginArgs","pluginArgs","dealPluginArgs","argArr","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","initInstance","justForSingle","originPluginArgs","dealInstance","hasFinished","onload","__default","onerror","last","concat","pluginMain","waitSeconds","moduleMap","scriptSrc","absUrl","getName","Invoker","_preNewModule","DefineObject","ignoreCurrentRequireDep","appendConfigDepsAndEmbedDeps","newModule","instances","parent","parentDefine","relys","absUrlFromModule","absUrlFromDefineObject","getCallback","_dealApplyArgs","_loadCallback","reinitByDefineObject","newDefineObject","setInstanceType","_singlePluginResult","currentDefineModuleQueue","setState","isDefault","errinfo","_callback","_state","theCallback","depModule","getDeps","require","defined_module_for_deps","refmodule","toOtherModule","otherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","genErrs","infos","nodePaths","logedPathMap","leaf","reverse","as","errModule","getState","depMod","indexPlguin","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","hasCallErr","theExports","depCount","depModules","invoker_of_module","checkFinish","dep_name","syncHandle","isFinish","customerResult","ignoreErrState","onGetModule","originDep","relyItFun","dmod","onFinish","i1","i2","i3","groupModule","defaultVersion","_url","resUrlBuilder","isInUrls","getUrls","rurl","loadModule","module2","loadScript","scriptData","defaultMod","lastModule","m2Name","configDeps","d","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","ua","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","theHead","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastSrc","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","Handle","onError","ThisInvoker","_buildInvoker","getId","forArgsUrl","getUrlArgs","h","define","defineAsync","withAbsUrl","absUrlStr","_im","_id","getMineInvoker","getInvoker","nullNew","parentModule","isRequire","_scriptSrc","_src","_directDepLength","directDepLength","names","__ignoreCurrentRequireDep","before","depBefore","depDeps","absoluteUrl","instance","odeps","replaceDepAlias","hasOrderDep","applyArgs","jsFilePath","moduleLoop","hasCurrentPath","getCurrentScript","_getCurrentScriptOrSrc","b","sourceURL","stacktrace","__src","__currentPath","srcBeforeCurrentPath","setAttribute","__createNode","charset","async","__removeListener","ieName","__browserLoader","moduleName","useAttach","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","isFirstRequire","prerequire","mineInvoker","oneDep","theMod","timeid","tagString","isOk","customerErrCallback","isErr","plugins","enable","delay","clearTimer","clearTimeout","waitTime","logError","logFun","checkResultFun","forTimeout","ifmodule","setTag","tag","promise","inject","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","putUrlArgs","argsObj","clearUrlArgs","hasDefine","hasDefined","groupName","clear_module_","_newContext","context","contextName","defQueue","loader","pathname","ignoreProperties","depsPaths","aliasPaths","defineFunction","autoUrlArgs","dealtDeps","splice","addVersion","newUrlArgs","newUrl","urlArg","forPrefixSuffix","encodeURIComponent","dealUrlArgs","image","timeout","xsmsg","sleep","ifmsg","connTimeout","sleepTimeout","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","onModuleLoaded","lastDefineObject","moduleBeforeCurrentPath","needCallback","depModuleArgs","amd","progIds","httpRequest","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","okCallback","ok","failCallback","fail","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","createXhr","xhr","progId","XMLHttpRequest","ActiveXObject","conn","_conn","toUpperCase","headers","handleType","multiPart","_connAfterOpenHook","_doOnFailResponseHook","extraErr","formData","FormData","append","File","Blob","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","timeoutTimer","isTimeout","abort","onreadystatechange","responseText","send","requestObj","urlStr","methodStr","isAsync","paramsObj","headersObj","handleAs","done","extraErrorType","_xshttp_request_","http","Request","reject","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","current","insert","position","pNode","elementAt","getElement","willRemove","currentNode","nextCurrentNode","eachForRemove","removeAt","find","size","api","linkedList","initPostMessageBridge","postMessageBridge","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","listen","cmd","conndata","connectingSource","isActive","_onConned","_onMsg","_onResponse","_onElse","listener","osource","active","refused","instanceid","data","msgid","_sendData","sendConn","sendResponse","handleConn","fromSource","originStr","oinstanceid","listeners","Callback","isAccept","msg","origin","handleAccept","minstanceid","handleBinded","checkSource","handleConned","handleMsg","handleResponse","postMessage","event","rdata","runAfter","CommunicationUnit","onfailed","msgQueue","SLEEP","starttime","isFailed","isConnected","isCanceled","handleId","onConnectedListener","onReceiveListener","sendTop","release","couldChat","_source","initListen","initActively","checkPassively","setSource","_connectWindow","winObjOrCallback","notActive","gconfig","connected","mine","errtype","connectedCallback","receiveCallback","unit","sender","winObj","_connectIFrame","iframe","getElementById","contentWindow","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","hasRegVnodex","__renderJsx","vm","component","$createElement","Vue","children","regVnodex","requiredVue","required","render","$listeners","$attrs","wrapProps","on","Comp","content","innerText","getDefine","getRequire","renderJsx","getVueCompiler","_default","template","group","regResult","res","compile","staticRenderFns","getVtemplate","vtemplate","comp","getImporter","getStyleBuilder","cssContent","styleDom","innerHTML","init","destroy","decodeBase64","base64Content","CONNS_MAP","DEBUG_OPTION","logMessage","Debug","currentTimemillis","clearRunAfter","timer","destroyTimer","startTimer","clients","checkHeart","selfclients","doSendMessage","isserver","__ifmsg","client","MESSAGE_LISTENER","fromid","toid","mdata","server","_createTime","Client","_conntimeout","_connTimeout","_sleeptimeout","_sleepTimeout","onConnect","gotConnectingFail","gotConnect","gotMessage","close","gotHeart","invoke","autoClosablesOnWindowClose","closable","getUnloadData","autoCloseOnWindowClose","Base","_cmd","isself","_origin","_fromid","_connect","_connected","_destroyed","_onConnect","_onConnectFail","_rtimer","_starttime","_failed","_heartTimeout","_heartTime","_lastSendHeartTime","_lastReceiveHeartTime","_onHeartTimeout","_onUnload","_onClosed","_onMessage","_onConnected","destroyed","connect","_onConnectTimeout","checkClientConnected","onConn","errOrConndata","gotConnected","onConnected","sendClosed","closeMessage","recvMessage","closeBase","onHeartTimeout","onUnload","onClosed","onMessage","Server","singleMode","_start","onConnectTimeout","IfmsgServer","IfmsgClient","onConnectFail","sendMessage","depId","depsObj","newInvoker","TryModule","arg","tryModule","vars","moduleNames","existsMods","newName","lastM","info","lastDom","Node","_maxindex","_minindex","doms","anchorDom","engine","useImportLoad","useOnload","cssAPI","cssIndex","rootNodes","domIndex","previousSibling","buildAndGetNode","mthiz","pnode","getChild","addChild","appendCssDom","cssThis","inverse","mthis","getIndex","findAnchor","curStyle","curSheet","createStyle","styleSheet","sheet","ieCnt","ieLoads","ieCurCallback","createIeLoad","addImport","processIeLoad","nextLoad","importLoad","textContent","loadInterval","cssRules","linkLoad","link","rel","styleSheets","cssId","css","loadCss","cssPath","loadCsses","depsStr","json","img","Image","οnerrοr","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","extendConfig","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","loadServiceConfig","isLocal","confText","conf","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","startLoad","pageHref","resUrl","__htmv_init_bridge_","originThis","originArgs"],"mappings":"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"}